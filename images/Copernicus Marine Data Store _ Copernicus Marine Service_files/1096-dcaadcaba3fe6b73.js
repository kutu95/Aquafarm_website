!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="bec8580b-afa6-4bfb-8dbc-a4aba05f788c",e._sentryDebugIdIdentifier="sentry-dbid-bec8580b-afa6-4bfb-8dbc-a4aba05f788c")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1096],{71096:(e,t,a)=>{a.d(t,{A:()=>s2});var s=a(31085),i=a(93243),n=a.n(i),l=a(14041),r=a(31242),o=a(99870),c=a.n(o),d=a(70541),h=a(99420),u=a.n(h),p=a(18798),x=a(81864),m=a(55065),f=a(49608),b=a(77226),g=a(7859),j=a(94631),v=a(83832),_=a(53432),y=a(82989),w=a(7350),k=a.n(w),M=a(50086),N=a(98461),S=a(24626),I=a(238),A=a(24230),C=a(77118),D=a(96944),T=a(2990),L=a(1216),E=a(68198),O=a(75791);let P=155*Math.PI/180,z=[255,255,255],F=(e,t,a,s)=>{var i,n,l;let{datasets:r,mapLayers:o,settings:c,isEditingThumbnail:d}=s,h=o[a],u=(0,f.VF)(r,h.layerId);if(!u)return;let{tzDataset:p}=u;if(!p)return;let x=t[a];if(h._subsetReqs.some(e=>null==e))return;let b=h._subsets;if(b.some(e=>null==e))return;let g=U(h,u,b,p,s),j=R(g),v=null!==(n=h.opacity)&&void 0!==n?n:m.UI.defaultLayerOpacity,_=d?c.thumbnailBasemap:c.basemap,y=null===(i=m.BASEMAPS[_])||void 0===i?void 0:i.tileSpecMaskLand,w=null==y?void 0:y.id;if(x&&"zarr"===x.subtype&&h===x.tileSpec.renderProps.layer&&j===x.tileSpec.id&&w===(null===(l=x.tileSpecMask)||void 0===l?void 0:l.id)){e[a]=x;return}if(!x||"zarr"!==x.subtype){x={id:a,type:"tiles",subtype:"zarr",tileSpec:{id:j,url:"#{crs}/{z}/{x}/{y}{resolution}",render:B,renderProps:g,resolutionMax:3},tileSpecMask:y,opacity:v},e[a]=x;return}x=(0,S.mergeIn)(x,["tileSpec"],{id:j,render:B,renderProps:g}),x=(0,S.merge)(x,{opacity:v,tileSpecMask:y}),y||(x=(0,S.omit)(x,"tileSpecMask")),e[a]=x},U=(e,t,a,s,i)=>{let{settings:n}=i,l=s.variables[t.variableId],r=(0,f.WV)(e,t,n),{colormapId:o,colormapInvert:c,colormapStops:d}=r,h=(0,E.Co)(o,c,d);return{dataset:s,variable:l,subsets:a,layer:e,layerSpec:t,settings:n,...r,colormap:h}},R=e=>{var t;let{threshold:a}=e;return[e.subsets.map(e=>e.id).join("."),e.valueClamp,e.valueMin,e.valueMax,e.logScale,(0,L.nG)(a),String(e.styleSolid),String(e.styleParticles),String(e.styleVectors),String(e.styleHatched),e.colormapId,e.colormapInvert,(null!==(t=e.colormapStops)&&void 0!==t?t:[]).join("-")].join(".")},B=async(e,t)=>{let{subsets:a,layerSpec:s}=t;if(0===a.length)return;for(let e=0;e<a.length;e++)if(null==a[e])return;let{strides:i,dimIds:n,dims:l}=a[0],r=n.indexOf(m.DIM_LONGITUDE),o=n.indexOf(m.DIM_LATITUDE);if(r<0)throw Error("Could not find longitude dimension in subset");if(o<0)throw Error("Could not find latitude dimension in subset");let c=l[m.DIM_LONGITUDE].coords.values,d=l[m.DIM_LATITUDE].coords.values;await (0,T.c)(20*Math.random());let h=a[0].data,u=null,p="none";if(s.vectorComponentIds){let e=a[1];u=e.data,p="norm";let t=e.dims;V(c,d,t[m.DIM_LONGITUDE].coords.values,t[m.DIM_LATITUDE].coords.values)}let{styleSolid:x,styleVectors:f}=t;if(x){if(s.flagColormap)await (0,D.canvasRenderTile)(e,{lons:c,lats:d,colorForIdxs:H(h,i,r,o,t,"raw"),colorStrForIdxs:H(h,i,r,o,t,"str"),debugDrawTileBorder:m.DEBUG.showTileBorders,debugDrawTileCoords:m.DEBUG.showTileLabels,debugProfile:m.DEBUG.profileRasterTiles});else{let{raw:a,str:s}=t.colormap;await (0,D.canvasRenderTile)(e,{lons:c,lats:d,colorForIdxs:W(h,u,p,i,r,o,t,a),colorStrForIdxs:W(h,u,p,i,r,o,t,s),debugDrawTileBorder:m.DEBUG.showTileBorders,debugDrawTileCoords:m.DEBUG.showTileLabels,debugProfile:m.DEBUG.profileRasterTiles})}}if(t.threshold){let a=document.createElement("canvas");a.width=e.tileSize,a.height=e.tileSize;let s=a.getContext("2d"),n=(0,S.set)(e,"ctx",s),l="norm"===p?"norm-threshold":"threshold";await (0,D.canvasRenderTile)(n,{lons:c,lats:d,colorForIdxs:W(h,u,l,i,r,o,t,[z]),colorStrForIdxs:W(h,u,l,i,r,o,t,["rgb(255, 255, 255)"])}),s.globalCompositeOperation="source-in",s.fillStyle=await (0,O.$)(e.tileReq.resolution),s.fillRect(0,0,e.tileSize,e.tileSize),e.ctx.drawImage(a,0,0)}if(f){let{str:a,brightnessType:s}=t.colormap;G(e,h,u,c,d,i,r,o,t,x?$(s):e=>a[e])}},V=(e,t,a,s)=>{if(a[0]!==e[0]||a[a.length-1]!==e[e.length-1])throw Error("Longitude mismatch");if(s[0]!==t[0]||s[s.length-1]!==t[t.length-1])throw Error("Latitude mismatch")},G=(e,t,a,s,i,n,l,r,o,c)=>{let d,h;let{ctx:u,tileReq:x,tileSize:m,crsSpec:b}=e,{resolution:g}=x,{valueClamp:j,logScale:v,styleSolid:_}=o,{valueMin:y,valueMax:w}=(0,f.$9)(o),{isNorthPolar:k,isSouthPolar:M}=b,N=(0,p.getWgs84ToTilePixelProjection)(b,x);if(k||M){let e=N(k?[0,90]:[0,-90]);d=e[0],h=e[1]}let S=m/22,I=.4*S,A=.24*S,C=E.Yo,D=s.length,T=i.length,L=s[0],O=i[0],z=s[D-1],F=i[T-1],U=(z-L)/(D-1),R=(F-O)/(T-1);u.lineWidth=_?1:1.5*g;for(let e=S/2;e<m;e+=S)for(let s=S/2;s<m;s+=S){let i=N.invert([s,e]);if(!i)continue;let[o,p]=i,x=Math.round((o-L)/U),m=Math.round((p-O)/R);if(x<0||m<0||x>=D||m>=T)continue;let f=t[x*n[l]+m*n[r]];if(f!=f||null==f)continue;let b=a[x*n[l]+m*n[r]];if(b!=b||null==b||0===f&&0===b)continue;let g=Math.sqrt(f*f+b*b);if(v&&(g=Math.log10(g)),g<y){if(!j)continue;g=y}if(g>w){if(!j)continue;g=w}let _=(g-y)/(w-y),S=Math.floor(_*C);S>=C&&(S=C-1);let E=c(S),z=Math.atan2(b,f);k?z-=Math.atan2(h-e,d-s)+Math.PI/2:M&&(z-=Math.atan2(h-e,d-s)-Math.PI/2);let F=_>.02?I:I/2,B=Math.cos(z)*F,V=-Math.sin(z)*F,G=s-B,W=e-V,H=s+B,$=e+V,q=H+Math.cos(z+P)*A,Z=$-Math.sin(z+P)*A,Y=H+Math.cos(z-P)*A,J=$-Math.sin(z-P)*A;u.beginPath(),u.strokeStyle=E,u.moveTo(G,W),u.lineTo(H,$),u.lineTo(q,Z),u.lineTo(H,$),u.lineTo(Y,J),u.stroke()}},W=(e,t,a,s,i,n,l,r)=>{let{valueClamp:o,logScale:c,threshold:d}=l,{valueMin:h,valueMax:u}=(0,f.$9)(l),p=h===u,x=r.length,m="norm"===a||"norm-threshold"===a,b="threshold"===a||"norm-threshold"===a;return(a,l)=>{let f=e[a*s[i]+l*s[n]];if(f!=f||null==f)return null;if(m&&null!=t){let e=t[a*s[i]+l*s[n]];if(e!=e||null==e)return null;m&&(f=Math.sqrt(f*f+e*e))}if(b)return d&&(0,L.bF)(d,f)?r[0]:null;if(c&&(f=Math.log10(f)),f<h){if(!o)return null;f=h}if(f>u){if(!o)return null;f=u}let g=Math.floor((p?.5:(f-h)/(u-h))*x);return g>=x&&(g=x-1),r[g]}},H=(e,t,a,s,i,n)=>{let l=i.layerSpec.flagColormap[n];return(i,n)=>{let r=e[i*t[a]+n*t[s]];return r!=r||null==r?null:l[r]}},$=e=>"centerLight"===e?e=>"rgba(".concat(e>=64&&e<=192?[0,0,0]:[255,255,255],", ").concat(.8,")"):"centerDark"===e?e=>"rgba(".concat(e>=64&&e<=192?[255,255,255]:[0,0,0],", ").concat(.8,")"):"darkToLight"===e?e=>"rgba(".concat(e>=128?[0,0,0]:[255,255,255],", ").concat(.8,")"):"lightToDark"===e?e=>"rgba(".concat(e<=128?[0,0,0]:[255,255,255],", ").concat(.8,")"):e=>"rgba(0, 0, 0, ".concat(.8,")");var q=a(4591);let Z=(e,t,a,s)=>{var i,n;let{datasets:l,mapLayers:r}=s,o=r[a],c=(0,f.VF)(l,o.layerId);if(!c)return;let d=o._subsets.filter(e=>!!(null==e?void 0:e.isSparse)),h=Y(o,c,d,s),u=J(h),p=t[a];if(p&&"sqlite"===p.subtype&&(null===(i=p.tileSpec.renderProps)||void 0===i?void 0:i.layer)===o&&p.tileSpec.id===u){e[a]=p;return}let x={id:a,type:"tiles",subtype:"sqlite",tileSpec:{id:u,url:"#{crs}/{z}/{x}/{y}{resolution}",render:K,renderProps:h},opacity:null!==(n=o.opacity)&&void 0!==n?n:m.UI.defaultLayerOpacity};e[a]=x},Y=(e,t,a,s)=>{let i=(0,f.WV)(e,t,s.settings),{colormapId:n,colormapInvert:l,colormapStops:r}=i;return{layer:e,layerSpec:t,layerProps:i,subsets:a,colormap:(0,E.Co)(n,l,r),isEditingThumbnail:s.isEditingThumbnail}},J=e=>{var t,a;let{threshold:s}=e.layerProps;return[e.subsets.map(e=>{let{id:t}=e;return t}).join("."),null!==(t=e.layer._clientVersion)&&void 0!==t?t:0,e.layerProps.valueClamp,e.layerProps.valueMin,e.layerProps.valueMax,e.layerProps.logScale,(0,L.nG)(s),String(e.layerProps.styleSolid),String(e.layerProps.styleParticles),String(e.layerProps.styleVectors),String(e.layerProps.styleHatched),e.colormap.id,e.layerProps.colormapInvert,(null!==(a=e.layerProps.colormapStops)&&void 0!==a?a:[]).join("-"),Object.keys(e.layerProps.hiddenSparsePtypes).join("-"),String(e.isEditingThumbnail)].join(".")},K=async(e,t)=>{let{crsSpec:a,tileReq:s,tileSize:i,ctx:n}=e,{layerSpec:l,layerProps:r}=t,{hiddenSparsePtypes:o,threshold:c}=r,{subsets:d,colormap:h,isEditingThumbnail:u}=t,x=(0,p.getWgs84ToTilePixelProjection)(a,s),f=2.5*s.resolution,b=f*(1+(u?l.isAltimetry?.3:-.55:1.8)),g=.4*f,j=.4*f,v=b+j/2,_=b+j,y=0,{x:w,z:k}=s;if(a.isCylindrical){let e=w===a.level0numTilesX*2**k-1;if(0===w||e){let t=x([-180,0])[0],a=x([180,0])[0];y=e?a-t:t-a}}let M=null!=c?await (0,O.$)(e.tileReq.resolution):null,N=[],S=[];n.beginPath();for(let e=0;e<d.length;e++){let t=d[e],a=Object.keys(t.data);for(let e=0;e<a.length;e++){let s;let l=a[e],{samples:d,idxTimeWindowCenter:u}=t.data[l];for(let e=0;e<d.length;e++){let[,t,,a,p,,,m]=d[e];if(o[t])continue;let f=x([a,p]);if(!f)continue;let b=f[0],g=f[1];if(0!==y&&(b<0-_||b>i+_)&&(b+=y,f[0]=b),null!=u&&s&&e===u+1&&(s.xyNext=f),b<0-_||g<0-_||b>i+_||g>i+_)continue;let j=Q(r,h,m);j&&(n.moveTo(b+v,g),n.arc(b,g,v,0,2*Math.PI),N.push({xy:f,longitude:a,latitude:p,valueColor:j,violatesThreshold:null!=c&&(0,L.bF)(c,m)}),null!=u&&e===u&&(s={xy:f,xyNext:null,longitude:a,latitude:p,platformId:l,platformType:t}))}s&&S.push(s)}}n.lineWidth=j,n.strokeStyle="rgba(5, 5, 5, 0.3)",n.stroke();for(let e=0;e<N.length;e++){let t=N[e],{xy:a,valueColor:s}=t,[i,l]=a,r=s[0],o=s[1],c=s[2];n.beginPath(),n.arc(i,l,b,0,2*Math.PI),n.fillStyle="rgb(".concat(r,", ").concat(o,", ").concat(c,")"),n.fill(),t.violatesThreshold&&(n.fillStyle=M,n.fill())}if(!u)for(let e=0;e<S.length;e++){var I,A;let{xy:t,platformType:a,platformId:s}=S[e],[i,l]=t,r=null!==(I=q.pw[a])&&void 0!==I?I:q.GW,o=r[0],c=r[1],d=r[2],h=null!==(A=q.W6[a])&&void 0!==A?A:"black";n.beginPath(),n.arc(i,l,f,0,2*Math.PI),n.lineWidth=g,n.strokeStyle=h,n.stroke(),n.beginPath(),n.arc(i,l,f,0,2*Math.PI),n.fillStyle="rgb(".concat(o,", ").concat(c,", ").concat(d,")"),n.fill(),m.DEBUG.showSparsePlatformLabels&&(n.font="24px sans-serif",n.fillStyle="black",n.textAlign="center",n.fillText(s,i,l-20))}return!0},Q=(e,t,a)=>{var s;let{valueClamp:i,logScale:n}=e,l=n?Math.log10(e.valueMin):e.valueMin,r=n?Math.log10(e.valueMin):e.valueMax;if(a<l){if(!i)return null;a=l}if(a>r){if(!i)return null;a=r}let o=Math.floor((l===r?.5:(a-l)/(r-l))*t.raw.length),c=t.raw.length;return o>=c&&(o=c-1),null!==(s=t.raw[o])&&void 0!==s?s:null};var X=a(56355),ee=a(38221),et=a.n(ee);let ea=5e3/1400/500,es=5e3/1400/500/5,ei="black",en="white";class el extends l.Component{componentDidMount(){this.hasData()&&this.reenable(),this.timer=window.requestAnimationFrame(this.animate)}componentDidUpdate(e){let{width:t,height:a,center:s,zoom:i}=this.props,n=this.hasData();t===e.width&&a===e.height&&s===e.center&&i===e.zoom&&this.hasData()||(this.isEnabled=!1,this.reenable()),!this.isEnabled&&n&&this.reenable()}componentWillUnmount(){this.isUnmounted=!0,null!=this.timer&&(window.cancelAnimationFrame(this.timer),this.timer=null)}hasData(){let{mapLayer:e}=this.props;if(!e)return!1;let{_subsets:t}=e,a=this.isWave?1:2;return!(t.length!==a||t.some(e=>null==e))}render(){var e;let{width:t,height:a}=this.props;return this.isWave=!!(null===(e=this.props.layerSpec)||void 0===e?void 0:e.hasWaveStyle),(0,s.jsx)("canvas",{ref:this.refCanvas,style:{width:t,height:a},width:t,height:a,"data-sentry-component":"ParticleLayer","data-sentry-source-file":"105-ParticleLayer.tsx",className:"jsx-".concat(ec.__hash)+" particle-layer",children:(0,s.jsx)(n(),{id:ec.__hash,children:ec})})}plotUpdate(e){let t,a;if(e-this.tLastFrame<1/70*1e3)return;this.tLastFrame=e;let s=this.refCanvas.current;if(!s)return;let i=s.getContext("2d");if(!i)return;let{isEnabled:n}=this,{width:l,height:r}=this.props;if(i.globalCompositeOperation="destination-out",i.fillStyle="rgba(0, 0, 0, ".concat(1-(n?.97:.75),")"),i.fillRect(0,0,l,r),i.globalCompositeOperation="source-over",!n)return;let{settings:o,mapLayer:c,layerSpec:d}=this.props;if(!d)return;let h=(0,f.WV)(c,d,o),{styleSolid:u,colormapId:p,colormapInvert:x,colormapStops:m}=h,b=(0,E.Co)(p,x,m);u?(a=eo(b.brightnessType),t=""):t=c.particleColor?c.particleColor:(0,E.LZ)(o);let g=this.updateParticles(h,a),j=this.particles;if(this.isWave&&(i.globalAlpha=.15),a){let e=Object.keys(g);for(let t=0;t<e.length;t++){let a=e[t];this.renderParticles(i,g[a],a)}}else this.renderParticles(i,j,t);this.isWave&&(i.globalAlpha=1);let v=this.cleanupRow;v>=r&&(v=0);let _=Math.min(r,v+Math.round(r/20)),y=_-v;if(y>0){let e=i.getImageData(0,v,l,y),{data:t}=e;for(let e=0;e<t.length;e+=4)t[e+3]<20&&(t[e+3]=0),e>=t.length&&(e=0);i.putImageData(e,0,v)}this.cleanupRow=_}updateParticles(e,t){let a=this.particles,{width:s,height:i,zoom:n}=this.props,l=this.props.wrappedVariableProjection,{valueMin:r,valueMax:o,logScale:c}=e,d=c?Math.log10(r):r,h=c?Math.log10(o):o,u=r===o,p=this.props.mapLayer._subsets,x=p[0],{strides:f,dimIds:b,dims:g}=x,j=b.indexOf(m.DIM_LONGITUDE),v=b.indexOf(m.DIM_LATITUDE);if(j<0)throw Error("Could not find longitude dimension in subset");if(v<0)throw Error("Could not find latitude dimension in subset");let _=g[m.DIM_LONGITUDE].coords.values,y=g[m.DIM_LATITUDE].coords.values,w=_.length,k=y.length,M=_[0],N=y[0],S=_[w-1],I=y[k-1],A=(S-M)/(w-1),C=(I-N)/(k-1),D=S+A-M>=359,T=x.data,L=this.isWave?null:p[1].data,E=this.isWave?.01*Math.pow(2,12-n):.12*Math.pow(2,12-n)/Math.abs(o),O={white:[],black:[]};for(let e=0;e<a.length;e++){let n=a[e],r=n[0],o=n[3],p=n[4];if(r>=100&&(r=Math.round(100*Math.random()-50),o=Math.random()*s,p=Math.random()*i,n[5]=null),r++,n[0]=r,n[1]=o,n[2]=p,n[3]=null,n[4]=null,null==o||null==p)continue;let x=l.invert([o,p]);if(!x)continue;let m=x[0],b=x[1],g=Math.floor((m+180)/360),_=Math.round((m-360*g-M)/A);D&&_===w&&(_=0),D&&-1===_&&(_=w-1);let y=Math.round((b-N)/C);if(_<0||_>=w||y<0||y>=k)continue;let S=_*f[j]+y*f[v],I=null,P=null,z=null,F=null;if(this.isWave){let e=T[S];if(null==e||e!=e)continue;let t=(90-(e+180))/180*Math.PI;I=Math.cos(t),P=Math.sin(t),F=e}else{if(I=T[S],P=L[S],null==I||I!=I||null==P||P!=P||0===I&&0===P)continue;if((z=Math.sqrt(I*I+P*P))*E>.08){let e=.08/(z*E);I*=e,P*=e}}let U=b/180*Math.PI;if(x[0]+=I*E/Math.cos(U),x[1]+=P*E,t){let e,a=this.isWave?F:z;c&&(a=Math.log10(a));let s=u?.5:(a-d)/(h-d),i=n[5];null!=i?e=0===i?"black":"white":(e=t(s),n[5]="black"===e?0:1),O[e].push(n)}let R=l(x);if(!R)continue;let[B,V]=R;if(n[3]=B,n[4]=V,this.isWave){let e=B-o,t=V-p,a=Math.sqrt(e*e+t*t),s=e/a,i=t/a;n[1]=-i,n[2]=s}}return O}renderParticles(e,t,a){this.isWave?this.renderWaveParticles(e,t,a):this.renderCurrentParticles(e,t,a)}renderCurrentParticles(e,t,a){e.beginPath();for(let a=0;a<t.length;a++){let s=t[a],i=s[3],n=s[4];if(null==i||null==n)continue;let l=s[1],r=s[2];e.moveTo(l,r),e.lineTo(i,n)}e.strokeStyle=a,e.stroke()}renderWaveParticles(e,t,a){e.beginPath();for(let a=0;a<t.length;a++){let s=t[a],i=s[3],n=s[4];if(null==i||null==n)continue;let l=8*s[1],r=8*s[2];e.moveTo(i-l,n-r),e.lineTo(i+l,n+r)}e.strokeStyle=a,e.lineWidth=1,e.stroke()}constructor(...e){super(...e),this.isEnabled=!1,this.isWave=!1,this.refCanvas=l.createRef(),this.particles=er(0,0,!1),this.isUnmounted=!1,this.timer=null,this.tLastFrame=0,this.cleanupRow=0,this._reenable=()=>{if(this.isEnabled||this.isUnmounted||!this.hasData())return;let{width:e,height:t}=this.props;this.particles=er(e,t,this.isWave),this.isEnabled=!0},this.reenable=et()(this._reenable,50),this.animate=e=>{this.plotUpdate(e),this.timer=window.requestAnimationFrame(this.animate)}}}let er=(e,t,a)=>{let s=Math.round((a?es:ea)*e*t*(matchMedia("(hover: hover)").matches?1:.75)),i=Array(s);for(let a=0;a<s;a++)i[a]=[-Math.round(100*Math.random()),null,null,Math.random()*e,Math.random()*t,null];return i},eo=e=>"centerLight"===e?e=>e>=.15&&e<=.85?ei:en:"centerDark"===e?e=>e>=.15&&e<=.85?en:ei:"darkToLight"===e?e=>e>=.8?ei:en:"lightToDark"===e?e=>e<=.8?ei:en:e=>en,ec=new String(".particle-layer.jsx-480b1c7b0883f06{position:absolute;display:block;top:0;left:0;pointer-events:none}");ec.__hash="480b1c7b0883f06";let ed=(0,d.Ng)((e,t)=>{let a=(0,v.yT)(e),s=(0,v.Yj)(e,t.layer.mapLayerId),i=s?(0,f.VF)(a,s.layerId):null;return{mapLayer:s,layerSpec:i,settings:(0,v.mt)(e)}},x)(el),eh=e=>(0,s.jsx)(ed,{...e,"data-sentry-element":"ConnectedParticleLayer","data-sentry-component":"WrappedParticleLayer","data-sentry-source-file":"105-ParticleLayer.tsx"}),eu=(0,I.A)()(),ep={id:"graticule",type:"tiles",tileSpec:{id:"graticule",url:"#graticule/{crs}/{z}/{x}/{y}",renderProps:{showBorders:!0},render:e=>{let{crsSpec:t,ctx:a,tileReq:s}=e,i=(0,p.getWgs84ToTilePixelProjection)(t,s);(0,A.A)(i,a)(eu),a.lineWidth=.5,a.strokeStyle="epsg:4326"===t.crs?"#333333":"#555555",a.stroke()},resolutionMax:3},opacity:1},ex=(e,t)=>{let{datasets:a,mapLayers:s,settings:i,cardId:n}=t,{isEditingThumbnail:l,isEditingDashboard:r}=t,o=l?i.thumbnailBasemap:i.basemap,c=m.BASEMAPS[o],d=e.basemap,h=d&&(null==c?void 0:c.layer.id)===d.id,u={};c&&!c.onTop&&(u.basemap=h?d:c.layer),(0,C.Hw)(s).forEach(i=>{let l=s[i];if(l.isHidden||m.DEBUG.hideAllLayers||n&&l.cardId!==n&&!l.isDashboardOverlay||r&&!l.isDashboardOverlay)return;let{datasetId:o}=(0,f.ei)(l.layerId);if(!a[o])return;let c=(0,f.VF)(a,l.layerId);c&&c.isViewable&&(c.hasZarr?(F(u,e,i,t),em(u,e,i,t)):c.hasSqlite?Z(u,e,i,t):(c.wmsUrl||c.wmsUrlByTime)&&(0,X.w)(u,e,i,t))});let p=e.graticule||ep;if(p=(0,S.set)(p,"isHidden",i.hideGraticule),u.graticule=p,c&&c.onTop&&(u.basemap=h?d:c.layer),i.showToponyms){let t=m.SUITABLE_TOPONYMS_FOR_BASEMAP[o],a=e.toponyms&&e.toponyms.id===t;u.toponyms=a?e.toponyms:m.TOPONYMS[t]}return u},em=(e,t,a,s)=>{var i;let{mapLayers:n}=s,l=n[a];if(!l.styleParticles)return;let r="".concat(a,"-particles"),o=null!==(i=l.opacity)&&void 0!==i?i:m.UI.defaultLayerOpacity,c=t[r];c||(c={id:r,mapLayerId:a,type:"custom",render:eh,opacity:o}),c=(0,S.set)(c,"opacity",o),e[r]=c};var ef=a(64104),eb=a(8953),eg=a(93197),ej=a(8539),ev=a(38361),e_=a(70226),ey=a(15617),ew=a(2866),ek=a(35269);class eM extends l.PureComponent{componentDidMount(){this.plotUpdate()}componentDidUpdate(){this.plotUpdate()}componentWillUnmount(){this.isUnmounted=!0}render(){let e=this.renderContents();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{ref:this.refSvg,width:this.props.width,height:this.props.height,"data-sentry-element":"svg","data-sentry-source-file":"105-MapTopLayer.tsx",className:"map-top-layer",children:[e.svgGeomEls,e.svgPinLineEls,e.svgLabelEls]}),e.htmlEls,(0,s.jsx)(n(),{id:eD.__hash,children:eD})]})}renderContents(){let e={svgGeomEls:[],svgPinLineEls:[],svgLabelEls:[],htmlEls:[]},t=Object.values(this.props.mapObjects),{draggedPinBoxId:a}=this.state;t.sort((e,t)=>{let s=e.id,i=t.id;return s===a?1:i===a?-1:0}),this.refPinBoxes={};for(let a=0;a<t.length;a++){var s;let i=t[a];if(!(0,e_.p)(i))continue;if(i.isMulti){this.renderMultiObject(i,e);continue}let n=null==i?void 0:null===(s=i.features)||void 0===s?void 0:s[0];n&&this.renderObject(i,n,e)}return this.renderCursor(e),this.renderSparseSampleCursor(e),e}renderPoint(e,t,a){let{highlight:i,canChange:n,isHovered:l,showLabel:r,pinBox:o}=this.getObjectFlags(e,t),{coordinates:c}=t.geometry;this.renderLocation({key:"point-".concat(e.id),mapObject:e,feature:t,dragId:n?e.id:void 0,location:c,className:"le-object-point",pinBox:o,isMainPin:!0,highlight:i,dot:"large",unlocated:t.properties.isUnlocated,pinOffset:e.pinOffset,hint:l?(0,s.jsx)(ef.A,{id:"toolHint.pointHovered",defaultMessage:"Click/tap to set the geographic area to this point"}):void 0,els:a}),r&&this.renderLabel(t,!0,a)}renderMultiPoint(e,t,a){let s=this.getObjectFlags(e,t),{highlight:i,showLabel:n}=s,{mapObjects:l,isDashboard:r,variableProjection:o}=this.props,c=eS(e,l,o,r),{coordinates:d}=t.geometry;d.forEach((n,l)=>{this.renderLocation({key:"".concat(e.id,"-").concat(l),mapObject:e,feature:t,location:n,pinBox:s.pinBox&&0===l,pinLine:s.pinBox,pinOffset:c[l].pinOffset,isMainPin:0===l,highlight:i,dot:"large",els:a})}),n&&this.renderLabel(t,!0,a)}renderLineString(e,t,a){let i=this.getObjectFlags(e,t),{highlight:n,beingDrawn:l,createdViaDragging:r,canChange:o}=i,{isHovered:c,showLabel:d,lineDots:h}=i,{hoverCoords:u,crs:x}=this.props,{coordinates:m}=t.geometry;l&&u&&(m=(0,g.OD)(m,u,x),t=(0,S.setIn)(t,["geometry","coordinates"],m),t=(0,p.addInterpolatedVersion)(t,{recalculate:!0}),m.length>1&&(t=(0,p.addMeasurementsAndRef)(t,{recalculate:!0})));let f=x!==t.properties.crs?t.properties.interpolated.geometry.coordinates:m;this._renderLine(e,t,f,"line","0",n,a);let b=m.length;m.forEach((d,u)=>{let p;let x=0===u,m=u===b-1,f=i.pinBox&&(x||m);l&&m?p=r?(0,s.jsx)(ef.A,{id:"toolHint.lineDragStop",defaultMessage:"Stop dragging to create line"}):(0,s.jsxs)("span",{children:[(0,s.jsx)(ef.A,{id:"toolHint.lineOrAreaAddVertex",defaultMessage:"Click/tap to add vertex"}),(0,s.jsx)("br",{}),(0,s.jsx)(ef.A,{id:"toolHint.escape",defaultMessage:"Press ESC or click on any tool to end"})]}):c&&m&&(p=(0,s.jsx)(ef.A,{id:"toolHint.lineOrAreaHovered",defaultMessage:"Click to use this geometry's bounding box"})),this.renderLocation({key:"".concat(e.id,"-").concat(String(u),"-").concat(String(l)),mapObject:e,feature:t,dragId:o?"".concat(e.id,".").concat(u,".").concat(m?"main":"normal"):void 0,location:d,pinBox:f,isMainPin:m,highlight:n,dot:!!h&&!(x||m)&&"small",pinOffset:m?e.pinOffset:void 0,hint:p,els:a})}),d&&this.renderLabel(t,!1,a)}renderMultiLineString(e,t,a){let s=this.getObjectFlags(e,t),{highlight:i,showLabel:n}=s,{crs:l}=this.props,{coordinates:r}=t.geometry;for(let s=0;s<r.length;s++){let n=r[s];l!==t.properties.crs&&(n=t.properties.interpolated.geometry.coordinates[s]);let o=String(s);this._renderLine(e,t,n,"line",o,i,a)}let{mapObjects:o,isDashboard:c,variableProjection:d}=this.props,h=eS(e,o,d,c);for(let i=0;i<r.length;i++){let{pinCoord:n,pinOffset:l}=h[i];this.renderLocation({key:"".concat(e.id,"-").concat(i),mapObject:e,feature:t,location:n,pinBox:s.pinBox&&0===i,pinLine:s.pinBox,pinOffset:l,isMainPin:!0,dot:!1,els:a})}n&&this.renderLabel(t,!1,a)}renderPolygon(e,t,a){let i,n;let l=this.getObjectFlags(e,t),{highlight:r,beingDrawn:o,canChange:c,isBbox:d}=l,{isHovered:h,showLabel:u}=l,{hoverCoords:x,crs:m}=this.props,{coordinates:f}=t.geometry;d?(i=f[0],o&&x&&(i=(0,g.OA)(i[0],x),t=(0,S.setIn)(t,["geometry","coordinates",0],i),t=(0,p.addInterpolatedVersion)(t,{recalculate:!0}),t=(0,p.addMeasurementsAndRef)(t,{recalculate:!0})),n=i):(n=i=f[0],o&&(x&&(i=(0,g.OD)(i,x,m)),n=[...i,i[0]],t=(0,S.setIn)(t,["geometry","coordinates",0],n),t=(0,p.addInterpolatedVersion)(t,{recalculate:!0}),n.length>=2&&(t=(0,p.addMeasurementsAndRef)(t,{recalculate:!0}))));let b=m!==t.properties.crs?t.properties.interpolated.geometry.coordinates:t.geometry.coordinates;this._renderPolygon(e,b,"area","0",r,a);let{isUserDefined:j,refCoord:v}=t.properties;j||(i=[null!=v?v:i[0]]);let _=i.length;i.forEach((i,n)=>{let u;let p=n===_-1,x=o&&!d?0===n:p,m=o?x||p:x;l.pinBox||(m=!1),o&&p?u=d?(0,s.jsx)(ef.A,{id:"toolHint.bboxDragStop",defaultMessage:"Stop dragging to define bounding box"}):(0,s.jsxs)("span",{children:[(0,s.jsx)(ef.A,{id:"toolHint.lineOrAreaAddVertex",defaultMessage:"Click/tap to add vertex"}),(0,s.jsx)("br",{}),(0,s.jsx)(ef.A,{id:"toolHint.escape",defaultMessage:"Press ESC or click on any tool to end"})]}):h&&(u=(0,s.jsx)(ef.A,{id:"toolHint.lineOrAreaHovered",defaultMessage:"Click to use this geometry's bounding box"})),(x||p||c)&&this.renderLocation({key:"".concat(e.id,"-").concat(String(n),"-").concat(String(o)),mapObject:e,feature:t,dragId:c?"".concat(e.id,".").concat(n,".").concat(j?x?"main":"":"ref"):"",location:i,pinBox:m,isMainPin:x,highlight:r,dot:!1,pinOffset:x?e.pinOffset:void 0,hint:u,els:a})}),u&&this.renderLabel(t,!1,a)}renderMultiPolygon(e,t,a){let s=this.getObjectFlags(e,t),{highlight:i,showLabel:n}=s,{crs:l}=this.props,{coordinates:r}=t.geometry;for(let s=0;s<r.length;s++){let n=l!==t.properties.crs?t.properties.interpolated.geometry.coordinates[s]:r[s];this._renderPolygon(e,n,"area",String(s),i,a)}let{mapObjects:o,isDashboard:c,variableProjection:d}=this.props,h=eS(e,o,d,c);for(let i=0;i<r.length;i++){let{pinCoord:n,pinOffset:l}=h[i];this.renderLocation({key:"".concat(e.id,"-").concat(i),mapObject:e,feature:t,location:n,pinBox:s.pinBox&&0===i,pinLine:s.pinBox,pinOffset:l,isMainPin:!0,dot:!1,els:a})}n&&this.renderLabel(t,!1,a)}renderCursor(e){let t;let{hoverCoords:a,hoverFeature:i,activeTool:n}=this.props;if(!a||i&&"subsetBbox"===n)return;let l=Object.values(this.props.mapObjects);for(let e=0;e<l.length;e++){let t=l[e];if(t.beingDrawn)return null;if(!(0,e_.p)(t))continue;let s=t.features[0];if(!s)return null;if("Point"===s.geometry.type){let e=s.geometry;if((0,g.gf)(e.coordinates,a))return}}if("dashboardSelect"===n)return this.renderDashboardSelectCursor(e);switch(n){case m.UI.tools.point:t=(0,s.jsx)(ef.A,{id:"toolHint.createPoint",defaultMessage:"Click/tap to create point"});break;case m.UI.tools.line:t=(0,s.jsxs)("span",{children:[(0,s.jsx)(ef.A,{id:"toolHint.createPolyline",defaultMessage:"Click/tap to create polyline"}),(0,s.jsx)("br",{}),(0,s.jsx)(ef.A,{id:"toolHint.createLineDragging",defaultMessage:"or drag to create single line"})]});break;case m.UI.tools.area:t=(0,s.jsx)(ef.A,{id:"toolHint.createPolygon",defaultMessage:"Click/tap to create polygon"});break;case m.UI.tools.subsetBbox:t=(0,s.jsxs)("span",{children:[(0,s.jsx)(ef.A,{id:"toolHint.bboxFromGeometry",defaultMessage:"Click on any kind of geometry"}),(0,s.jsx)("br",{}),(0,s.jsx)(ef.A,{id:"toolHint.bboxNewGeometry",defaultMessage:"or click/drag to create a new bounding box"})]})}let r=this.props.hoverFeature;if(r){let{crs:t}=this.props,{properties:a}=r,s={id:"__hover__ "},i=t!==a.crs?a.interpolated.geometry:r.geometry;if("Polygon"===i.type||"MultiPolygon"===i.type){let t="Polygon"===i.type?[i.coordinates]:i.coordinates;for(let a=0;a<t.length;a++){let i=t[a][0],n=String(a);this._renderLine(s,r,i,"area",n,!1,e)}}}this.renderLocation({key:"cursor-coords",feature:r,location:a,className:"le-cursor",pinBox:!0,isMainPin:n===m.UI.tools.point,dot:"large",hint:t,els:e})}renderDashboardSelectCursor(e){let{hoverCoords:t,variableProjection:a}=this.props;if(!t)return;let i=a(t);if(!i)return;let n=i[0]+5,l=i[1]-5;e.htmlEls.push((0,s.jsx)("div",{className:"dashboard-select-cursor",style:{position:"absolute",zIndex:"var(--z-pin-box)",left:n,top:l},children:(0,s.jsx)(ek.A,{hint:(0,s.jsx)(ef.A,{id:"toolHint.selectGeometry",defaultMessage:"Click/tap on a geometry to select it"})})},"dashboard-select-cursor"))}renderSparseSampleCursor(e){var t;let{hoverSample:a,hoverSampleIdxWorld:i,variableProjection:n}=this.props;if(!a)return;let l=a[N.s.platformId],r=a[N.s.platformType],o=a[N.s.longitude]+360*i,c=a[N.s.latitude];if(!n([o,c]))return;let d=[o,c],h=Object.values(this.props.mapObjects);for(let e=0;e<h.length;e++){let t=h[e];if(t.beingDrawn)return null;if(!(0,e_.p)(t))continue;let a=t.features[0];if(!a)return null;if("Point"===a.geometry.type){let e=a.geometry;if((0,g.gf)(e.coordinates,d))return}}let u={type:"Feature",geometry:{type:"Point",coordinates:d},properties:{name:(0,ey.Ie)(l),displayType:null!==(t=q.g7[r])&&void 0!==t?t:r,isUserDefined:!1}},p=(0,s.jsx)(ef.A,{id:"toolHint.clickSparseSample",defaultMessage:"Click to explore this platform"});this.renderLocation({key:"cursor-sparse-pinbox",feature:u,location:d,className:"le-cursor",pinBox:!0,isMainPin:!0,dot:"sparse",hint:p,els:e})}_renderLine(e,t,a,i,n,l,r){let{variableProjection:o}=this.props,{id:d}=e,h=a.map(o),u="M".concat(h.join("L"));r.svgGeomEls.push((0,s.jsxs)("g",{children:[(0,s.jsx)("path",{className:c()("le-object-".concat(i," le-halo"),{highlight:l}),d:u}),(0,s.jsx)("path",{className:c()("le-object-".concat(i),{highlight:l}),d:u})]},"".concat(d,"-line-").concat(null!=n?n:0)))}_renderPolygon(e,t,a,i,n,l){let{variableProjection:r}=this.props,{id:o}=e,d=t.map(e=>e.map(r)).map(e=>"M".concat(e.join("L"),"Z")).join("");l.svgGeomEls.push((0,s.jsxs)("g",{children:[(0,s.jsx)("path",{className:c()("le-object-".concat(a," le-halo"),{highlight:n}),d:d}),(0,s.jsx)("path",{className:c()("le-object-".concat(a),{highlight:n}),d:d})]},"".concat(o,"-line-").concat(null!=i?i:0)))}renderLabel(e,t,a){let i=(0,f.mo)(e);if(!i)return;let n=e.properties.refCoord,[l,r]=this.props.variableProjection(n);a.svgLabelEls.push((0,s.jsxs)("g",{transform:"translate(".concat(l+(t?-8:0),",").concat(r+((t?8:0)+3),")"),children:[(0,s.jsx)("text",{className:c()("le-label le-halo",{center:!t}),children:i}),(0,s.jsx)("text",{className:c()("le-label",{center:!t}),children:i})]},"".concat(e.properties.id,"-label")))}renderLocation(e){var t,a,i,n;let{key:r,className:o,mapObject:d,feature:h,dragId:u}=e,{isMainPin:p,highlight:x,hint:f,pinBox:b,els:g}=e,{dot:j,forceNoDot:v,unlocated:_}=e,y=null!==(t=null==d?void 0:d.isSparse)&&void 0!==t?t:"sparse"===j,w=null!==(a=e.pinLine)&&void 0!==a?a:b,{variableProjection:k,activeTool:M}=this.props,{location:N}=e;if(!N)return;let S=k(N),I=y?12:"large"===j?4:2,A=null!==(i=e.pinOffset)&&void 0!==i?i:m.UI.defaultPinOffset.normal,C=j&&!v;if(g.svgGeomEls.push((0,s.jsxs)("g",{className:"le-location-dot",transform:"translate(".concat(S,")"),children:[C&&(0,s.jsx)("circle",{className:c()(o,"le-halo",{highlight:x,sparse:y,unlocated:_}),r:y?_?I:I+1:I+2}),C&&(0,s.jsx)("circle",{className:c()(o,{highlight:x,sparse:y,unlocated:_}),r:I}),u&&!M&&(0,s.jsx)("circle",{className:"le-draggable-dot",id:u,r:18})]},r)),w){let[e,t]=S,a=A[0]+S[0],i=A[1]+S[1],[n,l]=[a-e,i-t],d=Math.atan2(l,n);e+=(I+.5)*Math.cos(d),t+=(I+.5)*Math.sin(d),g.svgPinLineEls.push((0,s.jsx)("line",{x1:e,y1:t,x2:a,y2:i,className:c()(o,"le-pin-line")},"".concat(r,"-pin-line")))}if(b){let e=S[0]+A[0],t=S[1]+A[1]-11,{mapObjects:a}=this.props,{draggedPinBoxId:i,dragTargetPinBoxId:o}=this.state,c=null!==(n=a[null!=i?i:""])&&void 0!==n?n:null,u=null!=i&&null!=d&&eC(d,c)&&d.id!==i&&!!p,x=p?l.createRef():void 0;x&&d&&(this.refPinBoxes[d.id]=x);let m=(null==d?void 0:d.id)===o&&!!p,b=(null==d?void 0:d.id)===i&&!!o;g.htmlEls.push((0,s.jsx)("div",{ref:x,style:{position:"absolute",zIndex:"var(--z-pin-box)",left:e,top:t},children:(0,s.jsx)(ew.A,{mapObject:null!=d?d:null,feature:null!=h?h:null,isMainPin:p,coords:N,hint:f,onDragMove:this.onDragMovePinBox,onDragEnd:this.onDragEndPinBox,isOnTarget:b,canBeDragTarget:u,isDragTarget:m})},r))}}plotUpdate(){let e=this.refSvg.current;if(!this.dragBehavior){let t=this;this.dragBehavior=(0,ev.A)().container(e).on("drag",function(){t.onDragVertexMove(this.id)}).on("end",function(){t.onDragVertexEnd(this.id)})}(0,eg.A)(e).selectAll(".le-draggable-dot").on("drag",null).on("end",null).call(this.dragBehavior)}onDragVertexMove(e){if(this.props.activeTool)return;let{x:t,y:a,sourceEvent:s}=ej.f0,{altKey:i}=s;this.throttledDragMove(e,t,a,i)}onDragVertexEnd(e){this.reprocessFeatureImmediately(e,!0)}getObjectFlags(e,t){var a,s;let{isDashboard:i,isEditingDashboard:n}=this.props,{isUserDefined:l}=t.properties,r=t.properties.id,o=(null===(s=this.props.hoverFeature)||void 0===s?void 0:null===(a=s.properties)||void 0===a?void 0:a.id)===r,c=this.isLinkedToAnyLayerForSubsetting(e)||this.isInMultiObjectBeingDrawn(r),d=this.isInMultiObject(r),h=(i||d)&&!n&&!e.beingDrawn,u=!d;return i&&u&&(u=!e||!!e.beingDrawn),{beingDrawn:!!l&&!!e.beingDrawn,createdViaDragging:!!l&&!!e.createdViaDragging,isBbox:!!l&&!!e.isBbox,canChange:l&&!e.isSparse,isHovered:o,isSelected:c,highlight:o||c,showLabel:h,pinBox:u,lineDots:!1}}isLinkedToAnyLayerForSubsetting(e){let t=Object.values(this.props.xLayerObjects),{id:a}=e;for(let e=0;e<t.length;e++){let s=t[e];if(null!=s&&s.objectId===a&&s.isShown)return!0}return!1}constructor(...e){var t;super(...e),t=this,this.state={draggedPinBoxId:null,dragTargetPinBoxId:null},this.teroLayers={},this.refSvg=l.createRef(),this.dragBehavior=null,this.refPinBoxes={},this.isUnmounted=!1,this.renderObject=(e,t,a)=>{switch(t.geometry.type){case"Point":return this.renderPoint(e,t,a);case"MultiPoint":return this.renderMultiPoint(e,t,a);case"LineString":return this.renderLineString(e,t,a);case"MultiLineString":return this.renderMultiLineString(e,t,a);case"Polygon":return this.renderPolygon(e,t,a);case"MultiPolygon":return this.renderMultiPolygon(e,t,a);default:console.error("Cannot render geometry of type ".concat(t.geometry.type))}},this.renderMultiObject=(e,t)=>{let{isDashboard:a}=this.props;if(a&&!e.beingDrawn)return;let{variableProjection:i,mapObjects:n}=this.props,l=eS(e,n,i,a);for(let a=0;a<l.length;a++){let{pinCoord:i,pinOffset:n,dotSize:r}=l[a],o=0===a;this.renderLocation({key:"multi-".concat(e.id,"-").concat(a),mapObject:e,feature:null,location:i,className:"le-object-point",pinBox:o,isMainPin:o,pinLine:!0,dot:r,forceNoDot:!0,pinOffset:n,hint:o&&e.beingDrawn?(0,s.jsx)(ef.A,{id:"toolHint.selectMultipleGeometries",defaultMessage:"Click/tap on multiple geometries to select or deselect them"}):void 0,els:t})}},this._onDragVertexMove=(e,t,a,s)=>{var i;let{variableProjection:n}=this.props,l=n.invert([t,a]),r=n(l=(0,g.P7)(l));t=r[0],a=r[1];let[o,c,d]=e.split("."),h=Number(c),u=this.props.mapObjects[o];if(!u)return;let{isBbox:x}=u,f=null===(i=u.features)||void 0===i?void 0:i[0];if(!f)return;let b=f.properties.id,{pinOffset:j}=u;!j&&this.isInMultiObject(b)&&(j=m.UI.defaultPinOffset.normal);let{geometry:v}=f;switch(v.type){case"Point":if(f=(0,S.setIn)(f,["geometry","coordinates"],l),f=(0,p.addMeasurementsAndRef)(f,{recalculate:!0}),u=(0,S.setIn)(u,["features",0],f),!s){let[e,s]=n(v.coordinates),i=t-e,l=a-s;if(j){let e=[j[0]-i,j[1]-l];u=(0,S.set)(u,"pinOffset",e)}}break;case"Polygon":case"LineString":{let e;let i="Polygon"===v.type,r=i?v.coordinates[0]:v.coordinates,o=r.length;x?e=eN(r,h,l):(e=(0,g.Px)(r,h,l,this.props.crs),i&&h===o-1&&(e=(0,g.Px)(e,0,l,this.props.crs)));let c=["geometry","coordinates"];i&&c.push(0),f=(0,S.setIn)(f,c,e);let m=(f=(0,p.addInterpolatedVersion)(f,{recalculate:!0})).properties.refCoord;if(f=(0,p.addMeasurementsAndRef)(f,{recalculate:!0}),u=(0,S.setIn)(u,["features",0],f),("main"===d||"ref"===d||x)&&!s){let s=0,i=0;if("ref"===d&&m){let[e,t]=n(f.properties.refCoord),[a,l]=n(m);s=e-a,i=t-l}else if(x){let[t,a]=n(e[0]),[l,o]=n(r[0]);s=t-l,i=a-o}else{let[e,l]=n(r[h]);s=t-e,i=a-l}if(j){let e=[j[0]-s,j[1]-i];u=(0,S.set)(u,"pinOffset",e)}}}}this.props.updateMapObject(u),this.throttledReprocessFeature(e)},this.throttledDragMove=k()(this._onDragVertexMove,30),this.reprocessFeatureImmediately=function(e){var a,s;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.split(".")[0],l=t.props.mapObjects[n];if(!l)return;let r=null===(a=l.features)||void 0===a?void 0:a[0];if(!r)return;i&&(r=(0,p.preprocessFeature)(r,{recalculate:!0,noFixWinding:l.isBbox}));let o=(null!==(s=r.properties.version)&&void 0!==s?s:0)+1;r=(0,S.setIn)(r,["properties","version"],o),l=(0,S.setIn)(l,["features",0],r),t.props.updateMapObject(l,{versionChanged:!0,dragEnd:i})},this.throttledReprocessFeature=k()(this.reprocessFeatureImmediately,500,{leading:!1,trailing:!0}),this.onDragMovePinBox=(e,t,a,s,i)=>{var n,l;let{mapObjects:r,isDashboard:o}=this.props,c=r[e],{state:d}=this;this.state.draggedPinBoxId||(d=(0,S.set)(d,"draggedPinBoxId",e));let h=this.refPinBoxes,u=Object.keys(h),p=!1;for(let t=0;t<u.length;t++){let a=u[t];if(a===e||!eC(c,r[a]))continue;let l=null===(n=h[a])||void 0===n?void 0:n.current;if(!l)continue;let{left:o,top:x,width:m,height:f}=l.getBoundingClientRect();if(s>=o&&s<=o+m&&i>=x&&i<=x+f){d=(0,S.set)(d,"dragTargetPinBoxId",a),p=!0;break}}if(!p&&this.state.dragTargetPinBoxId&&(d=(0,S.set)(d,"dragTargetPinBoxId",null)),d!==this.state&&this.setState(d),c.isMulti&&!o){let{features:e}=c;if(!e.length)return;c=eA(r,e[0].properties.id)}if(!c||0===t&&0===a)return;let[x,f]=null!==(l=c.pinOffset)&&void 0!==l?l:c.isMulti&&o?m.UI.defaultPinOffset.multi:m.UI.defaultPinOffset.normal;x+=t,f+=a,c=(0,S.set)(c,"pinOffset",[x,f]),this.props.updateMapObject(c)},this.onDragEndPinBox=e=>{if(this.isUnmounted)return;let{draggedPinBoxId:t,dragTargetPinBoxId:a}=this.state;null!=t&&null!=a&&this.props.groupMapObjects(t,a),this.setState({draggedPinBoxId:null,dragTargetPinBoxId:null})},this.isInMultiObjectBeingDrawn=e=>this.isInMultiObject(e,!0),this.isInMultiObject=(e,t)=>Object.values(this.props.mapObjects).some(a=>!!a.isMulti&&(null==t||a.beingDrawn===t)&&a.features.some(t=>("string"==typeof t?t:t.properties.id)===e))}}let eN=(e,t,a)=>{let s,i;let[n,l]=a;switch(t){case 0:case 4:s=a,i=e[2];break;case 1:s=[n,e[0][1]],i=[e[2][0],l];break;case 2:s=e[0],i=a;break;case 3:s=[e[0][0],l],i=[n,e[2][1]];break;default:throw Error("Unexpected idxDragged: ".concat(t))}return e=(0,g.OA)(s,i)},eS=(e,t,a,s)=>{let i,n;let{isMulti:l}=e,r=[],o=!0,{features:c}=e;for(let u=0;u<c.length;u++){let p=c[u],{id:x}=p.properties,f=eI(p);for(let c=0;c<f.length;c++){let u;let b=f[c],g=a(b);if(o){var d,h;i=u=l&&!s?null!==(d=eA(t,x).pinOffset)&&void 0!==d?d:m.UI.defaultPinOffset.normal:null!==(h=e.pinOffset)&&void 0!==h?h:l?m.UI.defaultPinOffset.multi:m.UI.defaultPinOffset.normal,n=g}else u=[n[0]-g[0]+i[0],n[1]-g[1]+i[1]];let j="Point"===p.geometry.type&&"large";r.push({pinCoord:b,pinOffset:u,dotSize:j}),o=!1}}return r},eI=e=>{let{isUserDefined:t,refCoords:a}=e.properties;if(!t&&null!=a)return a;let{geometry:s}=e;switch(s.type){case"Point":return[s.coordinates];case"MultiPoint":return s.coordinates;case"LineString":return[s.coordinates[s.coordinates.length-1]];case"MultiLineString":return s.coordinates.map(e=>e[0]);case"Polygon":return[s.coordinates[0][0]];case"MultiPolygon":return s.coordinates.map(e=>e[0][0]);default:throw Error("Unexpected geometry type: ".concat(s.type))}},eA=(e,t)=>{let a=Object.values(e);for(let e=0;e<a.length;e++){var s,i;let n=a[e],l=null==n?void 0:null===(s=n.features)||void 0===s?void 0:s[0];if("string"!=typeof l&&(null==l?void 0:null===(i=l.properties)||void 0===i?void 0:i.id)===t)return n}return null},eC=(e,t)=>null!=e&&null!=t&&e.isSparse===t.isSparse&&(!e.isSparse||e.sparseDatasetId===t.sparseDatasetId&&e.sparseSubdatasetId===t.sparseSubdatasetId),eD=new String(".map-top-layer{position:absolute;top:0px;left:0px;right:0px;bottom:0px;fill:black;stroke:none;--color-halo:white;--blend-mode-halo:normal}.map-top-layer line{stroke:white;stroke-width:2}.map-top-layer .le-object-line,.map-top-layer .le-object-area{stroke:black;stroke-width:".concat(2,";stroke-linecap:round;stroke-linejoin:round;fill:none;pointer-events:none}.map-top-layer .le-object-area{fill:rgba(255,255,255,.1)}.map-top-layer .le-object-area.highlight{fill:var(--color-accent-bg-semi-transparent)}.map-top-layer .le-pin-line{stroke-width:1;pointer-events:none}.map-top-layer .le-label{font-size:12px;text-anchor:end;pointer-events:none}.map-top-layer .le-label.le-halo{stroke-width:3;stroke-opacity:.85}.map-top-layer .le-label.center{text-anchor:middle}.map-top-layer circle.sparse{fill:none;stroke:black}.map-top-layer circle.sparse.unlocated{stroke-dasharray:2 2.5;stroke-width:4}.map-top-layer circle.le-halo{fill:var(--color-halo);mix-blend-mode:var(--blend-mode-halo)}.map-top-layer circle.sparse.le-halo{fill:none;stroke:white;stroke-width:1}.map-top-layer circle.sparse.le-halo.unlocated{fill:none;stroke:white;stroke-dasharray:2 2.5;stroke-dashoffset:2;stroke-width:4}.map-top-layer line.le-halo,.map-top-layer path.le-halo,.map-top-layer rect.le-halo{stroke:var(--color-halo);mix-blend-mode:var(--blend-mode-halo);stroke-width:").concat(6,";stroke-linejoin:round}.map-top-layer text.le-halo{fill:none;stroke:var(--color-halo);mix-blend-mode:var(--blend-mode-halo);stroke-width:4}.map-top-layer .le-halo.highlight{stroke:var(--color-accent-bg)}.map-top-layer circle.le-halo.highlight{fill:var(--color-accent-bg)}@media(hover:none){.le-cursor{display:none!important}}.le-sparse-sample-cursor{stroke:var(--color-accent-bg);stroke-width:2;fill:rgba(0,0,0,.1)}.map-top-layer .le-draggable-dot{cursor:move;fill:transparent;stroke:none}"));eD.__hash="7a8bf43730162ee7";let eT=(0,d.Ng)(e=>({activeTool:(0,v.Z9)(e),mapObjects:(0,v.B_)(e),xLayerObjects:(0,v.QM)(e),crs:(0,v.tT)(e),isDashboard:(0,v.N0)(e),isEditingDashboard:(0,v.Rp)(e)}),x)((0,eb.Ay)(eM));class eL extends l.PureComponent{static getDerivedStateFromProps(e,t){return null==e.activeTool&&null!=t.hoverCoords?{hoverCoords:null}:null}componentDidUpdate(e){let{activeTool:t}=this.props;t!==e.activeTool&&this.state.hoverObjectId&&this.setState({hoverObjectId:null,hoverSample:null});let{mapLayers:a}=this.props;a!==e.mapLayers&&this.maybeUpdateMapReady()}componentWillUnmount(){this.isUnmounted=!0}render(){let e;let{width:t,height:a}=this.props;if(null==t||null==a)return null;let{initialCenter:i,initialZoom:n}=this.props;if(null==i||null==n)return null;let{settings:l,crs:r,activeTool:o,isEditingThumbnail:c}=this.props;this.updateLayers();let d=!matchMedia("(hover: hover)").matches,h=(o===m.UI.tools.line||o===m.UI.tools.area||o===m.UI.tools.subsetBbox)&&(this.isToolDragging||!Object.values(this.props.mapObjects).find(e=>e.beingDrawn));return c?e=2:l.highResolution&&(e=3),(0,s.jsx)(y.default,{ref:this.refMap,width:t,height:a,crs:r,center:i,zoom:n,zoomLimits:c?[0,18]:m.UI.zoomLimits,visibleExtentLimits:m.UI.visibleExtentLimits[r],resolution:e,layers:this.teroLayers,debugShowCoordinates:this.props.debugMode.indexOf("coords")>=0,onChangePending:this.onChangePending,onInitialPanZoomKnown:this.onInitialPanZoom,onPanZoom:this.onPanZoom,onHoverMap:d?this.onHoverMapMobile:this.onHoverMapDesktop,onClickMap:c?void 0:this.onClickMap,onDragStartMap:h?this.onDragStartMap:void 0,onDragEndMap:h?this.onDragEndMap:void 0,disallowDoubleClick:!0,"data-sentry-element":"Map2d","data-sentry-component":"RootMap","data-sentry-source-file":"100-RootMap.tsx",children:this.renderTopLayer},r)}updateLayers(){let{mapLayers:e,datasets:t,settings:a,crs:s,cardId:i}=this.props,{isEditingThumbnail:n,isEditingDashboard:l}=this.props;this.teroLayers=ex(this.teroLayers,{mapLayers:e,datasets:t,settings:a,crs:s,cardId:i,isEditingThumbnail:n,isEditingDashboard:l})}constructor(...e){super(...e),this.state={hoverCoords:null,hoverObjectId:null,hoverSample:null,hoverSampleIdxWorld:0},this.teroLayers={},this.isToolDragging=!1,this.isUnmounted=!1,this.pendingTiles={},this.refMap=l.createRef(),this.zoomIn=()=>{var e,t;return null===(t=this.refMap)||void 0===t?void 0:null===(e=t.current)||void 0===e?void 0:e.zoomIn()},this.zoomOut=()=>{var e,t;return null===(t=this.refMap)||void 0===t?void 0:null===(e=t.current)||void 0===e?void 0:e.zoomOut()},this.panZoomTo=(e,t,a)=>{var s;return null===(s=this.refMap.current)||void 0===s?void 0:s.panZoomTo(e,t,a)},this.renderTopLayer=e=>{let{variableProjection:t}=e;return this.props.isEditingThumbnail?null:(0,s.jsx)(eT,{variableProjection:t,width:this.props.width,height:this.props.height,hoverCoords:this.props.activeTool?this.state.hoverCoords:null,hoverFeature:this.getHoverFeature(),hoverSample:this.state.hoverSample,hoverSampleIdxWorld:this.state.hoverSampleIdxWorld})},this.onChangePending=e=>{this.pendingTiles=e,this.maybeUpdateMapReady()},this.maybeUpdateMapReady=async()=>{if(!this.isMapReady()){this.props.setIsMapReady(!1);return}await (0,T.c)(60),!this.isUnmounted&&this.isMapReady()&&this.props.setIsMapReady(!0)},this.isMapReady=()=>{let e;let t=this.pendingTiles;e=Object.keys(t);for(let a=0;a<e.length;a++)if(t[e[a]])return!1;if(this.props.isEditingDashboard)return!0;let{mapLayers:a,datasets:s}=this.props;e=Object.keys(a);for(let t=0;t<e.length;t++){let i=a[e[t]];if(i.isHidden)continue;let n=(0,f.VF)(s,i.layerId);if(!n||n.isViewable&&!i.isReadyToView)return!1;let l=i._subsetStatus;if(l){for(let e=0;e<l.length;e++)if("fetching"===l[e])return!1}}return!0},this.onInitialPanZoom=(e,t,a,s)=>{this.props.setImmediateCenter(e),this.props.setImmediateZoom(t),this.doPanZoom(e,t,a,s,!0)},this.onPanZoom=(e,t,a,s)=>{this.props.setImmediateCenter(e),this.props.setImmediateZoom(t),this.throttledOnPanZoom(e,t,a,s)},this.throttledOnPanZoom=k()((e,t,a,s)=>{this.doPanZoom(e,t,a,s,!1);let{width:i,isControlBlockShown:n}=this.props,{isEditingThumbnail:l,isEditingDashboard:r}=this.props;null!=i&&i<m.UI.narrowControlBlockBreak&&n&&!l&&!r&&this.props.setIsControlBlockShown(!1)},700,{leading:!1}),this.doPanZoom=(e,t,a,s,i)=>{var n,l;let{crs:r,cardId:o}=this.props;this.variableProjection=s;let c=null;if(a){if((0,p.getCrsSpec)(r).isCylindrical){let{bottomLeft:[e,t],topRight:[s,i]}=a;c=[e,t,s,i]}else c=null!==(l=null===(n=this.refMap.current)||void 0===n?void 0:n.getVisibleBbox())&&void 0!==l?l:null}this.props.panZoom({center:e,zoom:t,visibleBbox:c,isInitial:i,cardId:o})},this.onHoverMapDesktop=(e,t)=>{if(eP(t.target,ew.n)){this.setState({hoverCoords:null,hoverObjectId:null,hoverSample:null});return}this.setState({hoverCoords:e}),this.detectHoveredObjects(e)},this.onHoverMapMobile=(e,t)=>{this.isToolDragging&&this.setState({hoverCoords:e})},this.detectHoveredObjects=k()(e=>{if(this.isUnmounted||!e)return;let{activeTool:t}=this.props;if(null==t){let t=this.findSparseSample(e);t?this.setState({hoverSample:t.sample,hoverSampleIdxWorld:t.idxWorld}):this.state.hoverSample&&this.setState({hoverSample:null})}if(t===m.UI.tools.subsetBbox||t===m.UI.tools.dashboardSelect){let t=this.findObjectAtCoords(e);if(t===this.state.hoverObjectId)return;this.setState({hoverObjectId:t})}},70),this.onClickMap=(e,t)=>{if(e=(0,g.P7)(e),null==this.props.activeTool){let a=this.findSparseSample(e);if(a){this.props.clickOnSparseSample(a.mapLayerId,a.sample,a.idxWorld,this.getClickOptions(t));return}}this.props.clickOnMap(e,{...this.getClickOptions(t),clickedObjectId:this.state.hoverObjectId})},this.onDragStartMap=(e,t)=>{e=(0,g.P7)(e),this.isToolDragging=!0,this.props.clickOnMap(e,{...this.getClickOptions(t),createdViaDragging:!0})},this.onDragEndMap=(e,t)=>{e=(0,g.P7)(e),this.isToolDragging=!1,this.props.clickOnMap(e,{...this.getClickOptions(t),createdViaDragging:!0,alsoDeactivateTool:this.props.activeTool===m.UI.tools.line})},this.getClickOptions=e=>{var t;let a={};a.altKey=e.altKey,a.shiftKey=e.shiftKey;let{cardId:s,mapLayers:i}=this.props;return a.mapLayerId=s?null===(t=Object.values(i).find(e=>e.cardId===s))||void 0===t?void 0:t.id:null,a},this.getHoverFeature=()=>{var e,t;let{hoverObjectId:a}=this.state;if(!a)return null;let s=this.props.mapObjects[a];return s&&null!==(t=null===(e=s.features)||void 0===e?void 0:e[0])&&void 0!==t?t:null},this.findObjectAtCoords=e=>{let t;if(!e)return null;let{activeTool:a}=this.props;if(a!==m.UI.tools.subsetBbox&&a!==m.UI.tools.dashboardSelect)return null;let s=Object.values(this.props.mapObjects);return(t=this._findObjectAtCoords(e,s,["Point","MultiPoint"]))||(t=this._findObjectAtCoords(e,s,["LineString","MultiLineString"]))?t:t=this._findObjectAtCoords(e,s,["Polygon","MultiPolygon"])},this._findObjectAtCoords=(e,t,a)=>{let s=this.variableProjection;for(let n=0;n<t.length;n++){var i;let l=t[n],{id:r}=l;if(l.isMulti||l.isSparse)continue;let o=null==l?void 0:null===(i=l.features)||void 0===i?void 0:i[0];if(!o||"string"==typeof o)continue;let{geometry:c}=o;if(a.includes(c.type))switch(c.type){case"Point":if(eE(e,[c.coordinates],s))return r;break;case"MultiPoint":case"LineString":if(eE(e,c.coordinates,s))return r;break;case"MultiLineString":{let t=c.coordinates;for(let a=0;a<t.length;a++)if(eE(e,t[a],s))return r;break}case"Polygon":case"MultiPolygon":if(eO(e,o))return r}}return null},this.findSparseSample=e=>{let t,a;let{crs:s,mapLayers:i,zoom:n}=this.props;if(null==n)return null;let l=Math.floor((e[0]+180)/360),r=.001*2**(14.4-n),o=(0,p.getCrsSpec)(s).getProjection(1,0,0),[c,d]=o(e),h=Infinity,u=Object.keys(i);for(let e=0;e<u.length;e++){var x;let n=u[e],l=i[n];if(l.isHidden||(null===(x=l._subsetStatus)||void 0===x?void 0:x[0])!=="succeeded")continue;let p=l._subsets[0];if(!(null==p?void 0:p.isSparse))continue;let{data:m,kdTrees:f,kdTreeIdxsToSamples:b}=p,{hiddenSparsePtypes:g}=l;if(f&&b){let e=f[s].within(c,d,r);for(let s=0;s<e.length;s++){let[i,l]=b[e[s]],r=m[i].samples[l],u=r[N.s.platformType];if(null==g?void 0:g[u])continue;let[p,x]=o([r[N.s.longitude],r[N.s.latitude]]),f=(p-c)**2+(x-d)**2;f<h&&(h=f,t=r,a=n)}}else{let e=Object.keys(m);for(let s=0;s<e.length;s++){let i=m[e[s]].samples;for(let e=0;e<i.length;e++){let s=i[e],[l,u]=o([s[N.s.longitude],s[N.s.latitude]]),p=Math.sqrt((l-c)**2+(u-d)**2);p<r&&p<h&&(h=p,t=s,a=n)}}}}return null==t?null:{sample:t,mapLayerId:a,idxWorld:l}}}}let eE=(e,t,a)=>{let s=a(e);for(let i=0;i<t.length;i++){let n=t[i],l=a(n),r=l[0]-s[0],o=l[1]-s[1];if(r*r+o*o<64||20>(0,M.A)(n,e))return!0}return!1},eO=(e,t)=>{var a;let s=null!==(a=t.properties.interpolatedGeometry)&&void 0!==a?a:t.geometry;return(0,p.polyOrMultiPolyContains)(s,null,e)},eP=(e,t)=>{for(;e&&e instanceof Element;){if(e.classList.contains(t))return!0;e=e.parentNode}return!1},ez=(0,d.Ng)(e=>({initialCenter:(0,v.sx)(e),initialZoom:(0,v.m$)(e),crs:(0,v.tT)(e),debugMode:(0,v.N)(e),mapLayers:(0,v.b7)(e),mapObjects:(0,v.B_)(e),zoom:(0,v.IX)(e),datasets:(0,v.yT)(e),activeTool:(0,v.Z9)(e),settings:(0,v.mt)(e),isControlBlockShown:(0,v.mb)(e),isEditingThumbnail:(0,v.R9)(e),isEditingDashboard:(0,v.Rp)(e)}),x,null,{forwardRef:!0})(eL);var eF=a(89384),eU=a(20409),eR=a(89594),eB=a(13037);let eV=new String(".outer.jsx-a8c0c28633c30067{padding:10px 20px;background:lightyellow;font-size:.6rem;overflow:auto}");eV.__hash="a8c0c28633c30067";let eG=e=>{let t=(0,d.d4)(v.B_);return(()=>{let e=(0,eB.s)(t);return(0,s.jsxs)("pre",{"data-sentry-component":"render","data-sentry-source-file":"800-DebugMapObjects.tsx",className:"jsx-".concat(eV.__hash)+" outer",children:[e,(0,s.jsx)(n(),{id:eV.__hash,children:eV})]})})()};var eW=a(52191),eH=a(44916),e$=a(88133),eq=a(30520),eZ=a(88704),eY=a.n(eZ);class eJ{addFrame(e){this.gif.addFrame(e,{copy:!0,delay:1e3*this.frameDuration})}abort(){this.gif.abort(),this.isCanceled=!0}render(){return new Promise((e,t)=>{if(this.isCanceled)return e(null);this.gif.on("finished",async t=>{if(this.isCanceled)return e(null);e(t)}),this.gif.render()})}constructor(e){this.isCanceled=!1,this.frameDuration=e.frameDuration,this.gif=new(eY())({workers:2,quality:10,workerScript:"/deps/gif.js/gif.worker.js"})}}class eK{addFrame(e){let t=eQ(e.toDataURL("image/jpeg",1)),{frames:a}=this;a.push({name:"input".concat(a.length,".jpeg"),data:t}),null==this.width&&(this.width=e.width,this.height=e.height)}abort(){this.isCanceled=!0;try{this.onRenderFinished&&this.onRenderFinished(null),this.worker.terminate()}catch(e){}}async render(){if(await (0,eU.waitUntil)(()=>this.isWorkerReady||this.isCanceled,5e3),this.isCanceled)return;let{width:e,height:t}=this,a=Math.sqrt(e*t/3e5),s=e/a,i=t/a;s=2*Math.round(s/2),i=2*Math.round(i/2);let n=["-r",String(1/this.frameDuration),"-i","input%d.jpeg","-vcodec","libx264","-preset","ultrafast","-vf","scale=".concat(s,":").concat(i),"-pix_fmt","yuv420p","out.mp4"];return new Promise((e,t)=>{this.onRenderFinished=a=>{var s,i;if(this.isCanceled)return e(null);let n=null==a?void 0:null===(i=a.MEMFS)||void 0===i?void 0:null===(s=i[0])||void 0===s?void 0:s.data;if(!n||!n.length)return t(Error("Encoder returned no data"));e(new Blob([n],{type:"video/mp4"}))},this.worker.postMessage({type:"run",TOTAL_MEMORY:0x20000000,MEMFS:this.frames,arguments:n})})}constructor(e){this.isCanceled=!1,this.worker=null,this.isWorkerReady=!1,this.width=null,this.height=null,this.frames=[],this.onRenderFinished=null,this.frameDuration=e.frameDuration;let t=new Worker("/deps/ffmpeg/ffmpeg-worker-mp4.js");t.onmessage=e=>{let a=e.data;switch(a.type){case"ready":this.isWorkerReady=!0;break;case"stdout":case"stderr":break;case"done":this.onRenderFinished&&this.onRenderFinished(null==a?void 0:a.data),t.terminate()}},this.worker=t}}let eQ=e=>{let t=e.substring(23),a=window.atob(t),s=a.length,i=new Uint8Array(new ArrayBuffer(s));for(let e=0;e<s;e++)i[e]=a.charCodeAt(e);return i};var eX=a(20084),e0=a(85317),e1=a(19416),e2=a(59916),e5=a(61708);let e3={link:!1,image:!1,video:!m.APP_CONFIG.noAuthForShare,embed:!m.APP_CONFIG.noAuthForShare},e6='<iframe src="',e4='" width="100%" height="350px"></iframe>',e9=[400/1.9,145/1.9],e8=e=>[{value:1,label:e.$t({id:"share.timeStep.hour",defaultMessage:"1 hour"})},{value:24,label:e.$t({id:"share.timeStep.day",defaultMessage:"1 day"})},{value:168,label:e.$t({id:"share.timeStep.week",defaultMessage:"1 week"})},{value:720,label:e.$t({id:"share.timeStep.month",defaultMessage:"1 month"})},{value:8760,label:e.$t({id:"share.timeStep.year",defaultMessage:"1 year"})}];class e7 extends l.PureComponent{componentDidMount(){this.initLink(),this.initEmbed(),"image"===this.state.tab&&this.buildImage()}componentDidUpdate(e,t){let{tab:a}=this.state;a!==t.tab&&"image"===a&&this.buildImage()}componentWillUnmount(){this.isUnmounted=!0,this.cancelVideo()}render(){if(this.state.showLogin)return(0,s.jsx)(eX.A,{onClose:()=>this.setState({showLogin:!1}),"data-sentry-element":"LoginModal","data-sentry-component":"ShareModal","data-sentry-source-file":"220-ShareModal.tsx"});let{intl:e,onClose:t,loginStatus:a}=this.props,{tab:i}=this.state,l=e3[i]&&"LOGGED_IN"!==a;return(0,s.jsxs)(e0.A,{className:c()("wk-modal-share-url",this.state.tab),onClose:t,"data-sentry-element":"Modal","data-sentry-component":"ShareModal","data-sentry-source-file":"220-ShareModal.tsx",children:[(0,s.jsx)(e2.A,{title:e.$t({id:"share.title",defaultMessage:"Share"}),onClickBack:t,"data-sentry-element":"TitleRow","data-sentry-source-file":"220-ShareModal.tsx"}),(0,s.jsxs)("div",{className:"jsx-".concat(ty.__hash)+" share-modal",children:[this.renderTabTitles(),l?this.renderLogIn():(0,s.jsxs)(s.Fragment,{children:[this.renderLinkTab(),this.renderImageTab(),this.renderVideoTab(),this.renderEmbedTab()]})]}),(0,s.jsx)(n(),{id:ty.__hash,children:ty})]})}renderTabTitles(){let e=this.isRendering(),{intl:t}=this.props,a=[{id:"link",label:t.$t({id:"share.tab.link",defaultMessage:"Link"}),icon:"link"},{id:"image",label:t.$t({id:"share.tab.image",defaultMessage:"Image"}),icon:"image",iconFamily:"far"},{id:"video",label:t.$t({id:"share.tab.video",defaultMessage:"Video"}),icon:"film"},{id:"embed",label:t.$t({id:"share.tab.embed",defaultMessage:"Embed"}),icon:"code"}];return(0,s.jsx)(e5.A,{tabs:a,activeTabId:this.state.tab,onClickTab:e=>this.setState({tab:e}),disabled:e})}renderLogIn(){return(0,s.jsxs)("div",{className:"jsx-".concat(tw.__hash)+" content",children:[(0,s.jsx)("div",{className:"jsx-".concat(tw.__hash)+" instructions",children:(0,s.jsx)(ef.A,{id:"share.logInPrompt",defaultMessage:"Please log in to access this feature."})}),(0,s.jsx)("div",{className:"jsx-".concat(tw.__hash)+" login-form",children:(0,s.jsx)("div",{onClick:()=>{this.setState({showLogin:!0})},className:"jsx-".concat(tw.__hash)+" wk-button primary login-button",children:(0,s.jsx)(ef.A,{id:"share.logInButton",defaultMessage:"Log in"})})}),(0,s.jsx)(n(),{id:tw.__hash,children:tw})]})}renderLinkTab(){if("link"!==this.state.tab)return null;let{isFetchingShortUrl:e,shareUrl:t}=this.state;return(0,s.jsxs)("div",{className:"jsx-".concat(tw.__hash)+" content",children:[(0,s.jsxs)("div",{className:"jsx-".concat(tw.__hash)+" instructions",children:[(0,s.jsx)(ef.A,{id:"share.linkInstructions",defaultMessage:"This shortened URL represents the current map, including all layers, geometries and graphs"}),":"]}),(0,s.jsxs)("div",{className:"jsx-".concat(tw.__hash)+" centered-button",children:[(0,s.jsx)("div",{onClick:e?void 0:this.onClickCopyUrl,className:"jsx-".concat(tw.__hash)+" "+(c()("wk-button",{primary:!e,disabled:e})||""),children:e?(0,s.jsx)(e1.A,{timeout:0}):(0,s.jsx)(ef.A,{id:"share.copyButton",defaultMessage:"Copy"})}),(0,s.jsx)("span",{className:"jsx-".concat(tw.__hash)+" share-url",children:t})]}),(0,s.jsx)(n(),{id:tw.__hash,children:tw})]})}renderImageTab(){let{tab:e,imageUrl:t,isRenderingImage:a,imageRenderError:i}=this.state,{settings:l}=this.props,r=null!=t;return(0,s.jsxs)("div",{className:"jsx-".concat(tw.__hash)+" "+(c()("content",{hidden:"image"!==e})||""),children:[this.renderImageForm(),i&&(0,s.jsx)(eU.LargeMessage,{children:i}),a&&(0,s.jsxs)(eU.LargeMessage,{children:[(0,s.jsx)(ef.A,{id:"share.imageProcessing",defaultMessage:"Generating image…"})," ",(0,s.jsx)(e1.A,{})]}),r&&(0,s.jsxs)("div",{className:"jsx-".concat(tw.__hash)+" centered-button",children:[(0,s.jsx)("div",{onClick:this.onClickDownloadImage,className:"jsx-".concat(tw.__hash)+" "+(c()("wk-button",{primary:!navigator.share})||""),children:l.highResolution?(0,s.jsx)(ef.A,{id:"share.downloadButtonHiRes",defaultMessage:"Download in high resolution"}):(0,s.jsx)(ef.A,{id:"share.downloadButton",defaultMessage:"Download"})}),navigator.share&&(0,s.jsx)("div",{onClick:this.onClickShareImage,className:"jsx-".concat(tw.__hash)+" wk-button primary",children:(0,s.jsx)(ef.A,{id:"share.shareButton",defaultMessage:"Share"})})]}),(0,s.jsx)("div",{className:"jsx-".concat(tw.__hash)+" "+(c()("preview-image-wrapper",{shown:r})||""),children:(0,s.jsx)("img",{src:t,className:"jsx-".concat(tw.__hash)+" preview-image"})}),(0,s.jsx)("canvas",{ref:this.refImageCanvas,style:{display:"none"},className:"jsx-".concat(tw.__hash)}),(0,s.jsx)(n(),{id:tw.__hash,children:tw})]})}renderVideoTab(){let{tab:e,videoUrl:t,isRenderingVideo:a,isVideoCanvasShown:i,videoRenderError:l,videoProgress:r}=this.state,o=this.validateAnimationSpecs(),d=t&&t.indexOf("video/mp4")>=0;return(0,s.jsxs)("div",{className:"jsx-".concat(tw.__hash)+" "+(c()("content",{hidden:"video"!==e})||""),children:[this.renderVideoForm(),o&&(0,s.jsxs)("div",{className:"jsx-".concat(tw.__hash)+" centered-button",children:[!a&&(0,s.jsx)("div",{onClick:this.onClickGenerateVideo,className:"jsx-".concat(tw.__hash)+" "+(c()("wk-button",{primary:!t})||""),children:(0,s.jsx)(ef.A,{id:"share.generateVideoButton",defaultMessage:"Generate video"})}),a&&(0,s.jsxs)("div",{className:"jsx-".concat(tw.__hash)+" wk-button disabled",children:[(0,s.jsx)(ef.A,{id:"share.processingVideo",defaultMessage:"Generating…"})," ",(0,s.jsx)(e1.A,{timeout:0})]}),a&&(0,s.jsx)("div",{onClick:this.onClickCancelVideo,className:"jsx-".concat(tw.__hash)+" wk-button",children:(0,s.jsx)(ef.A,{id:"share.cancelButton",defaultMessage:"Cancel"})}),t&&(0,s.jsx)("div",{onClick:this.onClickDownloadVideo,className:"jsx-".concat(tw.__hash)+" wk-button primary",children:(0,s.jsx)(ef.A,{id:"share.downloadButton",defaultMessage:"Download"})})]}),l&&(0,s.jsx)(eU.LargeMessage,{children:l}),(0,s.jsx)("div",{className:"jsx-".concat(tw.__hash)+" "+(c()("preview-canvas-wrapper",{shown:i})||""),children:(0,s.jsxs)("div",{className:"jsx-".concat(tw.__hash)+" preview-canvas-wrapper-2",children:[(0,s.jsx)("div",{style:{width:"".concat(r,"%")},className:"jsx-".concat(tw.__hash)+" preview-canvas-progress"}),(0,s.jsx)("canvas",{ref:this.refVideoCanvas,className:"jsx-".concat(tw.__hash)+" preview-canvas"})]})}),t&&(0,s.jsxs)("div",{className:"jsx-".concat(tw.__hash)+" "+(c()("preview-video-wrapper shown")||""),children:[d&&(0,s.jsx)("video",{controls:!0,loop:!0,autoPlay:!0,src:t,className:"jsx-".concat(tw.__hash)+" preview-video"}),!d&&(0,s.jsx)("img",{src:t,className:"jsx-".concat(tw.__hash)+" preview-video"})]}),(0,s.jsx)(n(),{id:tw.__hash,children:tw})]})}renderEmbedTab(){if("embed"!==this.state.tab)return null;let{embedUrl:e}=this.state;return(0,s.jsxs)("div",{className:"jsx-".concat(tw.__hash)+" content",children:[(0,s.jsx)("div",{className:"jsx-".concat(tw.__hash)+" instructions",children:(0,s.jsx)(ef.A,{id:"share.embedInstructions",defaultMessage:"Copy the following code snippet to your site to embed a fully functional version of the viewer. Modify <code>width</code> and <code>height</code> as needed.",values:{code:e=>(0,s.jsx)("code",{className:"jsx-".concat(tw.__hash),children:e},String(e))}})}),(0,s.jsxs)("div",{className:"jsx-".concat(tw.__hash)+" centered-button",children:[(0,s.jsx)("div",{onClick:this.onClickCopyEmbed,className:"jsx-".concat(tw.__hash)+" "+(c()("wk-button primary")||""),children:(0,s.jsx)(ef.A,{id:"share.copyButton",defaultMessage:"Copy"})}),(0,s.jsxs)("code",{className:"jsx-".concat(tw.__hash)+" snippet",children:[e6,(0,s.jsx)("b",{className:"jsx-".concat(tw.__hash),children:e}),e4]})]}),(0,s.jsxs)("div",{className:"jsx-".concat(tw.__hash)+" instructions",children:[(0,s.jsx)(ef.A,{id:"share.embedPreviewInstructions",defaultMessage:"Preview (note that changes are not saved)"}),":"]}),(0,s.jsx)("div",{className:"jsx-".concat(tw.__hash)+" inception-wrapper",children:(0,s.jsx)("iframe",{src:e,className:"jsx-".concat(tw.__hash)+" inception"})}),(0,s.jsx)(n(),{id:tw.__hash,children:tw})]})}renderImageForm(){let e=this.isRendering();return(0,s.jsxs)("div",{className:"jsx-".concat(tk.__hash)+" "+(c()("image-video-form",{disabled:e})||""),children:[this.renderOverlayFlags(),(0,s.jsx)(n(),{id:tk.__hash,children:tk})]})}renderVideoForm(){let{animateAxis:e,videoDuration:t,videoFormat:a}=this.state,i=this.isRendering();return(0,s.jsxs)("div",{className:"jsx-".concat(tk.__hash)+" "+(c()("image-video-form",{disabled:i})||""),children:["time"===e?this.renderAnimateTimeForm():this.renderAnimateElevationForm(),(0,s.jsxs)("div",{className:"jsx-".concat(tk.__hash),children:[(0,s.jsx)("span",{className:"jsx-".concat(tk.__hash)+" field-name",children:(0,s.jsx)(ef.A,{id:"share.videoFormat",defaultMessage:"Format"})}),(0,s.jsx)("span",{className:"jsx-".concat(tk.__hash)+" field",children:(0,s.jsxs)("label",{className:"jsx-".concat(tk.__hash),children:[(0,s.jsx)("input",{type:"radio",name:"video-format",value:"mp4",checked:"mp4"===a,onChange:e=>{let{target:t}=e;return this.setState({videoFormat:t.value})},className:"jsx-".concat(tk.__hash)}),"MP4"," ",(0,s.jsx)("span",{className:"jsx-".concat(tk.__hash)+" format-usage",children:(0,s.jsx)(ef.A,{id:"share.videoMp4Description",defaultMessage:"(smaller, memory-hungry)"})})]})}),(0,s.jsx)("span",{className:"jsx-".concat(tk.__hash)+" field",children:(0,s.jsxs)("label",{className:"jsx-".concat(tk.__hash),children:[(0,s.jsx)("input",{type:"radio",name:"video-format",value:"gif",checked:"gif"===a,onChange:e=>{let{target:t}=e;return this.setState({videoFormat:t.value})},className:"jsx-".concat(tk.__hash)}),"GIF"," ",(0,s.jsx)("span",{className:"jsx-".concat(tk.__hash)+" format-usage",children:(0,s.jsx)(ef.A,{id:"share.videoGifDescription",defaultMessage:"(higher quality)"})})]})}),(0,s.jsxs)("span",{className:"jsx-".concat(tk.__hash)+" field",children:[(0,s.jsx)("span",{className:"jsx-".concat(tk.__hash)+" field-name",children:(0,s.jsx)(ef.A,{id:"share.videoDuration",defaultMessage:"Duration"})}),(0,s.jsx)("input",{ref:this.refVideoDuration,type:"number",min:.2,max:300,step:.1,defaultValue:tu(t),onBlur:e=>{let{target:t}=e;return this.setState({videoDuration:tp(t.value)})},className:"jsx-".concat(tk.__hash)+" video-duration"})," ","s"]})]}),this.renderOverlayFlags(),(0,s.jsx)(n(),{id:tk.__hash,children:tk})]})}renderAnimateTimeForm(){let{intl:e}=this.props,{animateStep:t}=this.state,{dateStart:a,timeStart:i,dateStop:l,timeStop:r}=this.state;return(0,s.jsxs)("div",{className:"jsx-".concat(tk.__hash),children:[(0,s.jsx)("span",{className:"jsx-".concat(tk.__hash)+" field-name start-stop-step",children:(0,s.jsx)(ef.A,{id:"share.videoStart",defaultMessage:"Start"})}),(0,s.jsx)("input",{type:"date",defaultValue:to(a),onBlur:this.onChangeDate(!0),className:"jsx-".concat(tk.__hash)}),(0,s.jsx)("input",{type:"time",defaultValue:td(i),onBlur:this.onChangeTime(!0),className:"jsx-".concat(tk.__hash)}),(0,s.jsx)("br",{className:"jsx-".concat(tk.__hash)+" optional-break"}),(0,s.jsx)("span",{className:"jsx-".concat(tk.__hash)+" field-name start-stop-step",children:(0,s.jsx)(ef.A,{id:"share.videoStop",defaultMessage:"Stop"})}),(0,s.jsx)("input",{type:"date",defaultValue:to(l),onBlur:this.onChangeDate(!1),className:"jsx-".concat(tk.__hash)}),(0,s.jsx)("input",{type:"time",defaultValue:td(r),onBlur:this.onChangeTime(!1),className:"jsx-".concat(tk.__hash)}),(0,s.jsx)("br",{className:"jsx-".concat(tk.__hash)+" optional-break"}),(0,s.jsxs)("span",{className:"jsx-".concat(tk.__hash)+" field",children:[(0,s.jsx)("span",{className:"jsx-".concat(tk.__hash)+" field-name start-stop-step",children:(0,s.jsx)(ef.A,{id:"share.videoStep",defaultMessage:"Step"})}),(0,s.jsx)("select",{id:"animate-time-step",value:null!=t?JSON.stringify(t):"",onChange:this.onChangeDuration,className:"jsx-".concat(tk.__hash),children:e8(e).map(e=>{let{value:t,label:a}=e;return(0,s.jsx)("option",{value:JSON.stringify(t),className:"jsx-".concat(tk.__hash),children:a},t)})})]}),(0,s.jsx)(n(),{id:tk.__hash,children:tk})]},"time")}renderAnimateElevationForm(){let{animateStart:e,animateStop:t,animateStep:a}=this.state;return(0,s.jsxs)("div",{className:"jsx-".concat(tk.__hash),children:[(0,s.jsxs)("span",{className:"jsx-".concat(tk.__hash)+" field",children:[(0,s.jsx)("span",{className:"jsx-".concat(tk.__hash)+" field-name start-stop-step",children:(0,s.jsx)(ef.A,{id:"share.videoStart",defaultMessage:"Start"})}),(0,s.jsx)("input",{type:"number",min:-1e4,max:100,step:1,defaultValue:tu(e),onBlur:e=>{let{target:t}=e;return this.setState({animateStart:tp(t.value)})},className:"jsx-".concat(tk.__hash)})," ","m"]}),(0,s.jsxs)("span",{className:"jsx-".concat(tk.__hash)+" field",children:[(0,s.jsx)("span",{className:"jsx-".concat(tk.__hash)+" field-name start-stop-step",children:(0,s.jsx)(ef.A,{id:"share.videoStop",defaultMessage:"Stop"})}),(0,s.jsx)("input",{type:"number",min:-1e4,max:100,step:1,defaultValue:tu(t),onBlur:e=>{let{target:t}=e;return this.setState({animateStop:tp(t.value)})},className:"jsx-".concat(tk.__hash)})," ","m"]}),(0,s.jsxs)("span",{className:"jsx-".concat(tk.__hash)+" field",children:[(0,s.jsx)("span",{className:"jsx-".concat(tk.__hash)+" field-name start-stop-step",children:(0,s.jsx)(ef.A,{id:"share.videoStep",defaultMessage:"Step"})}),(0,s.jsx)("input",{type:"number",min:1,max:1e3,step:1,defaultValue:tu(a),onBlur:e=>{let{target:t}=e;return this.setState({animateStep:tp(t.value)})},className:"jsx-".concat(tk.__hash)})," ","m"]}),(0,s.jsx)(n(),{id:tk.__hash,children:tk})]},"elevation")}renderOverlayFlags(){return(0,s.jsxs)("div",{className:"jsx-".concat(tk.__hash),children:[(0,s.jsx)("span",{className:"jsx-".concat(tk.__hash)+" field-name",children:(0,s.jsx)(ef.A,{id:"share.videoOverlay",defaultMessage:"Overlay"})}),(0,s.jsxs)("label",{className:"jsx-".concat(tk.__hash),children:[(0,s.jsx)("input",{type:"checkbox",id:"overlay-legend",checked:this.state.overlayLegend,onChange:this.onChangeOverlayFlag("overlayLegend"),className:"jsx-".concat(tk.__hash)}),(0,s.jsx)(ef.A,{id:"share.videoOverlayLegend",defaultMessage:"legend"})]}),(0,s.jsxs)("label",{className:"jsx-".concat(tk.__hash),children:[(0,s.jsx)("input",{type:"checkbox",id:"overlay-caption",checked:this.state.overlayCaption,onChange:this.onChangeOverlayFlag("overlayCaption"),className:"jsx-".concat(tk.__hash)}),(0,s.jsx)(ef.A,{id:"share.videoOverlayTZ",defaultMessage:"t/z caption"})]}),"",(0,s.jsx)(n(),{id:tk.__hash,children:tk})]})}async initLink(){let e;if(this.state.shareUrl)return;let t=!1;try{e=await this.shortenUrl(window.location.href),t=!0}catch(t){console.error(t),e=window.location.href}this.setState({isShortenedUrl:t,shareUrl:e})}async initEmbed(){if(!this.state.embedUrl)try{let{href:e}=window.location;0>e.indexOf("embed=")&&(e+="&embed=1");let t=await this.shortenUrl(e);this.setState({embedUrl:t})}catch(e){console.error(e)}}async shortenUrl(e){let t=encodeURIComponent(e),{key:a}=await (0,e_.z)("".concat("https://data-be-prd.marine.copernicus.eu","/api/shortUrl?url=").concat(t),{timeout:16e3}),{protocol:s,host:i}=window.location;return"".concat(s,"//").concat(i,"/-/").concat(a)}async buildImage(){let e=this.refImageCanvas.current;if(!e)return;let{intl:t}=this.props;this.setState({isRenderingImage:!0,imageRenderError:null});try{await this.drawMap(e);let t=e.toDataURL("image/png");this.setState({isRenderingImage:!1,imageUrl:t})}catch(a){let e=0===a.message.indexOf("PAINT_ERROR")?a.message.split(":")[1]:t.$t({id:"notif.buildImageError",defaultMessage:"An unknown error occurred"});console.error(a.message),this.setState({isRenderingImage:!1,imageRenderError:e,imageUrl:null})}}async buildVideo(){if(!this.validateAnimationSpecs())return;let{intl:e}=this.props,{animateAxis:t,animateStart:a,animateStop:s,animateStep:i}=this.state,{videoDuration:n,videoFormat:l}=this.state,r="mp4"===l,o=r?"videoGenerateMp4":"videoGenerateGif";t_("".concat(o,"Start"));let c="time"===t,d=a>s?-1:1,[h,p]=ta(a,s),x=tt(i),m=a,f=c?this.props.time:this.props.elevation,b=tf(this.state),g=n/(b-1);(isNaN(g)||!isFinite(g)||g<=0)&&(g=.5),this.setState({isRenderingVideo:!0,videoRenderError:null,isVideoCanvasShown:!1,videoUrl:null,videoBlob:null,videoProgress:0});try{this.videoEncoder=r?new eK({frameDuration:g}):new eJ({frameDuration:g});let e=0;for(;;){if(this.setTimeElevation(c,m),await (0,eU.delay)(100),!this.videoEncoder)throw Error("CANCELLED");let t=this.refVideoCanvas.current;if(!t||(await this.drawMap(t,{forVideo:!0}),!this.videoEncoder))throw Error("CANCELLED");this.videoEncoder.addFrame(t);let a=(e+=1)/b*100;if(a>100&&(a=100),this.setState({isVideoCanvasShown:!0,videoProgress:a}),c){let e=u().utc(m);e.add(d,x),m=e.valueOf()}else m+=d*i;if(m<h||m>p)break}let t=await this.videoEncoder.render();if(!t)throw Error("CANCELLED");let a=await (0,eq.GW)(t);this.setState({isRenderingVideo:!1,isVideoCanvasShown:!1,videoUrl:a,videoBlob:t}),t_("".concat(o,"Complete"))}catch(s){if("CANCELLED"===s.message){this.setState({isRenderingVideo:!1,isVideoCanvasShown:!1,videoUrl:null,videoBlob:null}),t_("".concat(o,"Cancel"));return}t_("".concat(o,"Error"),s.message);let t=0===s.message.indexOf("PAINT_ERROR"),a=t?s.message.split(":")[1]:e.$t({id:"notif.videoError",defaultMessage:"An error occurred"});t||console.error(s.message),this.setState({isRenderingVideo:!1,videoRenderError:a,isVideoCanvasShown:!1,videoUrl:null,videoBlob:null})}finally{this.setTimeElevation(c,f),this.videoEncoder=null}}setTimeElevation(e,t){let a={immediateEffects:!0,noAnalytics:!0};e?this.props.setTime(t,a):this.props.setElevation(t,a)}isRendering(){return this.state.isRenderingImage||this.state.isRenderingVideo}drawTitlesAndLegend(e,t,a,s){e.save();let{overlayLegend:i,overlayCaption:n,geoCaption:l}=this.state,{intl:r,datasets:o,mapLayers:c,settings:d,visibleBBox:h}=this.props,p=(0,C.Hw)(c).reverse(),x=27,m=this.getCmemsLogoSize(a/t),b=Math.min(a/t-m[0]-10,440);e.font="".concat(22*t,"px Arial"),e.globalAlpha=1;let g=!1,j=!1;for(let a=0;a<p.length;a++){let s=c[p[a]],{isHidden:n,layerId:l,time:h,elevation:u}=s;if(n)continue;let m=(0,f.VF)(o,l);if(m&&(null!=h&&(g=!0),null!=u&&(j=!0),i)){let{datasetId:a}=(0,f.ei)(l),i=o[a],{units:n}=(0,f.WV)(s,m,d),c=(0,f.ez)(m,i,r);(n=(0,e$.vr)(n,r,{exponents:!0}))&&(c+=" [".concat(n,"]")),tv(e,c,b*t-10*t).forEach(a=>{tb(e,a,10*t,x*t),x+=25});let h=tg(e,t,s,m,d,40,b,x-=5);x+=14+(h?60:0)+22}}let v=[];if(n){let{time:e,elevation:s}=this.props,i=[];if(g&&null!=e){let s=u().utc(e);a/t>=400?i.push("".concat(s.format("YYYY MMM DD, HH:mm")," UTC")):i.push(s.format("YYYY MMM DD"))}j&&null!=s&&i.push("".concat(Math.round(10*s)/10," m")),i.length&&v.push(i.join(" \xb7 "))}if(l){let[e,s,i,n]=h,l=a/t>=400?2:1;v.push("Lon: ".concat(tx(e,l)," \xb7 ").concat(tx(i,l)),"Lat: ".concat(tx(s,l)," \xb7 ").concat(tx(n,l)))}for(let a=0;a<v.length;a++)tb(e,v[a],10*t,s-(10+30*a)*t);e.restore()}validateAnimationSpecs(){let{animateAxis:e,animateStart:t,animateStop:a,animateStep:s,videoDuration:i}=this.state;return!!e&&null!=t&&null!=a&&t!==a&&!!s&&!(s<=0)&&!!i&&!(i<=0)}getCmemsLogoSize(e){let t=e9.slice();if(t[0]>.45*e){let a=.45*e/t[0];t[0]*=a,t[1]*=a}return t}constructor(...e){var t;super(...e),t=this,this.refImageCanvas=l.createRef(),this.refVideoCanvas=l.createRef(),this.refVideoDuration=l.createRef(),this.isUnmounted=!1,this.slowWmsWarningShown=!1,this.state={showLogin:!1,tab:"link",isFetchingShortUrl:!1,isShortenedUrl:!1,shareUrl:null,embedUrl:null,imageUrl:null,videoUrl:null,videoBlob:null,isVideoCanvasShown:!1,isRenderingImage:!1,isRenderingVideo:!1,imageRenderError:null,videoRenderError:null,animateAxis:"time",...tn("time",this.props.time,this.props.elevation),overlayLegend:!0,overlayCaption:!0,geoCaption:!1,videoDuration:4,videoFormat:"mp4",videoProgress:0},this.onClickCopyUrl=async()=>{let{intl:e}=this.props,{isShortenedUrl:t,shareUrl:a}=this.state;try{await navigator.clipboard.writeText(a),(0,eU.notify)({type:"success",title:e.$t({id:"notif.copyUrlSuccess",defaultMessage:"Copied URL to your clipboard!"}),msg:t?a:void 0,icon:"copy",iconFamily:"far"}),t_("linkCopy",a)}catch(t){if(/^Abort/.test(t.message)){t_("linkShareCanceled",a);return}console.error(t),(0,eU.notify)({type:"error",title:e.$t({id:"notif.copyUrlFailed",defaultMessage:"Copy failed"}),msg:e.$t({id:"notif.copyUrlManually",defaultMessage:"Please copy the URL manually"}),icon:"copy",iconFamily:"far"})}},this.onClickDownloadImage=async()=>{let e=this.refImageCanvas.current;e&&(e.toBlob(e=>{e&&(0,eq.WN)(e,"cmems.png")},"image/png"),t_("imageDownload"))},this.onChangeDate=e=>t=>{let a=tc(t.target.value),s={[e?"dateStart":"dateStop"]:a},i=this.state[e?"timeStart":"timeStop"];s[e?"animateStart":"animateStop"]=tr(a,i);let n=tm((0,S.merge)(this.state,s));null!=n&&(s.videoDuration=n,this.updateVideoDuration(n)),this.setState(s)},this.onChangeTime=e=>t=>{let a=th(t.target.value),s={[e?"timeStart":"timeStop"]:a},i=this.state[e?"dateStart":"dateStop"];s[e?"animateStart":"animateStop"]=tr(i,a);let n=tm((0,S.merge)(this.state,s));null!=n&&(s.videoDuration=n,this.updateVideoDuration(n)),this.setState(s)},this.onChangeDuration=e=>{let t=e.target.value,a={animateStep:""!==t?JSON.parse(t):null},s=tm((0,S.merge)(this.state,a));null!=s&&(a.videoDuration=s,this.updateVideoDuration(s)),this.setState(a)},this.onClickDownloadVideo=()=>{let{videoUrl:e,videoBlob:t}=this.state;if(null==e||null==t)return;let a=e.indexOf("video/mp4")>=0;(0,eq.WN)(t,a?"cmems.mp4":"cmems.gif"),t_("videoDownload")},this.updateVideoDuration=e=>{var t;let a=this.refVideoDuration.current;a&&(a.value=String(e),null===(t=a.classList)||void 0===t||t.add("wk-flash"),setTimeout(()=>{var e;null===(e=a.classList)||void 0===e||e.remove("wk-flash")},500))},this.onClickShareImage=()=>{let{intl:e}=this.props;(0,eU.notify)({type:"warn",title:e.$t({id:"notif.shareImageTitle",defaultMessage:"To share the image:"}),msg:m.IS_MOBILE?e.$t({id:"notif.shareImageTap",defaultMessage:"Tap and hold on the preview"}):e.$t({id:"notif.shareImageRightClick",defaultMessage:"Right-click on the preview"}),timeOut:1e4,icon:"image",iconFamily:"far"}),t_("imageShare")},this.onClickGenerateVideo=()=>{this.buildVideo()},this.onClickCancelVideo=()=>{this.cancelVideo(),t_("videoCancel")},this.onChangeAnimateAxis=e=>{let{time:t,elevation:a}=this.props;this.setState({animateAxis:e,...tn(e,t,a)})},this.onChangeOverlayFlag=e=>t=>{let a=t.target.checked;this.setState({[e]:a},()=>{"image"===this.state.tab&&this.buildImage()})},this.onClickCopyEmbed=async()=>{let{embedUrl:e}=this.state;if(!e)return;let{intl:t}=this.props;try{let a="".concat(e6).concat(e).concat(e4);await navigator.clipboard.writeText(a),(0,eU.notify)({type:"success",title:t.$t({id:"notif.copyEmbedSuccess",defaultMessage:"Copied embed code snippet to your clipboard!"}),icon:"code"}),t_("embedCopy",e)}catch(e){console.error(e)}},this.cancelVideo=()=>{var e;null===(e=this.videoEncoder)||void 0===e||e.abort(),this.videoEncoder=null,this.setState({isVideoCanvasShown:!1,videoUrl:null,videoBlob:null})},this.drawMap=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{intl:s,settings:i}=t.props,n=te();if(!n.length)throw Error("PAINT_ERROR:No visible layers");let l=n.some(e=>e.classList.contains("particle-layer")),r=e.getContext("2d"),{width:o,height:c}=n[0];e.width!==o&&(e.width=o),e.height!==c&&(e.height=c);try{let e=new Date().getTime();await (0,eU.waitUntil)(()=>{if(t.props.isMapReady||t.isUnmounted)return!0;let a=new Date().getTime();return!t.slowWmsWarningShown&&a-e>=2e4&&((0,eU.notify)({id:"slowWms",type:"warn",title:s.$t({id:"notif.wmsSlow",defaultMessage:"WMS servers are a bit slow today!"}),msg:s.$t({id:"notif.patience",defaultMessage:"Please be patient"}),sticky:!0,icon:"mug-hot"}),t.slowWmsWarningShown=!0),!1}),a.forVideo&&l&&await (0,eU.delay)(2e3)}catch(e){if(t.isUnmounted)return;if("TIME_OUT"!==e.message)throw e;throw Error("PAINT_ERROR:WMS servers timed out — please try again later")}let d=i.highResolution?3:window.devicePixelRatio;t.drawBackground(r,o,c,i.basemap),t.drawMapLayers(r,n,o,c),await t.drawLogos(r,d,o,c),t.drawTitlesAndLegend(r,d,o,c)},this.drawBackground=(e,t,a,s)=>{var i,n;let l=null!==(n=null===(i=m.BASEMAPS[s])||void 0===i?void 0:i.bgColor)&&void 0!==n?n:"black";e.save(),e.globalAlpha=1,e.fillStyle=l,e.fillRect(0,0,t,a),e.restore()},this.drawMapLayers=(e,t,a,s)=>{e.save();for(let i=0;i<t.length;i++){let n=t[i],l=Number(n.style.opacity||"1");e.globalAlpha=isNaN(l)?1:l,e.drawImage(n,0,0,a,s)}e.restore()},this.drawLogos=async(e,t,a,s)=>{if(m.APP_CONFIG.noShareLogos)return;e.save();let i=await ti("/images/save-overlay-myocean-by-cmems2.png"),n=this.getCmemsLogoSize(a/t);e.globalAlpha=1,e.drawImage(i,a-n[0]*t,10*t,n[0]*t,n[1]*t),e.restore()}}}let te=()=>{let e=Array.from(document.getElementsByClassName("tero-maps-layer")),t=[];return e.forEach(e=>{if("CANVAS"===e.tagName){t.push(e);return}let a=e.querySelector("canvas");a&&t.push(a)}),t},tt=e=>{if(1===e)return"hour";if(24===e)return"day";if(168===e)return"week";if(720===e);else if(8760===e)return"year";return"month"},ta=(e,t)=>[Math.min(e,t),Math.max(e,t)],ts={},ti=e=>new Promise((t,a)=>{let s=ts[e];if(s){t(s);return}(s=new Image).onerror=e=>a(e),s.onload=()=>{ts[e]=s,t(s)},s.src=e}),tn=(e,t,a)=>{if("time"!==e)return{animateStart:a,animateStop:a+(a>-50?-1e3:1e3),animateStep:100,dateStart:null,timeStart:null,dateStop:null,timeStop:null};{let{date:e,time:a}=tl(t),s=t+6048e5,{date:i,time:n}=tl(s);return{animateStart:t,animateStop:s,animateStep:24,dateStart:e,timeStart:a,dateStop:i,timeStop:n}}},tl=e=>{if(null===e)return{date:null,time:null};let t=u().utc(e);return{date:t.format("YYYY-MM-DD"),time:t.format("HH:mm")}},tr=(e,t)=>null==e||null==t?null:u().utc("".concat(e,"T").concat(t)).valueOf(),to=e=>null!=e?e:"",tc=e=>""!==e?e:null,td=to,th=tc,tu=e=>null!=e?String(e):"",tp=e=>{if(""===e)return null;let t=Number(e);return isNaN(t)?null:t},tx=(e,t)=>{let a=0|e,s=Math.abs(e-a),i=60*s|0,n=(3600*s-60*i).toFixed(t||0);return a+"\xba "+i+"' "+n+'"'},tm=e=>{if(null==e.animateStart||null==e.animateStop)return null;let t=Math.pow(3,Math.log10(tf(e)/.3));return t<4&&(t=4),t>90&&(t=90),t=Math.round(10*t)/10},tf=e=>{let{animateAxis:t,animateStart:a,animateStop:s,animateStep:i}=e,[n,l]=ta(a,s);return Math.ceil((l-n)/("time"===t?36e5*i:i))},tb=(e,t,a,s)=>{e.save(),e.lineWidth=4,e.strokeStyle="rgba(0, 0, 0, 0.5)",e.strokeText(t,a,s),e.fillStyle="rgba(255, 255, 255, 1)",e.fillText(t,a,s),e.restore()},tg=function(e,t,a,s,i,n,l,r){var o,c,d,h;let u,p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{},x=(0,f.WV)(a,s,i),{valueMin:m,valueMax:b,valueClamp:g,logScale:j}=x,{colormapId:v,colormapInvert:_,colormapStops:y}=x;if(!m&&!b)return!1;let w=null===(o=(0,E.Co)(v,_,y))||void 0===o?void 0:o.raw;if(!w)return!1;e.save(),e.beginPath();let k=null!==(c=p.hGradient)&&void 0!==c?c:14,M=r+k;e.moveTo(n*t,r*t),e.lineTo(l*t,r*t),g&&e.lineTo((l+k/2)*t,(r+k/2)*t),e.lineTo(l*t,M*t),e.lineTo(n*t,M*t),g&&e.lineTo((n-k/2)*t,(r+k/2)*t),e.closePath();let N=[m,b],S=(j?(0,eH.ZE)():(0,eH.m4)()).range([n*t,l*t]).domain(N),I=S.ticks(4),A=M+(null!==(d=p.hTicks)&&void 0!==d?d:8);for(let a=0;a<I.length;a++){let s=I[a];e.moveTo(S(s),M*t),e.lineTo(S(s),A*t)}if(e.lineCap="square",e.lineWidth=5,e.strokeStyle="rgba(0, 0, 0, 0.7)",e.stroke(),e.lineWidth=3,e.strokeStyle="rgba(255, 255, 255, 1)",e.stroke(),e.fillStyle=tj(e,n*t,l*t,r*t,w),e.fill(),j){let e=Math.log10(N[0]);u=Math.log10(N[1])-e<1?e=>.7>(0,f.Ex)(Math.log10(e),1)?String(e):"":e=>0===(0,f.Ex)(Math.log10(e),1)?String(e):""}else u=e=>String(e);let C=null!==(h=p.fontSize)&&void 0!==h?h:22,D=A+C/1.2;e.font="".concat(C/1.2*t,"px Arial");for(let a=0;a<I.length;a++){let s=I[a],i=String(u(s));i.length&&(e.textAlign="center",tb(e,i,S(s),D*t))}return e.restore(),!0},tj=(e,t,a,s,i)=>{let n=e.createLinearGradient(t,s,a,s),l=i.length;for(let e=0;e<l;e++){let t=i[e];n.addColorStop(e/(l-1),"rgb(".concat(t.join(","),")"))}return n},tv=(e,t,a)=>{let s=t.split(" "),i=[],n=s[0];for(let t=1;t<s.length;t++){let l=s[t];e.measureText("".concat(n," ").concat(l)).width<a?n+=" ".concat(l):(i.push(n),n=l)}return i.push(n),i},t_=(e,t)=>(0,eR.PJ)({category:"share",action:e,label:t||void 0}),ty=new String(".wk-modal-share-url .wk-modal-inner{}.share-modal.jsx-2449e0e053fa58ae{margin:var(--modal-padding)}");ty.__hash="2449e0e053fa58ae";let tw=new String(".content.jsx-b128ffd643ef2c75{margin:0 0 20px}.content.hidden.jsx-b128ffd643ef2c75{display:none}.instructions.jsx-b128ffd643ef2c75{margin:10px 190px;text-align:center}.login-form.jsx-b128ffd643ef2c75{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.centered-button.jsx-b128ffd643ef2c75{margin:12px 4px;text-align:center}.share-url.jsx-b128ffd643ef2c75{font-size:.8rem;margin-left:.4em}.snippet.jsx-b128ffd643ef2c75{display:inline-block;font-size:.8rem;padding:5px 10px;word-break:break-word}.inception-wrapper.jsx-b128ffd643ef2c75{width:100%;overflow-x:hidden}.inception.jsx-b128ffd643ef2c75{width:100%;height:350px;border:1px solid var(--color-dim)}.preview-canvas-wrapper.jsx-b128ffd643ef2c75,.preview-image-wrapper.jsx-b128ffd643ef2c75,.preview-video-wrapper.jsx-b128ffd643ef2c75{display:none;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center}.preview-canvas-wrapper.shown.jsx-b128ffd643ef2c75,.preview-image-wrapper.shown.jsx-b128ffd643ef2c75,.preview-video-wrapper.shown.jsx-b128ffd643ef2c75{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex}.preview-canvas-wrapper-2.jsx-b128ffd643ef2c75{position:relative}.preview-canvas-progress.jsx-b128ffd643ef2c75{position:absolute;height:5px;top:-6px;left:0;background-color:var(--color-icon-button-active)}.preview-canvas.jsx-b128ffd643ef2c75,.preview-image.jsx-b128ffd643ef2c75,.preview-video.jsx-b128ffd643ef2c75{display:block;max-width:100%;max-height:min(500px,50vh)}@media screen and (max-width:".concat(m.UI.narrowBreak,"px){.instructions.jsx-b128ffd643ef2c75{font-size:.8rem;margin:10px 0}.inception.jsx-b128ffd643ef2c75{width:-webkit-calc(100% / ").concat(.7,");width:-moz-calc(100% / ").concat(.7,");width:calc(100% / ").concat(.7,");height:").concat(500,"px;-webkit-transform:scale(").concat(.7,");-moz-transform:scale(").concat(.7,");-ms-transform:scale(").concat(.7,");-o-transform:scale(").concat(.7,");transform:scale(").concat(.7,");-webkit-transform-origin:top left;-moz-transform-origin:top left;-ms-transform-origin:top left;-o-transform-origin:top left;transform-origin:top left;margin-bottom:-webkit-calc(        -").concat(500,"px * (1 - ").concat(.7,")      );margin-bottom:-moz-calc(        -").concat(500,"px * (1 - ").concat(.7,")      );margin-bottom:calc(        -").concat(500,"px * (1 - ").concat(.7,")      )}}"));tw.__hash="b128ffd643ef2c75";let tk=new String('.image-video-form.jsx-20438559f1c9f6ec{text-align:center;line-height:1.6;margin-bottom:.4em}.field.jsx-20438559f1c9f6ec{display:inline-block;white-space:nowrap;margin:0 .35em}.field-name.jsx-20438559f1c9f6ec{font-weight:bold;margin-left:.3em;margin-right:.3em}.field-name.start-stop-step.jsx-20438559f1c9f6ec{display:inline-block;min-width:37px;text-align:right}.optional-break.jsx-20438559f1c9f6ec{display:none}input[type="date"].jsx-20438559f1c9f6ec{width:155px}input[type="time"].jsx-20438559f1c9f6ec{width:110px}input[type="date"].jsx-20438559f1c9f6ec+input[type="time"].jsx-20438559f1c9f6ec{margin-left:2px}input[type="number"].jsx-20438559f1c9f6ec{width:80px}input.video-duration.jsx-20438559f1c9f6ec{width:55px}input[type="number"].jsx-20438559f1c9f6ec,input[type="datetime-local"].jsx-20438559f1c9f6ec,input[type="date"].jsx-20438559f1c9f6ec,input[type="time"].jsx-20438559f1c9f6ec,select.jsx-20438559f1c9f6ec{height:1.5em}input[type="radio"].jsx-20438559f1c9f6ec,input[type="checkbox"].jsx-20438559f1c9f6ec{margin-right:.3em}label.jsx-20438559f1c9f6ec{white-space:nowrap}label.jsx-20438559f1c9f6ec+label.jsx-20438559f1c9f6ec{margin-left:.6em}.image-video-form.disabled.jsx-20438559f1c9f6ec *.jsx-20438559f1c9f6ec{color:var(--color-disabled);pointer-events:none}.format-usage.jsx-20438559f1c9f6ec{color:var(--color-text-dim)}@media screen and (max-width:'.concat(m.UI.narrowBreak,"px){.optional-break.jsx-20438559f1c9f6ec{display:block}}"));tk.__hash="20438559f1c9f6ec";let tM=(0,d.Ng)(e=>({loginStatus:(0,v.iN)(e),isMapReady:(0,v.oS)(e),datasets:(0,v.yT)(e),mapLayers:(0,v.b7)(e),time:(0,v.WB)(e),elevation:(0,v.S1)(e),settings:(0,v.mt)(e),visibleBBox:(0,v.Eb)(e)}),x)((0,eb.Ay)(e7));var tN=a(8867),tS=a(78945),tI=a(19101);let tA=e=>{let{refTime:t,showAfterMs:a=5e3}=e,[i,n]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{let e=setTimeout(()=>{n(!0)},a);return()=>clearTimeout(e)},[a]),i&&null!=t?(0,s.jsxs)("div",{className:"cm-miniform-patience","data-sentry-component":"render","data-sentry-source-file":"965-Patience.tsx",children:[(0,s.jsx)(ef.A,{id:"subset.patience",defaultMessage:"Please be patient","data-sentry-element":"FormattedMessage","data-sentry-source-file":"965-Patience.tsx"}),"… ",(0,s.jsx)(ef.A,{id:"subset.elapsed",defaultMessage:"Elapsed","data-sentry-element":"FormattedMessage","data-sentry-source-file":"965-Patience.tsx"}),": ",(0,s.jsx)(tI.A,{format:"mm:ss",refTime:t,"data-sentry-element":"Clock","data-sentry-source-file":"965-Patience.tsx"})]}):null},tC=new String(".login-block.jsx-7d910f529d8b5f99{margin-top:1em;text-align:center}");tC.__hash="7d910f529d8b5f99";let tD=e=>{let t=(0,d.d4)(v.iN),[a,i]=(0,l.useState)(!1),r="LOGGED_IN"===t;return(0,l.useEffect)(()=>{r||i(!0)},[]),r?e.children:(0,s.jsxs)("div",{"data-sentry-component":"render","data-sentry-source-file":"900-LoggedInFeature.tsx",className:"jsx-".concat(tC.__hash)+" login-block",children:[(0,s.jsx)("button",{onClick:()=>{i(!0)},className:"jsx-".concat(tC.__hash)+" wk-button extra-small log-in",children:(0,s.jsx)(ef.A,{id:"subset.logInButton",defaultMessage:"Log in","data-sentry-element":"FormattedMessage","data-sentry-source-file":"900-LoggedInFeature.tsx"})}),a&&(0,s.jsx)(eX.A,{onClose:()=>{i(!1)}}),(0,s.jsx)(n(),{id:tC.__hash,children:tC})]})};var tT=a(18152);let tL=new String(".required-asterisk.jsx-4cd210519713a94b{position:relative;top:-3px;color:var(--color-alert);cursor:default}");tL.__hash="4cd210519713a94b";let tE=()=>{let e=(0,tN.A)();return(0,s.jsxs)("span",{title:e.$t({id:"asterisk",defaultMessage:"Required"}),"data-sentry-component":"RequiredAsterisk","data-sentry-source-file":"995-RequiredAsterisk.tsx",className:"jsx-".concat(tL.__hash)+" required-asterisk",children:["*",(0,s.jsx)(n(),{id:tL.__hash,children:tL})]})};class tO extends l.PureComponent{componentDidMount(){let{mapObject:e}=this.props,{xLayerObject:t}=this.props;t&&!t.isShown&&(t=(0,S.set)(t,"isShown",!0),this.props.updateXLayerObject(this.props.mapLayerId,t),e&&!e.beingDrawn&&this.applyBboxOfSelectedObject(e))}componentDidUpdate(e){let{mapObject:t}=this.props;t&&t!==e.mapObject&&!t.beingDrawn&&(this.applyBboxOfSelectedObject(t),this.props.isRequestingXLayerObject&&this.props.setXLayerObjectRequester(null))}componentWillUnmount(){let{isRequestingXLayerObject:e}=this.props;e&&(this.props.setXLayerObjectRequester(null),this.props.setActiveTool(null));let{xLayerObject:t}=this.props;(null==t?void 0:t.isShown)&&(t=(0,S.set)(t,"isShown",!1),this.props.updateXLayerObject(this.props.mapLayerId,t))}render(){let{intl:e,mapObject:t,showClearButton:a}=this.props,{required:i,error:l}=this.props;return(0,s.jsxs)("div",{"data-sentry-component":"LinkedBboxForm","data-sentry-source-file":"410-LinkedBboxForm.tsx",className:"jsx-".concat(tP.__hash)+" "+(c()("cm-miniform-field",{"recently-changed":this.state.hasRecentlyChanged})||""),children:[(0,s.jsxs)("div",{className:"jsx-".concat(tP.__hash)+" cm-miniform-field-label",children:[(0,s.jsx)(ef.A,{id:"subset.aoi",defaultMessage:"Geographic area","data-sentry-element":"FormattedMessage","data-sentry-source-file":"410-LinkedBboxForm.tsx"}),i&&(0,s.jsx)(tE,{}),(0,s.jsx)("button",{onClick:this.onClickBboxOrSelect,className:"jsx-".concat(tP.__hash)+" "+(c()("wk-button extra-small cm-miniform-button",{active:this.props.activeTool===m.UI.tools.subsetBbox&&this.props.isRequestingXLayerObject})||""),children:(0,s.jsx)(ef.A,{id:"subset.defineOnMap",defaultMessage:"Define on map","data-sentry-element":"FormattedMessage","data-sentry-source-file":"410-LinkedBboxForm.tsx"})}),a&&(0,s.jsx)("span",{title:e.$t({id:"subset.clearGeoArea",defaultMessage:"Clear geographic area"}),className:"jsx-".concat(tP.__hash)+" wk-icon-button cm-miniform-icon-button btn-clear",children:(0,s.jsx)(eU.Icon,{icon:"times-circle",onClick:this.onClickClearButton})})]}),l&&(0,s.jsx)("div",{className:"jsx-".concat(tP.__hash)+" cm-miniform-field-error",children:l}),t&&(0,s.jsxs)("div",{className:"jsx-".concat(tP.__hash)+" geo-area-notice",children:[(0,s.jsx)(eU.Icon,{icon:"link",disabled:!0})," ",(0,s.jsx)(ef.A,{id:"subset.linkedToGeometry",defaultMessage:"Linked to a geometry on the map"})]}),(0,s.jsxs)("div",{className:"jsx-".concat(tP.__hash)+" coords",children:[(0,s.jsx)("div",{className:"jsx-".concat(tP.__hash),children:this.renderCoord("latMax","N")}),(0,s.jsxs)("div",{className:"jsx-".concat(tP.__hash),children:[this.renderCoord("lonMin","W"),this.renderCoord("lonMax","E")]}),(0,s.jsx)("div",{className:"jsx-".concat(tP.__hash),children:this.renderCoord("latMin","S")})]}),(0,s.jsx)(n(),{id:tP.__hash,children:tP})]})}applyBboxOfSelectedObject(e){var t;let a=null==e?void 0:null===(t=e.features)||void 0===t?void 0:t[0];if(!a)return;let s=(0,tT.A)(a.geometry);if(!s)return;let[i,n,l,r]=s;this.setAttr("lonMin",i),this.setAttr("lonMax",l),this.setAttr("latMin",n),this.setAttr("latMax",r),this.state.hasRecentlyChanged||(this.setState({hasRecentlyChanged:!0}),this.resetRecentlyChanged()),this.resetRecentlyChanged()}constructor(...e){super(...e),this.ref_lonMin=l.createRef(),this.ref_lonMax=l.createRef(),this.ref_latMin=l.createRef(),this.ref_latMax=l.createRef(),this.state={hasRecentlyChanged:!1},this.renderCoord=(e,t)=>{let{initialValues:a,isInvalid:i}=this.props,l=null==i?void 0:i[e];return(0,s.jsxs)("span",{className:"jsx-".concat(tP.__hash)+" coord",children:[(0,s.jsxs)("span",{className:"jsx-".concat(tP.__hash)+" coord-label",children:[t,":"]}),(0,s.jsx)(eU.NumberInput,{ref:this["ref_".concat(e)],id:"".concat(this.props.mapLayerId,"-").concat(e),className:c()("cm-miniform-input",{invalid:l}),value:a[e],onChange:(t,a)=>this.onChangeAttr(e,a)}),(0,s.jsx)(n(),{id:tP.__hash,children:tP})]})},this.onChangeAttr=(e,t)=>{this.deleteXLayerObject(),this.props.onChangeAttr(e,t)},this.onClickClearButton=()=>{this.deleteXLayerObject(),this.setAttr("lonMin",null),this.setAttr("lonMax",null),this.setAttr("latMin",null),this.setAttr("latMax",null)},this.setAttr=(e,t)=>{var a,s;null===(s=this["ref_".concat(e)])||void 0===s||null===(a=s.current)||void 0===a||a.setValue(t),this.props.onChangeAttr(e,t)},this.deleteXLayerObject=()=>{this.props.xLayerObject&&this.props.deleteXLayerObject(this.props.mapLayerId)},this.onClickBboxOrSelect=()=>{let{mapLayerId:e}=this.props,t=this.props.activeTool===m.UI.tools.subsetBbox&&this.props.isRequestingXLayerObject?null:m.UI.tools.subsetBbox;this.props.setActiveTool(t),this.props.setXLayerObjectRequester(t?e:null)},this._resetRecentlyChanged=()=>{this.state.hasRecentlyChanged&&this.setState({hasRecentlyChanged:!1})},this.resetRecentlyChanged=et()(this._resetRecentlyChanged,300,{leading:!1,trailing:!0})}}let tP=new String(".btn-clear.jsx-849b301f7c11966a{margin-left:.8em}.geo-area-notice.jsx-849b301f7c11966a{color:var(--color-dim)}.coords.jsx-849b301f7c11966a{margin-top:3px;text-align:center;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content}.coord.jsx-849b301f7c11966a{display:inline-block;-webkit-transition:color 1s ease-in;-moz-transition:color 1s ease-in;-o-transition:color 1s ease-in;transition:color 1s ease-in}.coord.jsx-849b301f7c11966a+.coord.jsx-849b301f7c11966a{margin-left:.6em}.coord-label.jsx-849b301f7c11966a{display:inline-block;margin-right:.3em;min-width:1.2em}.cm-miniform-field.recently-changed.jsx-849b301f7c11966a .coord.jsx-849b301f7c11966a{color:var(--color-icon-button-active);-webkit-transition:color 0s ease-in;-moz-transition:color 0s ease-in;-o-transition:color 0s ease-in;transition:color 0s ease-in}");tP.__hash="849b301f7c11966a";let tz=(0,d.Ng)((e,t)=>{var a,s;let{mapLayerId:i}=t,n=(0,v.QM)(e),l=null!==(a=n[i])&&void 0!==a?a:null,r=n._requesterLayerId===i,o=null;return l&&(o=null!==(s=Object.values((0,v.B_)(e)).find(e=>e.id===l.objectId))&&void 0!==s?s:null),{activeTool:(0,v.Z9)(e),xLayerObject:l,mapObject:o,isRequestingXLayerObject:r}},x)((0,eb.Ay)(tO)),tF=[{value:"thetao",label:e=>e.$t({id:"aiForecast.thetao",defaultMessage:"Temperature"})},{value:"so",label:e=>e.$t({id:"aiForecast.so",defaultMessage:"Salinity"})},{value:"zos",label:e=>e.$t({id:"aiForecast.zos",defaultMessage:"Sea surface height"})},{value:"uo",label:e=>e.$t({id:"aiForecast.uo",defaultMessage:"Eastward velocity"})},{value:"vo",label:e=>e.$t({id:"aiForecast.vo",defaultMessage:"Northward velocity"})}],tU="__aiForecast",tR={title:null,lonMin:null,lonMax:null,latMin:null,latMax:null,elevationMin:-1,tRef:null,tEnd:null,variableIds:["thetao","so"]},tB=e=>{let t=(0,r.useRouter)(),a=(0,tN.A)(),i=(0,d.wA)(),o=(0,d.d4)(v.WB),h=(0,d.d4)(v.S1),p=(0,d.d4)(v.b7),b=(0,d.d4)(v.yT),g=(0,d.d4)(v.wz),[j,_]=(0,l.useState)(!1),[y,w]=(0,l.useState)(null),[k,M]=(0,l.useState)(null),N=(0,l.useRef)(tR),[S,I]=(0,l.useState)(tR),A=(0,l.useRef)(null),C=(0,l.useRef)(null),D=(0,l.useRef)(null),[T,L]=(0,l.useState)(null);(0,l.useEffect)(()=>{(async()=>{L(await (0,e_.z)("https://s3.waw3-1.cloudferro.com/udl-metadata/metadata-longlived/GLONET_PRECOMPUTED/history_P1D/dataset.stac.json"))})()},[]);let E=tV(a,S,T),O=Object.keys(E).length>0,P=()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("p",{className:"jsx-".concat(t$.__hash)+" instructions",children:[(0,s.jsx)("b",{className:"jsx-".concat(t$.__hash),children:(0,s.jsx)(ef.A,{id:"notif.restrictedFeature",defaultMessage:"Restricted feature","data-sentry-element":"FormattedMessage","data-sentry-source-file":"205-AiForecast.tsx"})})," ","—"," ",(0,s.jsx)(ef.A,{id:"notif.contactSupport",defaultMessage:"Please contact User Support","data-sentry-element":"FormattedMessage","data-sentry-source-file":"205-AiForecast.tsx"})]}),(0,s.jsx)(n(),{id:t$.__hash,children:t$})]}),z=()=>(0,s.jsxs)("div",{"data-sentry-component":"renderForm","data-sentry-source-file":"205-AiForecast.tsx",className:"jsx-".concat(tq.__hash)+" form",children:[F(),U(),R(),B(),V(),(0,s.jsx)(n(),{id:tq.__hash,children:tq})]}),F=()=>(0,s.jsx)(tz,{mapLayerId:tU,initialValues:{lonMin:N.current.lonMin,lonMax:N.current.lonMax,latMin:N.current.latMin,latMax:N.current.latMax},showClearButton:!1,onChangeAttr:W,required:!0,isInvalid:{lonMin:!!E.lonMin,lonMax:!!E.lonMax,latMin:!!E.latMin,latMax:!!E.latMax},error:E.bbox,"data-sentry-element":"LinkedBboxForm","data-sentry-component":"renderBbox","data-sentry-source-file":"205-AiForecast.tsx"}),U=()=>{let e=E.tbox,{tRefMin:t,tRefMax:a}=tG(T),i=(0,eF.x8)(p,b,{});return(0,s.jsxs)("div",{"data-sentry-component":"renderTime","data-sentry-source-file":"205-AiForecast.tsx",className:"jsx-".concat(tq.__hash)+" cm-miniform-field",children:[(0,s.jsxs)("div",{className:"jsx-".concat(tq.__hash)+" cm-miniform-field-label",children:[(0,s.jsx)(ef.A,{id:"aiForecast.dateRange",defaultMessage:"Dates","data-sentry-element":"FormattedMessage","data-sentry-source-file":"205-AiForecast.tsx"}),(0,s.jsx)(tE,{"data-sentry-element":"RequiredAsterisk","data-sentry-source-file":"205-AiForecast.tsx"}),(0,s.jsxs)("span",{className:"jsx-".concat(tq.__hash)+" cm-miniform-field-domain",children:[(0,s.jsx)(ef.A,{id:"aiForecast.tRef",defaultMessage:"Ref","data-sentry-element":"FormattedMessage","data-sentry-source-file":"205-AiForecast.tsx"}),":"," ",(0,f.Kq)(t),(0,s.jsx)("span",{className:"jsx-".concat(tq.__hash)+" cm-miniform-field-domain-sep",children:"→"}),(0,f.Kq)(a)]})]}),e&&(0,s.jsx)("div",{className:"jsx-".concat(tq.__hash)+" cm-miniform-field-error",children:e}),(0,s.jsx)("div",{className:"jsx-".concat(tq.__hash)+" cm-miniform-field-values",children:(0,s.jsxs)("div",{className:"jsx-".concat(tq.__hash)+" cm-miniform-field-value",children:[(0,s.jsxs)("span",{className:"jsx-".concat(tq.__hash)+" cm-miniform-range-label",children:[(0,s.jsx)(ef.A,{id:"aiForecast.tRef",defaultMessage:"Ref","data-sentry-element":"FormattedMessage","data-sentry-source-file":"205-AiForecast.tsx"}),":"]}),(0,s.jsx)(eU.DateInput,{ref:C,id:"".concat(tU,"-tRef"),className:c()("cm-miniform-input",{invalid:E.tRef}),time:!1,utc:!0,type:"native",value:N.current.tRef,onChange:(e,t)=>W("tRef",t),"data-sentry-element":"DateInput","data-sentry-source-file":"205-AiForecast.tsx"}),(0,s.jsx)("button",{disabled:!i,onClick:i?()=>{H("tRef",C,u().utc(o).startOf("day").toDate())}:void 0,className:"jsx-".concat(tq.__hash)+" "+(c()("wk-button extra-small cm-miniform-button",{disabled:!i})||""),children:(0,s.jsx)(ef.A,{id:"subset.asInMap",defaultMessage:"As in map","data-sentry-element":"FormattedMessage","data-sentry-source-file":"205-AiForecast.tsx"})})]})}),(0,s.jsx)("div",{className:"jsx-".concat(tq.__hash)+" cm-miniform-field-values",children:(0,s.jsxs)("div",{className:"jsx-".concat(tq.__hash)+" cm-miniform-field-value",children:[(0,s.jsxs)("span",{className:"jsx-".concat(tq.__hash)+" cm-miniform-range-label",children:[(0,s.jsx)(ef.A,{id:"aiForecast.tEnd",defaultMessage:"End","data-sentry-element":"FormattedMessage","data-sentry-source-file":"205-AiForecast.tsx"}),":"]}),(0,s.jsx)(eU.DateInput,{ref:D,id:"".concat(tU,"-tEnd"),className:c()("cm-miniform-input",{invalid:E.tEnd}),time:!1,utc:!0,type:"native",value:N.current.tEnd,onChange:(e,t)=>W("tEnd",t),"data-sentry-element":"DateInput","data-sentry-source-file":"205-AiForecast.tsx"}),(0,s.jsx)("button",{disabled:!i,onClick:i?()=>{H("tEnd",D,u().utc(o).startOf("day").toDate())}:void 0,className:"jsx-".concat(tq.__hash)+" "+(c()("wk-button extra-small cm-miniform-button",{disabled:!i})||""),children:(0,s.jsx)(ef.A,{id:"subset.asInMap",defaultMessage:"As in map","data-sentry-element":"FormattedMessage","data-sentry-source-file":"205-AiForecast.tsx"})})]})}),(0,s.jsx)(n(),{id:tq.__hash,children:tq})]})},R=()=>{let e=!!E.elevationMin,t=(0,eF.V7)(p,b,{});return(0,s.jsxs)("div",{"data-sentry-component":"renderDepth","data-sentry-source-file":"205-AiForecast.tsx",className:"jsx-".concat(tq.__hash)+" cm-miniform-field",children:[(0,s.jsxs)("div",{className:"jsx-".concat(tq.__hash)+" cm-miniform-field-label",children:[(0,s.jsx)(ef.A,{id:"aiForecast.maxDepth",defaultMessage:"Depth (maximum)","data-sentry-element":"FormattedMessage","data-sentry-source-file":"205-AiForecast.tsx"}),(0,s.jsx)(tE,{"data-sentry-element":"RequiredAsterisk","data-sentry-source-file":"205-AiForecast.tsx"}),(0,s.jsxs)("span",{className:"jsx-".concat(tq.__hash)+" cm-miniform-field-domain",children:[(0,s.jsx)("span",{className:"jsx-".concat(tq.__hash)+" cm-miniform-field-domain-sep",children:"→"}),"".concat(5275," m")]})]}),(0,s.jsx)("div",{className:"jsx-".concat(tq.__hash)+" cm-miniform-field-values",children:(0,s.jsxs)("div",{className:"jsx-".concat(tq.__hash)+" cm-miniform-field-value",children:[(0,s.jsx)(eU.NumberInput,{ref:A,id:"".concat(tU,"-elevationMin"),className:c()("cm-miniform-input",{invalid:e}),value:(0,tS.gu)(N.current.elevationMin),onChange:(e,t)=>W("elevationMin",(0,tS.gu)(t)),"data-sentry-element":"NumberInput","data-sentry-source-file":"205-AiForecast.tsx"}),(0,s.jsx)("span",{className:"jsx-".concat(tq.__hash)+" cm-miniform-unit",children:"m"}),(0,s.jsx)("button",{disabled:!t,onClick:t?()=>{H("elevationMin",A,(0,tS.qE)(h,-5275,-.49),{negative:!0})}:void 0,className:"jsx-".concat(tq.__hash)+" "+(c()("wk-button extra-small cm-miniform-button",{disabled:!t})||""),children:(0,s.jsx)(ef.A,{id:"subset.asInMap",defaultMessage:"As in map","data-sentry-element":"FormattedMessage","data-sentry-source-file":"205-AiForecast.tsx"})})]})}),(0,s.jsx)(n(),{id:tq.__hash,children:tq})]})},B=()=>{let e=E.variableIds;return(0,s.jsxs)("div",{"data-sentry-component":"renderVariables","data-sentry-source-file":"205-AiForecast.tsx",className:"jsx-".concat(tq.__hash)+" cm-miniform-field",children:[(0,s.jsxs)("div",{className:"jsx-".concat(tq.__hash)+" cm-miniform-field-label",children:[(0,s.jsx)(ef.A,{id:"aiForecast.variables",defaultMessage:"Variables","data-sentry-element":"FormattedMessage","data-sentry-source-file":"205-AiForecast.tsx"}),(0,s.jsx)(tE,{"data-sentry-element":"RequiredAsterisk","data-sentry-source-file":"205-AiForecast.tsx"})]}),e&&(0,s.jsx)("div",{className:"jsx-".concat(tq.__hash)+" cm-miniform-field-error",children:e}),(0,s.jsx)("div",{className:"jsx-".concat(tq.__hash)+" cm-miniform-field-values two-col",children:tF.map(e=>(0,s.jsx)("div",{className:"jsx-".concat(tq.__hash)+" cm-miniform-field-value",children:(0,s.jsx)(eU.Checkbox,{id:"".concat(tU,"-").concat(e.value),className:"cm-miniform-input no-wrap",checked:S.variableIds.includes(e.value),onChange:(t,a)=>{W("variableIds",a?[...S.variableIds,e.value]:S.variableIds.filter(t=>t!==e.value))},label:e.label(a)})},e.value))}),(0,s.jsx)(n(),{id:tq.__hash,children:tq})]})},V=()=>{let e=Z();return(0,s.jsxs)("div",{"data-sentry-component":"renderTitle","data-sentry-source-file":"205-AiForecast.tsx",className:"jsx-".concat(tq.__hash)+" cm-miniform-field",children:[(0,s.jsx)("div",{className:"jsx-".concat(tq.__hash)+" cm-miniform-field-label",children:(0,s.jsx)(ef.A,{id:"aiForecast.title",defaultMessage:"Title","data-sentry-element":"FormattedMessage","data-sentry-source-file":"205-AiForecast.tsx"})}),(0,s.jsx)("div",{className:"jsx-".concat(tq.__hash)+" cm-miniform-field-values",children:(0,s.jsx)("div",{className:"jsx-".concat(tq.__hash)+" cm-miniform-field-value",children:(0,s.jsx)("input",{type:"text",id:"".concat(tU,"-title"),value:S.title||"",onChange:e=>W("title",e.target.value||null,{noPersist:!0}),placeholder:e,className:"jsx-".concat(tq.__hash)+" cm-miniform-input dataset-title"})})}),(0,s.jsx)(n(),{id:tq.__hash,children:tq})]})},G=()=>{let e=!O&&!j;return(0,s.jsxs)("div",{"data-sentry-component":"renderButtons","data-sentry-source-file":"205-AiForecast.tsx",className:"jsx-".concat(tq.__hash)+" cm-miniform-button-block",children:[j&&(0,s.jsx)(tA,{refTime:y}),(0,s.jsxs)("div",{className:"jsx-".concat(tq.__hash)+" cm-miniform-button-row",children:[j&&k&&(0,s.jsx)("div",{onClick:q,className:"jsx-".concat(tq.__hash)+" wk-button small",children:(0,s.jsx)(ef.A,{id:"tools.cancel",defaultMessage:"Cancel"})}),(0,s.jsx)("div",{onClick:e?$:void 0,className:"jsx-".concat(tq.__hash)+" "+(c()("wk-button primary small",{disabled:!e})||""),children:j?(0,s.jsx)(e1.A,{timeout:0}):(0,s.jsx)(ef.A,{id:"tools.aiForecast.getForecast",defaultMessage:"Get forecast"})})]}),(0,s.jsx)(n(),{id:tq.__hash,children:tq})]})},W=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};I(a=>({...a,[e]:t})),a.noPersist||(tR[e]=t)},H=function(e,t,a){var s;let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};null===(s=t.current)||void 0===s||s.setValue(i.negative?(0,tS.gu)(a):a),W(e,a,{noPersist:i.noPersist})},$=async()=>{if(j||O)return;let a=S.variableIds,{elevationMin:s}=S,{lonMin:n,lonMax:l,latMin:r,latMax:o}=S,c=u().utc(S.tRef).format("YYYY-MM-DD"),d=u().utc(S.tEnd).format("YYYY-MM-DD"),h=S.title||Z();try{_(!0),w(Date.now());let u=await i((0,x.requestAiForecast)({type:"aiForecast",details:{variables:a,elevationRange:[s,-.49],bbox:[n,r,l,o],tRef:c,tEnd:d,location:void 0},title:h}));M(u);let p=await i((0,x.waitForUserDataset)(u));if((null==p?void 0:p.status)==="RUNNING")e.onClose(),t.push("".concat(m.URLS.viewer,"?view=layers&dataset=").concat(p.id));else{let e=Error("ADMP_ERROR");throw e.myoErrorCode="ADMP_ERROR",console.error("ADMP_ERROR: ".concat(null==p?void 0:p.error)),e}}catch(e){Y(e),console.error(e)}finally{_(!1),w(null),M(null)}},q=async()=>{try{await i((0,x.deleteUserDataset)(k))}catch(e){console.error(e)}},Z=()=>null!=S.tRef&&null!=S.tEnd?a.$t({id:"aiForecast.titlePlaceholderWithDate",defaultMessage:"AI forecast up to {tEnd} (reference: {tRef})"},{tRef:(0,f.Kq)(S.tRef.getTime()),tEnd:(0,f.Kq)(S.tEnd.getTime())}):a.$t({id:"aiForecast.titlePlaceholder",defaultMessage:"AI forecast"}),Y=e=>{let t,s="";switch(e.myoErrorCode){case"ADMP_UNAVAILABLE":s=a.$t({id:"notif.admpUnavailable",defaultMessage:"Feature is currently unavailable"}),t=a.$t({id:"notif.tryLater",defaultMessage:"Please try again later"});break;case"ADMP_ERROR":s=a.$t({id:"notif.admpError",defaultMessage:"Error preparing data"}),t=a.$t({id:"notif.checkConsole",defaultMessage:"Please check the console"});break;case"UNAUTHORIZED":s=a.$t({id:"notif.restrictedFeature",defaultMessage:"Restricted feature"}),t=a.$t({id:"notif.contactSupport",defaultMessage:"Please contact User Support"});break;case"BAD_REQUEST":s=a.$t({id:"notif.badRequest",defaultMessage:"Invalid request"}),t=e.displayMessage;break;case"QUOTA_EXCEEDED":s=a.$t({id:"notif.quotaExceeded",defaultMessage:"Quota exceeded"}),t=a.$t({id:"notif.deleteSomeDatasets",defaultMessage:"Delete some datasets and try again"});break;default:s=a.$t({id:"notif.aiForecastError",defaultMessage:"Error requesting forecast"}),t=e.displayMessage}(0,eU.notify)({type:"error",icon:"screwdriver-wrench",title:s,msg:t})};return(()=>{var e;return g.isAdmin||(null===(e=g.permissions)||void 0===e?void 0:e.createAiForecast)?(0,s.jsxs)("div",{"data-sentry-component":"render","data-sentry-source-file":"205-AiForecast.tsx",className:"jsx-".concat(tq.__hash),children:[z(),G(),(0,s.jsx)(n(),{id:tq.__hash,children:tq})]}):P()})()},tV=(e,t,a)=>{let s={},{lonMin:i,lonMax:n,latMin:l,latMax:r}=t;null==i&&(s.lonMin=!0),null==n&&(s.lonMax=!0),null==l&&(s.latMin=!0),null==r&&(s.latMax=!0);let o=[];null!=i&&(i<-180||i>=180)&&(o.push(tW(e)),s.lonMin=!0),null!=n&&(n<-180||n>=180)&&(o.push(tW(e)),s.lonMax=!0),null!=l&&(l<-90||l>90)&&(o.push(tH(e)),s.latMin=!0),null!=r&&(r<-90||r>90)&&(o.push(tH(e)),s.latMax=!0),null!=i&&null!=n&&(n-i<.1&&(o.push(e.$t({id:"validate.minLonDelta",defaultMessage:"Longitude range must be at least {value}\xb0."},{value:.1})),s.lonMin=s.lonMax=!0),n-i>100&&(o.push(e.$t({id:"validate.maxLonDelta",defaultMessage:"Longitude range must be at most {value}\xb0."},{value:100})),s.lonMin=s.lonMax=!0)),null!=l&&null!=r&&(r-l<.1&&(o.push(e.$t({id:"validate.minLatDelta",defaultMessage:"Latitude range must be at least {value}\xb0."},{value:.1})),s.latMin=s.latMax=!0),r-l>60&&(o.push(e.$t({id:"validate.maxLatDelta",defaultMessage:"Latitude range must be at most {value}\xb0."},{value:100})),s.latMin=s.latMax=!0)),o.length>0&&(s.bbox=o.join(" "));let{elevationMin:c}=t;(null==c||(0,tS.hb)(c,-5275,-.49))&&(s.elevationMin=!0);let{tRef:d,tEnd:h}=t;null==d&&(s.tRef=!0),null==h&&(s.tEnd=!0);let p=[];if(null!=d){let{tRefMin:t,tRefMax:i}=tG(a);if((0,tS.hb)(d.getTime(),t,i)&&(s.tRef=!0,p.push(e.$t({id:"validate.tRefRange",defaultMessage:"Reference date must be between {min} and {max}."},{min:(0,f.Kq)(t),max:(0,f.Kq)(i)}))),null!=h){let t=u().utc(d).startOf("day").add(1,"day").valueOf(),a=u().utc(d).startOf("day").add(10,"days").valueOf();(0,tS.hb)(h.getTime(),t,a)&&(s.tEnd=!0,p.push(e.$t({id:"validate.tEndRange",defaultMessage:"End date must be between 1 and 10 days after the reference date."})))}}return p.length>0&&(s.tbox=p.join(" ")),0===t.variableIds.length&&(s.variableIds=e.$t({id:"validate.atLeastOne",defaultMessage:"Choose at least one option."})),s},tG=e=>e?{tRefMin:u().utc(e.properties.start_datetime).valueOf(),tRefMax:u().utc(e.properties.end_datetime).valueOf()}:{tRefMin:u().utc().subtract(30,"days").startOf("day").valueOf(),tRefMax:u().utc().startOf("day").valueOf()},tW=e=>e.$t({id:"validate.lonRange",defaultMessage:"Longitude must be between -180\xb0 and +180\xb0."}),tH=e=>e.$t({id:"validate.latRange",defaultMessage:"Latitude must be between -90\xb0 and +90\xb0."}),t$=new String(".instructions.jsx-7d2ddf45e2e37972{font-style:italic;text-align:center}");t$.__hash="7d2ddf45e2e37972";let tq=new String(".form.jsx-852b778059dfbf7d{padding:var(--modal-padding)}.dataset-title.jsx-852b778059dfbf7d{width:100%}.two-col.jsx-852b778059dfbf7d{-webkit-columns:2;-moz-columns:2;columns:2}.giu-checkbox.cm-miniform-input.no-wrap .giu-checkbox-label{white-space:nowrap}");tq.__hash="852b778059dfbf7d";let tZ=e=>(0,s.jsxs)("div",{"data-sentry-component":"LoggedInAiForecast","data-sentry-source-file":"205-AiForecast.tsx",className:"jsx-".concat(t$.__hash)+" tools",children:[(0,s.jsx)("div",{className:"jsx-".concat(t$.__hash)+" instructions",children:(0,s.jsx)(ef.A,{id:"tools.aiForecast.instructions",defaultMessage:"Get a tailored AI-based forecast for your area of interest.","data-sentry-element":"FormattedMessage","data-sentry-source-file":"205-AiForecast.tsx"})}),(0,s.jsx)(tD,{"data-sentry-element":"LoggedInFeature","data-sentry-source-file":"205-AiForecast.tsx",children:(0,s.jsx)(tB,{...e,"data-sentry-element":"AiForecast","data-sentry-source-file":"205-AiForecast.tsx"})}),(0,s.jsx)(n(),{id:t$.__hash,children:t$})]}),tY=new String(".control-block-tools.jsx-9f1ad56bf3994bc9{padding:var(--modal-padding);border-bottom:1px solid var(--color-subtle-line);font-size:.8rem;background-color:var(--color-title-bg-lighter)}");tY.__hash="9f1ad56bf3994bc9";let tJ=e=>(0,s.jsxs)("div",{"data-sentry-component":"render","data-sentry-source-file":"200-ControlBlockTools.tsx",className:"jsx-".concat(tY.__hash)+" control-block-tools",children:[(0,s.jsx)(tZ,{onClose:e.onClose,"data-sentry-element":"AiForecast","data-sentry-source-file":"200-ControlBlockTools.tsx"}),(0,s.jsx)(n(),{id:tY.__hash,children:tY})]});var tK=a(51321),tQ=a(87046),tX=a(5414),t0=a(56550);let t1=new String(".card-layer-select.jsx-7b6e7cb2f3e9ae28{margin-left:.6em}.card-layer-select.jsx-7b6e7cb2f3e9ae28 select.jsx-7b6e7cb2f3e9ae28{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0}");t1.__hash="7b6e7cb2f3e9ae28";let t2=e=>{let{cardId:t,cardLayerId:a}=e,i=(0,tN.A)(),l=(0,d.wA)(),r=(0,d.d4)(v.yT),o=(0,d.d4)(v.b7),c=e=>{let a=e.target.value;""!==a&&(l((0,x.assignNewLayerToCard)(t,a)),(0,eR.PJ)({category:"dashboard",action:"cardReconfigure"}))};return(()=>{let e=[];return Object.values(o).filter(e=>e.id===a||null==e.cardId).filter(e=>!e.isDashboardOverlay).forEach(t=>{let a=r[(0,f.ei)(t.layerId).datasetId],s=(0,f.VF)(r,t.layerId);if(!(0,e_.p)(a)||!s)return;let n={context:t.dashboardLabel},l=(0,f.ez)(s,a,i,n);e.push({value:t.id,label:l})}),e.sort(C.Y3),a||e.unshift({label:i.$t({id:"dashboard.card.selectVariable",defaultMessage:"Select a variable:"}),value:""}),(0,s.jsxs)("span",{"data-sentry-component":"render","data-sentry-source-file":"900-ViewerCardLayerSelect.tsx",className:"jsx-".concat(t1.__hash)+" card-layer-select",children:[(0,s.jsx)(eU.Icon,{icon:"angle-down","data-sentry-element":"Icon","data-sentry-source-file":"900-ViewerCardLayerSelect.tsx"}),(0,s.jsx)("select",{value:a,onChange:c,className:"jsx-".concat(t1.__hash),children:e.map(e=>(0,s.jsx)("option",{value:e.value,className:"jsx-".concat(t1.__hash),children:e.label},e.value))}),(0,s.jsx)(n(),{id:t1.__hash,children:t1})]})})()};var t5=a(4124),t3=a.n(t5),t6=a(89174),t4=a(58657),t9=a(71198);let t8=!1,t7={};class ae extends l.PureComponent{componentDidMount(){let{dataset:e}=this.props,t=this.resetMapView(),a={};a.hideGraticule="epsg:3857"===t||"epsg:4326"===t,a.thumbnailBasemap=aa(e),this.props.updateSettings(a);let{mapLayer:s}=this.props;this.props.updateMapLayer(s.id,s,{hideAllOthers:!0}),this.props.setActiveTool(null);let i=an(this.initialValues.tags);this.props.setEditedThumbnailOverlays({tags:i})}renderOldThumbnail(){var e;if(!this.state.isShowingOldThumbnail)return null;let{dataset:t}=this.props,{layerId:a,time:i,elevation:l,timeWindow:r,elevationWindow:o,valueMin:c,valueMax:d}=null!==(e=t.thumbnailMeta)&&void 0!==e?e:{},{subdatasetId:h,variableId:p}=(0,f.ei)(null!=a?a:"");return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t9.A,{dataset:t,large:!0}),null!=h&&(0,s.jsxs)("div",{className:"jsx-".concat(al.__hash)+" form-row",children:[(0,s.jsx)("div",{className:"jsx-".concat(al.__hash)+" label",children:"Dataset"}),(0,s.jsx)("div",{className:"jsx-".concat(al.__hash)+" value product-id",children:h})]}),null!=p&&(0,s.jsxs)("div",{className:"jsx-".concat(al.__hash)+" form-row",children:[(0,s.jsx)("div",{className:"jsx-".concat(al.__hash)+" label",children:"Variable"}),(0,s.jsx)("div",{className:"jsx-".concat(al.__hash)+" value product-id",children:p})]}),null!=i&&(0,s.jsxs)("div",{className:"jsx-".concat(al.__hash)+" form-row",children:[(0,s.jsx)("div",{className:"jsx-".concat(al.__hash)+" label",children:"Time"}),(0,s.jsxs)("div",{className:"jsx-".concat(al.__hash)+" value product-id",children:[u().utc(i).format("DD/MM/YYYY HH:mm"),null!=r&&" \xb1 ".concat(r," h")]})]}),null!=l&&(0,s.jsxs)("div",{className:"jsx-".concat(al.__hash)+" form-row",children:[(0,s.jsx)("div",{className:"jsx-".concat(al.__hash)+" label",children:"Elevation"}),(0,s.jsxs)("div",{className:"jsx-".concat(al.__hash)+" value product-id",children:[l,null!=o&&" \xb1 ".concat(o)," m"]})]}),null!=c&&null!=d&&(0,s.jsxs)("div",{className:"jsx-".concat(al.__hash)+" form-row",children:[(0,s.jsx)("div",{className:"jsx-".concat(al.__hash)+" label",children:"Limits"}),(0,s.jsxs)("div",{className:"jsx-".concat(al.__hash)+" value product-id",children:[c," to ",d]})]}),(0,s.jsx)(n(),{id:al.__hash,children:al})]})}constructor(e){var t,a;super(e),this.refThumbCanvas=l.createRef(),this.state={isSubmitting:!1,isShowingOldThumbnail:t8,tags:""},this.render=()=>{let{isSubmitting:e,isShowingOldThumbnail:t}=this.state,{dataset:a}=this.props,i=!e;return(0,s.jsxs)("div",{className:"jsx-".concat(al.__hash)+" thumbnail-editor",children:[(0,s.jsxs)("div",{className:"jsx-".concat(al.__hash)+" instructions",children:["Modify the thumbnail as needed,",(0,s.jsx)("br",{className:"jsx-".concat(al.__hash)}),"and then click on ",(0,s.jsx)("b",{className:"jsx-".concat(al.__hash),children:"Update"}),"."]}),(0,s.jsx)("canvas",{ref:this.refThumbCanvas,width:m.THUMBNAIL_SIZE[0],height:m.THUMBNAIL_SIZE[1],style:{display:"none"},className:"jsx-".concat(al.__hash)}),(0,s.jsxs)("div",{className:"jsx-".concat(al.__hash)+" form-row",children:[(0,s.jsx)("div",{className:"jsx-".concat(al.__hash)+" label",children:"Tags"}),(0,s.jsxs)("span",{className:"jsx-".concat(al.__hash),children:[(0,s.jsx)(eU.TextInput,{value:this.initialValues.tags,onChange:this.onChangeTags})," ","(use commas)"]})]}),(0,s.jsxs)("div",{className:"jsx-".concat(al.__hash)+" form-row",children:[(0,s.jsx)("div",{className:"jsx-".concat(al.__hash)+" label",children:"Product"}),(0,s.jsx)("div",{className:"jsx-".concat(al.__hash)+" value product-id",children:a.id})]}),(0,s.jsxs)("div",{className:"jsx-".concat(al.__hash)+" button-row",children:[(0,s.jsx)("div",{onClick:this.resetMapView,className:"jsx-".concat(al.__hash)+" wk-button small",children:"Reset map view"}),(0,s.jsx)("div",{onClick:i?this.onSubmit:void 0,className:"jsx-".concat(al.__hash)+" "+(c()("wk-button primary small",{disabled:!i})||""),children:e?(0,s.jsx)(e1.A,{timeout:0}):"Update"})]}),(0,s.jsxs)("div",{onClick:()=>{t8=!t8,this.setState({isShowingOldThumbnail:t8})},className:"jsx-".concat(al.__hash)+" show-old",children:[(0,s.jsx)("span",{className:"jsx-".concat(al.__hash)+" show-old-caret",children:(0,s.jsx)(eU.Icon,{icon:t?"caret-up":"caret-down"})}),"Show current thumbnail"," ",t&&(0,s.jsx)("div",{onClick:this.copyOldConfigToNewThumbnail,className:"jsx-".concat(al.__hash)+" wk-button small",children:"Copy to new"})]}),this.renderOldThumbnail(),(0,s.jsx)(n(),{id:al.__hash,children:al})]})},this.onChangeTags=(e,t)=>{var a;let{datasetId:s}=this.props;null!==(a=t7[s])&&void 0!==a||(t7[s]={}),null==t&&(t=""),t7[s].tags=t,this.props.setEditedThumbnailOverlays({tags:an(t)}),this.setState({tags:t})},this.onSubmit=async()=>{let e=this.refThumbCanvas.current;e&&(this.setState({isSubmitting:!0}),this.copyMapToThumbnailCanvas(),e.toBlob(async e=>{if(!e)return;let{dataset:t}=this.props;{let a=this.getThumbnailMeta();await this.props.uploadThumbnail(t.id,e,{datasetId:t.id,thumbnailMeta:a})}this.setState({isSubmitting:!1})},"image/jpeg",.9))},this.copyMapToThumbnailCanvas=()=>{var e,t,a,s;let i=this.refThumbCanvas.current;if(!i)return;let n=document.getElementsByClassName("tero-maps-tiles"),l=i.getContext("2d"),r=i.width,o=i.height,{thumbnailBasemap:c}=this.props.settings,d=null!==(t=null===(e=t4.tt[c])||void 0===e?void 0:e.bgColor)&&void 0!==t?t:"black";l.globalAlpha=1,l.fillStyle=d,l.fillRect(0,0,r,o);for(let e=0;e<n.length;e++){l.save();let t=n[e];if(t.className.includes("tero-layer-basemap")){let e=null!==(s=null===(a=t4.tt[c])||void 0===a?void 0:a.thumbnailBrightness)&&void 0!==s?s:1;l.filter="brightness(".concat(e,")")}l.globalAlpha=1,l.drawImage(t,0,0,r,o),l.restore()}},this.getThumbnailMeta=()=>{var e,t,a,s;let{mapLayer:i,layerSpec:n,settings:l}=this.props,r=an(this.state.tags);return{creationDate:new Date().toISOString(),layerId:i.layerId,time:null!==(e=i.time)&&void 0!==e?e:null,elevation:null!==(t=i.elevation)&&void 0!==t?t:null,timeWindow:null!==(a=i.timeWindow)&&void 0!==a?a:null,elevationWindow:null!==(s=i.elevationWindow)&&void 0!==s?s:null,basemapId:l.thumbnailBasemap,overlays:{tags:r},crs:this.props.crs,...(0,f.WV)(i,n,l)}},this.resetMapView=()=>{let{dataset:e}=this.props,t=at(e),{crs:a,center:s,zoom:i}=(0,j.A)(e,m.THUMBNAIL_PREVIEW_SIZE[0],m.THUMBNAIL_PREVIEW_SIZE[1],t);this.props.setCrs(a,!0);let n=1e-9*Math.random();return this.props.setZoom(i+n,{force:!0}),this.props.setCenter(s.map(e=>e+n),{force:!0}),a},this.copyOldConfigToNewThumbnail=async e=>{var t;e.stopPropagation();let{dataset:a,mapLayer:s}=this.props,i=null!==(t=a.thumbnailMeta)&&void 0!==t?t:{},{layerId:n,time:l,elevation:r}=i;null!=l&&this.props.setTime(l),null!=r&&this.props.setElevation(r),null!=n&&n!==s.layerId&&(this.props.replaceMapLayerContents(s.id,n),await (0,T.c)(100));let{valueMin:o,valueMax:c}=i;if(null!=o||null!=c){let{mapLayer:e}=this.props;e=(0,S.merge)(e,{valueMin:o,valueMax:c}),this.props.updateMapLayer(e.id,e),await (0,T.c)(100)}let{colormapId:d,colormapInvert:h,colormapStops:u}=i;if(null!=d||null!=h||null!=u){let{mapLayer:e}=this.props;e=(0,S.merge)(e,{colormapId:d,colormapInvert:h,colormapStops:u}),this.props.updateMapLayer(e.id,e),await (0,T.c)(100)}let{timeWindow:p,elevationWindow:x}=i;if(null!=p||null!=x){let{mapLayer:e}=this.props;e=(0,S.merge)(e,{timeWindow:p,elevationWindow:x}),this.props.updateMapLayer(e.id,e),await (0,T.c)(100)}};let{dataset:i}=e,{thumbnailMeta:r}=i,o=ai(null!==(t=null==r?void 0:r.overlays.tags)&&void 0!==t?t:[]);this.state.tags=o,this.initialValues=null!==(a=t7[i.id])&&void 0!==a?a:{tags:o}}}let at=e=>{let{id:t}=e;if((0,g.hB)(t))return{cover:!1,margin:0,useHeuristics:!0};if((0,g.g3)(t))return{cover:!1,margin:-5,useHeuristics:!0};let a=0,s=!0,i=(0,g.QQ)(e,!0),n=!1;if(null!=i){let e=i[2]-i[0];i[3]-i[1]>e&&(n=!0)}return(n||(0,g.$D)(t))&&(s=!1,a=10),{margin:a,cover:s,useHeuristics:!0}},aa=e=>{let t;let{layers:a}=e,s=null!=Object.values(a).find(e=>e.hasSqlite),i=null!=Object.values(a).find(e=>e.isAltimetry);return(/INSITU_/.test(e.id)||s)&&!i?"bathymetry":(0,f.o7)(e)?"light":(/_NRT_|_ANALYSISFORECAST_|_ANALYSIS_FORECAST_/.test(e.id)?t=!1:(/_MY_|_MULTIYEAR_/.test(e.id)||as(e))&&(t=!0),t?"light":"dark")},as=e=>{let t=[Infinity,-1/0],{layers:a}=e;return Object.values(a).forEach(e=>{let a,s;let{tValues:i}=e;i&&(Array.isArray(i)?(a=i[0],s=i[i.length-1]):(a=i.tMin,s=i.tMax),a<t[0]&&(t[0]=a),s>t[1]&&(t[1]=s))}),Infinity!==t[0]&&t[1]!==-1/0&&t[1]-t[0]>94608e6},ai=e=>e.map(e=>e.name).join(", "),an=e=>{let t=e.split(",").map(e=>e.trim());return""===t[0]?[]:t.map(e=>({name:e}))},al=new String(".thumbnail-editor.jsx-366cfa05e942af8c{}.instructions.jsx-366cfa05e942af8c{padding:6px 0 16px;font-style:italic;text-align:center}.product-id.jsx-366cfa05e942af8c{word-break:break-all}.form-row.jsx-366cfa05e942af8c{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:baseline;-webkit-align-items:baseline;-moz-box-align:baseline;-ms-flex-align:baseline;align-items:baseline;line-height:1.5}.form-row.jsx-366cfa05e942af8c{}.label.jsx-366cfa05e942af8c{min-width:60px;font-weight:bold}.button-row.jsx-366cfa05e942af8c{margin-top:16px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-moz-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;-webkit-box-align:baseline;-webkit-align-items:baseline;-moz-box-align:baseline;-ms-flex-align:baseline;align-items:baseline}.show-old.jsx-366cfa05e942af8c{margin:1em 0;cursor:pointer}.show-old-caret.jsx-366cfa05e942af8c{margin-right:.5em}");al.__hash="366cfa05e942af8c";let ar=(0,d.Ng)((e,t)=>{var a;let{mapLayerId:s,datasetId:i}=t;return{dataset:(0,v.vh)(e,i),mapLayer:null!==(a=(0,v.b7)(e)[s])&&void 0!==a?a:null,settings:(0,v.mt)(e),crs:(0,v.tT)(e)}},x)(ae);var ao=a(41723),ac=a(82549),ad=a(37168),ah=a(51893),au=a(63449),ap=a(49650);let ax={};class am extends l.PureComponent{componentDidMount(){"LOGGED_IN"!==this.props.loginStatus&&this.onOpenLoginModal(),this._calcVolume(),this.props.layerSpec.hasZarr&&(0,au.Du)()}componentDidUpdate(){this.dirtyVolume&&(this.dirtyVolume=!1,this.calcVolume())}render(){let{loginStatus:e,layerSpec:t}=this.props,{extraVariableIds:a}=this.state,i=af(t).concat(a);return(0,s.jsxs)("div",{"data-sentry-component":"SubsetForm","data-sentry-source-file":"400-SubsetForm.tsx",className:"jsx-".concat(ab.__hash)+" subset",children:["LOGGED_IN"===e?(0,s.jsxs)(s.Fragment,{children:[this.renderBbox(i),this.renderTimeRange(i),this.renderDepthRange(i),this.renderExtraVariables(),this.renderButtonSection()]}):(0,s.jsxs)("div",{className:"jsx-".concat(ab.__hash)+" cm-miniform-instructions",children:[(0,s.jsx)(ef.A,{id:"subset.logInPrompt",defaultMessage:"Please log in to download data"}),(0,s.jsx)("br",{className:"jsx-".concat(ab.__hash)}),(0,s.jsx)("button",{onClick:this.onOpenLoginModal,className:"jsx-".concat(ab.__hash)+" wk-button extra-small log-in",children:(0,s.jsx)(ef.A,{id:"subset.logInButton",defaultMessage:"Log in"})})]}),this.state.isLoginModalOpen&&(0,s.jsx)(eX.A,{onClose:this.onCloseLoginModal}),this.state.isAutomateShown&&(0,s.jsx)(ap.A,{datasetId:this.props.datasetId,layerSpec:t,subsetValues:(0,tS.Mj)(t,this.state,i),onClose:this.onToggleAutomate}),(0,s.jsx)(n(),{id:ab.__hash,children:ab})]})}renderBbox(e){let{stacItem:t}=this.props.layerSpec;if(!(0,tS.J$)(t,e,m.DIM_LONGITUDE)||!(0,tS.J$)(t,e,m.DIM_LATITUDE))return null;let{lonMin:a,lonMax:i,latMin:n,latMax:l}=this.state;return(0,s.jsx)(tz,{mapLayerId:this.props.mapLayerId,initialValues:{lonMin:this.initialValues.lonMin,lonMax:this.initialValues.lonMax,latMin:this.initialValues.latMin,latMax:this.initialValues.latMax},showClearButton:null!=a||null!=i||null!=n||null!=l,onChangeAttr:this.onChangeAttr})}renderTimeRange(e){let{intl:t}=this.props,{stacItem:a,hasSqlite:i}=this.props.layerSpec;if(!(0,tS.tv)(a,m.DIM_TIME))return null;let l=!(0,tS.J$)(a,e,m.DIM_TIME),{tMin:r,tMax:o,isSubdaily:d}=(0,b.l9)(a);if(null==r)return null;let{timeMin:h,timeMax:p}=this.state,x=r,g=o;d||(x=u().utc(r).startOf("day").valueOf(),g=u().utc(o).endOf("day").valueOf());let j=(0,tS.h_)(null==h?void 0:h.getTime(),null==p?void 0:p.getTime(),x,g),v=this.getLayerTime(),_=null!=v;return(0,s.jsxs)("div",{className:"jsx-".concat(ag.__hash)+" "+(c()("cm-miniform-field",{hidden:l})||""),children:[(0,s.jsxs)("div",{className:"jsx-".concat(ag.__hash)+" cm-miniform-field-label",children:[(0,s.jsx)(ef.A,{id:"subset.dateRange",defaultMessage:"Date range"}),(null!=h||null!=p)&&(0,s.jsx)("span",{title:t.$t({id:"subset.clearDateRange",defaultMessage:"Clear date range"}),className:"jsx-".concat(ag.__hash)+" wk-icon-button cm-miniform-icon-button",children:(0,s.jsx)(eU.Icon,{icon:"times-circle",onClick:()=>{this.setAttr("timeMin",null),this.setAttr("timeMax",null)}})}),(0,s.jsxs)("span",{className:"jsx-".concat(ag.__hash)+" cm-miniform-field-domain",children:[(0,s.jsx)("span",{title:d?(0,f.Kq)(r,{withTime:!0}):void 0,className:"jsx-".concat(ag.__hash),children:(0,f.Kq)(r)}),(0,s.jsx)("span",{className:"jsx-".concat(ag.__hash)+" cm-miniform-field-domain-sep",children:"→"}),(0,s.jsx)("span",{title:d?(0,f.Kq)(o,{withTime:!0}):void 0,className:"jsx-".concat(ag.__hash),children:(0,f.Kq)(o)})]})]}),(0,s.jsxs)("div",{className:"jsx-".concat(ag.__hash)+" cm-miniform-field-values",children:[(0,s.jsxs)("div",{className:"jsx-".concat(ag.__hash)+" cm-miniform-field-value",children:[(0,s.jsxs)("span",{className:"jsx-".concat(ag.__hash)+" cm-miniform-range-label",children:[(0,s.jsx)(ef.A,{id:"subset.rangeFrom",defaultMessage:"From"}),":"]}),(0,s.jsx)(eU.DateInput,{ref:this.ref_timeMin,id:"".concat(this.props.mapLayerId,"-timeMin"),className:c()("cm-miniform-input",{invalid:j,"with-time":d}),time:d,utc:!0,type:"native",value:this.initialValues.timeMin,onChange:(e,t)=>this.onChangeAttr("timeMin",t),onBlur:this.onBlurTime}),(0,s.jsx)("button",{disabled:!_,onClick:_?()=>{let e=u().utc(v);if(i){let t=this.props.timeWindow,a=e.clone().subtract(t,"hour").toDate(),s=e.clone().add(t,"hour").toDate();a=(0,tS.M7)(a,r,o),s=(0,tS.M7)(s,r,o),this.setAttr("timeMin",a),this.setAttr("timeMax",s)}else{d||e.startOf("day");let t=(0,tS.M7)(e.toDate(),r,o);this.setAttr("timeMin",t)}}:void 0,className:"jsx-".concat(ag.__hash)+" "+(c()("wk-button extra-small cm-miniform-button",{disabled:!_,displaced:i})||""),children:(0,s.jsx)(ef.A,{id:"subset.asInMap",defaultMessage:"As in map"})})]}),(0,s.jsxs)("div",{className:"jsx-".concat(ag.__hash)+" cm-miniform-field-value",children:[(0,s.jsxs)("span",{className:"jsx-".concat(ag.__hash)+" cm-miniform-range-label",children:[(0,s.jsx)(ef.A,{id:"subset.rangeTo",defaultMessage:"To"}),":"]}),(0,s.jsx)(eU.DateInput,{ref:this.ref_timeMax,id:"".concat(this.props.mapLayerId,"-timeMax"),className:c()("cm-miniform-input",{invalid:j,"with-time":d}),time:d,utc:!0,type:"native",value:this.initialValues.timeMax,onChange:(e,t)=>this.onChangeAttr("timeMax",t),onBlur:this.onBlurTime}),(0,s.jsx)("button",{disabled:!_,onClick:_?()=>{let e=u().utc(v);d||e.startOf("day");let t=(0,tS.M7)(e.toDate(),r,o);this.setAttr("timeMax",t)}:void 0,className:"jsx-".concat(ag.__hash)+" "+(c()("wk-button extra-small cm-miniform-button",{disabled:!_,hidden:i})||""),children:(0,s.jsx)(ef.A,{id:"subset.asInMap",defaultMessage:"As in map"})})]})]}),(0,s.jsx)(n(),{id:ag.__hash,children:ag})]})}renderDepthRange(e){let t;let{intl:a}=this.props,{stacItem:i,hasSqlite:l}=this.props.layerSpec;if(!(0,tS.tv)(i,m.DIM_ELEVATION))return null;let r=!(0,tS.J$)(i,e,m.DIM_ELEVATION),{zMin:o,zMax:d,zValues:h}=(0,b.tQ)(i);if(null==o)return null;let{elevationMin:u,elevationMax:p}=this.state,x=(0,tS.h_)(u,p,o,d),f=Array.isArray(h),g=e=>Math.round(100*e)/100;f&&(t=h.map(e=>-e).slice().sort((e,t)=>e-t).map(e=>({value:e,label:String(g(e))})));let j=this.getLayerElevation(),v=null!=j;return(0,s.jsxs)("div",{className:"jsx-".concat(ag.__hash)+" "+(c()("cm-miniform-field",{hidden:r})||""),children:[(0,s.jsxs)("div",{className:"jsx-".concat(ag.__hash)+" cm-miniform-field-label",children:[(0,s.jsx)(ef.A,{id:"subset.depthRange",defaultMessage:"Depth range"}),(null!=u||null!=p)&&(0,s.jsx)("span",{title:a.$t({id:"subset.clearDepthRange",defaultMessage:"Clear depth range"}),className:"jsx-".concat(ag.__hash)+" wk-icon-button cm-miniform-icon-button",children:(0,s.jsx)(eU.Icon,{icon:"times-circle",onClick:()=>{this.setAttr("elevationMin",null),this.setAttr("elevationMax",null)}})}),(0,s.jsxs)("span",{className:"jsx-".concat(ag.__hash)+" cm-miniform-field-domain",children:["".concat(-g(d)," m"),(0,s.jsx)("span",{className:"jsx-".concat(ag.__hash)+" cm-miniform-field-domain-sep",children:"→"}),"".concat(-g(o)," m")]})]}),(0,s.jsxs)("div",{className:"jsx-".concat(ag.__hash)+" cm-miniform-field-values",children:[(0,s.jsxs)("div",{className:"jsx-".concat(ag.__hash)+" cm-miniform-field-value",children:[(0,s.jsxs)("span",{className:"jsx-".concat(ag.__hash)+" cm-miniform-range-label",children:[(0,s.jsx)(ef.A,{id:"subset.rangeFrom",defaultMessage:"From"}),":"]}),f?(0,s.jsx)(eU.Select,{ref:this.ref_elevationMax,id:"elevationMax",className:"standalone-subsetter-input",items:t,value:(0,tS.gu)(this.initialValues.elevationMax),onChange:(e,t)=>this.onChangeAttr("elevationMax",(0,tS.gu)(t)),onBlur:this.onBlurElevation}):(0,s.jsx)(eU.NumberInput,{ref:this.ref_elevationMax,id:"".concat(this.props.mapLayerId,"-elevationMax"),className:c()("cm-miniform-input",{invalid:x}),value:(0,tS.gu)(this.initialValues.elevationMax),onChange:(e,t)=>this.onChangeAttr("elevationMax",(0,tS.gu)(t)),onBlur:this.onBlurElevation}),(0,s.jsx)("span",{className:"jsx-".concat(ag.__hash)+" cm-miniform-unit",children:"m"}),(0,s.jsx)("button",{disabled:!v,onClick:v?()=>{let e={negative:!0};if(l){let t=this.props.elevationWindow,a=(0,tS.qE)(j-t,o,d),s=(0,tS.qE)(j+t,o,d);this.setAttr("elevationMin",a,e),this.setAttr("elevationMax",s,e)}else{let t=(0,tS.qE)(j,o,d);this.setAttr("elevationMax",t,e)}}:void 0,className:"jsx-".concat(ag.__hash)+" "+(c()("wk-button extra-small cm-miniform-button",{disabled:!v,displaced:l})||""),children:(0,s.jsx)(ef.A,{id:"subset.asInMap",defaultMessage:"As in map"})})]}),(0,s.jsxs)("div",{className:"jsx-".concat(ag.__hash)+" cm-miniform-field-value",children:[(0,s.jsxs)("span",{className:"jsx-".concat(ag.__hash)+" cm-miniform-range-label",children:[(0,s.jsx)(ef.A,{id:"subset.rangeTo",defaultMessage:"To"}),":"]}),f?(0,s.jsx)(eU.Select,{ref:this.ref_elevationMin,id:"elevationMin",className:"standalone-subsetter-input",items:t,value:(0,tS.gu)(this.initialValues.elevationMin),onChange:(e,t)=>this.onChangeAttr("elevationMin",(0,tS.gu)(t)),onBlur:this.onBlurElevation}):(0,s.jsx)(eU.NumberInput,{ref:this.ref_elevationMin,id:"".concat(this.props.mapLayerId,"-elevationMin"),className:c()("cm-miniform-input",{invalid:x}),value:(0,tS.gu)(this.initialValues.elevationMin),onChange:(e,t)=>this.onChangeAttr("elevationMin",(0,tS.gu)(t)),onBlur:this.onBlurElevation}),(0,s.jsx)("span",{className:"jsx-".concat(ag.__hash)+" cm-miniform-unit",children:"m"}),(0,s.jsx)("button",{disabled:!v,onClick:v?()=>{let e=(0,tS.qE)(j,o,d);this.setAttr("elevationMin",e,{negative:!0})}:void 0,className:"jsx-".concat(ag.__hash)+" "+(c()("wk-button extra-small cm-miniform-button",{disabled:!v,hidden:l})||""),children:(0,s.jsx)(ef.A,{id:"subset.asInMap",defaultMessage:"As in map"})})]})]}),(0,s.jsx)(n(),{id:ag.__hash,children:ag})]})}renderExtraVariables(){var e,t;let{dataset:a,layerSpec:i}=this.props;if(!(0,e_.p)(a))return null;let{variableId:l,stacItem:r}=i,o=null!==(e=null==r?void 0:r.properties["cube:variables"])&&void 0!==e?e:{},d=null!==(t=i.vectorComponentIds)&&void 0!==t?t:[l],h=(0,f.jk)(o).filter(e=>!d.includes(e.id));if(!h.length)return null;let u=h.map(e=>e.id),{extraVariableIds:p}=this.state,x=u.map(e=>{let t=o[e],{unit:s}=t,n=Object.values(a.layers).find(t=>t.subdatasetId===i.subdatasetId&&t.variableId===e);if(!n)return{value:e,label:(0,ah.getVariableTitle)(e,t),unit:s};let{variableTitle:l,isVariableTitleUntranslated:r}=n;return{value:e,label:l,untranslated:r,unit:s}});x.sort(C.Y3);let m=p.length===u.length,b=this.state.isExtraVariablesShown;return(0,s.jsxs)("div",{className:"jsx-".concat(ag.__hash)+" cm-miniform-field",children:[(0,s.jsxs)("div",{className:"jsx-".concat(ag.__hash)+" cm-miniform-field-label",children:[(0,s.jsxs)("span",{onClick:()=>this.setState({isExtraVariablesShown:!b}),className:"jsx-".concat(ag.__hash)+" extra-vars",children:[(0,s.jsx)(ef.A,{id:"subset.alsoDownload",defaultMessage:"Also download"}),"…",(0,s.jsx)("span",{title:"Show additional variables from the same dataset",className:"jsx-".concat(ag.__hash)+" wk-icon-button cm-miniform-icon-button",children:(0,s.jsx)(eU.Icon,{icon:b?"caret-up":"caret-down"})})]}),b&&(0,s.jsx)("button",{onClick:()=>{let e=m?[]:u;this.setState({extraVariableIds:e}),this.dirtyVolume=!0},className:"jsx-".concat(ag.__hash)+" "+(c()("wk-button extra-small cm-miniform-button")||""),children:m?(0,s.jsx)(ef.A,{id:"subset.clearAllVariables",defaultMessage:"Clear all"}):(0,s.jsx)(ef.A,{id:"subset.addAllVariables",defaultMessage:"Add all"})})]}),b&&(0,s.jsx)("div",{className:"jsx-".concat(ag.__hash)+" extra-vars-form",children:x.map(e=>{let{value:t,label:a,untranslated:i}=e;return(0,s.jsx)("div",{className:"jsx-".concat(ag.__hash)+" "+(c()("extra-variable",{untranslated:i})||""),children:(0,s.jsx)(eU.Checkbox,{id:t,value:p.includes(t),onChange:(e,a)=>{let s=p.slice();a?s.push(t):s=s.filter(e=>e!==t),this.setState({extraVariableIds:s}),this.dirtyVolume=!0},label:a})},t)})}),(0,s.jsx)(n(),{id:ag.__hash,children:ag})]})}renderButtonSection(){let{dataset:e,layerSpec:t,intl:a}=this.props,{hasNative:i}=t,l=(0,f.Of)(e,t),{isDownloading:r}=this.state,{isCalculatingVolume:o,volume:d}=this.state,{tooSmall:h,tooLarge:u}=(0,tS.IR)(t,d,a),p=!r&&!(u||h)&&!o,x=t.hasZarr||t.hasSqlite;return(0,s.jsxs)("div",{className:"jsx-".concat(aj.__hash)+" cm-miniform-button-block",children:[this.renderVolume(),r&&(0,s.jsx)(tA,{refTime:this.state.tLastRequest,showAfterMs:m.UI.subset.patienceShownAfterMs}),(0,s.jsxs)("div",{className:"jsx-".concat(aj.__hash)+" cm-miniform-button-row",children:[!m.APP_CONFIG.noBrowseFiles&&i&&l&&(0,s.jsx)(eW.A,{className:"wk-button small",href:"/viewer/expert?view=files&dataset=".concat(e.id,"&subdataset=").concat(l.id),children:(0,s.jsx)(ef.A,{id:"subset.browseFilesButton",defaultMessage:"Browse files"})}),!m.APP_CONFIG.noAutomateDownload&&x&&(0,s.jsxs)("div",{onClick:this.onToggleAutomate,className:"jsx-".concat(aj.__hash)+" wk-button small",children:[(0,s.jsx)(ef.A,{id:"subset.automateButton",defaultMessage:"Automate"}),(0,s.jsx)(ao.A,{ids:["subsetAutomate"],top:-2,right:-8})]}),(0,s.jsx)("div",{onClick:p?this.onSubmit:void 0,className:"jsx-".concat(aj.__hash)+" "+(c()("wk-button primary small",{disabled:!p})||""),children:r?(0,s.jsx)(e1.A,{timeout:0}):(0,s.jsx)(ef.A,{id:"subset.downloadButton",defaultMessage:"Download"})})]}),(0,s.jsx)(n(),{id:aj.__hash,children:aj})]})}renderVolume(){let{volume:e,isCalculatingVolume:t}=this.state,{datasetId:a,layerSpec:i,intl:l}=this.props,{bytesStr:r,tooSmall:o,tooLarge:d,tooLargeMsg:h}=(0,tS.IR)(i,e,l);return(0,s.jsxs)("div",{className:"jsx-".concat(av.__hash)+" "+(c()("size-estimate",{"invalid-size":d||o})||""),children:[(0,s.jsx)("span",{className:"jsx-".concat(av.__hash)+" size-estimate-icon",children:t?(0,s.jsx)(e1.A,{timeout:0,label:null==e?"Calculating size…":void 0}):(0,s.jsx)(eU.Icon,{icon:d?"exclamation-triangle":"weight-hanging"})}),null!=e&&(d?(0,s.jsxs)("span",{className:"jsx-".concat(av.__hash)+" size-estimate-error",children:[h,":",(0,s.jsx)("br",{className:"jsx-".concat(av.__hash)}),(0,s.jsx)(ef.A,{id:"subset.reduceSize",defaultMessage:"Try reducing it or use {linkServices}",values:{linkServices:(0,s.jsx)(eW.A,{href:"".concat(m.URLS.viewer,"?view=datasetServices&dataset=").concat(a),children:(0,s.jsx)(ef.A,{id:"subset.otherDownloadServices",defaultMessage:"other download services"})},"linkServices")}})," "]}):(0,s.jsx)("span",{className:"jsx-".concat(av.__hash),children:r})),(0,s.jsx)(n(),{id:av.__hash,children:av})]})}getLayerTime(){let{mapLayer:e}=this.props;return(null==e?void 0:e.time)!=null?u().utc(e.time):null}getLayerElevation(){var e;let{mapLayer:t}=this.props;return null!==(e=null==t?void 0:t.elevation)&&void 0!==e?e:null}constructor(e){var t;super(e),t=this,this.state={isLoginModalOpen:!1,isDownloading:!1,tLastRequest:null,lonMin:null,lonMax:null,latMin:null,latMax:null,elevationMin:null,elevationMax:null,timeMin:null,timeMax:null,extraVariableIds:[],isExtraVariablesShown:!1,isAutomateShown:!1,volume:null,isCalculatingVolume:!1},this.ref_elevationMin=l.createRef(),this.ref_elevationMax=l.createRef(),this.ref_timeMin=l.createRef(),this.ref_timeMax=l.createRef(),this.cntVolumeCalculation=0,this.dirtyVolume=!1,this.calcInitialValues=()=>{var e,t,a,s,i,n;let{time:l,elevation:r,layerSpec:o}=this.props,{stacItem:c,hasSqlite:d}=o,h=(0,b.BQ)(c),p={},{tMin:x,tMax:f,isSubdaily:g}=(0,b.l9)(c);if(null!=x&&null!=f){let{timeMin:t,timeMax:a}=ax;if(null==t||null==a){let s=null!==(e=this.getLayerTime())&&void 0!==e?e:u().utc(l);if(d){let e=this.props.timeWindow;t=s.clone().subtract(e,"hours").toDate(),a=s.clone().add(e,"hours").toDate()}else g||s.startOf("day"),t=s.toDate(),a=s.toDate()}t=(0,tS.M7)(t,x,f),a=(0,tS.M7)(a,x,f),ax.timeMin=p.timeMin=t,ax.timeMax=p.timeMax=a}let{zMin:j,zMax:v}=(0,b.tQ)(c);if(null!=j&&null!=v){let{elevationMin:e,elevationMax:a}=ax;if(null==e||null==a){let s=null!==(t=this.getLayerElevation())&&void 0!==t?t:r;if(d){let t=this.props.elevationWindow;e=s-t,a=s+t}else e=s,a=s}e=(0,tS.qE)(e,j,v),a=(0,tS.qE)(a,j,v),ax.elevationMin=p.elevationMin=e,ax.elevationMax=p.elevationMax=a}return h[m.DIM_LONGITUDE]&&h[m.DIM_LATITUDE]&&(p.lonMin=null!==(a=ax.lonMin)&&void 0!==a?a:null,p.lonMax=null!==(s=ax.lonMax)&&void 0!==s?s:null,p.latMin=null!==(i=ax.latMin)&&void 0!==i?i:null,p.latMax=null!==(n=ax.latMax)&&void 0!==n?n:null),p},this.onOpenLoginModal=()=>this.setState({isLoginModalOpen:!0}),this.onCloseLoginModal=()=>this.setState({isLoginModalOpen:!1}),this.onChangeAttr=(e,t)=>{this.setState({[e]:t}),this.dirtyVolume=!0,ax[e]=t},this.setAttr=function(e,a){var s,i;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};null===(i=t["ref_".concat(e)])||void 0===i||null===(s=i.current)||void 0===s||s.setValue(n.negative?(0,tS.gu)(a):a),t.onChangeAttr(e,a)},this.onBlurTime=()=>{var e,t;let a=null===(e=this.ref_timeMin.current)||void 0===e?void 0:e.getValue(),s=null===(t=this.ref_timeMax.current)||void 0===t?void 0:t.getValue();null!=a&&null!=s&&s<a&&(this.setAttr("timeMin",s),this.setAttr("timeMax",a))},this.onBlurElevation=()=>{var e,t;let a=(0,tS.gu)(null===(e=this.ref_elevationMin.current)||void 0===e?void 0:e.getValue()),s=(0,tS.gu)(null===(t=this.ref_elevationMax.current)||void 0===t?void 0:t.getValue());null!=a&&null!=s&&s<a&&(this.setAttr("elevationMin",s,{negative:!0}),this.setAttr("elevationMax",a,{negative:!0}))},this.onSubmit=async()=>{let{datasetId:e,layerSpec:t,username:a,intl:s}=this.props,{extraVariableIds:i,volume:n}=this.state,l=af(t).concat(i),r=(0,tS.Ti)(e,t,this.state,l),o=(0,tS.LF)(e,t,n);(0,tS.Om)(o),this.setState({isDownloading:!0,tLastRequest:Date.now()});let c=[],d=-1;try{let e={username:a,usage:"Subsetter"};for(d=0;d<r.length;d++){let a=r[d],i=await (0,tS.BQ)(t,a,s,e);if(!i)return;c.push(i)}d=-1,await (0,tS.LR)(t,c,s),(0,tS.Ms)(o)}catch(n){console.error(n);let{state:a}=this;(0,tS.Ig)(n,(0,tS.G3)(e,t,a,l),s,e=>this.props.chatbotToggle(e)),(0,tS.rC)(o);let i=JSON.stringify(r,null,2);ac.Z({type:"user",category:"downloadSubsetError",level:"error",data:{datasetId:o.label,subsetReqs:i,idxReq:d}}),ad.Cp(n)}finally{this.setState({isDownloading:!1,tLastRequest:null})}},this.onToggleAutomate=()=>{let{datasetId:e,layerSpec:t}=this.props,{subdatasetId:a,variableId:s}=t,i=!this.state.isAutomateShown;this.setState({isAutomateShown:i}),this.props.setFeatureHint("subsetAutomate",!1),(0,eR.PJ)({category:"subsetter",action:i?"apiPreviewOpen":"apiPreviewClose",label:"".concat(e,"/").concat(a,"/").concat(s)})},this._calcVolume=async()=>{let e=this.cntVolumeCalculation+1;this.cntVolumeCalculation=e;try{this.state.isCalculatingVolume||this.setState({isCalculatingVolume:!0});let{datasetId:t,layerSpec:a}=this.props,{extraVariableIds:s}=this.state,i=af(a).concat(s),n=await (0,tS.X0)(t,a,this.state,i);if(this.cntVolumeCalculation!==e)return;this.setState({volume:n,isCalculatingVolume:!1})}catch(t){if(console.error(t),this.cntVolumeCalculation!==e)return;this.setState({isCalculatingVolume:!1})}},this.calcVolume=et()(this._calcVolume,400);let a=this.calcInitialValues();this.state=(0,S.merge)(this.state,a),this.initialValues=a}}let af=e=>{var t;return null!==(t=e.vectorComponentIds)&&void 0!==t?t:[e.variableId]},ab=new String(".subset.jsx-ec9c4fe4548af52d{padding-top:1.5px}.cm-miniform-instructions.jsx-ec9c4fe4548af52d .log-in.jsx-ec9c4fe4548af52d{margin-top:.4em}");ab.__hash="ec9c4fe4548af52d";let ag=new String(".cm-miniform-button.displaced.jsx-910a3736948f627f{top:.8em}.extra-vars.jsx-910a3736948f627f{cursor:pointer}.extra-vars-form.jsx-910a3736948f627f .giu-checkbox{white-space:initial}.untranslated.jsx-910a3736948f627f{font-style:italic}");ag.__hash="910a3736948f627f";let aj=new String("");aj.__hash="b3e1b6a7c9b96113";let av=new String(".size-estimate.jsx-8146b89f43224387{color:var(--color-dim);margin-bottom:4px}.size-estimate.invalid-size.jsx-8146b89f43224387{color:var(--color-alert)}.size-estimate-icon.jsx-8146b89f43224387{margin-right:.2em}.size-estimate-error.jsx-8146b89f43224387 a{color:inherit;text-decoration:underline}");av.__hash="8146b89f43224387";let a_=(0,d.Ng)((e,t)=>{var a,s,i;let{mapLayerId:n,datasetId:l}=t,r=(0,v.vh)(e,l),o=null!==(a=(0,v.b7)(e)[n])&&void 0!==a?a:null;return{loginStatus:(0,v.iN)(e),username:(0,v.TO)(e),time:(0,v.WB)(e),timeWindow:null!==(s=null==o?void 0:o.timeWindow)&&void 0!==s?s:m.TIME_ELEVATION_WINDOWS.time.defaultHour,elevation:(0,v.S1)(e),elevationWindow:null!==(i=null==o?void 0:o.elevationWindow)&&void 0!==i?i:m.TIME_ELEVATION_WINDOWS.elevation.default,dataset:r,mapLayer:o}},x)((0,eb.Ay)(am));var ay=a(22978),aw=a(41821),ak=a(20481);let aM=e=>{let t=[];for(let a=0;a<e;a++)t.push((a+1)/(e+1));return t},aN=aM(6),aS=Object.keys(E.xD);class aI extends l.PureComponent{componentDidUpdate(){let{autoLevelsCommand:e}=this.props;e!==this.prevAutoLevelsCommand&&(this.maybeCalcAutoLevelsForThisLayer(),this.prevAutoLevelsCommand=e),this.validateConfig()}render(){let{layer:e,layerSpec:t,settings:a}=this.props;if(!t||!e)return null;let i=(0,f.WV)(e,t,a);return(0,s.jsxs)("div",{"data-sentry-component":"LayerConfig","data-sentry-source-file":"500-LayerConfig.tsx",className:"jsx-".concat(aF.__hash)+" layer-config",children:[this.renderOpacity(),this.renderStyleBlock(i),this.renderColorBlock(i),(0,s.jsx)(n(),{id:aF.__hash,children:aF})]})}renderOpacity(){let{layer:e,isLight:t}=this.props,a=null!=e.opacity?e.opacity:m.UI.defaultLayerOpacity;return t?null:(0,s.jsxs)("div",{className:"jsx-".concat(aF.__hash)+" config-line opacity-line",children:[(0,s.jsx)("span",{className:"jsx-".concat(aF.__hash)+" config-title fixed-width",children:(0,s.jsx)(ef.A,{id:"layerConfig.opacity",defaultMessage:"Opacity"})}),(0,s.jsx)(eU.RangeInput,{className:"wk-range-opacity",min:0,max:1,step:.05,value:a,onChange:this.onChangeOpacity}),(0,s.jsx)(n(),{id:aF.__hash,children:aF})]})}renderStyleBlock(e){let{intl:t,layerSpec:a}=this.props;if(!a||!(null==a?void 0:a.hasSqlite)&&!(null==a?void 0:a.hasZarr))return null;let i=!!(null==a?void 0:a.hasSqlite),l=(null==a?void 0:a.hasVectorStyle)||(null==a?void 0:a.hasWaveStyle),r=!!(null==a?void 0:a.hasVectorStyle),{styleSolid:o,styleParticles:d,styleVectors:h,styleHatched:u}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"jsx-".concat(aF.__hash)+" config-line style-selector",children:[(0,s.jsx)("span",{className:"jsx-".concat(aF.__hash)+" config-title fixed-width",children:(0,s.jsx)(ef.A,{id:"layerConfig.style",defaultMessage:"Style"})}),(0,s.jsxs)("span",{className:"jsx-".concat(aF.__hash),children:[(0,s.jsx)("span",{title:t.$t({id:"layerConfig.styleSolid",defaultMessage:"Solid"}),onClick:i?void 0:()=>this.onChangeStyle("styleSolid",!o),"data-testid":"solid-style-button",className:"jsx-".concat(aF.__hash)+" style-button",children:(0,s.jsx)(eU.Icon,{className:c()("wk-icon-button",{active:o,disabled:i}),icon:"square",fixedWidth:!0})}),l&&(0,s.jsx)("span",{title:t.$t({id:"layerConfig.styleParticles",defaultMessage:"Particles"}),onClick:()=>this.onChangeStyle("styleParticles",!d),"data-testid":"particles-style-button",className:"jsx-".concat(aF.__hash)+" style-button",children:(null==a?void 0:a.hasWaveStyle)?this.renderIconParticleLines(d):this.renderIconParticleDots(d)}),r&&(0,s.jsx)("span",{title:t.$t({id:"layerConfig.styleVectors",defaultMessage:"Vectors"}),onClick:()=>this.onChangeStyle("styleVectors",!h),"data-testid":"vector-style-button",className:"jsx-".concat(aF.__hash)+" style-button",children:(0,s.jsx)(eU.Icon,{className:c()("wk-icon-button cm-style-button-vector",{active:h}),icon:"arrow-up",fixedWidth:!0})}),(0,s.jsxs)("span",{title:t.$t({id:"layerConfig.styleHatched",defaultMessage:"Hatching"}),onClick:()=>this.onChangeStyle("styleHatched",!u),"data-testid":"hatched-style-button",className:"jsx-".concat(aF.__hash)+" style-button",children:[this.renderIconHatching(u),(0,s.jsx)(ao.A,{ids:["hatching"],top:-2,disableOnUnmount:!1})]})]})]}),this.renderThresholdOptions(e),(0,s.jsx)(n(),{id:aF.__hash,children:aF})]})}renderIconParticleLines(e){return(0,s.jsxs)("svg",{width:"1.25em",height:"1em",viewBox:"0 0 ".concat(512," ").concat(512),className:"jsx-".concat(aF.__hash)+" "+(c()("wk-icon-button custom-icon",{active:e})||""),children:[(0,s.jsx)("line",{x1:60,y1:60,x2:452,y2:452,strokeWidth:120,className:"jsx-".concat(aF.__hash)}),(0,s.jsx)(n(),{id:aF.__hash,children:aF})]})}renderIconParticleDots(e){return(0,s.jsxs)("svg",{width:"1.25em",height:"1em",viewBox:"0 0 ".concat(512," ").concat(512),className:"jsx-".concat(aF.__hash)+" "+(c()("wk-icon-button custom-icon",{active:e})||""),children:[(0,s.jsx)("circle",{cx:128,cy:128,r:102.4,className:"jsx-".concat(aF.__hash)}),(0,s.jsx)("circle",{cx:384,cy:128,r:102.4,className:"jsx-".concat(aF.__hash)}),(0,s.jsx)("circle",{cx:128,cy:384,r:102.4,className:"jsx-".concat(aF.__hash)}),(0,s.jsx)("circle",{cx:384,cy:384,r:102.4,className:"jsx-".concat(aF.__hash)}),(0,s.jsx)(n(),{id:aF.__hash,children:aF})]})}renderIconHatching(e){let t=[];for(let e=-640;e<512;e+=256)t.push((0,s.jsx)("line",{x1:e,y1:0,x2:e+512,y2:512,strokeWidth:60,stroke:"currentColor"},String(e)));return(0,s.jsxs)("svg",{width:"1.25em",height:"1em",viewBox:"0 0 ".concat(512," ").concat(512),className:"jsx-".concat(aF.__hash)+" "+(c()("wk-icon-button custom-icon",{active:e})||""),children:[t,(0,s.jsx)(n(),{id:aF.__hash,children:aF})]})}renderThresholdOptions(e){var t;if(!e.styleHatched)return null;let{intl:a,dataset:i,isLight:l}=this.props;if((null==i?void 0:i.isExternal)||l)return null;let r=this.props.layerSpec;if(!r.hasZarr&&!r.hasSqlite)return null;let{threshold:o}=e,c=null!==(t=null==o?void 0:o.type)&&void 0!==t?t:null,d=(0,L.Iz)(o),h=(0,L.mV)(o),u=null==o?void 0:o.min,p=null==o?void 0:o.max,x=d&&h,m=this.state.errors.threshold,f=(0,L.ON)(a);return(0,s.jsxs)(s.Fragment,{children:[m&&(0,s.jsx)("div",{className:"jsx-".concat(aF.__hash)+" error",children:m}),(0,s.jsxs)("div",{className:"jsx-".concat(aF.__hash)+" config-line",children:[(0,s.jsx)("span",{className:"jsx-".concat(aF.__hash)+" config-subtitle fixed-width",children:(0,s.jsxs)("span",{className:"jsx-".concat(aF.__hash),children:[(0,s.jsx)(ef.A,{id:"layerConfig.hatching",defaultMessage:"Hatching"}),(0,s.jsx)(ao.A,{ids:["hatching"],takeUpSpace:!0})]})}),(0,s.jsx)("select",{value:null!=c?c:"",onChange:e=>{let{value:t}=e.target;this.onChangeThresholdType(""===t?null:t)},className:"jsx-".concat(aF.__hash),children:f.map(e=>{var t;return(0,s.jsx)("option",{value:null!==(t=e.value)&&void 0!==t?t:"",className:"jsx-".concat(aF.__hash),children:e.label},e.value)})}),"\xa0\xa0",x&&(0,s.jsx)("span",{style:{marginRight:"0.1em"},className:"jsx-".concat(aF.__hash),children:"["}),d&&(0,s.jsx)("input",{ref:this.ref_thresholdMin,type:"number",name:"min",step:aP(u),defaultValue:String(null!=u?u:""),onChange:e=>e.target.focus(),onBlur:this.onCommitThresholdLimit,onKeyUp:e=>this.onKeyUp(e,this.onCommitThresholdLimit,String(null!=u?u:"")),className:"jsx-".concat(aF.__hash)+" hatch-min-max"}),x&&(0,s.jsx)("span",{style:{margin:"0 0.1em"},className:"jsx-".concat(aF.__hash),children:",\xa0"}),h&&(0,s.jsx)("input",{ref:this.ref_thresholdMax,type:"number",name:"max",step:aP(p),defaultValue:String(null!=p?p:""),onChange:e=>e.target.focus(),onBlur:this.onCommitThresholdLimit,onKeyUp:e=>this.onKeyUp(e,this.onCommitThresholdLimit,String(null!=p?p:"")),className:"jsx-".concat(aF.__hash)+" hatch-min-max"}),x&&(0,s.jsx)("span",{style:{marginLeft:"0.1em"},className:"jsx-".concat(aF.__hash),children:"]"})]}),(0,s.jsx)(n(),{id:aF.__hash,children:aF})]})}renderColorBlock(e){let{dataset:t}=this.props;if(null==t?void 0:t.isExternal)return null;let a=this.props.layerSpec;if(!a.hasZarr&&!a.hasSqlite)return null;let{styleSolid:s,styleParticles:i,styleVectors:n}=e;return s||i||n?i&&!s?this.renderParticlesColorBlock(e):this.renderFullColorBlock(e):null}renderParticlesColorBlock(e){var t;let{intl:a,layer:i,settings:l}=this.props,r=null!==(t=i.particleColor)&&void 0!==t?t:(0,E.LZ)(l);return"white"===r?r="#ffffff":"black"===r&&(r="#000000"),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"jsx-".concat(aF.__hash)+" config-line",children:[(0,s.jsx)("span",{className:"jsx-".concat(aF.__hash)+" config-title fixed-width",children:(0,s.jsx)(ef.A,{id:"layerConfig.particleColor",defaultMessage:"Colour"})}),(0,s.jsx)("input",{type:"color",value:r,onChange:this.onChangeParticleColor,className:"jsx-".concat(aF.__hash)+" color-picker"}),null!=i.particleColor&&(0,s.jsx)("span",{onClick:this.onClickResetParticleColor,title:a.$t({id:"layerConfig.particleColorReset",defaultMessage:"Reset particle colour"}),className:"jsx-".concat(aF.__hash)+" reset-particle-color",children:(0,s.jsx)(eU.Icon,{icon:"times-circle"})})]}),this.renderOtherColorOptions(e),(0,s.jsx)(n(),{id:aF.__hash,children:aF})]})}renderFullColorBlock(e){var t;let a=this.props.layerSpec,i=a.isCategorical&&a.flagColormap,{intl:l,settings:r,isLight:o}=this.props,{colormapId:d,colormapInvert:h,colormapStops:u}=e,{valueClamp:p}=e,x=d!==(0,E.mB)(a)||!!a.colormapInvert!==h||(null==u?void 0:u.join("."))!==(null===(t=a.colormapStops)||void 0===t?void 0:t.join("."))||!p,{colorBlind:m}=r;return(0,s.jsxs)("div",{className:"jsx-".concat(aF.__hash)+" "+(c()("color-options",{hidden:i})||""),children:[(0,s.jsxs)("div",{className:"jsx-".concat(aF.__hash)+" config-line",children:[(0,s.jsx)("span",{className:"jsx-".concat(aF.__hash)+" config-title",children:(0,s.jsx)(ef.A,{id:"layerConfig.colorMap",defaultMessage:"Colour map"})}),!m&&x&&(0,s.jsx)("span",{title:l.$t({id:"layerConfig.colorMapReset",defaultMessage:"Reset colour map"}),onClick:this.onClickResetColormap,className:"jsx-".concat(aF.__hash)+" reset-colormap",children:(0,s.jsx)(eU.Icon,{icon:"times-circle"})}),(0,s.jsx)("div",{className:"jsx-".concat(aF.__hash)+" flex-space"}),(0,s.jsx)("span",{title:l.$t({id:"layerConfig.colorMapInvert",defaultMessage:"Invert colour map"}),onClick:this.onClickInvert,"data-testid":"invert-colormap-button",className:"jsx-".concat(aF.__hash)+" colormap-button",children:(0,s.jsx)(eU.Icon,{className:c()("wk-icon-button",{active:!!a.colormapInvert!==h}),icon:"arrow-right-arrow-left",fixedWidth:!0})}),(0,s.jsx)("span",{title:l.$t({id:"layerConfig.colorMapStepwise",defaultMessage:"Use stepwise colour map"}),onClick:this.onClickToggleColormapStops,"data-testid":"stepwise-colormap-button",className:"jsx-".concat(aF.__hash)+" colormap-button",children:(0,s.jsx)(eU.Icon,{className:c()("wk-icon-button",{active:null!=u}),icon:"stairs",fixedWidth:!0})}),!o&&(0,s.jsx)("span",{title:l.$t({id:"layerConfig.maskOutliers",defaultMessage:"Mask outliers"}),onClick:this.onClickClamp,"data-testid":"mask-outliers-button",className:"jsx-".concat(aF.__hash)+" colormap-button",children:(0,s.jsx)(eU.Icon,{className:c()("wk-icon-button",{active:!p}),icon:"arrows-left-right-to-line",fixedWidth:!0})})]}),this.renderColormapSelector(e),this.renderOtherColorOptions(e),(0,s.jsx)(n(),{id:aF.__hash,children:aF})]})}renderColormapSelector(e){let{colormapId:t,colormapInvert:a,colormapStops:i}=e,l=aS.map(e=>E.xD[e]).filter(e=>!e.isHidden);return this.props.settings.colorBlind?(0,s.jsxs)("div",{className:"jsx-".concat(aU.__hash)+" colormaps color-blind",children:[(0,s.jsx)("button",{onClick:()=>this.props.updateSettings({colorBlind:!1}),className:"jsx-".concat(aU.__hash)+" wk-button",children:(0,s.jsx)(ef.A,{id:"layerConfig.disableColorBlindMode",defaultMessage:"Disable colour-blind mode"})}),(0,s.jsx)(n(),{id:aU.__hash,children:aU})]}):(0,s.jsxs)("div",{className:"jsx-".concat(aU.__hash)+" colormaps",children:[l.map(e=>{if(!e)return null;let{id:n,raw:l,name:r}=e,o=(0,E.vQ)(l,a,i);return(0,s.jsx)("div",{title:r||n,onClick:()=>this.onChangeColormap(n),className:"jsx-".concat(aU.__hash)+" "+(c()("colormap",{selected:n===t})||""),children:(0,s.jsx)("div",{style:{background:o},className:"jsx-".concat(aU.__hash)+" gradient",children:(0,s.jsx)("div",{className:"jsx-".concat(aU.__hash)+" gradient-name",children:"\xa0"})})},n)}),(0,s.jsx)(n(),{id:aU.__hash,children:aU})]})}renderOtherColorOptions(e){return(0,s.jsxs)(s.Fragment,{children:[this.renderDomain(e),this.renderStops(e),(0,s.jsx)(n(),{id:aF.__hash,children:aF})]})}renderDomain(e){let{layer:t,intl:a}=this.props,{valueMin:i,valueMax:l,defaultValueMin:r,defaultValueMax:o}=e,d=aA(t),h=this.state.errors.domain;return(0,s.jsxs)(s.Fragment,{children:[h&&(0,s.jsx)("div",{className:"jsx-".concat(aF.__hash)+" error",children:h}),(0,s.jsxs)("div",{className:"jsx-".concat(aF.__hash)+" config-line",children:[(0,s.jsxs)("span",{className:"jsx-".concat(aF.__hash)+" field",children:[(0,s.jsxs)("span",{className:"jsx-".concat(aF.__hash)+" label",children:[(0,s.jsx)(ef.A,{id:"layerConfig.valueMin",defaultMessage:"Min"}),":"]}),(0,s.jsx)("input",{ref:this.ref_valueMin,type:"number",name:"valueMin",step:aP(i),defaultValue:String(null!=i?i:""),onChange:e=>e.target.focus(),onBlur:this.onCommitDomain,onKeyUp:e=>this.onKeyUp(e,this.onCommitDomain,String(null!=i?i:"")),className:"jsx-".concat(aF.__hash)+" value-min-max"})]}),(0,s.jsxs)("span",{className:"jsx-".concat(aF.__hash)+" field",children:[(0,s.jsxs)("span",{className:"jsx-".concat(aF.__hash)+" label",children:[(0,s.jsx)(ef.A,{id:"layerConfig.valueMax",defaultMessage:"Max"}),":"]}),(0,s.jsx)("input",{ref:this.ref_valueMax,type:"number",name:"valueMax",step:aP(l),defaultValue:String(null!=l?l:""),onChange:e=>e.target.focus(),onBlur:this.onCommitDomain,onKeyUp:e=>this.onKeyUp(e,this.onCommitDomain,String(null!=l?l:"")),className:"jsx-".concat(aF.__hash)+" value-min-max"})]}),(i!=r||l!=o)&&(0,s.jsx)("span",{onClick:this.onClickResetDomain,title:a.$t({id:"layerConfig.valueRangeReset",defaultMessage:"Reset value range"}),className:"jsx-".concat(aF.__hash)+" reset-range",children:(0,s.jsx)(eU.Icon,{icon:"times-circle"})}),(0,s.jsx)("button",{onClick:this.onClickAutoDomain,className:"jsx-".concat(aF.__hash)+" "+(c()("wk-button extra-small layer-config-button auto-domain",{disabled:!d})||""),children:(0,s.jsx)(ef.A,{id:"layerConfig.valueRangeAuto",defaultMessage:"Auto"})})]}),(0,s.jsx)(n(),{id:aF.__hash,children:aF})]})}renderStops(e){let{valueMin:t,valueMax:a}=e,{logScale:i,units:l,colormapStops:r}=e,o=null!=r;if(this.hasStops=o,!o)return null;let d=r.length,h=az(t,a),u=this.state.errors.cmapStops;return(0,s.jsxs)(s.Fragment,{children:[u&&(0,s.jsx)("div",{className:"jsx-".concat(aF.__hash)+" error",children:u}),(0,s.jsxs)("div",{className:"jsx-".concat(aF.__hash)+" config-line",children:[(0,s.jsxs)("span",{className:"jsx-".concat(aF.__hash)+" label",children:[(0,s.jsx)(ef.A,{id:"layerConfig.stops",defaultMessage:"Thresholds"}),":"]}),(0,s.jsx)("span",{onClick:()=>{d<=1||this.onClickSetNumStops(d-1)},className:"jsx-".concat(aF.__hash)+" num-stops-button",children:(0,s.jsx)(eU.Icon,{className:c()("wk-icon-button",{disabled:d<=1}),icon:"minus",fixedWidth:!0})}),(0,s.jsx)("span",{className:"jsx-".concat(aF.__hash)+" num-stops-value",children:d}),(0,s.jsx)("span",{onClick:()=>{d>=20||this.onClickSetNumStops(d+1)},className:"jsx-".concat(aF.__hash)+" num-stops-button",children:(0,s.jsx)(eU.Icon,{className:c()("wk-icon-button",{disabled:d>=20}),icon:"plus",fixedWidth:!0})})]}),(0,s.jsx)("div",{className:"jsx-".concat(aF.__hash)+" field-stops",children:r.map((e,n)=>{let r=(0,E.db)(e,t,a,i);r=(0,f.mi)(r,h);let o="".concat(i?"log":"nolog","-").concat(n);return(0,s.jsxs)("span",{className:"jsx-".concat(aF.__hash)+" field-stop",children:[(0,s.jsx)("input",{ref:this.ref_cmapThreshs[n],type:"number",min:t,max:a,step:aP(r),name:"stop-".concat(n),defaultValue:String(r),onBlur:this.onCommitCmapThresh,onKeyUp:e=>this.onKeyUp(e,this.onCommitCmapThresh,String(r)),className:"jsx-".concat(aF.__hash)+" value-min-max"}),"\xa0",(0,s.jsx)(ak.A,{units:l})]},o)})}),(0,s.jsx)(n(),{id:aF.__hash,children:aF})]})}onChangeColormap(e){let{layer:t}=this.props;e!==t.colormapId&&(t=(0,S.set)(t,"colormapId",e),this.props.updateMapLayer(this.props.mapLayerId,t),(0,eR.PJ)({category:"viewer",action:"colormapChange",label:e}))}validateConfig(){let{intl:e,layer:t,layerSpec:a,settings:s}=this.props;if(!t||!a)return;let{styleSolid:i,styleParticles:n,styleVectors:l,styleHatched:r}=(0,f.WV)(t,a,s),o={};try{if(i||n||l){let t=[],{valueMin:a,valueMax:s}=this.getFormDomain();null==a&&t.push(e.$t({id:"layerConfig.validation.valueMinRequired",defaultMessage:"Min value is required"})),null==s&&t.push(e.$t({id:"layerConfig.validation.valueMaxRequired",defaultMessage:"Max value is required"})),null!=a&&null!=s&&a>s&&t.push(e.$t({id:"layerConfig.validation.valueMinLteValueMax",defaultMessage:"Min value must be lower than or equal to the max value"})),t.length>0&&(o.domain=t.join(". "))}if(r){let{min:t,max:a}=this.getFormThresholdRange(),{threshold:s}=this.props.layer,i=(0,L.Iz)(s),n=(0,L.mV)(s),l=[];i&&null==t&&l.push(e.$t({id:"layerConfig.validation.valueMinRequired",defaultMessage:"Min value is required"})),n&&null==a&&l.push(e.$t({id:"layerConfig.validation.valueMaxRequired",defaultMessage:"Max value is required"})),null!=t&&null!=a&&t>a&&l.push(e.$t({id:"layerConfig.validation.valueMinLteValueMax",defaultMessage:"Min value must be lower than or equal to the max value"})),l.length>0&&(o.threshold=l.join(". "))}if(this.hasStops&&(i||l)){let{layer:t,layerSpec:a,settings:s}=this.props,{colormapStops:i}=(0,f.WV)(t,a,s),n=this.getFormCmapThreshs(i.length),l=-1/0,r=!0;for(let e=0;e<n.length;e++){let t=n[e];if(null==t||t<l){r=!1;break}l=t}r||(o.cmapStops=e.$t({id:"layerConfig.validation.monotonicStops",defaultMessage:"Thresholds must be monotonically increasing"}))}}catch(e){console.error("Error validating form",e)}let c=this.state.errors;return(o.domain!==c.domain||o.cmapStops!==c.cmapStops||o.threshold!==c.threshold)&&this.setState({errors:o}),0===Object.keys(o).length}constructor(e){super(e),this.ref_valueMin=l.createRef(),this.ref_valueMax=l.createRef(),this.ref_cmapThreshs=(()=>{let e=[];for(let t=0;t<20;t++)e.push(l.createRef());return e})(),this.ref_thresholdMin=l.createRef(),this.ref_thresholdMax=l.createRef(),this.hasStops=!1,this.state={errors:{}},this.onChangeStyle=(e,t)=>{let{layer:a}=this.props;if(a=(0,S.set)(a,e,t),"styleParticles"===e&&t?a=(0,S.set)(a,"styleVectors",!1):"styleVectors"===e&&t&&(a=(0,S.set)(a,"styleParticles",!1)),"styleHatched"===e&&t){if(!a.threshold){let e=this.calcNewThreshold("gte");a=(0,S.set)(a,"threshold",e)}this.props.setFeatureHint("hatching",!1)}this.props.updateMapLayer(this.props.mapLayerId,a),(0,eR.PJ)({category:"viewer",action:"changeStyle",label:a.layerId})},this.onChangeOpacity=(e,t)=>{t=Math.round(100*(t=Math.max(0,Math.min(1,t))))/100;let{layer:a}=this.props;a=(0,S.set)(a,"opacity",t),this.props.updateMapLayer(this.props.mapLayerId,a),this.onChangeOpacityEnd()},this.onChangeParticleColor=e=>{let{layer:t}=this.props,a=e.target.value;a!==t.particleColor&&(t=(0,S.set)(t,"particleColor",a),this.props.updateMapLayer(this.props.mapLayerId,t))},this.onClickResetParticleColor=()=>{let{layer:e}=this.props;null!=e.particleColor&&(e=(0,S.omit)(e,"particleColor"),this.props.updateMapLayer(this.props.mapLayerId,e))},this.onChangeOpacityEnd=et()(()=>{(0,eR.PJ)({category:"viewer",action:"opacityChange",label:this.props.layer.layerId})},2e3),this.onClickInvert=()=>{let{layer:e}=this.props,{layerSpec:t,settings:a}=this.props,{colormapInvert:s}=(0,f.WV)(e,t,a);s=!s,e=(0,S.set)(e,"colormapInvert",s),this.props.updateMapLayer(this.props.mapLayerId,e),(0,eR.PJ)({category:"viewer",action:"colormapInvertToggle",label:e.layerId})},this.onClickClamp=()=>{let{layer:e}=this.props,{layerSpec:t,settings:a}=this.props,{valueClamp:s}=(0,f.WV)(e,t,a);s=!s,e=(0,S.set)(e,"valueClamp",s),this.props.updateMapLayer(this.props.mapLayerId,e),(0,eR.PJ)({category:"viewer",action:s?"clampValuesOn":"clampValuesOff",label:e.layerId})},this.onClickResetColormap=()=>{let e=(0,S.omit)(this.props.layer,["colormapId","colormapInvert","colormapStops","valueClamp"]);this.props.updateMapLayer(this.props.mapLayerId,e),(0,eR.PJ)({category:"viewer",action:"colormapReset",label:e.layerId})},this.onClickToggleColormapStops=()=>{let{layer:e}=this.props,{layerSpec:t,settings:a}=this.props,{colormapStops:s}=(0,f.WV)(e,t,a);e=s?(0,S.omit)(e,"colormapStops"):(0,S.set)(e,"colormapStops",aN),this.props.updateMapLayer(this.props.mapLayerId,e),(0,eR.PJ)({category:"viewer",action:"colormapStopsToggle",label:e.layerId})},this.onClickSetNumStops=e=>{let t=aM(e),{layer:a}=this.props;a=(0,S.merge)(a,{colormapStops:t}),this.props.updateMapLayer(this.props.mapLayerId,a);let{layerSpec:s,settings:i}=this.props,{valueMin:n,valueMax:l,logScale:r}=(0,f.WV)(a,s,i);this.setFormCmapThreshs(t,n,l,r)},this.onCommitCmapThresh=()=>{if(!this.validateConfig())return;let{layer:e}=this.props,{layerSpec:t,settings:a}=this.props,{valueMin:s,valueMax:i,logScale:n}=(0,f.WV)(e,t,a),l=this.getFormCmapThreshs(e.colormapStops.length),r=(0,E.s8)(l,s,i,n);e=(0,S.set)(e,"colormapStops",r),this.props.updateMapLayer(this.props.mapLayerId,e)},this.onCommitDomain=async()=>{if(!this.validateConfig())return;let{layer:e}=this.props,t=this.getFormDomain();e=(0,S.merge)(e,t),e=this.maybeUpdateColormapStopsOnDomainChange(e),this.props.updateMapLayer(this.props.mapLayerId,e),(0,eR.PJ)({category:"viewer",action:"valueRangeChange",label:e.layerId})},this.onClickResetDomain=async()=>{let e=(0,S.omit)(this.props.layer,["valueMin","valueMax"]);e=this.maybeUpdateColormapStopsOnDomainChange(e),this.props.updateMapLayer(this.props.mapLayerId,e);let{layerSpec:t,settings:a}=this.props,{valueMin:s,valueMax:i}=(0,f.WV)(e,t,a);this.setFormDomain(s,i),(0,eR.PJ)({category:"viewer",action:"valueRangeReset",label:e.layerId})},this.onClickAutoDomain=e=>{e.altKey?this.props.calcAutoLevelsForAllLayers():this.maybeCalcAutoLevelsForThisLayer(),(0,eR.PJ)({category:"viewer",action:"valueRangeAuto",label:this.props.layer.layerId})},this.maybeCalcAutoLevelsForThisLayer=()=>{let{layer:e}=this.props;if(e.isHidden)return;let{layerSpec:t,visibleBbox:a}=this.props;if((null==t?void 0:t.isCategorical)&&t.flagColormap)return;let s=aC(e,a,{symmetric:aE(t)});null!=s&&(e=(0,S.merge)(e,s),e=this.maybeUpdateColormapStopsOnDomainChange(e),this.props.updateMapLayer(this.props.mapLayerId,e),this.setFormDomain(s.valueMin,s.valueMax))},this.maybeUpdateColormapStopsOnDomainChange=e=>{if(!this.hasStops)return e;let{layerSpec:t,settings:a}=this.props,{valueMin:s,valueMax:i,logScale:n}=(0,f.WV)(e,t,a),l=this.getFormCmapThreshs(e.colormapStops.length),r=(0,E.s8)(l,s,i,n);return e=(0,S.merge)(e,{colormapStops:r})},this.onChangeThresholdType=e=>{let t,{layer:a}=this.props,{layerSpec:s,settings:i}=this.props,n=a.threshold,{valueMin:l,valueMax:r}=(0,f.WV)(a,s,i);if(null==e)t=null;else if(n){var o,c,d,h,u;let a={type:e};switch(e){case"equal":case"different":a.max=null!==(o=n.max)&&void 0!==o?o:n.min;break;case"gte":a.max=null!==(c=n.max)&&void 0!==c?c:n.min;break;case"lte":a.min=null!==(d=n.min)&&void 0!==d?d:n.max;break;case"between":case"outside":if(null!=n.min&&null!=n.max)a.min=n.min,a.max=n.max;else{let e=(r-l)*.1,t=null!==(h=n.min)&&void 0!==h?h:n.max-e,s=null!==(u=n.max)&&void 0!==u?u:n.min+e,i=az(l,r);a.min=(0,f.mi)(t,i),a.max=(0,f.mi)(s,i)}}t=a}else t=this.calcNewThreshold(e);a=(0,S.merge)(a,{threshold:t}),this.props.updateMapLayer(this.props.mapLayerId,a),(0,eR.PJ)({category:"viewer",action:"thresholdChange",label:a.layerId})},this.calcNewThreshold=e=>{let{layer:t,layerSpec:a,settings:s}=this.props,{valueMin:i,valueMax:n,logScale:l}=(0,f.WV)(t,a,s),r={type:e},o=az(i,n),c=e=>{if(n===i)return i;let t=l?Math.log10(i):i,a=t+((l?Math.log10(n):n)-t)*e;return l&&(a=Math.pow(10,a)),a=(0,f.mi)(a,o)},d=c(.9),h=c(.1);switch(e){case"equal":case"different":r.max=i;break;case"gte":r.max=d;break;case"lte":r.min=h;break;case"between":r.min=c(.45),r.max=c(.55);break;case"outside":r.min=h,r.max=d}return r},this.onCommitThresholdLimit=async()=>{if(!this.validateConfig())return;let{layer:e}=this.props,t=this.getFormThresholdRange(),a=(0,S.merge)(e.threshold,t);e=(0,S.set)(e,"threshold",a),this.props.updateMapLayer(this.props.mapLayerId,e),(0,eR.PJ)({category:"viewer",action:"thresholdRangeChange",label:e.layerId})},this.onKeyUp=(e,t,a)=>{(0,aw.jr)(e,t,a)},this.getFormDomain=()=>({valueMin:this.getElemValueAsNumber(this.ref_valueMin.current),valueMax:this.getElemValueAsNumber(this.ref_valueMax.current)}),this.setFormDomain=(e,t)=>{this.ref_valueMin.current&&this.ref_valueMax.current&&(this.ref_valueMin.current.value=String(e),this.ref_valueMax.current.value=String(t),this.validateConfig())},this.getFormCmapThreshs=e=>{let t=[];for(let a=0;a<e;a++){let e=this.getElemValueAsNumber(this.ref_cmapThreshs[a].current);t.push(e)}return t},this.setFormCmapThreshs=(e,t,a,s)=>{for(let i=0;i<e.length;i++){let n=e[i],l=(0,E.db)(n,t,a,s);l=(0,f.mi)(l,az(t,a)),this.ref_cmapThreshs[i].current&&(this.ref_cmapThreshs[i].current.value=String(l))}this.validateConfig()},this.getFormThresholdRange=()=>{let{threshold:e}=this.props.layer;if(!e)return{min:null,max:null};let t=(0,L.Iz)(e),a=(0,L.mV)(e);return{min:t?this.getElemValueAsNumber(this.ref_thresholdMin.current):null,max:a?this.getElemValueAsNumber(this.ref_thresholdMax.current):null}},this.getElemValueAsNumber=e=>{let t=null==e?void 0:e.value;return null==t||""===t?null:parseFloat(t)},this.prevAutoLevelsCommand=e.autoLevelsCommand}}let aA=e=>{let{_subsets:t,_subsetStatus:a}=e;return!(!a||0===a.length||!t||0===t.length||a.some(e=>"succeeded"!==e)||t.some(e=>null==e))},aC=function(e,t){var a;let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!aA(e))return null;let i=t||[-180,-90,180,90],n=e._subsets,l=(null===(a=n[0])||void 0===a?void 0:a.isSparse)?aL(n,i):aD(n,i);if(null==l)return null;let{valueMin:r,valueMax:o}=l;if(s.symmetric){let e=Math.max(Math.abs(r),Math.abs(o));r=-e,o=+e}return{valueMin:r,valueMax:o}},aD=(e,t)=>{let a=Infinity,s=-1/0;if(e.length<1||e.length>2)return console.error("Unexpected number of subsets",e.length),null;let i=aT(e[0],t);if(null==i)return null;let{idxLonMin:n,idxLonMax:l,idxLatMin:r,idxLatMax:o}=i,{lonStride:c,latStride:d}=i;if(1===e.length){let{data:t}=e[0];for(let e=n;e<=l;e++)for(let i=r;i<=o;i++){let n=t[e*c+i*d];n==n&&null!=n&&(n<a&&(a=n),n>s&&(s=n))}}else{if(2!==e.length)return console.error("Unexpected number of subsets",e.length),null;let{data:t}=e[0],{data:i}=e[1];for(let e=n;e<=l;e++)for(let n=r;n<=o;n++){let l=e*c+n*d,r=t[l],o=i[l];if(r!=r||null==r||o!=o||null==o)continue;let h=Math.sqrt(r*r+o*o);h<a&&(a=h),h>s&&(s=h)}}return Infinity===a||s===-1/0?null:{valueMin:a,valueMax:s}},aT=(e,t)=>{if(null==e)return null;let{dims:a,dimIds:s,strides:i}=e,n=s.indexOf(m.DIM_LONGITUDE),l=s.indexOf(m.DIM_LATITUDE);if(n<0||l<0)return null;let r=i[n],o=i[l],c=a[m.DIM_LONGITUDE],d=a[m.DIM_LATITUDE];if(!c||!d)return null;let[h,u,p,x]=t,f=(0,ay.B_)(c.coords,h),b=(0,ay.B_)(c.coords,p),g=(0,ay.B_)(d.coords,u),j=(0,ay.B_)(d.coords,x);return null==f||null==b||null==g||null==j?null:{idxLonMin:f,idxLonMax:b,idxLatMin:g,idxLatMax:j,lonStride:r,latStride:o}},aL=(e,t)=>{let[a,s,i,n]=t,l=Infinity,r=-1/0;for(let t=0;t<e.length;t++){let{data:o}=e[t],c=Object.keys(o);for(let e=0;e<c.length;e++){let{samples:t}=o[c[e]];for(let e=0;e<t.length;e++){let o=t[e],c=o[N.s.value],d=o[N.s.longitude],h=o[N.s.latitude];d<a||d>i||h<s||h>n||null==c||(c<l&&(l=c),c>r&&(r=c))}}}return Infinity===l||r===-1/0?null:{valueMin:l,valueMax:r}},aE=e=>{let{variableId:t}=e;if(!t)return!1;if(/north|east|south|west/i.test(t)||aO.includes(t))return!0;if(/error|err|bias/i.test(t)){let{valueMin:t,valueMax:a}=e;return null!=t&&null!=a&&t<0&&a>0&&Math.abs(t)===a}return!1},aO=["u","v","uo","vo","vxo","vyo","uo_mean","vo_mean","usi","vsi","uice","vice","vxsi","vysi","U","V","ubar","vbar","ugo","vgo","ugos","vgos","ugosa","vgosa","EWCT","NSCT"],aP=e=>{if(null==e||0===e)return 1;let t=Math.abs(e);return 10**Math.floor(Math.log10(t))/10},az=(e,t)=>(t-e)/400,aF=new String('.layer-config.jsx-2c2ec70bd9cca09b{margin-bottom:6px}.config-line.jsx-2c2ec70bd9cca09b{margin:6px 0 4px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.config-line.style-selector.jsx-2c2ec70bd9cca09b{-webkit-box-align:baseline;-webkit-align-items:baseline;-moz-box-align:baseline;-ms-flex-align:baseline;align-items:baseline}.config-title.jsx-2c2ec70bd9cca09b{display:inline-block;font-weight:bold;margin-right:.3em}.config-subtitle.jsx-2c2ec70bd9cca09b{display:inline-block;margin-right:.3em}.fixed-width.jsx-2c2ec70bd9cca09b{-webkit-box-flex:0;-webkit-flex:0 0 65px;-moz-box-flex:0;-ms-flex:0 0 65px;flex:0 0 65px}.color-options.hidden.jsx-2c2ec70bd9cca09b{display:none}.reset-colormap.jsx-2c2ec70bd9cca09b{cursor:pointer;margin-left:.3rem}.opacity-line .giu-range-input-wrapper{-webkit-box-flex:1;-webkit-flex:1 1 0px;-moz-box-flex:1;-ms-flex:1 1 0px;flex:1 1 0px}.wk-range-opacity{display:block;width:100%}.value-min-max.jsx-2c2ec70bd9cca09b{width:82px}.hatch-min-max.jsx-2c2ec70bd9cca09b{width:71px}.reset-range.jsx-2c2ec70bd9cca09b,.reset-particle-color.jsx-2c2ec70bd9cca09b{cursor:pointer;margin-left:.3em}.color-picker.jsx-2c2ec70bd9cca09b{margin:-4px 0}.error.jsx-2c2ec70bd9cca09b{font-style:italic;color:red}.flex-space.jsx-2c2ec70bd9cca09b{-webkit-box-flex:1;-webkit-flex:1 0 0px;-moz-box-flex:1;-ms-flex:1 0 0px;flex:1 0 0px}.colormap-button.jsx-2c2ec70bd9cca09b{margin-left:.5rem}.layer-config-button.jsx-2c2ec70bd9cca09b{line-height:1}.layer-config-button.jsx-2c2ec70bd9cca09b+.layer-config-button.jsx-2c2ec70bd9cca09b{margin-left:10px}.layer-config-button.jsx-2c2ec70bd9cca09b+.layer-config-button.no-margin-left.jsx-2c2ec70bd9cca09b{margin-left:-1px}.auto-domain.jsx-2c2ec70bd9cca09b{margin-left:.6em}.style-option.jsx-2c2ec70bd9cca09b{display:inline-block;white-space:nowrap}.style-option.jsx-2c2ec70bd9cca09b{margin-right:.5em}.style-button.jsx-2c2ec70bd9cca09b+.style-button.jsx-2c2ec70bd9cca09b{margin-left:.5rem}.cm-style-button-vector{-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-ms-transform:rotate(45deg);-o-transform:rotate(45deg);transform:rotate(45deg)}.custom-icon.jsx-2c2ec70bd9cca09b{vertical-align:-.125em}.custom-icon.jsx-2c2ec70bd9cca09b circle.jsx-2c2ec70bd9cca09b{fill:currentColor}.custom-icon.jsx-2c2ec70bd9cca09b line.jsx-2c2ec70bd9cca09b{stroke:currentColor;stroke-linecap:round}input[type="radio"].jsx-2c2ec70bd9cca09b{position:relative;top:.1em;margin-right:.3em}.field.jsx-2c2ec70bd9cca09b+.field.jsx-2c2ec70bd9cca09b{margin-left:.3em}.field-stops.jsx-2c2ec70bd9cca09b{margin-left:10px}.field-stop.jsx-2c2ec70bd9cca09b{display:inline-block;margin-left:.6em}.label.jsx-2c2ec70bd9cca09b{margin-right:.2em}.num-stops-button.jsx-2c2ec70bd9cca09b{margin:0 .4em}.threshold-separator.jsx-2c2ec70bd9cca09b{margin-left:.1em;margin-right:.3em}');aF.__hash="2c2ec70bd9cca09b";let aU=new String(".colormaps.jsx-884ea9c911d2b667{line-height:1;padding-bottom:5px;margin:2px -5px}.colormaps.color-blind.jsx-884ea9c911d2b667{}.colormap.jsx-884ea9c911d2b667{display:inline-block;width:-webkit-calc(100% / ".concat(5,");width:-moz-calc(100% / ").concat(5,");width:calc(100% / ").concat(5,");padding:3px;margin-bottom:-2px;cursor:pointer;border:1px solid transparent}.colormap.selected.jsx-884ea9c911d2b667{border:1px solid var(--color-icon-button-active)}.colormap.jsx-884ea9c911d2b667:hover:not(.selected){border:1px solid var(--color-subtle-line)}.gradient.jsx-884ea9c911d2b667{height:12px;font-weight:bold;font-size:.6rem;text-align:center;color:white}.gradient-name.jsx-884ea9c911d2b667{opacity:0;position:relative;top:1px;text-shadow:0 0 2px black;mix-blend-mode:overlay;overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis}.gradient.jsx-884ea9c911d2b667:hover .gradient-name.jsx-884ea9c911d2b667{opacity:1}"));aU.__hash="884ea9c911d2b667";let aR=(0,d.Ng)((e,t)=>{let{mapLayerId:a}=t,s=(0,v.Yj)(e,a),i=s?(0,f.ei)(s.layerId).datasetId:null,n=(0,v.yT)(e),l=i?n[i]:null,r=s?(0,f.VF)(n,s.layerId):null;return{layer:s,layerSpec:r,dataset:l,settings:(0,v.mt)(e),featureHints:(0,v.BH)(e),isLight:(0,v.H9)(e),visibleBbox:s?(0,v.Eb)(e,s.cardId):null,autoLevelsCommand:(0,v.gB)(e)}},x)((0,eb.Ay)(aI));var aB=a(52018);class aV extends l.Component{componentDidMount(){window.addEventListener("resize",this.onResize),this.onResize(),this.timerCheckWidth=setInterval(this.onResize,700),setTimeout(()=>{this.isUnmounted||this.setState({isStarting:!1})})}componentDidUpdate(e){let{logScale:t}=this.props.layer;t||t===e.layer.logScale||(null!=this.timerLog&&clearTimeout(this.timerLog),this.forceLogScaleTickLabels=!0,this.timerLog=setTimeout(()=>{this.isUnmounted||(this.forceLogScaleTickLabels=!1,this.plotUpdate())},250)),this.plotUpdate()}componentWillUnmount(){this.isUnmounted=!0,window.removeEventListener("resize",this.onResize),null!=this.timerCheckWidth&&(clearInterval(this.timerCheckWidth),this.timerCheckWidth=null)}render(){let{layer:e,layerSpec:t,settings:a}=this.props,i=(0,f.WV)(e,t,a),{valueMin:l,valueMax:r}=i;return null==l||null==r?null:(this.hasLegend=!0,(0,s.jsxs)("div",{onClick:this.props.onClick,onMouseMove:this.onMouseMove,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,"data-sentry-component":"LegendContinuous","data-sentry-source-file":"320-LegendContinuous.tsx",className:"jsx-".concat(aW.__hash)+" cm-legend legend",children:[(0,s.jsx)("div",{ref:this.refWidthDiv,className:"jsx-".concat(aW.__hash)}),t.legendUrl?this.renderImageBar():this.renderBar(i),this.renderTicks(),(0,s.jsx)(n(),{id:aW.__hash,children:aW})]}))}renderImageBar(){let{layerSpec:e}=this.props;return(0,s.jsxs)("div",{className:"jsx-".concat(aH.__hash)+" gradient-wrapper",children:[(0,s.jsx)("img",{src:e.legendUrl,className:"jsx-".concat(aH.__hash)+" gradient"}),(0,s.jsx)(n(),{id:aH.__hash,children:aH})]})}renderBar(e){var t;let{width:a}=this.state;if(null==a)return null;let{colormapId:i,colormapInvert:l,colormapStops:r,valueClamp:o}=e,c=null===(t=(0,E.Co)(i,l,r))||void 0===t?void 0:t.raw;if(!c)return null;let d=c[0],h=c[c.length-1];return(0,s.jsxs)("div",{className:"jsx-".concat(aH.__hash)+" gradient-wrapper",children:[(0,s.jsx)("svg",{className:"jsx-".concat(aH.__hash)+" clamp-indicator left",children:(0,s.jsx)("g",{transform:"translate(0, ".concat(3.5,")"),className:"jsx-".concat(aH.__hash),children:o&&(0,s.jsx)("path",{d:"M0,0L".concat(3.5,",").concat(-3.5,"L").concat(3.5,",").concat(3.5,"L0,0"),fill:"#".concat((0,E.H2)(d)),className:"jsx-".concat(aH.__hash)})})}),(0,s.jsx)("div",{style:{background:(0,E.vQ)(c,!1,null)},className:"jsx-".concat(aH.__hash)+" gradient"}),(0,s.jsx)("svg",{className:"jsx-".concat(aH.__hash)+" clamp-indicator right",children:(0,s.jsx)("g",{transform:"translate(".concat(3.5,", ").concat(3.5,")"),className:"jsx-".concat(aH.__hash),children:o&&(0,s.jsx)("path",{d:"M0,0L".concat(-3.5,",").concat(-3.5,"L").concat(-3.5,",").concat(3.5,"L0,0"),fill:"#".concat((0,E.H2)(h)),className:"jsx-".concat(aH.__hash)})})}),(0,s.jsx)(n(),{id:aH.__hash,children:aH})]})}renderTicks(){let e="graph-threshold-pattern-".concat(this.randomId);return(0,s.jsxs)("svg",{className:"jsx-".concat(a$.__hash)+" wk-layer-ticks",children:[(0,s.jsx)("defs",{className:"jsx-".concat(a$.__hash),children:(0,s.jsx)("pattern",{id:e,patternUnits:"userSpaceOnUse",width:10,height:10,className:"jsx-".concat(a$.__hash),children:(0,s.jsx)("image",{href:O.k,width:10,height:10,className:"jsx-".concat(a$.__hash)})})}),(0,s.jsxs)("g",{ref:this.refRoot,transform:"translate(0, 0)",className:"jsx-".concat(a$.__hash),children:[(0,s.jsx)("g",{className:"jsx-".concat(a$.__hash)+" axis axis-x"}),(0,s.jsx)("g",{fill:"url(#".concat(e,")"),className:"jsx-".concat(a$.__hash)+" thresholds"})]}),(0,s.jsx)(n(),{id:a$.__hash,children:a$})]})}constructor(...e){super(...e),this.state={width:null,isStarting:!0,isHovering:!1,xHover:null},this.refWidthDiv=l.createRef(),this.refRoot=l.createRef(),this.randomId=Math.random().toString(36).slice(2),this.forceLogScaleTickLabels=!1,this.hasLegend=!1,this.isUnmounted=!1,this.onResize=()=>{let e=this.refWidthDiv.current;if(!e)return;let t=e.offsetWidth;t!==this.state.width&&this.setState({width:t})},this._onMouseMove=e=>{this.setState({xHover:e.nativeEvent.offsetX})},this.onMouseMove=k()(this._onMouseMove,30),this.onMouseEnter=()=>{this.setState({isHovering:!0})},this.onMouseLeave=()=>{this.setState({isHovering:!1})},this.plotUpdate=()=>{if(!this.hasLegend)return;let{width:e}=this.state;if(null==e)return;let{layer:t,layerSpec:a,settings:s}=this.props,i=(0,f.WV)(t,a,s),{valueMin:n,valueMax:l,logScale:r}=i,o=[n,l];!r&&n>0&&n<.01*l&&(o[0]=0);let c=(r?(0,eH.ZE)():(0,eH.m4)()).range([30,30+e-1]).domain(o),{isDefaultTicks:d,tickValues:h}=this.getTickValues(i,c),{isStarting:u}=this.state,p=u||!d,x=(0,aB.kY)().duration(p?0:250),m=(0,eg.A)(this.refRoot.current);this.drawXAxis({selRoot:m,xScale:c,xDomain:o,transition:x,layerProps:i,tickValues:h,isDefaultTicks:d}),this.drawThreshold({selRoot:m,xScale:c,transition:x,layerProps:i}),this.prevScale=c},this.drawXAxis=e=>{var t;let{selRoot:a,xScale:s,xDomain:i,transition:n,layerProps:l}=e,{tickValues:r,isDefaultTicks:o}=e,{intl:c}=this.props,{logScale:d}=l,{units:h}=l,u=null!==(t=null==(h=(0,e$.vr)(h,c,{exponents:!0,long:!0}))?void 0:h.split("\n"))&&void 0!==t?t:[];h=u[0];let p=u[1],x=r.length,m=Array(x),b=Array(x),g=Math.log10(i[0]),j=Math.log10(i[1]),v=o&&(d||this.forceLogScaleTickLabels);for(let e=0;e<x;e++){let t=r[e],a=String(t);v&&(j-g<1&&(0,f.Ex)(Math.log10(t),1)>=.7||j-g>=1&&0!==(0,f.Ex)(Math.log10(t),1))&&(a=""),m[e]=a}if(h)for(let e=x-1;e>=0;e--){let t=m[e];if(t){t+=" ".concat(h),m[e]=t,b[e]=p;break}}let _=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s;return e.attr("transform",e=>{let a=t(e);return a!=a&&(a=-1e3),"translate(".concat(a,", ").concat(14,")")})};a.select(".axis-x").selectAll("g.tick").data(r,e=>e).join(e=>e.append("g").attr("class","tick").style("opacity",0).call(e=>{var t;return _(e,null!==(t=this.prevScale)&&void 0!==t?t:s)}).call(e=>e.append("path").attr("class","tick-line").attr("d","M0,0v".concat(5))).call(e=>e.append("text").attr("class","tick-text").attr("y",9).attr("dy","0.71em").attr("text-anchor","middle")).call(e=>e.append("text").attr("class","tick-text2").attr("y",9).attr("dy","1.8em").attr("text-anchor","middle")),e=>e,e=>e.transition(n).call(_).style("opacity",0).remove()).call(e=>{e.select("text.tick-text").text((e,t)=>m[t]).style("text-anchor",(e,t)=>o||1===x?"middle":0===t?"end":"start")}).call(e=>{e.select("text.tick-text2").text((e,t)=>b[t]).style("text-anchor",(e,t)=>o||1===x?"middle":0===t?"end":"start")}).transition(n).call(_).style("opacity",1)},this.drawThreshold=e=>{let{selRoot:t,xScale:a,transition:s,layerProps:i}=e,{threshold:n}=i,l=(0,L.uk)(n),r=a.range(),o=(null==n?void 0:n.type)==="different",c=e=>e.attr("x",e=>{let[t]=(0,L.dp)(e,a,r,o);return t}).attr("width",e=>{let[t,s]=(0,L.dp)(e,a,r,o);return Math.max(0,s-t)}).attr("y",2).attr("height",5);t.select(".thresholds").selectAll("rect.threshold").data(l).join(e=>e.append("rect").attr("class","threshold").attr("opacity",0).call(c),e=>e,e=>e.transition(s).attr("opacity",0).remove()).transition(s).attr("opacity",.8).call(c)},this.getTickValues=(e,t)=>{let a={isDefaultTicks:!0,tickValues:t.ticks(4)},{isHovering:s,xHover:i}=this.state;if(!s||null==i)return a;let{valueMin:n,valueMax:l}=e,r=t.invert(i);if(r<n||r>l||n===l)return a;let o=(l-n)/400;if(!e.colormapStops)return{isDefaultTicks:!1,tickValues:[(0,f.mi)(r,o)]};{let{logScale:t,colormapStops:a}=e,s=(0,E.vu)(r,n,l,t),i=a.findIndex(e=>e>=s);return{isDefaultTicks:!1,tickValues:0===i?[aG(a[0],n,l,t,o)]:-1===i?[aG(a[a.length-1],n,l,t,o)]:[aG(a[i-1],n,l,t,o),aG(a[i],n,l,t,o)]}}}}}let aG=(e,t,a,s,i)=>{let n=(0,E.db)(e,t,a,s);return(0,f.mi)(n,i)},aW=new String(".legend.jsx-892f749c33ad40f7{cursor:pointer}");aW.__hash="892f749c33ad40f7";let aH=new String(".gradient-wrapper.jsx-82a79affcb09ed90{position:relative;margin-top:10px}.clamp-indicator.jsx-82a79affcb09ed90{position:absolute;top:0;width:".concat(3.5,"px;height:").concat(7,"px;fill:black}.clamp-indicator.left.jsx-82a79affcb09ed90{left:-").concat(3.5,"px}.clamp-indicator.right.jsx-82a79affcb09ed90{right:-").concat(3.5,"px}.gradient.jsx-82a79affcb09ed90{height:").concat(7,"px;-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1}img.gradient.jsx-82a79affcb09ed90{display:block;width:100%}"));aH.__hash="82a79affcb09ed90";let a$=new String("svg.wk-layer-ticks.jsx-b7049f63054d30ea{position:relative;display:block;margin-top:".concat(-14,"px;margin-left:").concat(-30,"px;margin-right:").concat(-30,"px;width:-webkit-calc(100% + ").concat(30,"px + ").concat(30,"px);width:-moz-calc(100% + ").concat(30,"px + ").concat(30,"px);width:calc(100% + ").concat(30,"px + ").concat(30,"px);height:").concat(43,"px}svg.wk-layer-ticks.jsx-b7049f63054d30ea .domain{stroke:none}svg.wk-layer-ticks.jsx-b7049f63054d30ea .tick-line{stroke:black;fill:none}svg.wk-layer-ticks.jsx-b7049f63054d30ea .thresh-line{stroke:var(--color-alert);fill:none}svg.wk-layer-ticks.jsx-b7049f63054d30ea .tick-text,svg.wk-layer-ticks.jsx-b7049f63054d30ea .tick-text2{font-size:10px}"));a$.__hash="b7049f63054d30ea";let aq=(0,eb.Ay)(aV),aZ=e=>{let{item:t}=e,a=e=>(0,s.jsx)("rect",{width:10,height:10,fill:e.fill,stroke:e.stroke,strokeWidth:3,"data-sentry-element":"rect","data-sentry-component":"renderArea","data-sentry-source-file":"325-LegendCategorical.tsx"}),i=e=>(0,s.jsx)("polygon",{points:"1,".concat(9," ").concat(9,",").concat(9," ").concat(5,",2"),fill:e.fill,stroke:e.stroke,strokeWidth:1,"data-sentry-element":"polygon","data-sentry-component":"renderTriangle","data-sentry-source-file":"325-LegendCategorical.tsx"}),l=e=>e.fill?(0,s.jsx)("g",{transform:"translate(2 0) rotate(45)","data-sentry-element":"g","data-sentry-component":"renderLine","data-sentry-source-file":"325-LegendCategorical.tsx",children:(0,s.jsx)("rect",{x:"0",y:"0",width:11,height:"3",fill:e.fill,stroke:e.stroke,strokeWidth:"1","data-sentry-element":"rect","data-sentry-source-file":"325-LegendCategorical.tsx"})}):(0,s.jsx)("path",{d:"M 0 0 L ".concat(10," ").concat(10),stroke:e.stroke,strokeWidth:3}),r=e=>(0,s.jsx)("circle",{cx:5,cy:5,r:2.5,fill:e.fill,"data-sentry-element":"circle","data-sentry-component":"renderPoint","data-sentry-source-file":"325-LegendCategorical.tsx"}),o=e=>{let t=e.narrow?10:34,a=[];e.noBorder||a.push((0,s.jsx)("rect",{width:t,height:10,fill:"none",stroke:e.stroke,strokeWidth:e.lineWidth},"border"));for(let i=-(2*e.separation)-4;i<t;i+=e.separation)a.push((0,s.jsx)("line",{x1:i,y1:0,x2:i+10,y2:10,stroke:e.stroke,strokeWidth:e.lineWidth},String(i)));return(0,s.jsx)(s.Fragment,{children:a})},d=e=>{let t=(0,eU.isLight)(e.fill)?.7:0;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("circle",{cx:2.5,cy:2.5,r:2,fill:e.fill,stroke:"black",strokeWidth:.5,strokeOpacity:t,"data-sentry-element":"circle","data-sentry-source-file":"325-LegendCategorical.tsx"}),(0,s.jsx)("circle",{cx:7.5,cy:2.5,r:2,fill:e.fill,stroke:"black",strokeWidth:.5,strokeOpacity:t,"data-sentry-element":"circle","data-sentry-source-file":"325-LegendCategorical.tsx"}),(0,s.jsx)("circle",{cx:2.5,cy:7.5,r:2,fill:e.fill,stroke:"black",strokeWidth:.5,strokeOpacity:t,"data-sentry-element":"circle","data-sentry-source-file":"325-LegendCategorical.tsx"}),(0,s.jsx)("circle",{cx:7.5,cy:7.5,r:2,fill:e.fill,stroke:"black",strokeWidth:.5,strokeOpacity:t,"data-sentry-element":"circle","data-sentry-source-file":"325-LegendCategorical.tsx"})]})},h=e=>{let t=(0,eU.isLight)(e.stroke),a=t?"rgba(0, 0, 0, 0.7)":e.stroke;return l({type:"line",fill:t?e.stroke:void 0,stroke:a,label:e.label})};return(()=>{var e;let u;let p=!1;switch(null!==(e=t.type)&&void 0!==e?e:"area"){case"area":u=a(t);break;case"triangle":u=i(t);break;case"line":u=l(t);break;case"point":u=r(t);break;case"hash":u=o(t),p=!t.narrow;break;case"particleDots":u=d(t);break;case"particleLines":u=h(t)}return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("svg",{"data-sentry-element":"svg","data-sentry-source-file":"325-LegendCategorical.tsx",className:"jsx-".concat(aJ.__hash)+" "+(c()("item-icon",{"extra-wide":p})||""),children:(0,s.jsx)("g",{transform:"translate(0.5, 0.5)","data-sentry-element":"g","data-sentry-source-file":"325-LegendCategorical.tsx",className:"jsx-".concat(aJ.__hash),children:u})}),(0,s.jsx)(n(),{id:aJ.__hash,children:aJ})]})})()},aY=new String(".legend-categories.jsx-4e18f071e98588a4{margin-top:6px;margin-bottom:10px;font-size:.8rem;overflow-x:auto;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex}.col.jsx-4e18f071e98588a4{-webkit-box-flex:1;-webkit-flex:1 1 0px;-moz-box-flex:1;-ms-flex:1 1 0px;flex:1 1 0px;min-width:45%}.col.no-scroll.jsx-4e18f071e98588a4{min-width:0}.col.jsx-4e18f071e98588a4+.col.jsx-4e18f071e98588a4{margin-left:".concat(15,"px}.cm-legend+.legend-categories{margin-top:3px}.category.jsx-4e18f071e98588a4{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex}.category.hidden.jsx-4e18f071e98588a4{color:var(--color-disabled)}.category.clickable.jsx-4e18f071e98588a4{cursor:pointer}.label.jsx-4e18f071e98588a4{-webkit-box-flex:1;-webkit-flex:1 1 0px;-moz-box-flex:1;-ms-flex:1 1 0px;flex:1 1 0px;white-space:nowrap;overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis}"));aY.__hash="4e18f071e98588a4";let aJ=new String(".item-icon.jsx-8f8e7268eb227821{display:inline-block;position:relative;top:3px;height:".concat(11,"px;width:").concat(11,"px;margin-right:.4em;overflow:hidden}.item-icon.extra-wide.jsx-8f8e7268eb227821{width:").concat(35,"px}"));aJ.__hash="8f8e7268eb227821";let aK=e=>{let t=(0,tN.A)(),a=e=>{var t;let{items:a}=e,l=a.length,r=l<=4?l:l<=10?Math.ceil(l/2):null!==(t=e.itemsPerColumn)&&void 0!==t?t:5,o=[];for(let e=0;e<l;e+=r){let t=a.slice(e,e+r);o.push((0,s.jsxs)("div",{className:"jsx-".concat(aY.__hash)+" "+(c()("col",{"no-scroll":l<=10})||""),children:[t.map((e,t)=>i(e,t)),(0,s.jsx)(n(),{id:aY.__hash,children:aY})]},String(e)))}return o},i=(a,i)=>{let{hiddenItems:l,onClickItem:r}=e,{label:o,id:d}=a,h=null!=d&&(null==l?void 0:l[d]),u=r?t.$t({id:"legend.togglePlatformType",defaultMessage:"Click to toggle visibility. Alt-click to show only this platform type."}):o;return(0,s.jsxs)("div",{onClick:e=>null==r?void 0:r(e,d),title:u,"data-sentry-component":"renderItem","data-sentry-source-file":"325-LegendCategorical.tsx",className:"jsx-".concat(aY.__hash)+" "+(c()("category",{hidden:h,clickable:null!=r})||""),children:[(0,s.jsx)(aZ,{item:a,"data-sentry-element":"LegendItemIcon","data-sentry-source-file":"325-LegendCategorical.tsx"}),(0,s.jsx)("div",{className:"jsx-".concat(aY.__hash)+" label",children:o}),(0,s.jsx)(n(),{id:aY.__hash,children:aY})]},String(i))};return(()=>{let{legendItemsObject:t}=e;if(!t||!t.items.length||t.items.length<=1)return null;let{paddingLeft:i,paddingRight:l}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{style:{paddingLeft:i,paddingRight:l},className:"jsx-".concat(aY.__hash)+" legend-categories",children:a(t)}),(0,s.jsx)(n(),{id:aY.__hash,children:aY})]})})()},aQ={time:null,elevation:null,timeWindow:null,elevationWindow:null};class aX extends l.PureComponent{render(){let{layer:e,layerSpec:t,sortableListeners:a}=this.props,{intl:i,isExternalEmbed:l,isDashboard:r}=this.props,{zoom:o,settings:d,highlightedMapLayerId:h}=this.props;if(!e)return null;this.legendItemsObject=a0(i,e,t,o,d);let u=null==t?void 0:t.isViewable,p=u?e.isHidden?i.$t({id:"layer.showHint",defaultMessage:"Show layer"}):i.$t({id:"layer.hideHint",defaultMessage:"Hide layer"}):i.$t({id:"layer.notViewableHint",defaultMessage:"Layer is not viewable"}),x=Object.keys(this.props.mapLayers).length>1,m=e.id===h;return(0,s.jsxs)("div",{"data-sentry-component":"ControlBlockLayer","data-sentry-source-file":"310-ControlBlockLayer.tsx",className:"jsx-".concat(se.__hash)+" "+(c()("layer",{"recently-created":a6(e),"temporary-order":this.props.isTemporaryOrder})||""),children:[(0,s.jsxs)("div",{className:"jsx-".concat(se.__hash)+" layer-body",children:[!l&&!r&&(0,s.jsxs)("div",{title:p,className:"jsx-".concat(se.__hash)+" left",children:[(0,s.jsx)(eU.Icon,{className:c()("wk-icon-button",{active:u&&!e.isHidden,disabled:!u}),icon:"eye",fixedWidth:!0,onClick:u?this.onClickShowHide:void 0}),(0,s.jsx)("div",{...a||{},title:i.$t({id:"layer.dragToReorderHint",defaultMessage:"Drag to reorder layers"}),className:"jsx-".concat(se.__hash)+" "+(c()("reorder",{hidden:!x})||""),children:(0,s.jsx)(eU.Icon,{icon:"grip-horizontal"})})]}),!l&&!r&&(0,s.jsx)("div",{title:i.$t({id:"layer.removeHint",defaultMessage:"Remove layer (alt-click to remove all layers)"}),className:"jsx-".concat(se.__hash)+" right",children:(0,s.jsx)(eU.Icon,{className:"wk-icon-button",icon:"times",onClick:this.onClickRemove})}),(0,s.jsx)("div",{className:"jsx-".concat(se.__hash)+" "+(c()("layer-highlight",{highlighted:m})||"")})]}),(0,s.jsx)(_.Q.Consumer,{"data-sentry-element":"unknown","data-sentry-source-file":"310-ControlBlockLayer.tsx",children:e=>this.renderTitleBlock(e)}),this.renderLegends(),this.renderButtons(),this.renderSubsetter(),this.renderExplorer(),this.renderThumbnailEditor(),this.renderConfig(),(0,s.jsx)(n(),{id:se.__hash,children:se})]})}renderTitleBlock(e){var t;let a;let{layer:i,layerSpec:l,dataset:r,anyMapObjects:o}=this.props,{intl:d,isExternalEmbed:h,isDashboard:u}=this.props,p=!(0,e_.p)(r),x=this.props.windowWidth<=m.UI.narrowControlBlockBreak,g=(0,f.d8)(l,r,d),j=this.shouldDisambiguate()?g:null,v={context:i.dashboardLabel},_=l&&!p?(0,f.ez)(l,r,d,v):null,{legendItemsObject:y}=this,w=!i.isHidden&&1===y.items.length,k=w&&(null==_?void 0:_.toLocaleLowerCase())!==y.items[0].label?y.items[0].label:void 0;l&&!(0,f.jL)(i.layerId)&&o&&!((null==r?void 0:r.isExternal)&&!(0,f.cn)(l))&&(a=null!==(t=(0,f.JM)(l))&&void 0!==t?t:void 0),t3()(a)===t3()(null!=_?_:void 0)&&(a=void 0);let M=i.layerId.replace(/\/__DEFAULT__/g,"");g&&(M="".concat(g,"\n\n").concat(M));let{time:N}=this.calcLayerTimeElevation(i,l),S=(0,b.$d)(l,N,d);return(0,s.jsxs)("div",{className:"jsx-".concat(st.__hash)+" "+(c()("title-block",{"external-embed":h,"in-dashboard":u})||""),children:[(0,s.jsxs)("h3",{title:M,className:"jsx-".concat(st.__hash)+" "+(c()("title",{narrow:x,"external-embed":h,"in-dashboard":u})||""),children:[(0,s.jsx)("span",{onClick:e?()=>e(i,{ignoreDatasetAutoZoom:!0}):void 0,className:"jsx-".concat(st.__hash)+" "+(c()("title-item title-label",{clickable:null!=e})||""),children:_||(0,s.jsx)(e1.A,{})}),(null==l?void 0:l.hasVectorStyle)&&(0,s.jsx)("span",{title:d.$t({id:"datasetLayers.vectorHint",defaultMessage:"Vector field, calculated from E and N components"}),className:"jsx-".concat(st.__hash)+" title-item",children:(0,s.jsx)(eU.Icon,{icon:"fa-arrows-split-up-and-left"})}),S&&(0,s.jsx)("span",{title:S,className:"jsx-".concat(st.__hash)+" title-item transient-data-warning",children:(0,s.jsx)(eU.Icon,{icon:"exclamation-triangle"})}),w&&(0,s.jsx)("span",{title:k,className:"jsx-".concat(st.__hash)+" title-item mini-legend",children:(0,s.jsx)(aZ,{item:this.legendItemsObject.items[0]})}),a&&!u&&(0,s.jsx)("span",{className:"jsx-".concat(st.__hash)+" title-item variable-id",children:a}),this.renderCardConfig(),!1]}),this.renderSubtitle(p,j,e),(0,s.jsx)(n(),{id:st.__hash,children:st})]})}renderCardConfig(){let{isDashboard:e,cardId:t,layer:a}=this.props;return e&&t&&!a.isDashboardOverlay?(0,s.jsx)(t2,{cardId:t,cardLayerId:this.props.id}):null}renderSubtitle(e,t,a){var i,l,r;let{intl:o,layer:d,layerSpec:h,zoom:u,dataset:p,crs:x}=this.props,{time:g,isDashboard:j,dashSettings:v}=this.props,{variableId:_}=(0,f.ei)(d.layerId),y=_===m.PLACEHOLDER_ID,{externalSourceShort:w}=null!=p?p:{},k=this.calcLayerTimeElevation(d,h),M=null!=h&&!!h.isViewable&&!(0,b.hU)(h,{dashSettings:v}),N=null===(i=null==h?void 0:h.supportsPolarProjections)||void 0===i||i||"epsg:3857"===x||"epsg:4326"===x,S=[],{time:I,timeWindow:A}=k,C=this.renderTimeSubtitle(M,I,A);C&&S.push(["date",C]);let{elevation:D,elevationWindow:T}=k,L=this.renderElevationSubtitle(M,D,T);if(L&&S.push(["elevation",L]),d.isHidden||N||!a||S.push(["warningProjection",(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ef.A,{id:"layer.badProjection",defaultMessage:"Not viewable in this projection"})," ",(0,s.jsx)("span",{className:"cm-auto-fix-layer",onClick:()=>{null==a||a(d,{ignoreDatasetAutoZoom:!0})},children:(0,s.jsx)(ef.A,{id:"layer.fix",defaultMessage:"Fix"})})]}),!0]),!d.isHidden&&M&&null==I&&!(0,f.NS)(h,m.DIM_TIME)){let{tMin:e,tMax:t}=(0,b.w6)(h,{dashSettings:v});if(null!=e&&null!=t){let a=g<e?e:g>t?t:null;null!=a&&S.push(["time-out-of-range",(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ef.A,{id:"layer.timeOutOfRange",defaultMessage:"Selected time is out of range"})," ",(0,s.jsx)("span",{className:"cm-auto-fix-layer",onClick:()=>{this.props.setTime(a,{noRound:!0})},children:(0,s.jsx)(ef.A,{id:"layer.fix",defaultMessage:"Fix"})})]}),!0])}}if(t&&S.push(["disambiguate",t,!0]),(null==h?void 0:h.hasSqlite)&&(null==h?void 0:h.isAltimetry)){let e=null==h?void 0:null===(r=h.stacItem)||void 0===r?void 0:null===(l=r.properties)||void 0===l?void 0:l.admp_title;e&&S.push(["platformId",e])}if(w&&!j&&S.push(["extSource",(0,s.jsxs)(s.Fragment,{children:[w,"\xa0\xa0",(0,s.jsxs)("span",{title:o.$t({id:"layer.externalLayer",defaultMessage:"This is an external layer. Please refer to the information section for more details."}),className:"jsx-".concat(sa.__hash)+" info",children:[(0,s.jsx)(eU.Icon,{className:"wk-icon-button no-hover",icon:"info-circle"}),(0,s.jsx)(n(),{id:sa.__hash,children:sa})]})]})]),!d.isHidden&&null!=u&&h){let{zoomMin:e}=h;null!=e&&Math.round(u-8)<e&&S.push(["zoom-min",o.$t({id:"layer.zoomIn",defaultMessage:"Zoom in to view on map"}),!0])}return e||M&&!y||S.push(["nonViewable",j?m.UI.messages.notViewable(o):m.UI.messages.notViewableButDownloadable(o),!0]),(0,s.jsxs)("div",{className:"jsx-".concat(sa.__hash)+" subtitle",children:[S.map(e=>{let[t,a,i,n]=e;return(0,s.jsx)("span",{onClick:n,className:"jsx-".concat(sa.__hash)+" "+(c()(t,{long:i})||""),children:a},t)}),(0,s.jsx)(n(),{id:sa.__hash,children:sa})]})}renderLegends(){let{layer:e,layerSpec:t,settings:a}=this.props,{isExternalEmbed:i,isDashboard:l}=this.props;if(!e||e.isHidden||!(null==t?void 0:t.isViewable)||(t.hasZarr||t.hasSqlite)&&!e._subsets.length)return null;let r=(0,f.WV)(e,t,a),o=t.hasSqlite;return(0,s.jsxs)(s.Fragment,{children:[a3(r,this.legendItemsObject)&&(0,s.jsxs)("div",{className:"jsx-".concat(ss.__hash)+" "+(c()("legend-continuous-wrapper",{"external-embed":i,"in-dashboard":l})||""),children:[(0,s.jsx)(aq,{layer:e,layerSpec:t,settings:this.props.settings,onClick:this.onClickConfigure}),t.wmsLegendUrl&&(0,s.jsx)("img",{src:t.wmsLegendUrl,className:"jsx-".concat(ss.__hash)+" wms-legend"})]}),(0,s.jsx)(aK,{legendItemsObject:this.legendItemsObject,paddingLeft:i||l?a9:a8,paddingRight:i||l?a9:a7,hiddenItems:o?e.hiddenSparsePtypes:void 0,onClickItem:o?this.onClickToggleSparsePtype:void 0}),(0,s.jsx)(n(),{id:ss.__hash,children:ss})]})}renderButtons(){var e,t,a;let{layer:i,layerSpec:l,datasetId:r,isSubstore:o}=this.props,{settings:d,canEditThumbnails:h}=this.props,{intl:u,isExternalEmbed:p,isDashboard:x}=this.props,b=x||p||o,g=this.props.dataset,j=(0,e_.p)(g),v=null!==(a=null!==(t=null!==(e=null==l?void 0:l.externalDownloadUrl)&&void 0!==e?e:null==g?void 0:g.externalDownloadUrl)&&void 0!==t?t:null==g?void 0:g.externalProductUrl)&&void 0!==a?a:null==g?void 0:g.externalProviderUrl,_=!x&&j&&g.layers&&Object.keys(g.layers).length>1,y=l&&l.hasLogScale&&!l.isCategorical,w=(null==l?void 0:l.isViewable)&&!(0,f.jL)(i.layerId),k=!x&&!o&&((null==l?void 0:l.hasNative)||(null==l?void 0:l.hasZarr)||(null==l?void 0:l.hasSqlite)),M=!b&&null!=v,N=!b&&!k&&!M&&j&&!g.isExternal&&(null==g?void 0:g.catalogue)==="CMEMS",S=!b&&j&&h&&d.editThumbnails;return(0,s.jsxs)("div",{className:"jsx-".concat(si.__hash)+" "+(c()("buttons",{"external-embed":p,"in-dashboard":x})||""),children:[k&&(0,s.jsxs)("div",{className:"jsx-".concat(si.__hash)+" "+(c()("button",{active:i.isSubsetting})||""),children:[(0,s.jsx)("div",{title:u.$t({id:"layer.subsetAndDownloadHint",defaultMessage:"Subset and download"}),onClick:this.onClickSubset,className:"jsx-".concat(si.__hash)+" "+(c()("wk-control-block-button wk-icon-button subset-button",{active:i.isSubsetting})||""),children:(0,s.jsx)(eU.Icon,{icon:"download",fixedWidth:!0})}),(0,s.jsx)("div",{className:"jsx-".concat(si.__hash)+" drawer-pin",children:"\xa0"}),(0,s.jsx)("div",{className:"jsx-".concat(si.__hash)+" drawer-pin2",children:"\xa0"})]}),N&&(0,s.jsx)("div",{className:"jsx-".concat(si.__hash)+" button wk-control-block-button wk-icon-button",children:(0,s.jsx)(eW.A,{href:"".concat(m.URLS.viewer,"?view=datasetServices&dataset=").concat(r),children:(0,s.jsx)("span",{title:u.$t({id:"layer.downloadServicesHint",defaultMessage:"Go to download services"}),className:"jsx-".concat(si.__hash),children:(0,s.jsx)(eU.Icon,{icon:"download",fixedWidth:!0})})})}),M&&(0,s.jsx)("div",{className:"jsx-".concat(si.__hash)+" button wk-control-block-button wk-icon-button",children:(0,s.jsx)(eW.A,{href:v,openInNewTab:!0,children:(0,s.jsx)("span",{title:u.$t({id:"layer.downloadExternalHint",defaultMessage:"Download from external provider"}),className:"jsx-".concat(si.__hash),children:(0,s.jsx)(eU.Icon,{icon:"download",fixedWidth:!0})})})}),!b&&(0,s.jsx)("div",{className:"jsx-".concat(si.__hash)+" button wk-control-block-button wk-icon-button",children:(0,s.jsx)(eW.A,{href:"".concat(m.URLS.viewer,"?view=dataset&dataset=").concat(r),children:(0,s.jsx)("span",{title:u.$t({id:"layer.infoHint",defaultMessage:"Show layer information"}),className:"jsx-".concat(si.__hash),children:(0,s.jsx)(eU.Icon,{icon:"info",fixedWidth:!0})})})}),x&&(0,s.jsx)("div",{className:"jsx-".concat(si.__hash)+" button wk-control-block-button wk-icon-button",children:(0,s.jsx)(eW.A,{href:"".concat(m.URLS.product,"/").concat(r),openInNewTab:!0,children:(0,s.jsx)("span",{title:u.$t({id:"layer.productPageHint",defaultMessage:"Show in the catalogue"}),className:"jsx-".concat(si.__hash),children:(0,s.jsx)(eU.Icon,{icon:"info",fixedWidth:!0})})})}),_&&(0,s.jsxs)("div",{className:"jsx-".concat(si.__hash)+" "+(c()("button",{active:i.isExploring})||""),children:[(0,s.jsx)("div",{title:u.$t({id:"layer.quickExploreHint",defaultMessage:"Explore other layers from the same dataset"}),onClick:this.onClickExplore,className:"jsx-".concat(si.__hash)+" "+(c()("wk-control-block-button wk-icon-button",{active:i.isExploring})||""),children:(0,s.jsx)(eU.Icon,{icon:"layer-group",fixedWidth:!0})}),(0,s.jsx)("div",{className:"jsx-".concat(si.__hash)+" drawer-pin",children:"\xa0"}),(0,s.jsx)("div",{className:"jsx-".concat(si.__hash)+" drawer-pin2",children:"\xa0"})]}),S&&(0,s.jsxs)("div",{className:"jsx-".concat(si.__hash)+" "+(c()("button",{active:i.isEditingThumbnail})||""),children:[(0,s.jsx)("div",{title:u.$t({id:"layer.thumbnailHint",defaultMessage:"Edit the thumbnail of this product"}),onClick:this.onClickEditThumbnail,className:"jsx-".concat(si.__hash)+" "+(c()("wk-control-block-button wk-icon-button",{active:i.isEditingThumbnail})||""),children:(0,s.jsx)(eU.Icon,{icon:"camera",fixedWidth:!0})}),(0,s.jsx)("div",{className:"jsx-".concat(si.__hash)+" drawer-pin",children:"\xa0"}),(0,s.jsx)("div",{className:"jsx-".concat(si.__hash)+" drawer-pin2",children:"\xa0"})]}),w&&(0,s.jsxs)("div",{className:"jsx-".concat(si.__hash)+" "+(c()("button",{active:i.isConfiguring})||""),children:[(0,s.jsxs)("div",{title:u.$t({id:"layer.configureHint",defaultMessage:"Configure layer"}),onClick:this.onClickConfigure,"data-testid":"configure-layer-button",className:"jsx-".concat(si.__hash)+" "+(c()("wk-control-block-button wk-icon-button",{active:i.isConfiguring})||""),children:[(0,s.jsx)(eU.Icon,{icon:"cog",fixedWidth:!0}),(0,s.jsx)(ao.A,{ids:["layerConfig","hatching"],right:-3,top:-2,disableOnUnmount:!1})]}),(0,s.jsx)("div",{className:"jsx-".concat(si.__hash)+" drawer-pin",children:"\xa0"}),(0,s.jsx)("div",{className:"jsx-".concat(si.__hash)+" drawer-pin2",children:"\xa0"})]}),y&&(0,s.jsx)("div",{title:i.logScale?u.$t({id:"layer.logOffHint",defaultMessage:"Disable log scale"}):u.$t({id:"layer.logOnHint",defaultMessage:"Enable log scale"}),onClick:this.onClickLogScale,className:"jsx-".concat(si.__hash)+" "+(c()("button wk-control-block-button wk-icon-button text-button",{active:i.logScale,disabled:!y})||""),children:"log"}),(0,s.jsx)(n(),{id:si.__hash,children:si})]})}renderSubsetter(){let{layer:e,layerSpec:t,isExternalEmbed:a,dataset:i}=this.props;if(!i||!e.isSubsetting||!t)return null;let{hasZarr:l,hasSqlite:r,hasNative:o}=t,d=(0,f.o7)(i),h=(l||r)&&!d;if(!h&&!o)return null;let u=(0,f.Of)(i,t);return u?(0,s.jsxs)("div",{className:"jsx-".concat(sn.__hash)+" "+(c()("layer-pane subset-pane",{"external-embed":a})||""),children:[h&&(0,s.jsx)(a_,{mapLayerId:this.props.id,datasetId:i.id,layerSpec:t}),!h&&o&&(0,s.jsxs)("div",{className:"jsx-".concat(sn.__hash),children:[(0,s.jsx)("div",{className:"jsx-".concat(sn.__hash)+" instructions",children:(0,s.jsx)(ef.A,{id:"layer.noSubsetterInstructions",defaultMessage:"Browse the files directly or use {otherServices}.",values:{otherServices:(0,s.jsx)(eW.A,{href:"".concat(m.URLS.viewer,"?view=datasetServices&dataset=").concat(i.id),children:(0,s.jsx)(ef.A,{id:"layer.otherDownloadServices",defaultMessage:"other download services"})},"otherServices")}})}),(0,s.jsx)("div",{className:"jsx-".concat(sn.__hash)+" single-button-line",children:(0,s.jsx)(eW.A,{className:"wk-button small primary",href:"/viewer/expert?view=files&dataset=".concat(i.id,"&subdataset=").concat(u.id),children:(0,s.jsx)(ef.A,{id:"subset.browseFilesButton",defaultMessage:"Browse files"})})})]}),(0,s.jsx)(n(),{id:sn.__hash,children:sn})]}):null}renderExplorer(){let{layer:e,isExternalEmbed:t}=this.props,a=this.props.dataset;if(!e.isExploring||!(0,e_.p)(a))return null;let{layerId:i}=e;return(0,s.jsxs)("div",{className:"jsx-".concat(sn.__hash)+" "+(c()("layer-pane",{"external-embed":t})||""),children:[(0,s.jsxs)("div",{className:"jsx-".concat(sn.__hash)+" instructions",children:[(0,s.jsx)(ef.A,{id:"quickExplore.instructions",defaultMessage:"Click to explore other layers in this product"})," ",(0,s.jsx)(ef.A,{id:"quickExplore.instructions2",defaultMessage:"(or click on “Add layer…” above for more products)"}),":"]}),(0,s.jsx)(t6.A,{dataset:a,activeTeroLayerIds:[i],onClickSelect:this.onClickReplace,mini:!0,settings:this.props.settings}),(0,s.jsx)(n(),{id:sn.__hash,children:sn})]})}renderThumbnailEditor(){let{dataset:e,layer:t,layerSpec:a}=this.props;return e&&this.props.datasetId&&t.isEditingThumbnail&&this.props.canEditThumbnails&&a?(0,s.jsxs)("div",{className:"jsx-".concat(sn.__hash)+" "+(c()("layer-pane")||""),children:[(0,s.jsx)(ar,{mapLayerId:this.props.id,datasetId:this.props.datasetId,layerSpec:a}),(0,s.jsx)(n(),{id:sn.__hash,children:sn})]}):null}renderConfig(){let{layer:e,isExternalEmbed:t,settings:a}=this.props;if(!(0,e_.p)(this.props.dataset))return null;let i="".concat(e.layerId,".").concat(a.unitsTemperature,".").concat(a.unitsWindSpeed);return(0,s.jsxs)("div",{className:"jsx-".concat(sn.__hash)+" "+(c()("layer-pane",{"external-embed":t,hidden:!e.isConfiguring})||""),children:[(0,s.jsx)(aR,{mapLayerId:this.props.id},i),(0,s.jsx)(n(),{id:sn.__hash,children:sn})]})}shouldDisambiguate(){if(this.props.settings.alwaysShowLayerAreaSubtitle)return!0;let{intl:e,layer:t,layerSpec:a,dataset:s,mapLayers:i,datasets:n}=this.props;if(!a||!s)return!1;let l=(0,f.ez)(a,s,e,{context:t.dashboardLabel});for(let t of Object.values(i)){if(t===this.props.layer)continue;let a=(0,f.VF)(n,t.layerId);if(!a)continue;let i={context:t.dashboardLabel};if((0,f.ez)(a,s,e,i)===l)return!0}return!1}constructor(...e){super(...e),this.state={timeWindowFocused:!1,elevWindowFocused:!1},this.renderTimeSubtitle=(e,t,a)=>{let{layerSpec:i}=this.props;return!e||null==t||(0,f.NS)(i,m.DIM_TIME)?null:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{children:(0,f.Kq)(t)}),(i.isHourly||i.isNonperiodic)&&(0,s.jsx)("span",{className:"time",children:(0,f.Kq)(t,{withDate:!1,withTime:!0})}),this.renderTimeWindow(a)]})},this.renderTimeWindow=e=>{var t,a,i,n;if(!e)return null;let{intl:l}=this.props,r=null!==(i=null===(t=this.props.layerSpec)||void 0===t?void 0:t.timeWindowMax)&&void 0!==i?i:m.TIME_ELEVATION_WINDOWS.time.defaultHour,o=m.TIME_ELEVATION_WINDOWS.time.values.map(e=>{let[t,a]=e;return{value:u().duration(t,a).asHours(),label:"".concat(t," ").concat(m.TIME_WINDOW_UNIT_TRANSLATIONS[a](l))}});return o=o.filter(e=>e.value<=r),(0,s.jsxs)(s.Fragment,{children:["\xa0\xb1\xa0",(0,s.jsxs)("span",{className:c()("window-value",{focused:this.state.timeWindowFocused}),children:[null!==(n=null===(a=o.find(t=>t.value===e))||void 0===a?void 0:a.label)&&void 0!==n?n:"".concat(e," ").concat(m.TIME_WINDOW_UNIT_TRANSLATIONS.hours(l)),(0,s.jsx)("span",{className:"window-select",children:(0,s.jsx)(eU.Select,{className:"time-window",items:o,value:e,onChange:(e,t)=>{this.setTimeWindow(t),setTimeout(()=>{var t,a;null===(a=e.target)||void 0===a||null===(t=a.blur)||void 0===t||t.call(a)},0)},onFocus:()=>this.setState({timeWindowFocused:!0}),onBlur:()=>this.setState({timeWindowFocused:!1}),required:!0})})]})]})},this.renderElevationSubtitle=(e,t,a)=>{let{layerSpec:i}=this.props;return!e||null==t||(0,f.NS)(i,m.DIM_ELEVATION)?null:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{children:"".concat(Math.round(10*t)/10," m")}),this.renderElevationWindow(a)]})},this.renderElevationWindow=e=>{var t;if(!e)return null;let a=m.TIME_ELEVATION_WINDOWS.elevation.values.map(e=>({label:"".concat(e," m"),value:e}));return(0,s.jsxs)(s.Fragment,{children:["\xa0\xb1\xa0",(0,s.jsxs)("span",{className:c()("window-value",{focused:this.state.elevWindowFocused}),children:[null===(t=a.find(t=>t.value===e))||void 0===t?void 0:t.label,(0,s.jsx)("span",{className:"window-select",children:(0,s.jsx)(eU.Select,{className:"elevation-window",items:a,value:e,onChange:(e,t)=>{this.setElevationWindow(t),setTimeout(()=>{var t,a;null===(a=e.target)||void 0===a||null===(t=a.blur)||void 0===t||t.call(a)},0)},onFocus:()=>this.setState({elevWindowFocused:!0}),onBlur:()=>this.setState({elevWindowFocused:!1}),required:!0})})]})]})},this.calcLayerTimeElevation=(e,t)=>{var a,s,i,n,l,r,o,c,d,h;if(!t||!t.isViewable||e.isHidden)return aQ;if(t.hasZarr){let t=null===(a=e._subsets)||void 0===a?void 0:a[0];return t?{time:"deletedDimCoords"in t?null===(s=t.deletedDimCoords[m.DIM_TIME])||void 0===s?void 0:s.values[0]:null,elevation:"deletedDimCoords"in t?null===(i=t.deletedDimCoords[m.DIM_ELEVATION])||void 0===i?void 0:i.values[0]:null,timeWindow:null,elevationWindow:null}:aQ}return t.hasSqlite?(null===(n=e._subsets)||void 0===n?void 0:n[0])?{time:null!==(l=e.time)&&void 0!==l?l:null,elevation:null!==(r=e.elevation)&&void 0!==r?r:null,timeWindow:null!==(o=e.timeWindow)&&void 0!==o?o:m.TIME_ELEVATION_WINDOWS.time.defaultHour,elevationWindow:null!==(c=e.elevationWindow)&&void 0!==c?c:m.TIME_ELEVATION_WINDOWS.elevation.default}:aQ:{time:null!==(d=e.time)&&void 0!==d?d:null,elevation:null!==(h=e.elevation)&&void 0!==h?h:null,timeWindow:null,elevationWindow:null}},this.onClickShowHide=e=>{let{layer:t}=this.props,a=!t.isHidden,{altKey:s}=e;t=(0,S.set)(t,"isHidden",!s&&a),this.props.updateMapLayer(this.props.id,t,{hideAllOthers:s}),(0,eR.PJ)({category:"viewer",action:a?"layerHide":"layerShow",label:t.layerId})},this.onClickRemove=e=>{e.altKey?this.props.removeAllMapLayers():this.props.removeMapLayer(this.props.id)},this.onClickReplace=(e,t)=>{t?this.props.addMapLayer(e):this.props.replaceMapLayerContents(this.props.id,e)},this.onChangeCardLayer=e=>{let t=e.target.value;this.props.assignNewLayerToCard(this.props.cardId,t),(0,eR.PJ)({category:"dashboard",action:"cardReconfigure"})},this.onClickLogScale=()=>{let{layer:e}=this.props,t=!e.logScale;e=(0,S.set)(e,"logScale",t),this.props.updateMapLayer(this.props.id,e),(0,eR.PJ)({category:"viewer",action:t?"logScaleOn":"logScaleOff",label:e.layerId})},this.onClickExplore=()=>{let{layer:e}=this.props,t=!e.isExploring;e=(0,S.merge)(e,{...a4(),isExploring:t}),this.props.updateMapLayer(this.props.id,e),(0,eR.PJ)({category:"viewer",action:t?"explorerShow":"explorerHide",label:e.layerId})},this.onClickSubset=()=>{let{layer:e}=this.props,t=!e.isSubsetting;e=(0,S.merge)(e,{...a4(),isSubsetting:t}),this.props.updateMapLayer(this.props.id,e),(0,eR.PJ)({category:"subsetter",action:t?"subsetFormShow":"subsetFormHide",label:e.layerId})},this.onClickEditThumbnail=()=>{let{layer:e}=this.props,t=!e.isEditingThumbnail;e=(0,S.merge)(e,{...a4(),isEditingThumbnail:t}),this.props.updateMapLayer(this.props.id,e),(0,eR.PJ)({category:"viewer",action:t?"editThumbnailShow":"editThumbnailHide",label:e.layerId})},this.onClickConfigure=()=>{let{layer:e}=this.props,t=!e.isConfiguring;e=(0,S.merge)(e,{...a4(),isConfiguring:t}),this.props.updateMapLayer(this.props.id,e),t||(this.props.setFeatureHint("layerConfig",!1),this.props.setFeatureHint("hatching",!1)),(0,eR.PJ)({category:"viewer",action:t?"configureLayerShow":"configureLayerHide",label:e.layerId})},this.setTimeWindow=e=>{let t=(0,S.set)(this.props.layer,"timeWindow",e);this.props.updateMapLayer(this.props.id,t),(0,eR.PJ)({category:"viewer",action:"layerSetTimeWindow",label:t.layerId})},this.setElevationWindow=e=>{let t=(0,S.set)(this.props.layer,"elevationWindow",e);this.props.updateMapLayer(this.props.id,t),(0,eR.PJ)({category:"viewer",action:"layerSetElevationWindow",label:t.layerId})},this.onClickToggleSparsePtype=(e,t)=>{let a=this.legendItemsObject.items,{layer:s}=this.props,{hiddenSparsePtypes:i}=s;if(e.altKey){let e=Object.keys(i).length===a.length-1&&!i[t];i={},e||a.forEach(e=>{null!=e.id&&e.id!==t&&(i[e.id]=!0)})}else i=i[t]?(0,S.omit)(i,t):(0,S.set)(i,t,!0);s=(0,S.set)(s,"hiddenSparsePtypes",i),this.props.updateMapLayer(this.props.id,s),(0,eR.PJ)({category:"viewer",action:"layerToggleSparsePtype",label:s.layerId})}}}let a0=(e,t,a,s,i)=>{var n,l,r,o;let c={type:"default",items:[]};if(!t||!a)return c;let d=(0,f.WV)(t,a,i),h=null!==(r=null!==(l=null!==(n=a1(a,s))&&void 0!==n?n:a2(a,d))&&void 0!==l?l:a5(t))&&void 0!==r?r:c,{styleSolid:u,styleParticles:p,threshold:x}=d;if(p){let s=u?"black":null!==(o=t.particleColor)&&void 0!==o?o:(0,E.LZ)(i),n=(null==a?void 0:a.hasWaveStyle)?{id:"Particles",type:"particleLines",stroke:s,label:e.$t({id:"legend.particles",defaultMessage:"Particle animation"})}:{id:"Particles",type:"particleDots",fill:s,label:e.$t({id:"legend.particles",defaultMessage:"Particle animation"})},l=(0,S.addLast)(h.items,n);h=(0,S.set)(h,"items",l)}if(x&&!a3(d,h)){let t=(0,L.nG)(x," "),s=(0,e$.vr)(a.units,e,{exponents:!0}),i="".concat(t," ").concat(null!=s?s:""),n=(0,S.addLast)(h.items,{id:"Hatched",type:"hash",stroke:"#B46269",separation:6,lineWidth:1.5,noBorder:!0,narrow:!0,label:i});h=(0,S.set)(h,"items",n)}return h},a1=(e,t)=>{let a=null==e?void 0:e.legendCategories;if(!a)return null;if(Array.isArray(a))return{type:"default",items:a};if("byZoom"!==a.type)return a;let s=Object.keys(a.byZoom),i=null;for(let e=0;e<s.length;e++){let n=s[e];t-8>=Number(n)&&(i=a.byZoom[n])}return i},a2=(e,t)=>{if(!e||!t.styleSolid)return null;let{isCategorical:a,flagValues:s,flagColormap:i}=e;if(!a)return null;let{valueMin:n,valueMax:l}=t,{colormapId:r,colormapInvert:o,colormapStops:c}=t,d=(0,E.Co)(r,o,c).str,h=n===l;return{type:"default",source:"denseSubset",items:s.map(t=>{let a;let s="".concat(t),r=(0,f.EL)(e,t),o=h?.5:(t-n)/(l-n);if(i)a=i.str[t];else{let e=Math.floor(o*E.Yo);e>=E.Yo&&(e=E.Yo-1),e<0&&(e=0),a=d[e]}return{id:s,type:"area",fill:a,label:r}})}},a5=(()=>{let e,t;return a=>{var s;let i=Object.keys(q.pw);if(e&&e===a&&t)return t;let n=!1,l=new Set;for(let e of null!==(s=null==a?void 0:a._subsets)&&void 0!==s?s:[])if(null==e?void 0:e.isSparse)for(let t of(n=!0,Object.values(e.data)))for(let e of t.samples)l.add(e[N.s.platformType]);if(!n)return null;let r=i.filter(e=>l.has(e)).map(e=>{let[t,a,s]=q.pw[e];return{id:e,type:"point",fill:"rgb(".concat(t,", ").concat(a,", ").concat(s,")"),label:q.g7[e]}});e=a;let o={type:"default",source:"sparseSubset",items:r};return t=o,o}})(),a3=(e,t)=>(null==t?void 0:t.source)!=="denseSubset"&&(e.styleSolid||e.styleVectors),a6=e=>new Date().getTime()-e.creationDate<1e3,a4=()=>({isSubsetting:!1,isExploring:!1,isEditingThumbnail:!1,isConfiguring:!1}),a9=18,a8=48,a7=38,se=new String(".layer.jsx-b9c97f92f449affc{position:relative;padding:".concat(12,"px 0px}@-webkit-keyframes flash-layer{from{background-color:var(--color-accent-bg-opaque)}to{background-color:transparent}}@-moz-keyframes flash-layer{from{background-color:var(--color-accent-bg-opaque)}to{background-color:transparent}}@-o-keyframes flash-layer{from{background-color:var(--color-accent-bg-opaque)}to{background-color:transparent}}@keyframes flash-layer{from{background-color:var(--color-accent-bg-opaque)}to{background-color:transparent}}.layer.recently-created.jsx-b9c97f92f449affc{-webkit-animation:1s ease-in 0s flash-layer;-moz-animation:1s ease-in 0s flash-layer;-o-animation:1s ease-in 0s flash-layer;animation:1s ease-in 0s flash-layer}.layer.jsx-b9c97f92f449affc:not(.recently-created){-webkit-transition:background-color ").concat(m.UI.transitionDuration,"ms;-moz-transition:background-color ").concat(m.UI.transitionDuration,"ms;-o-transition:background-color ").concat(m.UI.transitionDuration,"ms;transition:background-color ").concat(m.UI.transitionDuration,"ms}.layer.temporary-order.jsx-b9c97f92f449affc{opacity:.1}.layer-body.jsx-b9c97f92f449affc{-webkit-box-align:baseline;-webkit-align-items:baseline;-moz-box-align:baseline;-ms-flex-align:baseline;align-items:baseline}.layer-highlight.jsx-b9c97f92f449affc{-webkit-transition:opacity ").concat(m.UI.transitionDuration,"ms;-moz-transition:opacity ").concat(m.UI.transitionDuration,"ms;-o-transition:opacity ").concat(m.UI.transitionDuration,"ms;transition:opacity ").concat(m.UI.transitionDuration,"ms;pointer-events:none;position:absolute;top:0;left:0;width:100%;height:120px;background:-webkit-linear-gradient(290deg,var(--color-accent-complementary)-10%,transparent 50%);background:-moz-linear-gradient(290deg,var(--color-accent-complementary)-10%,transparent 50%);background:-o-linear-gradient(290deg,var(--color-accent-complementary)-10%,transparent 50%);background:linear-gradient(160deg,var(--color-accent-complementary)-10%,transparent 50%);mix-blend-mode:multiply;opacity:0}.layer-highlight.highlighted.jsx-b9c97f92f449affc{opacity:1}.left.jsx-b9c97f92f449affc{position:absolute;left:").concat(a9,"px;text-align:center}.reorder.jsx-b9c97f92f449affc{opacity:0;margin-top:-1px;color:#d0d0d0;cursor:ns-resize}.reorder.hidden.jsx-b9c97f92f449affc{display:none}@media(hover:hover){.layer.jsx-b9c97f92f449affc:hover .reorder.jsx-b9c97f92f449affc{opacity:1}}.right.jsx-b9c97f92f449affc{position:absolute;right:").concat(a9,"px;opacity:0}.layer.jsx-b9c97f92f449affc:hover .right.jsx-b9c97f92f449affc{opacity:1}@media(hover:none){.right.jsx-b9c97f92f449affc{opacity:1}}"));se.__hash="b9c97f92f449affc";let st=new String(".title-block.jsx-ab2f2e6bea21ddb0{margin:1px ".concat(a7,"px 0 ").concat(a8,"px;position:relative}.title-block.external-embed.jsx-ab2f2e6bea21ddb0,.title-block.in-dashboard.jsx-ab2f2e6bea21ddb0{margin:0 ").concat(a9,"px}.title-block.jsx-ab2f2e6bea21ddb0 .title.jsx-ab2f2e6bea21ddb0{margin:0;padding:0;line-height:1.2;font-size:1rem;position:relative}.title-item.jsx-ab2f2e6bea21ddb0{margin-right:.5em}.title.narrow.external-embed.jsx-ab2f2e6bea21ddb0,.title.narrow.in-dashboard.jsx-ab2f2e6bea21ddb0{margin-right:10px}.title-label.clickable.jsx-ab2f2e6bea21ddb0{cursor:pointer}.mini-legend.jsx-ab2f2e6bea21ddb0{display:inline-block;white-space:nowrap;position:relative;top:-3px}.variable-id.jsx-ab2f2e6bea21ddb0{color:var(--color-disabled);font-weight:normal}.transient-data-warning.jsx-ab2f2e6bea21ddb0{color:var(--color-warning)}"));st.__hash="ab2f2e6bea21ddb0";let sa=new String('.subtitle.jsx-cab9325b00babb6e{margin:3px 0 3px;font-size:.8rem;color:var(--color-disabled)}.subtitle.jsx-cab9325b00babb6e span.jsx-cab9325b00babb6e{margin-right:.7em}.subtitle.jsx-cab9325b00babb6e span.jsx-cab9325b00babb6e:not(.long){display:inline-block}.subtitle.jsx-cab9325b00babb6e span.jsx-cab9325b00babb6e:not(:last-child):after{content:"\xb7";color:#bbb;margin-left:.7em}.subtitle.jsx-cab9325b00babb6e span.time{margin-left:.45em}.subtitle.jsx-cab9325b00babb6e .window-value{text-decoration:underline;position:relative;display:inline-block}.subtitle.jsx-cab9325b00babb6e .window-value.focused{color:black}.subtitle.jsx-cab9325b00babb6e .window-select{position:absolute;top:0;left:0;opacity:0}.zoom-min.jsx-cab9325b00babb6e,.zoom-max.jsx-cab9325b00babb6e,.cm-auto-fix-layer{display:inline-block;background-color:var(--color-notif-warn-bg);color:var(--color-notif-warn-fg);-webkit-border-radius:0px;-moz-border-radius:0px;border-radius:0px;padding:0 6px;margin-bottom:0px}.zoom-min.jsx-cab9325b00babb6e:before,.zoom-max.jsx-cab9325b00babb6e:before,.cm-auto-fix-layer:before{content:""!important;margin-right:0!important}.cm-auto-fix-layer{cursor:pointer}.cm-auto-fix-layer:hover{opacity:.8}.info.jsx-cab9325b00babb6e{}.info.jsx-cab9325b00babb6e .wk-icon-button{color:var(--color-dim)}');sa.__hash="cab9325b00babb6e";let ss=new String(".legend-continuous-wrapper.jsx-6077eae31a1bd096{margin-left:".concat(a8,"px;margin-right:").concat(a7,"px}.legend-continuous-wrapper.external-embed.jsx-6077eae31a1bd096,.legend-continuous-wrapper.in-dashboard.jsx-6077eae31a1bd096{margin-left:").concat(a9,"px;margin-right:").concat(a9,"px}.wms-legend.jsx-6077eae31a1bd096{margin-top:5px;margin-bottom:2px;mix-blend-mode:multiply}"));ss.__hash="6077eae31a1bd096";let si=new String(".buttons.jsx-8a2d52ec0d796ecc{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;margin-left:".concat(a8-8,"px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.buttons.external-embed.jsx-8a2d52ec0d796ecc,.buttons.in-dashboard.jsx-8a2d52ec0d796ecc{margin-left:").concat(a9-8,"px}.button.jsx-8a2d52ec0d796ecc{position:relative}.button.jsx-8a2d52ec0d796ecc+.button.jsx-8a2d52ec0d796ecc{margin-left:.3em}.wk-control-block-button{padding:3px 6px}.wk-control-block-button.active{color:var(--color-icon-button-active)}.button.jsx-8a2d52ec0d796ecc .drawer-pin.jsx-8a2d52ec0d796ecc,.button.jsx-8a2d52ec0d796ecc .drawer-pin2.jsx-8a2d52ec0d796ecc{display:none;position:absolute;bottom:-").concat(13,"px;border-style:solid;border-top-color:transparent;border-left-color:transparent;border-right-color:transparent;width:0;heigth:0;line-height:0}.button.jsx-8a2d52ec0d796ecc .drawer-pin.jsx-8a2d52ec0d796ecc{left:-webkit-calc(50% - ").concat(10,"px);left:-moz-calc(50% - ").concat(10,"px);left:calc(50% - ").concat(10,"px);border-width:").concat(10,"px;border-bottom-color:var(--color-subtle-line)}.button.jsx-8a2d52ec0d796ecc .drawer-pin2.jsx-8a2d52ec0d796ecc{left:-webkit-calc(50% - ").concat(9,"px);left:-moz-calc(50% - ").concat(9,"px);left:calc(50% - ").concat(9,"px);border-width:").concat(9,"px;border-bottom-color:var(--color-title-bg-lighter)}.button.active.jsx-8a2d52ec0d796ecc .drawer-pin.jsx-8a2d52ec0d796ecc,.button.active.jsx-8a2d52ec0d796ecc .drawer-pin2.jsx-8a2d52ec0d796ecc{display:block}.text-button.jsx-8a2d52ec0d796ecc{font-weight:bold;font-size:.8rem;padding-top:5px;min-width:32px;text-align:center}.subset-button.jsx-8a2d52ec0d796ecc{position:relative}.wk-icon-show-vectors{-webkit-transform:rotate(-45deg);-moz-transform:rotate(-45deg);-ms-transform:rotate(-45deg);-o-transform:rotate(-45deg);transform:rotate(-45deg)}"));si.__hash="8a2d52ec0d796ecc";let sn=new String(".layer-pane.jsx-5906c1659030cd56{margin:".concat(12,"px 0 -").concat(12,"px;background-color:var(--color-title-bg-lighter);-webkit-border-radius:0px;-moz-border-radius:0px;border-radius:0px;border-top:1px solid var(--color-subtle-line);padding:5px -webkit-calc(").concat(a9,"px + 11px + ").concat(10,"px)5px -webkit-calc(").concat(a9,"px + 20px + ").concat(10,"px);padding:5px -moz-calc(").concat(a9,"px + 11px + ").concat(10,"px)5px -moz-calc(").concat(a9,"px + 20px + ").concat(10,"px);padding:5px calc(").concat(a9,"px + 11px + ").concat(10,"px)5px calc(").concat(a9,"px + 20px + ").concat(10,"px);font-size:.8rem}.layer-pane.external-embed.jsx-5906c1659030cd56{padding-left:").concat(a9,"px;padding-right:").concat(a9,"px}.layer-pane.hidden.jsx-5906c1659030cd56{display:none}.instructions.jsx-5906c1659030cd56{padding:6px 0 16px;font-style:italic;text-align:center}.single-button-line.jsx-5906c1659030cd56{text-align:center;margin-bottom:5px}"));sn.__hash="5906c1659030cd56";let sl=(0,r.withRouter)((0,d.Ng)((e,t)=>{let{id:a}=t,s=(0,v.B_)(e),i=(0,v.b7)(e),n=(0,v.Yj)(e,a),l=(0,v.yT)(e),r=(0,v.IX)(e),o=(0,v.mt)(e),c=null,d=null,h=null;return n&&(c=l[d=(0,f.ei)(n.layerId).datasetId],h=(0,f.VF)(l,n.layerId)),{anyMapObjects:Object.keys(s).length>0,mapLayers:i,layer:n,layerSpec:h,datasetId:d,dataset:c,datasets:l,zoom:r,isExternalEmbed:(0,v.$x)(e),isDashboard:(0,v.N0)(e),dashSettings:(0,v.YO)(e),isSubstore:(0,v.wZ)(e),settings:o,username:(0,v.TO)(e),canEditThumbnails:(0,v.YY)(e),crs:(0,v.tT)(e),time:(0,v.WB)(e),highlightedMapLayerId:(0,v.E8)(e)}},x)((0,eb.Ay)(aX))),sr=e=>{let{id:t,cardId:a}=e,{attributes:i,listeners:l,setNodeRef:r,transform:o,transition:c}=(0,tQ.gl)({id:t});return(0,s.jsxs)("div",{ref:r,style:{transform:t0.Ks.Transform.toString(o),transition:null!=c?c:void 0,outline:"none"},...i,"data-testid":"sortable-layer","data-sentry-component":"SortableItem","data-sentry-source-file":"300-ControlBlockLayers.tsx",className:"jsx-".concat(sd.__hash)+" "+(i&&null!=i.className&&i.className||"sortable-layer"),children:[(0,s.jsx)(sl,{id:t,cardId:a,windowWidth:e.windowWidth,sortableListeners:l,isTemporaryOrder:e.isTemporaryOrder,"data-sentry-element":"ControlBlockLayer","data-sentry-source-file":"300-ControlBlockLayers.tsx"}),(0,s.jsx)(n(),{id:sd.__hash,children:sd})]})},so=l.forwardRef((e,t)=>{let{id:a,windowWidth:i}=e;return(0,s.jsxs)("div",{ref:t,className:"jsx-".concat(sh.__hash)+" drag-overlay",children:[(0,s.jsx)(sl,{id:a,windowWidth:i}),(0,s.jsx)(n(),{id:sh.__hash,children:sh})]})}),sc=new String(".no-layers.jsx-7cb3bed81fa73cfc{padding:25px;text-align:center;color:var(--color-text-dim)}.dashboard-no-layers.jsx-7cb3bed81fa73cfc{padding:9.5px 18px;font-weight:bold;position:relative}");sc.__hash="7cb3bed81fa73cfc";let sd=new String(".sortable-layer.jsx-f29174c0fb91620b+.sortable-layer.jsx-f29174c0fb91620b{border-top:1px solid var(--color-subtle-line)}");sd.__hash="f29174c0fb91620b";let sh=new String(".drag-overlay.jsx-51e55ea57e46470b{background:rgba(255,255,255,.8);-webkit-border-radius:0px;-moz-border-radius:0px;border-radius:0px}");sh.__hash="51e55ea57e46470b";let su=e=>{let{ids:t,isDashboard:a,cardId:i,windowWidth:r,reorderMapLayer:o}=e,[c,d]=(0,l.useState)(null),h=(0,tK.FR)((0,tK.MS)(tK.AN));if(!t.length)return a?(0,s.jsxs)("div",{className:"jsx-".concat(sc.__hash)+" dashboard-no-layers",children:[(0,s.jsx)(ef.A,{id:"controlBlock.selectVariable",defaultMessage:"Select a variable"}),(0,s.jsx)(t2,{cardId:i}),(0,s.jsx)(n(),{id:sc.__hash,children:sc})]}):(0,s.jsxs)("div",{className:"jsx-".concat(sc.__hash)+" no-layers",children:[(0,s.jsx)(ef.A,{id:"controlBlock.noLayers",defaultMessage:"No layers have been added."}),(0,s.jsx)(n(),{id:sc.__hash,children:sc})]});let u=t.slice().reverse();return(0,s.jsxs)(tK.Mp,{sensors:h,collisionDetection:tK.fp,modifiers:[tX.FN],onDragStart:function(e){let{active:t}=e;d(t.id)},onDragEnd:function(e){d(null);let{active:t,over:a,delta:s}=e;if(t.id===a.id)return;let i=s.y>=0;o(t.id,a.id,i)},"data-sentry-element":"DndContext","data-sentry-component":"ControlBlockLayers","data-sentry-source-file":"300-ControlBlockLayers.tsx",children:[(0,s.jsx)(tQ.gB,{items:u,strategy:tQ._G,"data-sentry-element":"SortableContext","data-sentry-source-file":"300-ControlBlockLayers.tsx",children:u.map(e=>(0,s.jsx)(sr,{id:e,cardId:i,windowWidth:r,isTemporaryOrder:e===c},e))}),(0,s.jsx)(tK.Hd,{"data-sentry-element":"DragOverlay","data-sentry-source-file":"300-ControlBlockLayers.tsx",children:c?(0,s.jsx)(so,{id:c,windowWidth:r}):null})]})};class sp extends l.Component{componentDidUpdate(e,t){let a=Object.keys(e.mapLayers).length,s=Object.keys(this.props.mapLayers).length,i=t.isToolsOpen,n=this.state.isToolsOpen;(s>a||n&&!i)&&this.scrollToTop()}render(){let e=this.props.windowWidth<=m.UI.narrowControlBlockBreak;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"jsx-".concat(sf.__hash)+" "+(c()("control-block wk-map-box-overlay",{"is-hidden":!this.props.isControlBlockShown,"external-embed":this.props.isExternalEmbed,"in-dashboard":this.props.isDashboard,narrow:e})||""),children:[this.renderHeader(e),m.DEBUG.mapObjects&&(0,s.jsx)(eG,{}),this.renderContents(e)]}),this.renderHideButton(e),this.state.isSharing&&(0,s.jsx)(tM,{onClose:this.onCloseShare}),(0,s.jsx)(n(),{id:sf.__hash,children:sf})]})}renderHeader(e){let{isExternalEmbed:t,isLight:a,isDashboard:i,chatbotState:l}=this.props,{intl:r}=this.props;if(t||i)return null;let o=a?m.URLS.viewerLight:m.URLS.viewer,d=!1;return m.APP_CONFIG.aiForecastTool&&(d=!0),(0,s.jsxs)("div",{className:"jsx-".concat(sb.__hash)+" "+(c()("control-block-header",{narrow:e})||""),children:[(0,s.jsxs)(eW.A,{className:"wk-control-block-header-item wk-add-layer",href:"".concat(o,"?view=catalogue"),children:[(0,s.jsx)(eU.Icon,{icon:"plus",family:"fas",fixedWidth:!0}),(0,s.jsx)("span",{className:"jsx-".concat(sb.__hash)+" add-layer-label",children:(0,s.jsx)(ef.A,{id:"control-block.add-layer",defaultMessage:"Add layer…"})})]}),!m.APP_CONFIG.noChatbot&&(0,s.jsx)("div",{onClick:()=>this.props.chatbotToggle(),title:r.$t({id:"control-block.talk.tooltip",defaultMessage:"Talk to an expert"}),className:"jsx-".concat(sb.__hash)+" "+(c()("wk-control-block-header-item button chat-button wk-chat",{disabled:!l,active:"OPEN"===l})||""),children:(0,s.jsx)(eU.Icon,{icon:"comments",family:"far"})}),(0,s.jsx)("div",{onClick:this.onClickShare,title:r.$t({id:"control-block.share.tooltip",defaultMessage:"Share"}),className:"jsx-".concat(sb.__hash)+" wk-control-block-header-item button share-button",children:(0,s.jsx)(eU.Icon,{icon:"share-alt"})}),d&&(0,s.jsxs)("div",{onClick:this.onToggleTools,title:r.$t({id:"control-block.tools.tooltip",defaultMessage:"Tools"}),className:"jsx-".concat(sb.__hash)+" "+(c()("wk-control-block-header-item button share-button",{active:this.state.isToolsOpen})||""),children:[(0,s.jsx)(eU.Icon,{icon:"screwdriver-wrench"}),(0,s.jsx)(ao.A,{ids:["controlBlockTools"],top:-10,right:-8,disableOnUnmount:!1,light:!0})]}),(0,s.jsx)(eW.A,{className:"wk-control-block-header-item button",href:"".concat(o,"?view=about"),title:r.$t({id:"control-block.about.tooltip",defaultMessage:"About"}),children:(0,s.jsx)(eU.Icon,{icon:"info"})}),(0,s.jsx)(n(),{id:sb.__hash,children:sb})]})}renderContents(e){let{isExternalEmbed:t,windowHeight:a,cardId:i,dashSettings:l}=this.props,r=a-m.UI.headerHeight-sx-sm;return r-=e?180:90,t&&(r+=40),(0,s.jsxs)("div",{ref:this.refContents,onScroll:eU.floatReposition,style:{maxHeight:r},className:"jsx-".concat(sg.__hash)+" "+(c()("control-block-contents",{"is-single-layer":t,narrow:e})||""),children:[this.state.isToolsOpen&&(0,s.jsx)(tJ,{onClose:()=>{this.setState({isToolsOpen:!1})}}),(0,s.jsx)(su,{ids:(0,C.Hw)(this.props.mapLayers,i,{skipDashOverlays:null==l?void 0:l.hideOverlaysInControlBlock,dashOverlaysFirst:!0}),isDashboard:this.props.isDashboard,cardId:i,windowWidth:this.props.windowWidth,reorderMapLayer:this.props.reorderMapLayer}),(0,s.jsx)(n(),{id:sg.__hash,children:sg})]})}renderHideButton(e){let t=!this.props.isControlBlockShown,{intl:a}=this.props;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{onClick:this.onClickHideButton,title:t?a.$t({id:"control-block.show.tooltip",defaultMessage:"Show control block"}):a.$t({id:"control-block.hide.tooltip",defaultMessage:"Hide control block"}),className:"jsx-".concat(sj.__hash)+" "+(c()("control-block-hide-button",{active:t,narrow:e,"external-embed":this.props.isExternalEmbed,"in-dashboard":this.props.isDashboard})||""),children:(0,s.jsx)(eU.Icon,{icon:e?t?"angle-down":"angle-up":"angle-left"})}),(0,s.jsx)(n(),{id:sj.__hash,children:sj})]})}scrollToTop(){let e=this.refContents.current;e&&e.scrollTo({top:0,behavior:"smooth"})}constructor(...e){super(...e),this.state={isSharing:!1,isToolsOpen:!1},this.refContents=l.createRef(),this.onClickHideButton=()=>{let e=!this.props.isControlBlockShown;this.props.setIsControlBlockShown(e),(0,eR.PJ)({category:"viewer",action:e?"controlBlockShow":"controlBlockHide"})},this.onClickShare=async()=>{this.setState({isSharing:!0}),this.props.modalOpen("shareUrl"),this.props.setFeatureHint("share",!1),(0,eR.PJ)({category:"share",action:"shareOpen"})},this.onToggleTools=async()=>{this.setState({isToolsOpen:!this.state.isToolsOpen}),this.props.setFeatureHint("controlBlockTools",!1)},this.onCloseShare=()=>{this.setState({isSharing:!1}),this.props.modalClose("shareUrl"),(0,eR.PJ)({category:"share",action:"shareClose"})}}}let sx=32,sm=40,sf=new String(".control-block.jsx-588fb4e1542e5f33{position:absolute;top:-webkit-calc(var(--header-height) + ".concat(sx,"px);top:-moz-calc(var(--header-height) + ").concat(sx,"px);top:calc(var(--header-height) + ").concat(sx,"px);left:").concat(32,"px;width:").concat(m.UI.controlBlockWidth,"px;-webkit-transition:left 300ms,top 300ms;-moz-transition:left 300ms,top 300ms;-o-transition:left 300ms,top 300ms;transition:left 300ms,top 300ms;-webkit-border-radius:var(--border-radius);-moz-border-radius:var(--border-radius);border-radius:var(--border-radius);z-index:var(--z-control-block)}.control-block.external-embed.jsx-588fb4e1542e5f33,.control-block.in-dashboard.jsx-588fb4e1542e5f33{top:").concat(0,"px}.control-block.is-hidden.jsx-588fb4e1542e5f33{left:-400px}.control-block.narrow.jsx-588fb4e1542e5f33{position:absolute;left:0;top:var(--header-height);width:100%;max-width:100%;padding:0;-webkit-border-radius:0 0 var(--border-radius)var(--border-radius);-moz-border-radius:0 0 var(--border-radius)var(--border-radius);border-radius:0 0 var(--border-radius)var(--border-radius);-webkit-box-shadow:0 10px 8px rgba(0,0,0,.2);-moz-box-shadow:0 10px 8px rgba(0,0,0,.2);box-shadow:0 10px 8px rgba(0,0,0,.2)}.control-block.narrow.is-hidden.jsx-588fb4e1542e5f33{top:-100vh;left:0}"));sf.__hash="588fb4e1542e5f33";let sb=new String(".control-block-header.jsx-44184fcf17416d51{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;height:".concat(sm,"px;background:var(--color-button-primary-bg);color:var(--color-button-primary-fg)}.wk-control-block-header-item{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-top:6px;padding-bottom:6px;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0;color:inherit;font-weight:bold;cursor:pointer}.wk-control-block-header-item:hover{background:var(--color-button-primary-bg-lighter);color:inherit}.wk-control-block-header-item+.wk-control-block-header-item{border-left:1px solid var(--color-button-primary-bg-lighter)}.wk-add-layer{-webkit-box-pack:start;-webkit-justify-content:flex-start;-moz-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;padding-left:18px;padding-right:18px;-webkit-box-flex:1;-webkit-flex:1 1 0px;-moz-box-flex:1;-ms-flex:1 1 0px;flex:1 1 0px}.wk-add-layer:hover{opacity:.85}.add-layer-label.jsx-44184fcf17416d51{margin-left:10px}.wk-control-block-header-item.button{width:").concat(sm,"px}.wk-control-block-header-item.button.active{color:var(--color-button-primary-fg-selected)}.wk-control-block-header-item.button.disabled{color:var(--color-button-primary-fg-disabled);pointer-events:none;cursor:default}.control-block-header.narrow.jsx-44184fcf17416d51{padding-right:").concat(sm,"px}.share-button.jsx-44184fcf17416d51,.chat-button.jsx-44184fcf17416d51{position:relative}"));sb.__hash="44184fcf17416d51";let sg=new String(".control-block-contents.jsx-cb49c475097bbea2{overflow-y:auto;overflow-x:hidden}");sg.__hash="cb49c475097bbea2";let sj=new String(".control-block-hide-button.jsx-5b8b907129bc3a25{position:absolute;z-index:var(--z-control-block-hide-button);top:-webkit-calc(var(--header-height) + ".concat(sx,"px);top:-moz-calc(var(--header-height) + ").concat(sx,"px);top:calc(var(--header-height) + ").concat(sx,"px);left:0;height:40px;width:").concat(32,"px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;background-color:var(--color-accent-bg);color:var(--color-accent-fg);font-size:1.1rem;text-align:center;overflow:hidden;cursor:pointer;-webkit-transition:-webkit-transform 300ms;-moz-transition:-moz-transform 300ms;-o-transition:-o-transform 300ms;transition:-webkit-transform 300ms;transition:-moz-transform 300ms;transition:-o-transform 300ms;transition:transform 300ms}.control-block-hide-button.external-embed.jsx-5b8b907129bc3a25,.control-block-hide-button.in-dashboard.jsx-5b8b907129bc3a25{top:").concat(0,"px}.control-block-hide-button.active.jsx-5b8b907129bc3a25{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg);background-color:var(--color-accent-bg);color:var(--color-accent-fg)}.control-block-hide-button.narrow.jsx-5b8b907129bc3a25{top:-webkit-calc(var(--header-height));top:-moz-calc(var(--header-height));top:calc(var(--header-height));left:unset;right:0;height:").concat(sm,"px;width:").concat(sm,"px;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0;background-color:transparent;color:var(--color-button-primary-fg);-webkit-transform:rotate(0);-moz-transform:rotate(0);-ms-transform:rotate(0);-o-transform:rotate(0);transform:rotate(0);-webkit-transition:opacity 300ms,background-color 300ms,top 300ms,right 300ms,width 300ms,height 300ms,rotate 0ms;-moz-transition:opacity 300ms,background-color 300ms,top 300ms,right 300ms,width 300ms,height 300ms,rotate 0ms;-o-transition:opacity 300ms,background-color 300ms,top 300ms,right 300ms,width 300ms,height 300ms,rotate 0ms;transition:opacity 300ms,background-color 300ms,top 300ms,right 300ms,width 300ms,height 300ms,rotate 0ms;border-left:1px solid var(--color-button-primary-bg-lighter)}.control-block-hide-button.narrow.active.jsx-5b8b907129bc3a25{opacity:1;top:-webkit-calc(var(--header-height));top:-moz-calc(var(--header-height));top:calc(var(--header-height));right:0;width:32px;height:32px;-webkit-transform:rotate(0);-moz-transform:rotate(0);-ms-transform:rotate(0);-o-transform:rotate(0);transform:rotate(0);background-color:var(--color-accent-bg);color:var(--color-accent-fg);-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0;border-left:none}.control-block-hide-button.narrow.external-embed.jsx-5b8b907129bc3a25,.control-block-hide-button.narrow.in-dashboard.jsx-5b8b907129bc3a25{background-color:var(--color-light-bg);color:var(--color-accent-fg);border-left:1px solid var(--color-subtle-line);border-bottom:1px solid var(--color-subtle-line)}.control-block-hide-button.narrow.external-embed.active.jsx-5b8b907129bc3a25,.control-block-hide-button.narrow.in-dashboard.active.jsx-5b8b907129bc3a25{background-color:var(--color-accent-bg);color:var(--color-accent-fg);border-bottom:none}"));sj.__hash="5b8b907129bc3a25";let sv=(0,d.Ng)(e=>({mapLayers:(0,v.b7)(e),isControlBlockShown:(0,v.mb)(e),isExternalEmbed:(0,v.$x)(e),isLight:(0,v.H9)(e),isDashboard:(0,v.N0)(e),dashSettings:(0,v.YO)(e),chatbotState:(0,v.dx)(e)}),x,null,{forwardRef:!0})((0,eb.Ay)(sp));var s_=a(18355);let sy=new String(".light-drawer.jsx-d7724dd8b081f613{position:absolute;z-index:var(--z-light-drawer);right:-webkit-calc(100% - ".concat(185,"px);right:-moz-calc(100% - ").concat(185,"px);right:calc(100% - ").concat(185,"px);-webkit-transform:translate(0,-50%);-moz-transform:translate(0,-50%);-ms-transform:translate(0,-50%);-o-transform:translate(0,-50%);transform:translate(0,-50%);top:50%;width:").concat(205,"px;background-color:var(--color-light-bg);padding:8px 12px 8px ").concat(32,"px;-webkit-border-radius:0 12px 12px 0;-moz-border-radius:0 12px 12px 0;border-radius:0 12px 12px 0;border:2px solid#ccc;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:stretch;-webkit-align-items:stretch;-moz-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;text-align:right;-webkit-transition:right ").concat(m.UI.transitionDuration,"ms;-moz-transition:right ").concat(m.UI.transitionDuration,"ms;-o-transition:right ").concat(m.UI.transitionDuration,"ms;transition:right ").concat(m.UI.transitionDuration,"ms}.light-drawer.is-hidden.jsx-d7724dd8b081f613{right:-webkit-calc(100% - 42px);right:-moz-calc(100% - 42px);right:calc(100% - 42px)}.sep.jsx-d7724dd8b081f613{border-bottom:1px solid var(--color-subtle-line);padding-bottom:7px;margin-bottom:4px;margin-left:-2px;margin-right:-2px;-webkit-transition:width ").concat(m.UI.transitionDuration,"ms;-moz-transition:width ").concat(m.UI.transitionDuration,"ms;-o-transition:width ").concat(m.UI.transitionDuration,"ms;transition:width ").concat(m.UI.transitionDuration,"ms;width:100%;-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end}.light-drawer.is-hidden.jsx-d7724dd8b081f613 .sep.jsx-d7724dd8b081f613{width:24px}"));sy.__hash="d7724dd8b081f613";let sw=new String(".drawer-item.jsx-bdfcdccfbad9cb5a{padding:3px 0;color:var(--color-light-fg)}.drawer-item.jsx-bdfcdccfbad9cb5a,.drawer-item.jsx-bdfcdccfbad9cb5a *.jsx-bdfcdccfbad9cb5a{cursor:pointer}.drawer-item.active.jsx-bdfcdccfbad9cb5a{color:var(--color-icon-button-active)}.cm-drawer-item-link{color:inherit}.drawer-item-label.jsx-bdfcdccfbad9cb5a{margin-right:.75em;font-size:.9rem;color:var(--color-dim)}.drawer-item.jsx-bdfcdccfbad9cb5a:hover .drawer-item-label.jsx-bdfcdccfbad9cb5a,.drawer-item.active.jsx-bdfcdccfbad9cb5a .drawer-item-label.jsx-bdfcdccfbad9cb5a{color:inherit}.drawer-item-icon.jsx-bdfcdccfbad9cb5a{position:relative}.drawer-item-icon-svg.jsx-bdfcdccfbad9cb5a{display:inline-block}.drawer-item-icon-svg.jsx-bdfcdccfbad9cb5a svg{position:relative;margin-top:-5px;top:5px;display:block;width:100px;width:20px}.drawer-item-icon-text.jsx-bdfcdccfbad9cb5a{font-weight:bold;font-size:.8rem;display:inline-block;width:20px;text-align:center}.wk-drawer-extra-tool{color:inherit}.wk-drawer-extra-tool.active{color:var(--color-icon-button-active)}.wk-drawer-extra-tool+.wk-drawer-extra-tool{margin-left:6px}");sw.__hash="bdfcdccfbad9cb5a";let sk=new String(".light-drawer-hide-button.jsx-5c56326e8f3850b6{position:absolute;z-index:var(--z-light-drawer-thumb);top:-webkit-calc(50% - ".concat(32,"px);top:-moz-calc(50% - ").concat(32,"px);top:calc(50% - ").concat(32,"px);left:100%;height:").concat(64,"px;width:").concat(56,"px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;cursor:pointer}.thumb.jsx-5c56326e8f3850b6{height:").concat(34,"px;width:").concat(26,"px;padding-right:3px;-webkit-border-radius:0 12px 12px 0;-moz-border-radius:0 12px 12px 0;border-radius:0 12px 12px 0;background-color:var(--color-light-bg);border:2px solid#ccc;border-left:2px solid var(--color-light-bg);-webkit-transition:all ").concat(m.UI.transitionDuration,"ms;-moz-transition:all ").concat(m.UI.transitionDuration,"ms;-o-transition:all ").concat(m.UI.transitionDuration,"ms;transition:all ").concat(m.UI.transitionDuration,"ms;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center}.thumb.jsx-5c56326e8f3850b6 svg{-webkit-transition:-webkit-transform ").concat(m.UI.transitionDuration,"ms;-moz-transition:-moz-transform ").concat(m.UI.transitionDuration,"ms;-o-transition:-o-transform ").concat(m.UI.transitionDuration,"ms;transition:-webkit-transform ").concat(m.UI.transitionDuration,"ms;transition:-moz-transform ").concat(m.UI.transitionDuration,"ms;transition:-o-transform ").concat(m.UI.transitionDuration,"ms;transition:transform ").concat(m.UI.transitionDuration,"ms}.thumb.open.jsx-5c56326e8f3850b6 svg{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}.light-drawer-hide-button.jsx-5c56326e8f3850b6:hover .thumb.jsx-5c56326e8f3850b6{width:").concat(36,"px}"));sk.__hash="5c56326e8f3850b6";let sM=()=>{let[e,t]=l.useState(!1),a=l.useRef(0),i=(0,r.useRouter)(),o=(0,d.wA)(),h=(0,tN.A)(),u=(0,d.d4)(v.b7),p=(0,d.d4)(v.mb),f=(0,d.d4)(v.dx),b=(0,d.d4)(v.Z9),g=(0,d.d4)(e=>(0,v.cm)(e,{forceFullViewer:!0})),j=e=>{let t;let a=null!=Object.keys(u).map(e=>u[e]).find(t=>t.layerId===e),i=m.LIGHT_LAYERS[e],{iconFa:l,iconFaFamily:r,iconSvg:o,iconText:d}=i,p=i.label(h);return l?t=(0,s.jsx)(eU.Icon,{icon:l,family:r,fixedWidth:!0}):o?t=(0,s.jsxs)("span",{className:"jsx-".concat(sw.__hash)+" drawer-item-icon-svg",children:[o,(0,s.jsx)(n(),{id:sw.__hash,children:sw})]}):d&&(t=(0,s.jsxs)("span",{className:"jsx-".concat(sw.__hash)+" drawer-item-icon-text",children:[d,(0,s.jsx)(n(),{id:sw.__hash,children:sw})]})),(0,s.jsxs)("div",{onClick:()=>y(e,i),"data-sentry-component":"renderLayer","data-sentry-source-file":"210-LightDrawer.tsx",className:"jsx-".concat(sw.__hash)+" "+(c()("drawer-item",{active:a})||""),children:[(0,s.jsx)("span",{className:"jsx-".concat(sw.__hash)+" drawer-item-label",children:p}),(0,s.jsx)("span",{title:p,className:"jsx-".concat(sw.__hash)+" drawer-item-icon",children:t}),(0,s.jsx)(n(),{id:sw.__hash,children:sw})]},e)},_=()=>p?h.$t({id:"lightDrawer.closeHint",defaultMessage:"Close drawer"}):h.$t({id:"lightDrawer.openHint",defaultMessage:"Open drawer"}),y=(e,t)=>{var s;let i="c".concat(a.current);a.current+=1;let{valueMin:n,valueMax:l}=t,{colormapId:r,colormapInvert:c,colormapStops:d}=t;o((0,x.setMapLayers)({[i]:{layerId:e,zIndex:0,valueMin:n,valueMax:l,colormapId:r,colormapInvert:c,colormapStops:d}},{persist:!0}));let h=null!==(s=t.crs)&&void 0!==s?s:m.UI.defaultCrs;o((0,x.setCrs)(h,!0))},w=()=>{let e=!p;o((0,x.setIsControlBlockShown)(e)),(0,eR.PJ)({category:"viewer",action:e?"controlBlockShow":"controlBlockHide"})},k=async()=>{t(!0),o((0,x.modalOpen)("shareUrl")),o((0,x.setFeatureHint)("share",!1)),(0,eR.PJ)({category:"share",action:"shareOpen"})};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"jsx-".concat(sy.__hash)+" "+(c()("light-drawer wk-map-box-overlay",{"is-hidden":!p})||""),children:[(()=>{let e=Object.keys(m.LIGHT_LAYERS);return(0,s.jsx)(s.Fragment,{children:e.map(j)})})(),(0,s.jsx)("div",{className:"jsx-".concat(sy.__hash)+" sep"}),(()=>{let t=i.asPath.indexOf("view=about")>=0,a=b===m.UI.tools.settings;return(0,s.jsxs)(s.Fragment,{children:[!m.APP_CONFIG.noChatbot&&(0,s.jsxs)("div",{onClick:()=>o((0,x.chatbotToggle)()),className:"jsx-".concat(sw.__hash)+" "+(c()("drawer-item",{disabled:!f,active:"OPEN"===f})||""),children:[(0,s.jsx)("span",{className:"jsx-".concat(sw.__hash)+" drawer-item-label",children:(0,s.jsx)(ef.A,{id:"lightDrawer.talkToExpert",defaultMessage:"Talk to an expert"})}),(0,s.jsx)("span",{title:h.$t({id:"lightDrawer.talkToExpert",defaultMessage:"Talk to an expert"}),className:"jsx-".concat(sw.__hash)+" drawer-item-icon",children:(0,s.jsx)(eU.Icon,{icon:"comments",family:"far",fixedWidth:!0})})]}),(0,s.jsx)("div",{className:"jsx-".concat(sw.__hash)+" drawer-item",children:(0,s.jsxs)(eW.A,{className:"cm-drawer-item-link",href:g,"data-sentry-element":"AppLink","data-sentry-source-file":"210-LightDrawer.tsx",children:[(0,s.jsx)("span",{className:"jsx-".concat(sw.__hash)+" drawer-item-label",children:(0,s.jsx)(ef.A,{id:"lightDrawer.goToPro",defaultMessage:"Go to full viewer","data-sentry-element":"FormattedMessage","data-sentry-source-file":"210-LightDrawer.tsx"})}),(0,s.jsx)("span",{title:h.$t({id:"lightDrawer.goToProHint",defaultMessage:"Go to MyOcean Pro viewer"}),className:"jsx-".concat(sw.__hash)+" drawer-item-icon",children:(0,s.jsx)(eU.Icon,{icon:"door-open",fixedWidth:!0,"data-sentry-element":"Icon","data-sentry-source-file":"210-LightDrawer.tsx"})})]})}),(0,s.jsxs)("div",{className:"jsx-".concat(sw.__hash)+" drawer-item",children:[(0,s.jsx)("span",{onClick:k,title:h.$t({id:"lightDrawer.shareHint",defaultMessage:"Share"}),className:"jsx-".concat(sw.__hash)+" "+(c()("wk-drawer-extra-tool",{active:e})||""),children:(0,s.jsx)(eU.Icon,{icon:"share-alt",fixedWidth:!0,"data-sentry-element":"Icon","data-sentry-source-file":"210-LightDrawer.tsx"})}),(0,s.jsx)("span",{onClick:()=>o((0,x.setActiveTool)(a?null:m.UI.tools.settings)),title:h.$t({id:"lightDrawer.settingsHint",defaultMessage:"Settings"}),className:"jsx-".concat(sw.__hash)+" "+(c()("wk-drawer-extra-tool",{active:a})||""),children:(0,s.jsx)(eU.Icon,{icon:"cog",fixedWidth:!0,"data-sentry-element":"Icon","data-sentry-source-file":"210-LightDrawer.tsx"})}),(0,s.jsx)(eW.A,{className:c()("wk-drawer-extra-tool",{active:t}),href:"".concat(m.URLS.viewerLight,"?view=about"),title:h.$t({id:"lightDrawer.about",defaultMessage:"About this app"}),"data-sentry-element":"AppLink","data-sentry-source-file":"210-LightDrawer.tsx",children:(0,s.jsx)(eU.Icon,{icon:"info",fixedWidth:!0,"data-sentry-element":"Icon","data-sentry-source-file":"210-LightDrawer.tsx"})}),(0,s.jsx)("span",{onClick:w,title:_(),className:"jsx-".concat(sw.__hash)+" wk-drawer-extra-tool",children:(0,s.jsx)(eU.Icon,{icon:"ellipsis-h",fixedWidth:!0,"data-sentry-element":"Icon","data-sentry-source-file":"210-LightDrawer.tsx"})})]}),(0,s.jsx)(n(),{id:sw.__hash,children:sw})]})})(),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{onClick:w,title:_(),className:"jsx-".concat(sk.__hash)+" light-drawer-hide-button",children:(0,s.jsx)("div",{className:"jsx-".concat(sk.__hash)+" "+(c()("thumb",{open:p})||""),children:(0,s.jsx)(eU.Icon,{icon:"angle-right","data-sentry-element":"Icon","data-sentry-source-file":"210-LightDrawer.tsx"})})}),(0,s.jsx)(n(),{id:sk.__hash,children:sk})]})]}),e&&(0,s.jsx)(tM,{onClose:()=>{t(!1),o((0,x.modalClose)("shareUrl")),(0,eR.PJ)({category:"share",action:"shareClose"})}}),b===m.UI.tools.settings&&(0,s.jsx)(s_.A,{onClose:()=>{o((0,x.setActiveTool)(null))}}),(0,s.jsx)(n(),{id:sy.__hash,children:sy})]})};class sN extends l.Component{componentDidMount(){this.plotUpdate()}componentDidUpdate(){this.plotUpdate()}render(){let e=(0,f.jk)(this.props.mapLayers);if(!e.length)return null;let t=this.props.width<=m.UI.narrowLightDrawerBreak;return this.layer=e[0],this.layerSpec=(0,f.VF)(this.props.datasets,this.layer.layerId),(0,s.jsxs)("div",{"data-sentry-component":"LightTitle","data-sentry-source-file":"215-LightTitle.tsx",className:"jsx-".concat(sS.__hash)+" "+(c()("light-title",{narrow:t})||""),children:[this.renderTitleBlock(t),this.renderLegendBlock(t),(0,s.jsx)(n(),{id:sS.__hash,children:sS})]})}renderTitleBlock(e){var t,a,i,l;let r;let o=this.props.height<=540,{layer:d}=this,h=null!==(i=m.LIGHT_LAYERS[d.layerId])&&void 0!==i?i:{};if(!h)return null;let{crs:p,intl:x}=this.props,f="epsg:32661"===p||"epsg:32761"===p,b=null===(t=h.units)||void 0===t?void 0:t.call(h,x),g=null!==(l=null===(a=h.labelFull)||void 0===a?void 0:a.call(h,x))&&void 0!==l?l:h.label(x);return(null==d?void 0:d.time)!=null&&(r=u().utc(d.time).format("D MMMM YYYY")),(0,s.jsxs)("div",{className:"jsx-".concat(sI.__hash)+" "+(c()("title-block",{narrow:e,short:o})||""),children:[(0,s.jsxs)("div",{className:"jsx-".concat(sI.__hash)+" title",children:[g,b&&(0,s.jsxs)("span",{className:"jsx-".concat(sI.__hash)+" units",children:["(",b,")"]})]}),(r||f)&&(0,s.jsxs)("div",{className:"jsx-".concat(sI.__hash)+" subtitle",children:[r,f&&(0,s.jsxs)("span",{className:"jsx-".concat(sI.__hash)+" pole-info",children:[(0,s.jsx)("span",{className:"jsx-".concat(sI.__hash)+" pole",children:"epsg:32661"===p?x.$t({id:"lightTitle.arctic",defaultMessage:"Arctic"}):x.$t({id:"lightTitle.antarctic",defaultMessage:"Antarctic"})}),(0,s.jsx)("button",{onClick:this.onClickSwitchPoles,className:"jsx-".concat(sI.__hash)+" switch-poles",children:(0,s.jsx)(ef.A,{id:"lightTitle.switchPoles",defaultMessage:"Switch Poles"})})]})]}),(0,s.jsx)(n(),{id:sI.__hash,children:sI})]})}renderLegendBlock(e){let t=window.devicePixelRatio,a=this.props.width<m.UI.narrowLightDrawerBreak?250:400;this.legendWidth=a;let{layer:i}=this,{isShownLayerConfig:l}=this.state,{settings:r}=this.props,o="".concat(r.unitsTemperature,".").concat(r.unitsWindSpeed);return(0,s.jsxs)("div",{className:"jsx-".concat(sA.__hash)+" "+(c()("legend-block",{narrow:e})||""),children:[(0,s.jsx)("canvas",{ref:this.refLegend,width:a*t,height:60*t,style:{height:60,width:a},className:"jsx-".concat(sA.__hash)+" "+(c()("legend",{narrow:e})||"")}),(0,s.jsxs)("div",{className:"jsx-".concat(sA.__hash)+" "+(c()("layer-config-wrapper",{active:l})||""),children:[(0,s.jsx)("span",{onClick:()=>{this.setState({isShownLayerConfig:!l})},className:"jsx-".concat(sA.__hash)+" layer-config-button",children:(0,s.jsx)(eU.Icon,{icon:"cog"})}),(0,s.jsxs)("div",{className:"jsx-".concat(sA.__hash)+" layer-config-popup",children:[(0,s.jsx)("div",{className:"jsx-".concat(sA.__hash)+" drawer-pin",children:"\xa0"}),(0,s.jsx)("div",{className:"jsx-".concat(sA.__hash)+" drawer-pin2",children:"\xa0"}),(0,s.jsx)("div",{className:"jsx-".concat(sA.__hash)+" layer-config",children:(0,s.jsx)(aR,{mapLayerId:i.id},o)})]})]}),(0,s.jsx)(n(),{id:sA.__hash,children:sA})]})}plotUpdate(){var e;let t=null===(e=this.refLegend)||void 0===e?void 0:e.current;if(!t)return;let a=t.getContext("2d"),{layer:s,layerSpec:i}=this;if(!s||!i)return;let{settings:n}=this.props,l=this.legendWidth-20,r=window.devicePixelRatio;a.clearRect(0,0,this.legendWidth*r,60*r),tg(a,r,s,i,n,20,l,10,{hGradient:8,hTicks:5,fontSize:17})}constructor(...e){super(...e),this.state={isShownLayerConfig:!1},this.refLegend=l.createRef(),this.layer=null,this.layerSpec=null,this.onClickSwitchPoles=()=>{let e="epsg:32661"===this.props.crs?"epsg:32761":"epsg:32661";this.props.setCrs(e,!0),(0,eR.PJ)({category:"lightViewer",action:"poleSwitch"})}}}let sS=new String(".light-title.jsx-fb9927f199a67944{position:absolute;top:-webkit-calc(var(--header-height) + 32px);top:-moz-calc(var(--header-height) + 32px);top:calc(var(--header-height) + 32px);left:0;width:100%;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;pointer-events:none}.light-title.narrow.jsx-fb9927f199a67944{top:-webkit-calc(var(--header-height) + 8px);top:-moz-calc(var(--header-height) + 8px);top:calc(var(--header-height) + 8px);-webkit-box-align:start;-webkit-align-items:flex-start;-moz-box-align:start;-ms-flex-align:start;align-items:flex-start}");sS.__hash="fb9927f199a67944";let sI=new String('.title-block.jsx-77cbc5709b33a375{text-align:center;font-size:1.8rem;font-weight:bold;color:white;text-shadow:0 0 5px rgba(0,0,0,.7);pointer-events:initial}.subtitle.jsx-77cbc5709b33a375{font-size:.6em}.units.jsx-77cbc5709b33a375{margin-left:.3em;font-weight:normal;font-style:italic}.pole-info.jsx-77cbc5709b33a375{margin-left:1em}.pole-info.jsx-77cbc5709b33a375::before{content:"\xb7";margin-right:1em}.switch-poles.jsx-77cbc5709b33a375{margin-left:.4em;background:rgba(0,0,0,.5);color:inherit;border:1px solid white;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px;padding:3px 8px;cursor:pointer}.title-block.narrow.jsx-77cbc5709b33a375{font-size:1.5rem;margin-left:15px;text-align:left}.title-block.narrow.short.jsx-77cbc5709b33a375{display:none}');sI.__hash="77cbc5709b33a375";let sA=new String(".legend-block.jsx-c55a70c7e017a1d5{position:relative;margin-top:10px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:start;-webkit-align-items:flex-start;-moz-box-align:start;-ms-flex-align:start;align-items:flex-start;pointer-events:initial}.legend-block.narrow.jsx-c55a70c7e017a1d5{margin-top:0px}.legend.jsx-c55a70c7e017a1d5{pointer-events:initial}.layer-config-wrapper.jsx-c55a70c7e017a1d5{position:absolute;top:3px;left:100%}.layer-config-button.jsx-c55a70c7e017a1d5{opacity:0;pointer-events:none;color:white;cursor:pointer;padding:4px 6px;-webkit-border-radius:16px;-moz-border-radius:16px;border-radius:16px;background:rgba(0,0,0,.5);border:1px solid white}.legend-block.jsx-c55a70c7e017a1d5:hover .layer-config-button.jsx-c55a70c7e017a1d5,.layer-config-wrapper.active.jsx-c55a70c7e017a1d5 .layer-config-button.jsx-c55a70c7e017a1d5{opacity:1;pointer-events:initial}.layer-config-button.jsx-c55a70c7e017a1d5:hover{background:rgba(0,0,0,.7)}.layer-config-wrapper.active.jsx-c55a70c7e017a1d5 .layer-config-button.jsx-c55a70c7e017a1d5{color:var(--color-accent-bg)}.layer-config-popup.jsx-c55a70c7e017a1d5{display:none}.layer-config-wrapper.active.jsx-c55a70c7e017a1d5 .layer-config-popup.jsx-c55a70c7e017a1d5{display:block}.layer-config.jsx-c55a70c7e017a1d5{position:absolute;border:1px solid var(--color-subtle-line);background:var(--color-light-bg);font-size:.8rem;top:-webkit-calc(100% + 25px);top:-moz-calc(100% + 25px);top:calc(100% + 25px);right:0px;width:340px;padding:10px 20px}.drawer-pin.jsx-c55a70c7e017a1d5,.drawer-pin2.jsx-c55a70c7e017a1d5{position:absolute;z-index:1;border-style:solid;border-top-color:transparent;border-left-color:transparent;border-right-color:transparent;width:0;heigth:0;line-height:0}.drawer-pin.jsx-c55a70c7e017a1d5{right:".concat(3,"px;top:-webkit-calc(100% - ").concat(-2,"px);top:-moz-calc(100% - ").concat(-2,"px);top:calc(100% - ").concat(-2,"px);border-width:").concat(12,"px;border-bottom-color:var(--color-subtle-line)}.drawer-pin2.jsx-c55a70c7e017a1d5{right:").concat(3,"px;top:-webkit-calc(100% - ").concat(-4,"px);top:-moz-calc(100% - ").concat(-4,"px);top:calc(100% - ").concat(-4,"px);border-width:").concat(12,"px;border-bottom-color:var(--color-light-bg)}"));sA.__hash="c55a70c7e017a1d5";let sC=(0,d.Ng)(e=>({mapLayers:(0,v.b7)(e),datasets:(0,v.yT)(e),settings:(0,v.mt)(e),crs:(0,v.tT)(e)}),x)((0,eb.Ay)(sN));var sD=a(95110),sT=a(3546),sL=a(36744),sE=a(61474),sO=a(11804),sP=a(78757),sz=a(77059);class sF extends l.PureComponent{componentDidMount(){this.componentDidUpdate()}componentWillUnmount(){this.stopTimer()}componentDidUpdate(){let{value:e}=this.props;e!==this.targetValue&&(this.targetValue=e,this.startTimer())}render(){let e;if(this.props.formatter)e=this.props.formatter(this.shownValue);else if(null==this.shownValue){var t;e=null!==(t=this.props.nullLabel)&&void 0!==t?t:"–"}else e=this.shownValue.toFixed(this.props.decimals||0);return(0,s.jsx)("span",{className:c()("animated-counter",this.props.className),id:this.props.id,"data-sentry-component":"AnimatedCounter","data-sentry-source-file":"999-AnimatedCounter.tsx",children:e})}startTimer(){this.stopTimer(),this.timerLeft=500,this.timer=setInterval(this.refreshValue,25)}stopTimer(){null!=this.timer&&clearInterval(this.timer),this.timer=null}constructor(...e){super(...e),this.refreshValue=()=>{if(this.timerLeft-=25,this.timerLeft<=0){this.shownValue=this.targetValue,this.timerLeft=0,this.forceUpdate(),this.stopTimer();return}let e=null!=this.shownValue?this.shownValue:0,t=null!=this.targetValue?this.targetValue:0;this.shownValue+=(t-e)*25/this.timerLeft,Number.isNaN(this.shownValue)&&(this.shownValue=t),this.forceUpdate()}}}let sU="".concat("https://data-be-prd.marine.copernicus.eu","/api/mdsKpis"),sR=e=>{let t=(0,tN.A)(),{kpi:a}=e,[i,r]=(0,l.useState)(0),o=(0,l.useRef)(a),c=(0,l.useRef)(null),d=(0,l.useRef)(null),[h,u]=(0,l.useState)(null),[p,x]=(0,l.useState)(null),m=(0,l.createRef)(),f=(0,l.createRef)();(0,l.useEffect)(()=>{let e=new ResizeObserver(g);return f.current=e,e.observe(m.current),()=>{e.disconnect()}},[]),(0,l.useEffect)(()=>{o.current=a},[a]),(0,l.useEffect)(()=>{let e=setInterval(j,1e3);return setTimeout(j,400),()=>{clearInterval(e)}},[]),(0,l.useEffect)(()=>{b()},[i]);let b=()=>{if(null==h||null==p)return;let{factor:t=1,barValue:a=1}=e,s=null!=i?i/t:null,n=null!=s?s%a/a:0,l=[];for(let e=0;e<=4;e++){let t=e/4,a=n+(Math.random()-.5)*6/p;l.push([t,a])}let r=Math.max(200,h),o=(0,eH.m4)().domain([0,1]).range([0,r]),c=[p,0],u=(0,eH.m4)().domain([0,1]).range(c),x=(0,sP.A)().x(e=>o(e[0])).y0(u(0)).y1(e=>u(e[1])).curve(sz.G)(l)||"",m=(0,eg.A)(d.current),f=(0,aB.kY)().ease(sO.s).duration(1e3);m.select(".waves").transition(f).attr("d",x)},g=e=>{let t=e[0];if(!t)return;let{width:a,height:s}=t.contentRect;a!==h&&u(a),s!==p&&x(s)},j=()=>{let{t0:e,t1:t,value0:a}=o.current,s=v(o.current),i=Date.now();null==c.current&&(c.current=i-t);let n=c.current,l=s<a?s:a+(s-a)/(t-e)*(i-n-t);l>s&&(l=s),r(l)},v=t=>{var a,s;let{value1:i}=t;if(null==i)return i;let n=null!==(a=e.decimals)&&void 0!==a?a:0,l=null!==(s=e.factor)&&void 0!==s?s:1,r=10**n;return i/=l,((i=Math.floor(i*r)/r)+Math.random()*10**-n/1e5)*l},_=a=>{if(null==a)return"–";let s=10**(e.decimals||0);return(a=Math.floor(a*s)/s).toLocaleString(t.locale,{minimumFractionDigits:e.decimals||0,maximumFractionDigits:e.decimals||0})};return(()=>{let{label:t,units:a,factor:l=1}=e;return(0,s.jsxs)("div",{"data-sentry-component":"render","data-sentry-source-file":"910-MdsKpis.tsx",className:"jsx-".concat(sB.__hash)+" mds-kpi",children:[(0,s.jsxs)("div",{style:{width:null!=h?h:0,height:null!=p?p:0},className:"jsx-".concat(sB.__hash)+" value-outer",children:[(0,s.jsx)("svg",{ref:d,width:null!=h?h:0,height:null!=p?p:0,"data-sentry-element":"svg","data-sentry-source-file":"910-MdsKpis.tsx",className:"jsx-".concat(sB.__hash)+" svg-filling",children:(0,s.jsx)("path",{"data-sentry-element":"path","data-sentry-source-file":"910-MdsKpis.tsx",className:"jsx-".concat(sB.__hash)+" waves"})}),(0,s.jsx)("div",{ref:m,className:"jsx-".concat(sB.__hash)+" value-label-outer",children:(0,s.jsxs)("div",{className:"jsx-".concat(sB.__hash)+" value-label-inner",children:[(0,s.jsx)(sF,{value:null!=i?i/l:null,formatter:_,"data-sentry-element":"AnimatedCounter","data-sentry-source-file":"910-MdsKpis.tsx"}),a&&(0,s.jsx)("span",{className:"jsx-".concat(sB.__hash)+" units",children:a})]})})]}),(0,s.jsx)("div",{className:"jsx-".concat(sB.__hash)+" label",children:t.split("/").map((e,t)=>(0,s.jsx)("div",{className:"jsx-".concat(sB.__hash),children:e},t))}),(0,s.jsx)(n(),{id:sB.__hash,children:sB})]})})()},sB=new String('.mds-kpis.jsx-b6b36daf7ac3e3ba{margin:10px 0 30px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:stretch;-webkit-align-items:stretch;-moz-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-box-pack:justify;-webkit-justify-content:space-between;-moz-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.mds-kpi.jsx-b6b36daf7ac3e3ba{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;line-height:1;-webkit-box-align:stretch;-webkit-align-items:stretch;-moz-box-align:stretch;-ms-flex-align:stretch;align-items:stretch}@media(max-width:800px){.mds-kpis.jsx-b6b36daf7ac3e3ba{display:block}.mds-kpi.jsx-b6b36daf7ac3e3ba+.mds-kpi.jsx-b6b36daf7ac3e3ba{margin-top:1em}}.value-outer.jsx-b6b36daf7ac3e3ba{-webkit-border-radius:39px;-moz-border-radius:39px;border-radius:39px;overflow:hidden;position:relative;background:var(--color-title-bg-slightly-darker);background:-webkit-linear-gradient(135deg,var(--color-title-bg-slightly-darker)0%,var(--color-title-bg)100%);background:-moz-linear-gradient(135deg,var(--color-title-bg-slightly-darker)0%,var(--color-title-bg)100%);background:-o-linear-gradient(135deg,var(--color-title-bg-slightly-darker)0%,var(--color-title-bg)100%);background:linear-gradient(-45deg,var(--color-title-bg-slightly-darker)0%,var(--color-title-bg)100%);color:white}.value-label-outer.jsx-b6b36daf7ac3e3ba{position:absolute;top:0;left:0}.value-label-inner.jsx-b6b36daf7ac3e3ba{padding:6px 18px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:start;-webkit-align-items:flex-start;-moz-box-align:start;-ms-flex-align:start;align-items:flex-start;font-size:2rem;-webkit-font-feature-settings:"lnum"on;-moz-font-feature-settings:"lnum"on;font-feature-settings:"lnum"on}.svg-filling.jsx-b6b36daf7ac3e3ba{position:absolute;top:0;left:0}.waves.jsx-b6b36daf7ac3e3ba{fill:var(--color-moi-bg)}.units.jsx-b6b36daf7ac3e3ba{margin-left:.15em;font-size:.7rem}.label.jsx-b6b36daf7ac3e3ba{text-transform:uppercase;margin-top:.35rem;font-size:.7rem;margin-left:.3em;letter-spacing:.05em}');sB.__hash="b6b36daf7ac3e3ba";let sV=()=>{let e=(0,tN.A)(),[t,a]=(0,l.useState)({}),[i,r]=(0,l.useState)(null);(0,l.useEffect)(()=>{let e=setInterval(c,12e4);return c(),()=>{clearInterval(e)}},[]);let o=e=>{let{kpi:t,label:a,units:n,factor:l,decimals:r,barValue:o}=e;return null==t||null==t.value1?null:(0,s.jsx)(sR,{tDownloaded:i,label:a,kpi:t,units:n,factor:l,decimals:r,barValue:o,"data-sentry-element":"Kpi","data-sentry-component":"renderKpi","data-sentry-source-file":"910-MdsKpis.tsx"})},c=async()=>{let e=await (0,e_.z)(sU);e&&a(e),r(Date.now())};return null==i?null:(0,s.jsxs)("div",{"data-sentry-component":"render","data-sentry-source-file":"910-MdsKpis.tsx",className:"jsx-".concat(sB.__hash)+" mds-kpis",children:[o({kpi:t.volumeTB,label:e.$t({id:"mdsKpis.downloaded",defaultMessage:"Downloaded/this week"}),units:"TB",decimals:3,barValue:.1}),o({kpi:t.downloads,label:e.$t({id:"mdsKpis.downloads",defaultMessage:"Downloads/this week"}),barValue:10}),o({kpi:t.users,label:e.$t({id:"mdsKpis.activeUsers",defaultMessage:"Active users/this week"}),barValue:10}),(0,s.jsx)(n(),{id:sB.__hash,children:sB})]})},sG=()=>(0,f.cX)()?"⌥":"alt",sW=()=>(0,s.jsx)(s.Fragment,{children:" \xa0—\xa0 "}),sH=new String("h3.jsx-c8ed9b8d6e28debe{margin-top:1.5em}.kpi-wrapper.jsx-c8ed9b8d6e28debe{}.shortcuts.jsx-c8ed9b8d6e28debe{padding-bottom:.6em}.shortcut.jsx-c8ed9b8d6e28debe{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:baseline;-webkit-align-items:baseline;-moz-box-align:baseline;-ms-flex-align:baseline;align-items:baseline;font-size:.9rem}.shortcut.jsx-c8ed9b8d6e28debe+.shortcut.jsx-c8ed9b8d6e28debe{margin-top:6px}.shortcut-group.jsx-c8ed9b8d6e28debe{font-size:.9rem;margin-bottom:.8em}.keys.jsx-c8ed9b8d6e28debe{-webkit-box-flex:0;-webkit-flex:0;-moz-box-flex:0;-ms-flex:0;flex:0;pointer-events:none;white-space:nowrap}.key.jsx-c8ed9b8d6e28debe{display:-webkit-inline-box;display:-webkit-inline-flex;display:-moz-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;font-family:inherit;font-weight:bold;min-width:45px;height:24px;text-align:center;padding:0;border:1px solid var(--color-light-bg-darker)}.icon-aligner.jsx-c8ed9b8d6e28debe{display:inline-block;width:0px;opacity:0}.mouse-icon.jsx-c8ed9b8d6e28debe{color:var(--color-subtle-line)}.key.jsx-c8ed9b8d6e28debe+.key.jsx-c8ed9b8d6e28debe,.key.jsx-c8ed9b8d6e28debe+.key-complement.jsx-c8ed9b8d6e28debe,.key-complement.jsx-c8ed9b8d6e28debe+.key.jsx-c8ed9b8d6e28debe{margin-left:.5em}.key.key-button.jsx-c8ed9b8d6e28debe{padding:3px 6px;cursor:default}.key.key-button.in-text.jsx-c8ed9b8d6e28debe{margin-left:.2em;margin-right:.2em}.key.key-button.with-tooltip.jsx-c8ed9b8d6e28debe{pointer-events:auto}.description.jsx-c8ed9b8d6e28debe{margin-left:1em;-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1;line-height:1.5}.description.jsx-c8ed9b8d6e28debe .giu-icon{color:var(--color-icon-button);font-size:.9em}");sH.__hash="c8ed9b8d6e28debe";let s$=e=>{var t,a,i,l,r,o,c,d,h;let u=(0,tN.A)(),{seo:p,isLight:x}=e,f=null!==(d=x?null===(t=m.APP_CONFIG.aboutViewerLight)||void 0===t?void 0:t.call(m.APP_CONFIG,u):null===(a=m.APP_CONFIG.aboutViewerPro)||void 0===a?void 0:a.call(m.APP_CONFIG,u))&&void 0!==d?d:"",b=null!==(h=x?null===(i=m.APP_CONFIG.aboutViewerLightName)||void 0===i?void 0:i.call(m.APP_CONFIG,u):null===(l=m.APP_CONFIG.aboutViewerProName)||void 0===l?void 0:l.call(m.APP_CONFIG,u))&&void 0!==h?h:"MyOcean",g=null===(r=m.APP_CONFIG.aboutIntro)||void 0===r?void 0:r.call(m.APP_CONFIG,u);g&&(g=g.replace(/__ABOUT_VIEWER__/g,f).replace(/__ABOUT_VIEWER_NAME__/g,b));let j=null===(o=m.APP_CONFIG.aboutCredits)||void 0===o?void 0:o.call(m.APP_CONFIG,u);j&&(j=j.replace(/__ABOUT_VIEWER_NAME__/g,b));let v=null===(c=m.APP_CONFIG.aboutSeo)||void 0===c?void 0:c.call(m.APP_CONFIG,u),_=()=>(0,s.jsxs)("kbd",{title:u.$t({id:"about.click",defaultMessage:"Click"}),"data-sentry-component":"renderMouseClick","data-sentry-source-file":"235-AboutText.tsx",className:"jsx-".concat(sH.__hash)+" key key-button with-tooltip",children:[(0,s.jsx)("span",{className:"jsx-".concat(sH.__hash)+" icon-aligner",children:"\xa0"}),(0,s.jsx)("span",{className:"jsx-".concat(sH.__hash)+" mouse-icon",children:(0,s.jsx)(eU.Icon,{icon:"computer-mouse","data-sentry-element":"Icon","data-sentry-source-file":"235-AboutText.tsx"})}),"\xa0\xa0",(0,s.jsx)(eU.Icon,{icon:"mouse-pointer","data-sentry-element":"Icon","data-sentry-source-file":"235-AboutText.tsx"}),(0,s.jsx)(n(),{id:sH.__hash,children:sH})]}),y=()=>(0,s.jsxs)("kbd",{title:u.$t({id:"about.mouseWheel",defaultMessage:"Mouse wheel"}),"data-sentry-component":"renderMouseWheel","data-sentry-source-file":"235-AboutText.tsx",className:"jsx-".concat(sH.__hash)+" key key-button with-tooltip",children:[(0,s.jsx)("span",{className:"jsx-".concat(sH.__hash)+" icon-aligner",children:"\xa0"}),(0,s.jsx)("span",{className:"jsx-".concat(sH.__hash)+" mouse-icon",children:(0,s.jsx)(eU.Icon,{icon:"computer-mouse","data-sentry-element":"Icon","data-sentry-source-file":"235-AboutText.tsx"})}),"\xa0\xa0",(0,s.jsx)(eU.Icon,{icon:"up-down","data-sentry-element":"Icon","data-sentry-source-file":"235-AboutText.tsx"}),(0,s.jsx)(n(),{id:sH.__hash,children:sH})]});return(0,s.jsxs)("div",{"data-sentry-component":"render","data-sentry-source-file":"235-AboutText.tsx",className:"jsx-".concat(sH.__hash)+" about",children:[(0,s.jsxs)(s.Fragment,{children:[g&&(0,s.jsx)(sE.$,{linkTarget:"_blank",children:g}),p&&v&&(0,s.jsx)(sE.$,{linkTarget:"_blank",children:v}),(0,s.jsx)(n(),{id:sH.__hash,children:sH})]}),!p&&(m.APP_CONFIG.showMdsKpis?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h3",{className:"jsx-".concat(sH.__hash),children:(0,s.jsx)(ef.A,{id:"about.kpisTitle",defaultMessage:"Real-time marine data usage","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})}),(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" kpi-wrapper",children:(0,s.jsx)(sV,{"data-sentry-element":"MdsKpis","data-sentry-source-file":"235-AboutText.tsx"})}),(0,s.jsx)(n(),{id:sH.__hash,children:sH})]}):null),!p&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h3",{className:"jsx-".concat(sH.__hash),children:(0,s.jsx)(ef.A,{id:"about.keys.title",defaultMessage:"Keyboard and mouse tips","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcuts",children:[(0,s.jsx)("h4",{className:"jsx-".concat(sH.__hash)+" shortcut-group",children:(0,s.jsx)(ef.A,{id:"about.keys.general",defaultMessage:"General","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:"Z"})}),(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" description",children:(0,s.jsx)(ef.A,{id:"about.keys.toggleZen",defaultMessage:"Toggle zen mode","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})})]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:"T"})}),(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" description",children:(0,s.jsx)(ef.A,{id:"about.keys.toggleMapTools",defaultMessage:"Toggle map tools","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})})]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:"esc"})}),(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" description",children:(0,s.jsx)(ef.A,{id:"about.keys.toggleLayerList",defaultMessage:"Toggle layer list","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})})]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:"S"})}),(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" description",children:(0,s.jsx)(ef.A,{id:"about.keys.toggleSettings",defaultMessage:"Toggle Settings","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})})]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:[(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:"←"}),(0,s.jsx)("span",{className:"jsx-".concat(sH.__hash)+" key-complement",children:(0,s.jsx)(ef.A,{id:"about.keys.or",defaultMessage:"or","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})}),(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:"→"})]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" description",children:[(0,s.jsx)(ef.A,{id:"about.keys.moveLeftRightTime",defaultMessage:"Move time controller left or right","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"}),sW(),(0,s.jsx)(ef.A,{id:"about.keys.useAltToMoveFaster",defaultMessage:"use {altKey} to move faster",values:{altKey:(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button in-text",children:sG()},"altKey")},"data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})]})]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:[(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:"↑"}),(0,s.jsx)("span",{className:"jsx-".concat(sH.__hash)+" key-complement",children:(0,s.jsx)(ef.A,{id:"about.keys.or",defaultMessage:"or","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})}),(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:"↓"})]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" description",children:[(0,s.jsx)(ef.A,{id:"about.keys.moveUpDownDepth",defaultMessage:"Move depth controller up or down","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"}),sW(),(0,s.jsx)(ef.A,{id:"about.keys.useAltToMoveFaster",defaultMessage:"use {altKey} to move faster",values:{altKey:(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button in-text",children:sG()},"altKey")},"data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})]})]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:[(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:"+"}),(0,s.jsx)("span",{className:"jsx-".concat(sH.__hash)+" key-complement",children:(0,s.jsx)(ef.A,{id:"about.keys.or",defaultMessage:"or","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})}),(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:"–"})]}),(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" description",children:(0,s.jsx)(ef.A,{id:"about.keys.zoomInOut",defaultMessage:"Zoom in/out","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})})]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:y()}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" description",children:[(0,s.jsx)("i",{className:"jsx-".concat(sH.__hash),children:(0,s.jsx)(ef.A,{id:"about.keys.onTimeDepth",defaultMessage:"on time/depth controllers","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})}),":"," ",(0,s.jsx)(ef.A,{id:"about.keys.zoomInOutController",defaultMessage:"Zoom in/out on the controller","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})]})]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:[(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:sG()}),(0,s.jsxs)("kbd",{title:u.$t({id:"about.drag",defaultMessage:"Drag"}),"data-sentry-component":"renderMouseDrag","data-sentry-source-file":"235-AboutText.tsx",className:"jsx-".concat(sH.__hash)+" key key-button with-tooltip",children:[(0,s.jsx)("span",{className:"jsx-".concat(sH.__hash)+" icon-aligner",children:"\xa0"}),(0,s.jsx)("span",{className:"jsx-".concat(sH.__hash)+" mouse-icon",children:(0,s.jsx)(eU.Icon,{icon:"computer-mouse","data-sentry-element":"Icon","data-sentry-source-file":"235-AboutText.tsx"})}),"\xa0\xa0",(0,s.jsx)(eU.Icon,{icon:"up-down-left-right","data-sentry-element":"Icon","data-sentry-source-file":"235-AboutText.tsx"}),(0,s.jsx)(n(),{id:sH.__hash,children:sH})]})]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" description",children:[(0,s.jsx)("i",{className:"jsx-".concat(sH.__hash),children:(0,s.jsx)(ef.A,{id:"about.keys.onTimeDepth",defaultMessage:"on time/depth controllers","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})}),":"," ",(0,s.jsx)(ef.A,{id:"about.keys.scrollController",defaultMessage:"Scroll through time/depth","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})]})]}),"","",(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:"?"})}),(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" description",children:(0,s.jsx)(ef.A,{id:"about.keys.showAbout",defaultMessage:"Show this About page","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})})]}),(0,s.jsx)("h4",{className:"jsx-".concat(sH.__hash)+" shortcut-group",children:(0,s.jsx)(ef.A,{id:"about.keys.layers",defaultMessage:"Layers","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})}),!x&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:[(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:sG()}),_()]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" description",children:[(0,s.jsxs)("i",{className:"jsx-".concat(sH.__hash),children:[(0,s.jsx)(ef.A,{id:"about.keys.onLayer",defaultMessage:"on layer"}),"\xa0\xa0",(0,s.jsx)(eU.Icon,{icon:"times"})]})," ",":"," ",(0,s.jsx)(ef.A,{id:"about.keys.removeAll",defaultMessage:"Remove all layers"})]})]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:[(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:sG()}),_()]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" description",children:[(0,s.jsxs)("i",{className:"jsx-".concat(sH.__hash),children:[(0,s.jsx)(ef.A,{id:"about.keys.onLayer",defaultMessage:"on layer"}),"\xa0\xa0",(0,s.jsx)(eU.Icon,{icon:"eye"})]})," ",":"," ",(0,s.jsx)(ef.A,{id:"about.keys.showLayerAndHideRest",defaultMessage:"Show this layer and hide the rest"})]})]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:[(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:sG()}),_()]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" description",children:[(0,s.jsxs)("i",{className:"jsx-".concat(sH.__hash),children:[(0,s.jsx)(ef.A,{id:"about.keys.onLayerInExplorer",defaultMessage:"on layer in Layer Explorer"})," "]}),"(",(0,s.jsx)(eU.Icon,{icon:"layer-group"}),") :"," ",(0,s.jsx)(ef.A,{id:"about.keys.addLayerNotReplace",defaultMessage:"Add layer (rather than replace)"})]})]})]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:[(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:"1"}),(0,s.jsx)("span",{className:"jsx-".concat(sH.__hash)+" key-complement",children:(0,s.jsx)(ef.A,{id:"about.keys.to",defaultMessage:"to","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})}),(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:m.BASEMAPS_ORDER.length})]}),(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" description",children:(0,s.jsx)(ef.A,{id:"about.keys.setBasemap",defaultMessage:"Set basemap: dark, light, bathymetry, coastline or none","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})})]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:"C"})}),(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" description",children:(0,s.jsx)(ef.A,{id:"about.keys.maxContrast",defaultMessage:"Maximise contrast on all layers","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})})]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:"Y"})}),(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" description",children:(0,s.jsx)(ef.A,{id:"about.keys.toggleToponyms",defaultMessage:"Toggle toponyms","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})})]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:"G"})}),(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" description",children:(0,s.jsx)(ef.A,{id:"about.keys.toggleGraticule",defaultMessage:"Toggle 10\xb0 graticule","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})})]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:"Q"})}),(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" description",children:(0,s.jsx)(ef.A,{id:"about.keys.toggleInvalidInsitu",defaultMessage:"Toggle invalid insitu data","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})})]}),(0,s.jsx)("h4",{className:"jsx-".concat(sH.__hash)+" shortcut-group",children:(0,s.jsx)(ef.A,{id:"about.keys.geometries",defaultMessage:"Geometries","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})}),!x&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:"P"})}),(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" description",children:(0,s.jsx)(ef.A,{id:"about.keys.togglePoints",defaultMessage:"Toggle Points tool"})})]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:"L"})}),(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" description",children:(0,s.jsx)(ef.A,{id:"about.keys.toggleLines",defaultMessage:"Toggle Lines tool"})})]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:"A"})}),(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" description",children:(0,s.jsx)(ef.A,{id:"about.keys.toggleAreas",defaultMessage:"Toggle Areas tool"})})]}),"",(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:"esc"})}),(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" description",children:(0,s.jsx)(ef.A,{id:"about.keys.finaliseLineArea",defaultMessage:"Finalise line/area creation"})})]})]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:[(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:sG()}),_()]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" description",children:[(0,s.jsxs)("i",{className:"jsx-".concat(sH.__hash),children:[(0,s.jsx)(ef.A,{id:"about.keys.onGeometry",defaultMessage:"on geometry","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"}),"\xa0\xa0",(0,s.jsx)(eU.Icon,{icon:"times","data-sentry-element":"Icon","data-sentry-source-file":"235-AboutText.tsx"})]})," ",":"," ",(0,s.jsx)(ef.A,{id:"about.keys.removeAllGeometries",defaultMessage:"Remove all geometries","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})]})]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:[(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button",children:sG()}),_()]}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" description",children:[(0,s.jsx)("i",{className:"jsx-".concat(sH.__hash),children:(0,s.jsx)(ef.A,{id:"about.keys.onMapToCreateGeom",defaultMessage:"on the map, to create a geometry","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})}),":"," ",(0,s.jsx)(ef.A,{id:"about.keys.invertAutoAddGraphs",defaultMessage:"Invert the “Add sample graphs to new geometries” setting","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})]})]}),"",(0,s.jsx)("h4",{className:"jsx-".concat(sH.__hash)+" shortcut-group",children:(0,s.jsx)(ef.A,{id:"about.keys.graphs",defaultMessage:"Graphs","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" shortcut",children:[(0,s.jsx)("div",{className:"jsx-".concat(sH.__hash)+" keys",children:y()}),(0,s.jsxs)("div",{className:"jsx-".concat(sH.__hash)+" description",children:[(0,s.jsx)("i",{className:"jsx-".concat(sH.__hash),children:(0,s.jsx)(ef.A,{id:"about.keys.onGraph",defaultMessage:"on graph","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})}),":"," ",(0,s.jsx)(ef.A,{id:"about.keys.zoomInOut",defaultMessage:"Zoom in/out","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"}),sW(),(0,s.jsx)(ef.A,{id:"about.keys.useAltToChangeZoomDim",defaultMessage:"use {altKey} to change zoomed dimension",values:{altKey:(0,s.jsx)("kbd",{className:"jsx-".concat(sH.__hash)+" key key-button in-text",children:sG()},"altKey")},"data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})]})]})]}),(0,s.jsx)(n(),{id:sH.__hash,children:sH})]}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h3",{className:"jsx-".concat(sH.__hash),children:(0,s.jsx)(ef.A,{id:"about.sysReqsTitle",defaultMessage:"System requirements","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})}),(0,s.jsx)("p",{className:"jsx-".concat(sH.__hash),children:(0,s.jsx)(ef.A,{id:"about.sysReqs",defaultMessage:"Best viewed on Chrome 118+, Firefox 119+, Safari 15+, Android Chrome 118+, iOS Safari 15+, Edge 118+.","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})}),(0,s.jsx)(n(),{id:sH.__hash,children:sH})]}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h3",{className:"jsx-".concat(sH.__hash),children:(0,s.jsx)(ef.A,{id:"about.creditsTitle",defaultMessage:"Credits","data-sentry-element":"FormattedMessage","data-sentry-source-file":"235-AboutText.tsx"})}),j&&(0,s.jsx)(sE.$,{linkTarget:"_blank",children:j}),(0,s.jsx)(n(),{id:sH.__hash,children:sH})]}),(0,s.jsx)(n(),{id:sH.__hash,children:sH})]})},sq=new String(".content.jsx-49df94bb2abcef30{margin:var(--modal-padding)}.logos.jsx-49df94bb2abcef30{text-align:center;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap}.logo.jsx-49df94bb2abcef30{margin:20px 10px;display:inline-block}.logo-ec.jsx-49df94bb2abcef30{margin:10px 20px}.logo.jsx-49df94bb2abcef30 img.jsx-49df94bb2abcef30{-webkit-filter:grayscale(1);filter:grayscale(1)}.lobelia-colophon.jsx-49df94bb2abcef30{margin:20px 0 30px;text-align:center}.lobelia-colophon.jsx-49df94bb2abcef30 a.logo.jsx-49df94bb2abcef30{display:inline-block;width:160px}.love.jsx-49df94bb2abcef30{margin:.6em 0 3em;font-size:.7rem;color:var(--color-dim)}.green-heart.jsx-49df94bb2abcef30{margin:0 .2em}.lobelia-link.jsx-49df94bb2abcef30{color:var(--color-text-dim)}.lobelia-link.jsx-49df94bb2abcef30:hover{text-decoration:underline}.logo-top-wrapper.jsx-49df94bb2abcef30{padding:20px 0;text-align:center}.logo-top.jsx-49df94bb2abcef30{width:200px}@media screen and (max-width:".concat(m.UI.narrowBreak,"px){.about.jsx-49df94bb2abcef30{height:100%}}"));sq.__hash="49df94bb2abcef30";let sZ=e=>{let t=(0,tN.A)(),a=e=>(0,s.jsxs)("a",{href:e.href,target:"_blank",rel:"noopener noreferrer",style:e.style,"data-sentry-component":"renderLogo","data-sentry-source-file":"230-AboutModal.tsx",className:"jsx-".concat(sq.__hash)+" logo",children:[(0,s.jsx)("img",{src:e.src,alt:e.alt,width:e.width,className:"jsx-".concat(sq.__hash)}),(0,s.jsx)(n(),{id:sq.__hash,children:sq})]});return(()=>{let{isInitial:i,isLight:l}=e,{aboutLogoTop:r,aboutLogoBottom1:o,aboutLogoBottom2:c}=m.APP_CONFIG;return(0,s.jsxs)("section",{"data-sentry-component":"render","data-sentry-source-file":"230-AboutModal.tsx",className:"jsx-".concat(sq.__hash)+" about",children:[(0,s.jsx)(e2.A,{isInitial:i,title:t.$t({id:"control-block.about.tooltip",defaultMessage:"About"}),"data-sentry-element":"TitleRow","data-sentry-source-file":"230-AboutModal.tsx"}),(0,s.jsxs)("div",{className:"jsx-".concat(sq.__hash)+" content",children:[r&&(0,s.jsx)("div",{className:"jsx-".concat(sq.__hash)+" logo-top-wrapper",children:(0,s.jsx)("img",{src:r.src,alt:r.alt,className:"jsx-".concat(sq.__hash)+" logo-top"})}),(0,s.jsx)(s$,{isLight:l,"data-sentry-element":"AboutText","data-sentry-source-file":"230-AboutModal.tsx"}),(0,s.jsxs)("div",{className:"jsx-".concat(sq.__hash)+" logos",children:[o&&a(o),c&&a(c)]}),(0,s.jsx)("div",{className:"jsx-".concat(sq.__hash)+" lobelia-colophon",children:(0,s.jsxs)("p",{className:"jsx-".concat(sq.__hash)+" love",children:[(0,s.jsx)(ef.A,{id:"about.madeWithLove",defaultMessage:"Made with {emoji} by {link} in Barcelona.",values:{emoji:(0,s.jsx)("span",{role:"img","aria-label":"green heart",className:"jsx-".concat(sq.__hash)+" green-heart",children:"\uD83D\uDC9A"},"emoji"),link:(0,s.jsx)("a",{href:"https://lobelia.earth?utm_source=cmems&utm_medium=web&utm_campaign=cmems-about-colophon",target:"_blank",rel:"noopener noreferrer",className:"jsx-".concat(sq.__hash)+" lobelia-link",children:"Lobelia Earth"},"link")},"data-sentry-element":"FormattedMessage","data-sentry-source-file":"230-AboutModal.tsx"}),(0,s.jsx)("br",{className:"jsx-".concat(sq.__hash)}),"v","14.3.1"]})})]}),(0,s.jsx)(n(),{id:sq.__hash,children:sq})]})})()},sY=new String(".logo-wrapper.jsx-2bf0aa836777be46{position:absolute;top:-webkit-calc(var(--header-height) + 28px);top:-moz-calc(var(--header-height) + 28px);top:calc(var(--header-height) + 28px);right:28px}.logo-wrapper.narrow-control-block.jsx-2bf0aa836777be46:not(.light){position:absolute;top:15px;left:15px;right:auto}.logo-wrapper.narrow-light-drawer.jsx-2bf0aa836777be46{top:-webkit-calc(var(--header-height) + 14px);top:-moz-calc(var(--header-height) + 14px);top:calc(var(--header-height) + 14px);left:auto;right:14px}.my-ocean.jsx-2bf0aa836777be46{display:inline-block;width:110px;-webkit-filter:brightness(0)hue-rotate(0deg)invert(1)drop-shadow(0px 0px 2px rgba(0,0,0,.4));filter:brightness(0)hue-rotate(0deg)invert(1)drop-shadow(0px 0px 2px rgba(0,0,0,.4));margin:0 14px 0 0}.unep-logo.jsx-2bf0aa836777be46{display:inline-block;position:relative;top:2px;height:47px;-webkit-filter:brightness(0)hue-rotate(0deg)invert(1)drop-shadow(0px 0px 2px rgba(0,0,0,.4));filter:brightness(0)hue-rotate(0deg)invert(1)drop-shadow(0px 0px 2px rgba(0,0,0,.4));margin:0 30px 0 0}.edito-logo.jsx-2bf0aa836777be46{position:relative;top:2px;height:44px;margin:0;display:inline-block;-webkit-filter:drop-shadow(0px 0px 2px rgba(0,0,0,.4));filter:drop-shadow(0px 0px 2px rgba(0,0,0,.4))}.neccton-logo.jsx-2bf0aa836777be46{position:relative;top:2px;height:70px;margin:0;display:inline-block;-webkit-filter:brightness(0)hue-rotate(0deg)invert(1)drop-shadow(0px 0px 2px rgba(0,0,0,.4));filter:brightness(0)hue-rotate(0deg)invert(1)drop-shadow(0px 0px 2px rgba(0,0,0,.4))}.mo-logo.jsx-2bf0aa836777be46{display:inline-block;position:relative;bottom:6px;width:120px;-webkit-filter:brightness(0)hue-rotate(0deg)invert(1)drop-shadow(0px 0px 2px rgba(0,0,0,.4));filter:brightness(0)hue-rotate(0deg)invert(1)drop-shadow(0px 0px 2px rgba(0,0,0,.4));margin:0 30px 0 0}.logo.jsx-2bf0aa836777be46{display:inline-block;width:47px;-webkit-filter:brightness(0)hue-rotate(0deg)invert(1)drop-shadow(0px 0px 2px rgba(0,0,0,.4));filter:brightness(0)hue-rotate(0deg)invert(1)drop-shadow(0px 0px 2px rgba(0,0,0,.4));-webkit-transition:all 300ms;-moz-transition:all 300ms;-o-transition:all 300ms;transition:all 300ms}.logo.jsx-2bf0aa836777be46:hover{-webkit-filter:brightness(.5)hue-rotate(140deg)invert(1)drop-shadow(0px 0px 2px rgba(0,0,0,.4));filter:brightness(.5)hue-rotate(140deg)invert(1)drop-shadow(0px 0px 2px rgba(0,0,0,.4))}.logo-wrapper.narrow.jsx-2bf0aa836777be46 .mo-logo.jsx-2bf0aa836777be46{width:105px}.logo-wrapper.narrow-light-drawer.jsx-2bf0aa836777be46 .logo.jsx-2bf0aa836777be46{width:42px}");sY.__hash="2bf0aa836777be46";let sJ=e=>{let{windowWidth:t}=e,a=(0,d.d4)(v.$x),i=(0,d.d4)(v.H9),l=t<m.UI.narrowBreak,r=t<=m.UI.narrowControlBlockBreak,o=i&&t<=m.UI.narrowLightDrawerBreak,h=m.APP_CONFIG.id,u="cmems"===h&&(i?!l:!r),p="unep"===h&&t>810,x="edito"===h,f="neccton"===h,b=["cmems","unep","all"].includes(h);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"jsx-".concat(sY.__hash)+" "+(c()("logo-wrapper",{"external-embed":a,light:i,narrow:l,"narrow-control-block":r,"narrow-light-drawer":o})||""),children:[u&&(0,s.jsx)("img",{src:i?"/images/logo-myocean-light.png":"/images/logo-myocean-pro.png",alt:"MyOcean logo","data-testid":"my-ocean-logo",className:"jsx-".concat(sY.__hash)+" my-ocean"}),p&&(0,s.jsx)("a",{href:"https://mercator-ocean.eu/en",target:"_blank",rel:"noopener noreferrer",className:"jsx-".concat(sY.__hash),children:(0,s.jsx)("img",{src:"/images/logo-mo.png",alt:"MO logo",className:"jsx-".concat(sY.__hash)+" mo-logo"})}),p&&(0,s.jsx)("a",{href:"https://www.unep.org/",target:"_blank",rel:"noopener noreferrer",className:"jsx-".concat(sY.__hash),children:(0,s.jsx)("img",{src:"/images/logo-unep.png",alt:"UNEP logo",className:"jsx-".concat(sY.__hash)+" unep-logo"})}),x&&(0,s.jsx)("img",{src:"/images/logo-edito.png",alt:"DO logo",className:"jsx-".concat(sY.__hash)+" edito-logo"}),f&&(0,s.jsx)("a",{href:"https://neccton.eu/",target:"_blank",rel:"noopener noreferrer",className:"jsx-".concat(sY.__hash),children:(0,s.jsx)("img",{src:"/images/logo-neccton.webp",alt:"NECCTON logo",className:"jsx-".concat(sY.__hash)+" neccton-logo"})}),b&&(0,s.jsx)("a",{href:m.URLS.cmems,className:"jsx-".concat(sY.__hash),children:(0,s.jsx)("img",{src:"/images/logo-small.png",alt:"Copernicus Marine logo",title:"Copernicus Marine Home",className:"jsx-".concat(sY.__hash)+" logo"})})]}),(0,s.jsx)(n(),{id:sY.__hash,children:sY})]})};var sK=a(45511);let sQ=["dataset","datasetContacts","datasetServices","datasetStatus","files","layers"];class sX extends l.Component{componentDidMount(){setTimeout(()=>{if(this.isUnmounted)return;let{width:e,isLight:t}=this.props;null!=e&&e<m.UI.narrowControlBlockBreak&&t&&this.props.setIsControlBlockShown(!1)},400),this.props.isDashboard&&!this.props.isEditingDashboard&&setTimeout(()=>{let e={...this.props,mapLayers:{}},t=this.calcMapViewForObjects();t?this.zoomIntoMapView(t):this.tryToZoomIntoNewLayer(e),this.tryToAdaptTimeElevationToNewLayer(e)},1e3)}componentDidUpdate(e){this.props.isEditingDashboard||this.props.isDashboard||this.tryToZoomIntoNewLayer(e),this.props.isEditingDashboard||this.tryToAdaptTimeElevationToNewLayer(e)}componentWillUnmount(){this.isUnmounted=!0}render(){var e;let{width:t,height:a}=this.props;if(null==t)return null==a?null:(0,s.jsx)("div",{style:{height:a},"data-sentry-component":"ViewerApp","data-sentry-source-file":"020-ViewerApp.tsx",children:"\xa0"});if(null==t||null==a)return null;let{mapWidth:i,mapHeight:l}=this.calcMapSize(),{isLight:r,settings:o,router:d}=this.props,{isDashboard:h,isExternalEmbed:u,cardId:p}=this.props,{isEditingThumbnail:x,isEditingDashboard:f}=this.props,b=x?o.thumbnailBasemap:o.basemap,g=null!==(e=m.BASEMAPS[b])&&void 0!==e?e:m.BASEMAPS[m.DEFAULT_BASEMAP];return(0,s.jsxs)("div",{style:{width:t,height:a},"data-sentry-component":"ViewerApp","data-sentry-source-file":"020-ViewerApp.tsx",className:"jsx-".concat(s0.__hash)+" "+(c()("viewer-app",{light:r})||""),children:[(0,s.jsx)("section",{style:s1.hiddenInfoTab,className:"jsx-".concat(s0.__hash)+" hidden-info-tab",children:(0,s.jsx)("div",{style:s1.hiddenInfoTabInner,className:"jsx-".concat(s0.__hash),children:(0,s.jsx)(s$,{seo:!0,"data-sentry-element":"AboutText","data-sentry-source-file":"020-ViewerApp.tsx"})})}),"viewer"===d.query.view&&!h&&!u&&(0,s.jsx)(sK.A,{onZoomIn:()=>{var e;return null===(e=this.refRootMap.current)||void 0===e?void 0:e.zoomIn()},onZoomOut:()=>{var e;return null===(e=this.refRootMap.current)||void 0===e?void 0:e.zoomOut()},onAbout:()=>null==d?void 0:d.push("".concat(r?m.URLS.viewerLight:m.URLS.viewer,"?view=about"))}),(0,s.jsx)("div",{className:"jsx-".concat(s0.__hash)+" map-wrapper-outer",children:(0,s.jsxs)("div",{style:{backgroundColor:g.bgColor},className:"jsx-".concat(s0.__hash)+" "+(c()("map-wrapper-inner",{"is-editing-thumbnail":x})||""),children:[(0,s.jsx)(ez,{ref:this.refRootMap,width:i,height:l,cardId:p,"data-sentry-element":"RootMap","data-sentry-source-file":"020-ViewerApp.tsx"}),this.renderThumbnailEditorExtras(b)]})}),(0,s.jsx)(_.g.Provider,{value:this.zoomIntoMapView,"data-sentry-element":"unknown","data-sentry-source-file":"020-ViewerApp.tsx",children:(0,s.jsx)(eF.Ay,{width:t,height:a,cardId:p,"data-sentry-element":"MapTools","data-sentry-source-file":"020-ViewerApp.tsx"})}),!x&&!h&&(0,s.jsx)(sJ,{windowWidth:t,windowHeight:a}),!r&&!f&&(0,s.jsx)(_.Q.Provider,{value:this.zoomIntoLayer,children:(0,s.jsx)(sv,{windowWidth:t,windowHeight:a,cardId:p})}),r&&(0,s.jsx)(sM,{}),r&&(0,s.jsx)(sC,{width:t,height:a}),!this.props.isMapReady&&(0,s.jsx)("div",{title:"Waiting for tiles...",className:"jsx-".concat(s0.__hash)+" "+(c()("map-spinner",{narrow:t<=m.UI.narrowControlBlockBreak,"is-light-basemap":g.isLightColor})||""),children:(0,s.jsx)(e1.A,{timeout:2e3})}),this.renderModal(),(0,s.jsx)(n(),{id:s0.__hash,children:s0})]})}renderThumbnailEditorExtras(e){var t;let{isEditingThumbnail:a,editedThumbnailOverlays:i}=this.props;if(!a)return null;let{mapLayers:l,datasets:r}=this.props,o=Object.values(l).find(e=>e.isEditingThumbnail);if(!o)return null;let{datasetId:c}=(0,f.ei)(o.layerId),d=r[c];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(sL.A,{basemapId:e,overlays:null!=i?i:{tags:[]},sources:null!==(t=null==d?void 0:d.sources)&&void 0!==t?t:[],externalSourceShort:null==d?void 0:d.externalSourceShort}),(0,s.jsx)("div",{className:"jsx-".concat(s0.__hash)+" thumbnail-preview-headline",children:"Thumbnail preview"}),(0,s.jsx)(n(),{id:s0.__hash,children:s0})]})}renderModal(){let{query:e}=this.props.router,t=e[m.QUERY_INITIAL_FLAG],a=e.view,i=!!t;if(!a||"viewer"===a)return null;let n=sQ.indexOf(a)>=0;return n||["catalogue","about"].includes(a)?(0,s.jsxs)(e0.A,{className:"navigational ".concat(a),onClose:this.onCloseModal,rememberScroll:"catalogue"===a,children:["catalogue"===a&&this.renderCatalogue(i),n&&this.renderDatasetDetails(i,a),"about"===a&&this.renderAbout(i)]},n?"dataset":a):null}renderCatalogue(e){return(0,s.jsx)(sD.A,{isInitial:e,standalone:!1})}renderDatasetDetails(e,t){let{router:a,width:i}=this.props;if(null==i)return null;let{dataset:n}=a.query;return(0,s.jsx)(sT.A,{isInitial:e,datasetId:n,width:i,view:t})}renderAbout(e){return(0,s.jsx)(sZ,{isInitial:e,isLight:this.props.isLight})}constructor(...e){var t;super(...e),t=this,this.isUnmounted=!1,this.refRootMap=l.createRef(),this.onCloseModal=()=>{this.props.router.push(this.props.viewerUrl)},this.tryToZoomIntoNewLayer=e=>{let t=this.findNewLayer(e);if(!t)return;let{isDashboard:a}=this.props;!a&&new Date().getTime()-t.creationDate>1e3||this.zoomIntoLayer(t)},this.tryToAdaptTimeElevationToNewLayer=e=>{let t=this.findNewLayer(e,{alsoDetectReplace:!0});if(!t)return;let a=(0,f.VF)(this.props.datasets,t.layerId);if(!a)return;let{isDashboard:s}=this.props,i={ignoreOtherLayers:s};this.adaptTimeIfNeeded(a,i),this.adaptElevIfNeeded(a,i)},this.findNewLayer=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=Object.values(t.props.mapLayers),i=Object.values(e.mapLayers);if(t.props.isDashboard){let e=t.props.cardId,a=i.find(t=>t.cardId===e),n=s.find(t=>t.cardId===e);return n&&n.layerId!==(null==a?void 0:a.layerId)?n:null}return!a.alsoDetectReplace&&s.length<=i.length?null:s.find(e=>!e.isHidden&&!i.find(t=>t.layerId===e.layerId))},this.zoomIntoLayer=function(e){var a,s;let i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{datasetId:l,subdatasetId:r,variableId:o}=(0,f.ei)(e.layerId),c=t.props.datasets[l];if(!c||!(null===(s=c.autoZoom)||void 0===s||s)&&!n.ignoreDatasetAutoZoom)return;(null===(a=c.userDatasetDetails)||void 0===a?void 0:a.type)==="aiForecast"&&(i=150);let{mapWidth:d,mapHeight:h}=t.calcMapSize(),u={layerId:"".concat(r,"/").concat(o),margin:i},p=(0,j.A)(c,d,h,u);t.zoomIntoMapView(p)},this.zoomIntoMapView=e=>{let{crs:t,center:a,zoom:s}=e;if(t===this.props.crs){var i,n;null===(n=this.refRootMap)||void 0===n||null===(i=n.current)||void 0===i||i.panZoomTo(a,s)}else this.props.setCrsWithCenterZoom(t,a,s)},this.adaptTimeIfNeeded=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{mapLayers:s,datasets:i,dashSettings:n}=t.props,{time:l}=t.props;if(null==l)return;if(!a.ignoreOtherLayers){let{tMin:e,tMax:t}=(0,b.Kc)(s,i,{dashSettings:n});if(null==e||null==t||l>=e&&l<=t)return}let{tMin:r,tMax:o}=(0,b.w6)(e,{dashSettings:n});if(null!=r&&null!=o){if(l<r){let a=u().utc(r);if(e.hasSqlite?a.add(6,"hour"):a.startOf("day"),(l=a.valueOf())>o)return;t.props.setTime(l,{immediateEffects:!0})}else if(l>o){let a=u().utc(o);if(e.hasSqlite?a.subtract(6,"hour"):a.startOf("day").subtract(1,"day"),(l=a.valueOf())<r)return;t.props.setTime(l,{immediateEffects:!0})}}},this.adaptElevIfNeeded=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{mapLayers:s,datasets:i}=t.props,{elevation:n}=t.props;if(null==n)return;if(!a.ignoreOtherLayers){let{zMin:e,zMax:t}=(0,b.ml)(s,i);if(null==e||null==t||n>=e&&n<=t)return}let{zMin:l,zMax:r}=(0,b.OE)(e);null!=l&&null!=r&&(n<l?(n=l,t.props.setElevation(n,{immediateEffects:!0})):n>r&&(n=r,t.props.setElevation(n,{immediateEffects:!0})))},this.calcMapSize=()=>{let{width:e,height:t}=this.props,a=e,s=t;return this.props.isEditingThumbnail?{mapWidth:a=m.THUMBNAIL_PREVIEW_SIZE[0],mapHeight:s=m.THUMBNAIL_PREVIEW_SIZE[1]}:{mapWidth:a,mapHeight:s}},this.calcMapViewForObjects=()=>{let{mapObjects:e}=this.props,t=(0,g.vG)(e);if(null==t)return null;let{mapWidth:a,mapHeight:s}=this.calcMapSize(),i=m.UI.defaultCrs,n=t[1],l=t[3];n>=70?i="epsg:32661":l<=-70&&(i="epsg:32761");let r=(0,p.bboxToCenterZoom)(t,i,a,s,{margin:100});return{crs:i,center:r.center,zoom:Math.min(13,r.zoom)}}}}let s0=new String(".viewer-app.jsx-6a97656cd45a597d{position:relative;overflow:hidden}.hidden-info-tab.jsx-6a97656cd45a597d *{outline:none;color:transparent}.map-wrapper-outer.jsx-6a97656cd45a597d{height:100%;width:100%;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center}.map-wrapper-inner.jsx-6a97656cd45a597d{position:relative}.map-wrapper-inner.is-editing-thumbnail.jsx-6a97656cd45a597d .tero-layer-basemap-light{-webkit-filter:brightness(".concat(m.THUMBNAIL_BASEMAP_BRIGHTNESS.light,");filter:brightness(").concat(m.THUMBNAIL_BASEMAP_BRIGHTNESS.light,")}.map-wrapper-inner.is-editing-thumbnail.jsx-6a97656cd45a597d .tero-layer-basemap-dark{-webkit-filter:brightness(").concat(m.THUMBNAIL_BASEMAP_BRIGHTNESS.dark,");filter:brightness(").concat(m.THUMBNAIL_BASEMAP_BRIGHTNESS.dark,")}.thumbnail-preview-headline.jsx-6a97656cd45a597d{position:absolute;bottom:-webkit-calc(100% + 15px);bottom:-moz-calc(100% + 15px);bottom:calc(100% + 15px);width:100%;color:gray;font-size:1.4rem;font-weight:bold;text-align:left}.map-spinner.jsx-6a97656cd45a597d{position:absolute;top:").concat(m.UI.headerHeight+2,"px;right:2px;color:rgb(240,240,240);z-index:var(--z-map-spinner);mix-blend-mode:hard-light}.map-spinner.is-light-basemap.jsx-6a97656cd45a597d{color:rgb(40,40,40)}@media screen and (min-width:").concat(m.UI.narrowBreak+1,"px){.wk-modal-outer.layers .wk-modal-inner{max-width:600px}.wk-modal-outer.about .wk-modal-inner{max-width:800px}.wk-modal-outer.catalogue .wk-modal-inner,.wk-modal-outer.datasetServices .wk-modal-inner{max-width:90vw}}.map-spinner.narrow.jsx-6a97656cd45a597d{right:unset;left:2px}"));s0.__hash="6a97656cd45a597d";let s1={hiddenInfoTab:{position:"absolute",top:0,left:0,right:0,pointerEvents:"none",boxSizing:"border-box",height:50,overflow:"hidden"},hiddenInfoTabInner:{padding:50}},s2=(0,r.withRouter)((0,d.Ng)(e=>({isMapReady:(0,v.oS)(e),mapLayers:(0,v.b7)(e),mapObjects:(0,v.B_)(e),datasets:(0,v.yT)(e),settings:(0,v.mt)(e),isLight:(0,v.H9)(e),isDashboard:(0,v.N0)(e),isEditingDashboard:(0,v.Rp)(e),dashSettings:(0,v.YO)(e),isExternalEmbed:(0,v.$x)(e),elevation:(0,v.S1)(e),time:(0,v.WB)(e),crs:(0,v.tT)(e),viewerUrl:(0,v.cm)(e),isEditingThumbnail:(0,v.R9)(e),editedThumbnailOverlays:(0,v.$U)(e)}),x)(sX))},45511:(e,t,a)=>{a.d(t,{A:()=>f});var s=a(14041),i=a(70541),n=a(99420),l=a.n(n),r=a(20409),o=a(8953),c=a(81864),d=a(55065),h=a(49608),u=a(83832),p=a(89384);class x extends s.Component{componentDidMount(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}componentWillUnmount(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}render(){return null}constructor(...e){super(...e),this.onKeyDown=e=>{if(!(0,h.Xy)(e.target.tagName)&&!e.ctrlKey&&!e.altKey&&!e.metaKey)switch(e.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":e.preventDefault()}},this.onKeyUp=e=>{var t,a,s,i,n,o;if((0,h.Xy)(e.target.tagName)||e.ctrlKey||e.metaKey)return;let c=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key),{altKey:u}=e;if(u&&!c)return;let{activeTool:x,isControlBlockShown:f,isToolboxShown:b}=this.props;if(this.props.isModalOpen&&e.code!==d.UI.keys.settings)return;let{intl:g,isDashboard:j,mapLayers:v,datasets:_}=this.props,{isEditingThumbnail:y,isEditingDashboard:w,dashSettings:k}=this.props,M={isDashboard:j,isEditingDashboard:w,dashSettings:k},N=(0,p.x8)(v,_,M),S=(0,p.V7)(v,_,M);switch(e.key){case d.UI.keys.toggleControlBlock:x?this.props.setActiveTool(null,{cancelMultiObject:!0}):this.props.setIsControlBlockShown(!f);break;case d.UI.keys.toggleToolbox:this.props.setIsToolboxShown(!b);break;case d.UI.keys.dateTime:case d.UI.keys.elevation:break;case d.UI.keys.zenMode:f||b?(this.props.setIsControlBlockShown(!1),this.props.setIsToolboxShown(!1)):(this.props.setIsControlBlockShown(!0),this.props.setIsToolboxShown(!0));break;case d.UI.keys.point:this.props.setActiveTool(x===d.UI.tools.point?null:d.UI.tools.point);break;case d.UI.keys.line:this.props.setActiveTool(x===d.UI.tools.line?null:d.UI.tools.line);break;case d.UI.keys.area:this.props.setActiveTool(x===d.UI.tools.area?null:d.UI.tools.area);break;case d.UI.keys.importGeometry:this.props.setActiveTool(x===d.UI.tools.importGeometry?null:d.UI.tools.importGeometry);break;case d.UI.keys.select:if(!j)return;this.props.setActiveTool(x===d.UI.tools.dashboardSelect?null:d.UI.tools.dashboardSelect);break;case d.UI.keys.settings:if(w)return;this.props.setActiveTool(x===d.UI.tools.settings?null:d.UI.tools.settings);break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{let t=Number(e.key)-1;if(t>=d.BASEMAPS_ORDER.length)return;this.props.updateSettings({[y?"thumbnailBasemap":"basemap"]:d.BASEMAPS_ORDER[t]});break}case d.UI.keys.graticule:this.props.updateSettings({hideGraticule:!this.props.settings.hideGraticule});break;case d.UI.keys.toponyms:this.props.updateSettings({showToponyms:!this.props.settings.showToponyms});break;case d.UI.keys.filterInsitu:{let e=!this.props.settings.showInvalidInsituData;this.props.updateSettings({showInvalidInsituData:e}),(0,r.notify)({type:"success",icon:"location-dot",title:e?g.$t({id:"notif.badInsituDataShown",defaultMessage:"Invalid insitu data is now shown"}):g.$t({id:"notif.badInsituDataHidden",defaultMessage:"Invalid insitu data is now hidden"})});break}case d.UI.keys.about:null===(t=(a=this.props).onAbout)||void 0===t||t.call(a);break;case"ArrowUp":case"ArrowDown":{if(!S)return;e.preventDefault();let{elevation:t}=this.props,a=u?100:10;t=10*Math.round(t/10)+("ArrowUp"===e.code?+a:-a),this.props.setElevation(t,{immediateEffects:!0}),this.props.elevationDragStarted("keyboard",1500);break}case"ArrowLeft":case"ArrowRight":{if(!N)return;e.preventDefault();let{mapLayers:t,datasets:a,time:s}=this.props,{unit:i,numUnits:n}=m(t,a,u),r=l().utc(s).startOf(i);r.subtract(r.get(i)%n,i),"ArrowLeft"===e.code?r.valueOf()===s&&r.subtract(n,i):r.add(n,i);let o=r.valueOf();this.props.setTime(o,{immediateEffects:!0,noRound:!0}),this.props.timeDragStarted("keyboard",1500);break}case"+":null===(s=(i=this.props).onZoomIn)||void 0===s||s.call(i);break;case"-":null===(n=(o=this.props).onZoomOut)||void 0===n||n.call(o);break;case d.UI.keys.autoLevels:this.props.calcAutoLevelsForAllLayers()}}}}let m=(e,t,a)=>{let s=1/0;Object.values(e).forEach(e=>{if(e.isHidden)return;let a=(0,h.VF)(t,e.layerId);if(!a)return;let i=Infinity;if(a.isHourly)i=a.isAltimetry?3e5:36e5;else{let{tValues:e}=a;if(!e||!Array.isArray(e)||e.length<2)return;let t=e.length;i=(e[t-1]-e[0])/(t-1)}i<s&&(s=i)});let i=a?{unit:"day",numUnits:2}:{unit:"day",numUnits:1};if(s===1/0)return i;let n=l().duration(s),r=Math.round(n.asMinutes()),o=Math.round(n.asHours()),c=Math.round(n.asDays()),d=Math.round(n.asWeeks()),u=Math.round(n.asMonths()),p=Math.round(n.asYears());return r<10?a?{unit:"minute",numUnits:20}:{unit:"minute",numUnits:r}:r<45?a?{unit:"hour",numUnits:1}:{unit:"minute",numUnits:r}:o<15?a?{unit:"day",numUnits:1}:{unit:"hour",numUnits:o}:c<6?a?{unit:"week",numUnits:1}:{unit:"day",numUnits:c}:d<3?a?{unit:"month",numUnits:1}:{unit:"week",numUnits:d}:u<3?a?{unit:"month",numUnits:2*u}:{unit:"month",numUnits:u}:p<3?a?{unit:"year",numUnits:2*p}:{unit:"year",numUnits:p}:i},f=(0,i.Ng)(e=>({mapLayers:(0,u.b7)(e),datasets:(0,u.yT)(e),settings:(0,u.mt)(e),isModalOpen:(0,u.kF)(e),isControlBlockShown:(0,u.mb)(e),isToolboxShown:(0,u.$Y)(e),isDashboard:(0,u.N0)(e),isEditingDashboard:(0,u.Rp)(e),dashSettings:(0,u.YO)(e),activeTool:(0,u.Z9)(e),elevation:(0,u.S1)(e),time:(0,u.WB)(e),isEditingThumbnail:(0,u.R9)(e)}),c)((0,o.Ay)(x))},3546:(e,t,a)=>{let s;a.d(t,{A:()=>tx});var i=a(31085),n=a(93243),l=a.n(n),r=a(14041),o=a(70541),c=a(64104),d=a(8953),h=a(99870),u=a.n(h),p=a(20409),x=a(55065),m=a(49608),f=a(70226),b=a(41821),g=a(83832),j=a(81864);let v=["General","Incidents","Improvements","Maintenance"],_={General:e=>e.$t({id:"datasetDetails.notifs.general",defaultMessage:"General"}),Incidents:e=>e.$t({id:"datasetDetails.notifs.incident",defaultMessage:"Incident"}),Improvements:e=>e.$t({id:"datasetDetails.notifs.improvement",defaultMessage:"Improvement"}),Maintenance:e=>e.$t({id:"datasetDetails.notifs.maintenance",defaultMessage:"Maintenance"})},y=async e=>{let t="".concat("https://data-be-prd.marine.copernicus.eu","/api/dataset/").concat(e,"/shortNotifs");try{var a;let e=await (0,f.z)(t);return null!==(a=e.notifs)&&void 0!==a?a:[]}catch(e){return console.error(e),[]}},w=(e,t)=>/^(on\s*going|on-going|in\sprogress)$/i.test(e)?t.$t({id:"datasetDetails.notifs.inProgress",defaultMessage:"In progress"}):/^anomaly$/i.test(e)?t.$t({id:"datasetDetails.notifs.anomaly",defaultMessage:"Anomaly"}):/^improvement$/i.test(e)?t.$t({id:"datasetDetails.notifs.improvement",defaultMessage:"Improvement"}):/^resolved$/i.test(e)?t.$t({id:"datasetDetails.notifs.resolved",defaultMessage:"Resolved"}):/^completed$/i.test(e)?t.$t({id:"datasetDetails.notifs.completed",defaultMessage:"Completed"}):/^information$/i.test(e)?t.$t({id:"datasetDetails.notifs.information",defaultMessage:"Information"}):e,k=e=>/^anomaly$/i.test(e)?"error":/^(scheduled|on\s*going|on-going|in\s*progress|in-progress)$/i.test(e)?"warn":/^(completed|resolved|information)$/i.test(e)?"success":/^improvement$/i.test(e)?"improvement":void 0,M=e=>e.filter(e=>{let t=k(e.status);return"error"===t||"warn"===t}).length;var N=a(52191),S=a(19416),I=a(59916),A=a(8867),C=a(41723),D=a(71198);let T=new String(".sidebar.jsx-cc6a7af1630b729f{-webkit-box-flex:0;-webkit-flex:0 0 240px;-moz-box-flex:0;-ms-flex:0 0 240px;flex:0 0 240px;padding-right:30px}.sidebar.standalone.jsx-cc6a7af1630b729f{padding-right:30px}.sidebar.jsx-cc6a7af1630b729f .thumbnail{margin-bottom:15px}@media screen and (max-width:".concat(x.UI.narrowBreak,"px){.sidebar.jsx-cc6a7af1630b729f{-webkit-box-flex:0;-webkit-flex:0 0 130px;-moz-box-flex:0;-ms-flex:0 0 130px;flex:0 0 130px;font-size:.8rem}}@media screen and (max-width:").concat(x.UI.mobileBreak,"px){.sidebar.jsx-cc6a7af1630b729f,.sidebar.standalone.jsx-cc6a7af1630b729f{padding-right:0}.sidebar.jsx-cc6a7af1630b729f .thumbnail{display:none}}.add-layer.jsx-cc6a7af1630b729f{margin-top:15px}.add-layer.jsx-cc6a7af1630b729f .wk-button{width:100%}@media screen and (max-width:").concat(x.UI.mobileBreak,"px){.add-layer.jsx-cc6a7af1630b729f{display:none}}.nav-buttons.jsx-cc6a7af1630b729f{margin-top:15px;border:1px solid var(--color-title-bg)}.sidebar.standalone.jsx-cc6a7af1630b729f .nav-buttons.jsx-cc6a7af1630b729f{margin-top:0}.nav-buttons.jsx-cc6a7af1630b729f .nav-button{display:block;padding:").concat(8,"px ").concat(14,"px;color:inherit;background-color:white}.nav-buttons.jsx-cc6a7af1630b729f .nav-button+.nav-button{border-top:1px solid var(--color-title-bg)}.nav-buttons.jsx-cc6a7af1630b729f .nav-button.active{background-color:var(--color-title-bg)}@media(hover:hover){.nav-buttons.jsx-cc6a7af1630b729f .nav-button:hover:not(.active){background-color:var(--color-title-bg-lighter)}}@media screen and (max-width:").concat(x.UI.narrowBreak,"px){.add-layer.jsx-cc6a7af1630b729f .wk-button,.nav-buttons.jsx-cc6a7af1630b729f .nav-button{padding:").concat(6,"px ").concat(6,"px}}@media screen and (max-width:").concat(x.UI.mobileBreak,"px){.nav-buttons.jsx-cc6a7af1630b729f{display:grid;grid-template-columns:repeat(4,1fr);margin-bottom:var(--modal-padding)}.nav-buttons.jsx-cc6a7af1630b729f .nav-button{text-align:center}.nav-buttons.jsx-cc6a7af1630b729f .nav-button+.nav-button{border-top:none;border-left:1px solid var(--color-title-bg)}}.nav-button-icon.jsx-cc6a7af1630b729f{position:relative;margin-left:").concat(-4,"px;margin-right:").concat(8,"px;color:var(--color-dim)}@media screen and (max-width:").concat(x.UI.narrowBreak,"px){.nav-button-icon.jsx-cc6a7af1630b729f{display:none}}"));T.__hash="cc6a7af1630b729f";let L=new String(".extras.jsx-9526491a1ecb4882{display:none}@media screen and (min-width:".concat(x.UI.mobileBreak+1,"px){.extras.jsx-9526491a1ecb4882{display:block}}.extra.jsx-9526491a1ecb4882{border-left:1px solid var(--color-title-bg);border-right:1px solid var(--color-title-bg);border-bottom:1px solid var(--color-title-bg);background-color:white;padding-bottom:2px}.extra-title.jsx-9526491a1ecb4882{color:var(--color-dim);letter-spacing:1.3px;font-size:.8rem;padding:11px 11px 0;margin-bottom:5px}@media screen and (max-width:").concat(x.UI.narrowBreak,"px){.extra-title.jsx-9526491a1ecb4882{padding:6px 6px 0}}.cm-extra-row{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;padding:0 ").concat(14,"px;margin:").concat(9,"px 0;border:1px solid transparent;color:inherit}.extra-row-icon.jsx-9526491a1ecb4882{margin-left:").concat(-4,"px;margin-right:").concat(8,"px;color:var(--color-dim)}@media screen and (max-width:").concat(x.UI.narrowBreak,"px){.cm-extra-row{padding:0 ").concat(6,"px}.extra-row-icon.jsx-9526491a1ecb4882{display:none}}@media(hover:hover){.cm-extra-row:hover{color:var(--color-dim)}}.cm-doi{word-break:break-all}"));L.__hash="9526491a1ecb4882";let E=e=>{let t=(0,A.A)(),a=()=>{let{dataset:a,shortNotifs:n}=e,{isExternal:r}=a,o=M(n);return(0,i.jsxs)("div",{"data-sentry-component":"renderNavButtons","data-sentry-source-file":"210-DatasetSidebar.tsx",className:"jsx-".concat(T.__hash)+" nav-buttons",children:[s({view:"dataset",route:"description",label:t.$t({id:"datasetSidebar.description",defaultMessage:"Description"}),icon:"info"}),!r&&"CMEMS"===a.catalogue&&!x.APP_CONFIG.noCatalogueNotifs&&s({view:"datasetStatus",route:"notifications",label:t.$t({id:"datasetSidebar.notifications",defaultMessage:"Notifications"}),icon:"bell",iconFamily:"far",hint:!!o}),!r&&"CMEMS"===a.catalogue&&!x.APP_CONFIG.noCatalogueServices&&s({view:"datasetServices",route:"services",label:t.$t({id:"datasetSidebar.dataAccess",defaultMessage:"Data access"}),icon:"download"}),s({view:"datasetContacts",route:"contacts",label:t.$t({id:"datasetSidebar.contact",defaultMessage:"Contact"}),icon:"envelope",iconFamily:"far"}),(0,i.jsx)(l(),{id:T.__hash,children:T})]})},s=t=>{let{view:a,route:s,label:n,hint:r}=t,{view:o,narrow:c,standalone:d,dataset:h}=e,m=h.id;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(N.A,{className:u()("nav-button",{active:o===a}),href:d?"/product/".concat(m,"/").concat(s):"".concat(x.URLS.viewer,"?view=").concat(a,"&dataset=").concat(m),replace:!d,"data-sentry-element":"AppLink","data-sentry-source-file":"210-DatasetSidebar.tsx",children:[(0,i.jsxs)("span",{className:"jsx-".concat(T.__hash)+" nav-button-icon",children:[(0,i.jsx)(p.Icon,{icon:t.icon,family:t.iconFamily,fixedWidth:!0,"data-sentry-element":"Icon","data-sentry-source-file":"210-DatasetSidebar.tsx"}),!c&&r&&(0,i.jsx)(C.A,{ids:[],top:-1,right:-3})]}),n]}),(0,i.jsx)(l(),{id:T.__hash,children:T})]})},n=()=>{let{dataset:a,narrow:s}=e,n=(0,m.mh)(a,t),{doi:r}=a,o=(s?t.$t({id:"datasetSidebar.docsNarrow",defaultMessage:"Docs"}):t.$t({id:"datasetSidebar.docsWide",defaultMessage:"Documentation"})).toUpperCase();return(0,i.jsxs)("section",{"data-sentry-component":"renderExtras","data-sentry-source-file":"210-DatasetSidebar.tsx",className:"jsx-".concat(L.__hash)+" extras",children:[!a.isExternal&&"CMEMS"===a.catalogue&&n.length>0&&(0,i.jsxs)("div",{className:"jsx-".concat(L.__hash)+" extra",children:[(0,i.jsx)("div",{className:"jsx-".concat(L.__hash)+" extra-title",children:o}),n.map(e=>{let{icon:t,family:a}=(0,m.mz)(e);if(!e.url)return null;let{url:s}=e;return s=s.replace(/^http:\/\/marine.copernicus.eu/,"https://documentation.marine.copernicus.eu"),(0,i.jsxs)(N.A,{className:"cm-extra-row",href:s,openInNewTab:!0,title:e.ref,children:[(0,i.jsx)("span",{className:"jsx-".concat(L.__hash)+" extra-row-icon",children:(0,i.jsx)(p.Icon,{icon:t,family:a,fixedWidth:!0})}),e.title]},s)})]}),r&&(0,i.jsxs)("div",{className:"jsx-".concat(L.__hash)+" extra",children:[(0,i.jsx)("div",{className:"jsx-".concat(L.__hash)+" extra-title",children:"DOI"}),(0,i.jsxs)(N.A,{className:"cm-extra-row cm-doi",href:"https://doi.org/".concat(r),openInNewTab:!0,children:[(0,i.jsx)("span",{className:"jsx-".concat(L.__hash)+" extra-row-icon",children:(0,i.jsx)(p.Icon,{icon:"id-card",family:"far",fixedWidth:!0})}),r]})]}),(0,i.jsx)(l(),{id:L.__hash,children:L})]})};return(()=>{var t;let{dataset:s,standalone:r}=e,o=Object.keys(null!==(t=null==s?void 0:s.layers)&&void 0!==t?t:{}).length;return(0,i.jsxs)("div",{"data-sentry-component":"render","data-sentry-source-file":"210-DatasetSidebar.tsx",className:"jsx-".concat(T.__hash)+" "+(u()("sidebar",{standalone:r})||""),children:[!r&&(0,i.jsx)(D.A,{dataset:s,large:!0}),!r&&(0,m.nv)(s)&&(0,i.jsx)("div",{className:"jsx-".concat(T.__hash)+" add-layer",children:(0,i.jsx)(N.A,{className:"wk-button primary",href:"".concat(x.URLS.viewer,"?view=layers&dataset=").concat(s.id),children:(0,i.jsx)(c.A,{id:"datasetSidebar.addToMap",defaultMessage:"{numLayers, plural, one {Add to map} other {Add to map…}}",values:{numLayers:o}})})}),a(),n(),(0,i.jsx)(l(),{id:T.__hash,children:T})]})})()};var O=a(35744),P=a(24626),z=a(22046),F=a.n(z),U=a(99420),R=a.n(U),B=a(89594);let V=e=>{let{dataset:t}=e;return(0,i.jsxs)(p.LargeMessage,{"data-sentry-element":"LargeMessage","data-sentry-component":"PageNotAvailableForExternalDataset","data-sentry-source-file":"915-PageNotAvailableForExternalDataset.tsx",children:["Page is not available for external datasets.",t.externalProviderUrl&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("br",{}),"Please visit the"," ",(0,i.jsx)("u",{children:(0,i.jsx)(N.A,{href:t.externalProviderUrl,openInNewTab:!0,children:"data provider."})})]})]})};class G extends r.Component{componentDidUpdate(e,t){let{openNotifId:a}=this.state;if(!a)return;let{notifs:s}=this.props;s[a]||this.props.fetchNotifDetails(a);let i=t.openNotifId;if(i&&a!==i){let e=this.getShownNotifs(),t=e.findIndex(e=>e.id===i),s=e.findIndex(e=>e.id===a);if(t>=0&&s>=0&&t<s){var n;null===(n=this.refActiveNotif.current)||void 0===n||n.scrollIntoView()}}}render(){let{dataset:e}=this.props;if(e.isExternal||"CMEMS"!==e.catalogue)return(0,i.jsx)(V,{dataset:e,"data-sentry-element":"PageNotAvailableForExternalDataset","data-sentry-component":"DatasetNotifs","data-sentry-source-file":"230-DatasetNotifs.tsx"});let t=this.getShownNotifs();return(0,i.jsxs)("div",{"data-sentry-component":"DatasetNotifs","data-sentry-source-file":"230-DatasetNotifs.tsx",className:"jsx-".concat($.__hash)+" dataset-notifs",children:[(0,i.jsx)("h3",{className:"jsx-".concat($.__hash)+" cm-section-title",children:(0,i.jsx)(c.A,{id:"datasetDetails.notifications",defaultMessage:"Notifications","data-sentry-element":"FormattedMessage","data-sentry-source-file":"230-DatasetNotifs.tsx"})}),this.renderFilters(),this.props.narrow?this.renderNotifsNarrow(t):this.renderNotifs(t),(0,i.jsx)(l(),{id:$.__hash,children:$})]})}renderFilters(){let{intl:e}=this.props;return(0,i.jsxs)("div",{className:"jsx-".concat(q.__hash)+" filters",children:[v.map(t=>{var a;return(0,i.jsx)("span",{className:"jsx-".concat(q.__hash)+" filter",children:(0,i.jsx)(p.Checkbox,{id:"filter-".concat(t),label:null===(a=_[t])||void 0===a?void 0:a.call(_,e),value:this.state.filterCategories[t],onChange:()=>this.onToggleCategory(t)})},t)}),(0,i.jsx)(l(),{id:q.__hash,children:q})]})}renderNotifs(e){let{intl:t}=this.props,{openNotifId:a}=this.state;return(0,i.jsxs)("div",{className:"jsx-".concat(Z.__hash)+" notifs-wrapper",children:[(0,i.jsxs)("div",{className:"jsx-".concat(Z.__hash)+" notifs",children:[(0,i.jsxs)("div",{className:"jsx-".concat(Z.__hash)+" notifs-header notifs-row",children:[(0,i.jsx)("div",{className:"jsx-".concat(Z.__hash)+" col col-date",children:(0,i.jsx)(c.A,{id:"datasetDetails.notifs.date",defaultMessage:"Date"})}),(0,i.jsx)("div",{className:"jsx-".concat(Z.__hash)+" col col-title",children:(0,i.jsx)(c.A,{id:"datasetDetails.notifs.title",defaultMessage:"Title"})}),(0,i.jsx)("div",{className:"jsx-".concat(Z.__hash)+" col col-category",children:(0,i.jsx)(c.A,{id:"datasetDetails.notifs.category",defaultMessage:"Category"})}),(0,i.jsx)("div",{className:"jsx-".concat(Z.__hash)+" col col-status",children:(0,i.jsx)(c.A,{id:"datasetDetails.notifs.status",defaultMessage:"Status"})})]}),e.map(e=>{var s,n;let l=e.id===a;return(0,i.jsxs)(r.Fragment,{children:[(0,i.jsxs)("div",{ref:l?this.refActiveNotif:null,onClick:()=>this.onClickNotif(e.id),className:"jsx-".concat(Z.__hash)+" "+(u()("notif notifs-row",{active:l})||""),children:[(0,i.jsx)("div",{className:"jsx-".concat(Z.__hash)+" col col-date",children:R()(e.date).format("DD/MM/YYYY")}),(0,i.jsx)("div",{className:"jsx-".concat(Z.__hash)+" col col-title",children:F().decode(e.title)}),(0,i.jsx)("div",{className:"jsx-".concat(Z.__hash)+" col col-category",children:null!==(n=null===(s=_[e.category])||void 0===s?void 0:s.call(_,t))&&void 0!==n?n:e.category}),(0,i.jsx)("div",{className:"jsx-".concat(Z.__hash)+" "+(u()("col col-status",k(e.status))||""),children:w(e.status,t)})]}),l&&(0,i.jsx)("div",{className:"jsx-".concat(Z.__hash)+" notif-details-outer",children:this.renderNotifDetails()})]},e.id)})]}),(0,i.jsx)(l(),{id:Z.__hash,children:Z})]})}renderNotifsNarrow(e){let{intl:t}=this.props,{openNotifId:a}=this.state;return(0,i.jsxs)("div",{className:"jsx-".concat(Y.__hash)+" notifs",children:[e.map(e=>{var s,n;let l=e.id===a;return(0,i.jsxs)(r.Fragment,{children:[(0,i.jsxs)("div",{ref:l?this.refActiveNotif:null,onClick:()=>this.onClickNotif(e.id),className:"jsx-".concat(Y.__hash)+" "+(u()("notif",{active:l})||""),children:[(0,i.jsxs)("div",{className:"jsx-".concat(Y.__hash)+" notif-item",children:[(0,i.jsx)("div",{className:"jsx-".concat(Y.__hash)+" notif-label",children:(0,i.jsx)(c.A,{id:"datasetDetails.notifs.title",defaultMessage:"Title"})}),(0,i.jsx)("div",{className:"jsx-".concat(Y.__hash)+" notif-value",children:F().decode(e.title)})]}),(0,i.jsxs)("div",{className:"jsx-".concat(Y.__hash)+" notif-item",children:[(0,i.jsx)("div",{className:"jsx-".concat(Y.__hash)+" notif-label",children:(0,i.jsx)(c.A,{id:"datasetDetails.notifs.date",defaultMessage:"Date"})}),(0,i.jsx)("div",{className:"jsx-".concat(Y.__hash)+" notif-value",children:R()(e.date).format("DD/MM/YYYY")})]}),(0,i.jsxs)("div",{className:"jsx-".concat(Y.__hash)+" notif-item",children:[(0,i.jsx)("div",{className:"jsx-".concat(Y.__hash)+" notif-label",children:(0,i.jsx)(c.A,{id:"datasetDetails.notifs.category",defaultMessage:"Category"})}),(0,i.jsx)("div",{className:"jsx-".concat(Y.__hash)+" notif-value",children:null!==(n=null===(s=_[e.category])||void 0===s?void 0:s.call(_,t))&&void 0!==n?n:e.category})]}),(0,i.jsxs)("div",{className:"jsx-".concat(Y.__hash)+" notif-item",children:[(0,i.jsx)("div",{className:"jsx-".concat(Y.__hash)+" notif-label",children:(0,i.jsx)(c.A,{id:"datasetDetails.notifs.status",defaultMessage:"Status"})}),(0,i.jsx)("div",{className:"jsx-".concat(Y.__hash)+" "+(u()("notif-value",k(e.status))||""),children:w(e.status,t)})]})]}),l&&this.renderNotifDetails()]},e.id)}),(0,i.jsx)(l(),{id:Y.__hash,children:Y})]})}renderNotifDetails(){let{openNotifId:e}=this.state;if(!e)return null;let t=this.props.notifs[e];return(0,f.p)(t)?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{dangerouslySetInnerHTML:{__html:t.body},className:"jsx-".concat(J.__hash)+" notif-details"}),(0,i.jsx)(l(),{id:J.__hash,children:J})]}):(0,i.jsxs)("div",{style:{textAlign:"center"},className:"jsx-".concat(J.__hash)+" notif-details",children:[(0,i.jsx)(S.A,{}),(0,i.jsx)(l(),{id:J.__hash,children:J})]})}onToggleCategory(e){let{filterCategories:t}=this.state;t=(0,P.set)(t,e,!t[e]),this.setState({filterCategories:t})}onClickNotif(e){let t=this.state.openNotifId!==e?e:null;(0,B.PJ)({category:"catalogue",action:"notifOpen"}),this.setState({openNotifId:t})}getShownNotifs(){let{filterCategories:e}=this.state,t=this.props.shortNotifs.slice();return Object.keys(e).length&&(t=t.filter(t=>e[t.category])),t.sort(H),t}constructor(...e){super(...e),this.state={filterCategories:{General:!1,Incidents:!0,Improvements:!0,Maintenance:!0},openNotifId:null},this.refActiveNotif=r.createRef()}}let W=["in progress","on going","scheduled","anomaly"],H=(e,t)=>{var a,s,i,n;let l=null!==(i=null===(a=e.status)||void 0===a?void 0:a.toLowerCase())&&void 0!==i?i:"",r=null!==(n=null===(s=t.status)||void 0===s?void 0:s.toLowerCase())&&void 0!==n?n:"",o=W.indexOf(l),c=W.indexOf(r),d=-1!==o,h=-1!==c;if(d&&!h)return -1;if(!d&&h)return 1;if(d&&h)return o-c;let u=e.date,p=t.date;return u===p?0:u<p?1:-1},$=new String("");$.__hash="b3e1b6a7c9b96113";let q=new String(".filter.jsx-cbd801f8f2ae74cc+.filter.jsx-cbd801f8f2ae74cc{margin-left:1.5em}@media screen and (max-width:".concat(x.UI.narrowBreak,"px){.filter.jsx-cbd801f8f2ae74cc{display:block}.filter.jsx-cbd801f8f2ae74cc+.filter.jsx-cbd801f8f2ae74cc{margin-left:0}}"));q.__hash="cbd801f8f2ae74cc";let Z=new String(".notifs-wrapper.jsx-62e62241e22689ed{overflow-x:auto}.notifs.jsx-62e62241e22689ed{margin-top:2em;border-bottom:1px solid var(--color-title-bg)}.notifs-header.jsx-62e62241e22689ed{border-top:1px solid var(--color-title-bg);border-bottom:1px solid var(--color-title-bg);font-weight:bold}.col.jsx-62e62241e22689ed+.col.jsx-62e62241e22689ed{margin-left:15px}.col-date.jsx-62e62241e22689ed{-webkit-box-flex:0;-webkit-flex:0 0 100px;-moz-box-flex:0;-ms-flex:0 0 100px;flex:0 0 100px}.col-category.jsx-62e62241e22689ed,.col-status.jsx-62e62241e22689ed{-webkit-box-flex:0;-webkit-flex:0 0 110px;-moz-box-flex:0;-ms-flex:0 0 110px;flex:0 0 110px}.col-title.jsx-62e62241e22689ed{-webkit-box-flex:1;-webkit-flex:1 0 0px;-moz-box-flex:1;-ms-flex:1 0 0px;flex:1 0 0px;word-break:break-word}.notifs-row.jsx-62e62241e22689ed{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;padding:8px 10px}th.jsx-62e62241e22689ed{border-top:1px solid var(--color-title-bg);border-bottom:1px solid var(--color-title-bg);text-align:left}.notif.jsx-62e62241e22689ed{cursor:pointer;background:white}.notif.jsx-62e62241e22689ed:hover:not(.active){background-color:var(--color-title-bg-lighter)}.notif.active.jsx-62e62241e22689ed{background-color:var(--color-title-bg)}.notif-details-outer.jsx-62e62241e22689ed{padding:0}.success.jsx-62e62241e22689ed{color:var(--color-notif-success-bg)}.warn.jsx-62e62241e22689ed{color:var(--color-notif-warn-bg)}.error.jsx-62e62241e22689ed{color:var(--color-notif-error-bg)}.improvement.jsx-62e62241e22689ed{color:var(--color-icon-button-active)}");Z.__hash="62e62241e22689ed";let Y=new String(".notifs.jsx-a68d9c2d46a34b76{margin-top:1.5em}.notif.jsx-a68d9c2d46a34b76:not(.active)+.notif.jsx-a68d9c2d46a34b76{border-top:1px solid var(--color-title-bg)}.notif.jsx-a68d9c2d46a34b76{padding:10px 0;cursor:pointer}.notif.jsx-a68d9c2d46a34b76:hover:not(.active){background-color:var(--color-title-bg-lighter)}.notif.active.jsx-a68d9c2d46a34b76{background-color:var(--color-title-bg)}.notif-item.jsx-a68d9c2d46a34b76{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;margin-top:2px;padding:0 10px}.notif-label.jsx-a68d9c2d46a34b76{-webkit-box-flex:0;-webkit-flex:0 0 85px;-moz-box-flex:0;-ms-flex:0 0 85px;flex:0 0 85px;font-weight:bold}.notif-value.jsx-a68d9c2d46a34b76{word-break:break-word}.success.jsx-a68d9c2d46a34b76{color:var(--color-notif-success-bg)}.warn.jsx-a68d9c2d46a34b76{color:var(--color-notif-warn-bg)}.error.jsx-a68d9c2d46a34b76{color:var(--color-notif-error-bg)}.improvement.jsx-a68d9c2d46a34b76{color:var(--color-icon-button-active)}");Y.__hash="a68d9c2d46a34b76";let J=new String(".notif-details.jsx-24fd79c527ad9b95{padding:10px 20px 10px 20px;border-left:10px solid var(--color-title-bg);border-right:10px solid var(--color-title-bg);border-bottom:10px solid var(--color-title-bg);word-break:break-word;background-color:white}");J.__hash="24fd79c527ad9b95";let K=(0,o.Ng)((e,t)=>({dataset:(0,g.vh)(e,t.datasetId),notifs:(0,g.io)(e)}),j)((0,d.Ay)(G));var Q=a(51893),X=a(77118),ee=a(30520),et=a(64725),ea=a(68476);class es extends r.Component{render(){let{dataset:e}=this.props;if(e.isExternal||"CMEMS"!==e.catalogue)return(0,i.jsx)(V,{dataset:e,"data-sentry-element":"PageNotAvailableForExternalDataset","data-sentry-component":"DatasetServices","data-sentry-source-file":"240-DatasetServices.tsx"});let t=ei(e);return(0,i.jsxs)("div",{"data-sentry-component":"DatasetServices","data-sentry-source-file":"240-DatasetServices.tsx",className:"jsx-".concat(el.__hash)+" dataset-services",children:[this.renderServices(t),this.renderMetadata(),this.renderStacLinks(t),(0,i.jsx)(l(),{id:el.__hash,children:el})]})}renderServices(e){if(!e.length)return null;let{standalone:t,settings:a,intl:s}=this.props,n=t?(0,i.jsx)(c.A,{id:"datasetDetails.dataAccess.graphicalStandalone",defaultMessage:"If you prefer a graphical tool, click on the top-right button: {icon}.",values:{icon:(0,i.jsx)(p.Icon,{icon:"download"},"icon")}}):(0,i.jsx)(c.A,{id:"datasetDetails.dataAccess.graphicalEmbedded",defaultMessage:"If you prefer a graphical tool, add a product layer  to the map and click on {icon} below the layer’s legend.",values:{icon:(0,i.jsx)(p.Icon,{icon:"download"},"icon")}});return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h3",{className:"jsx-".concat(ec.__hash)+" cm-section-title",children:(0,i.jsx)(c.A,{id:"datasetDetails.dataAccess.title",defaultMessage:"Data access and mapping services"})}),(0,i.jsxs)("p",{className:"jsx-".concat(ec.__hash),children:[(0,i.jsx)(c.A,{id:"datasetDetails.dataAccess.multipleWays",defaultMessage:"There are multiple ways to download data from this product"}),":"]}),(0,i.jsxs)("ul",{className:"jsx-".concat(ec.__hash),children:[(0,i.jsx)("li",{className:"jsx-".concat(ec.__hash),children:n}),(0,i.jsx)("li",{className:"jsx-".concat(ec.__hash),children:(0,i.jsx)(c.A,{id:"datasetDetails.dataAccess.subsetDescription",defaultMessage:"<b>Subset</b>: The most intuitive graphical approach for subsetting data in time, space and/or variables. For a programming approach  (<i>WCS-like</i>), prefer the Copernicus Marine Toolbox: {cli} or {api}.",values:{b:e=>(0,i.jsx)("b",{className:"jsx-".concat(ec.__hash),children:e},String(e)),i:e=>(0,i.jsx)("i",{className:"jsx-".concat(ec.__hash),children:e},String(e)),cli:(0,i.jsx)("a",{href:"https://help.marine.copernicus.eu/en/articles/7972861-copernicus-marine-toolbox-cli-subset",target:"_blank",rel:"noreferrer",className:"jsx-".concat(ec.__hash),children:"CLI"},"cli"),api:(0,i.jsx)("a",{href:"https://help.marine.copernicus.eu/en/articles/8283072-copernicus-marine-toolbox-api-subset",target:"_blank",rel:"noreferrer",className:"jsx-".concat(ec.__hash),children:"Python API"},"api")}})}),(0,i.jsx)("li",{className:"jsx-".concat(ec.__hash),children:(0,i.jsx)(c.A,{id:"datasetDetails.dataAccess.filesDescription",defaultMessage:"<b>Files</b>: The fastest graphical approach to get original files (<i>FTP-like</i>). For a programming approach, prefer the Copernicus Marine Toolbox: {cli} or {api}.",values:{b:e=>(0,i.jsx)("b",{className:"jsx-".concat(ec.__hash),children:e},String(e)),i:e=>(0,i.jsx)("i",{className:"jsx-".concat(ec.__hash),children:e},String(e)),cli:(0,i.jsx)("a",{href:"https://help.marine.copernicus.eu/en/articles/7983226-copernicus-marine-toolbox-cli-get-original-files",target:"_blank",rel:"noreferrer",className:"jsx-".concat(ec.__hash),children:"CLI"},"cli"),api:(0,i.jsx)("a",{href:"https://help.marine.copernicus.eu/en/articles/8286883-copernicus-marine-toolbox-api-get-original-files",target:"_blank",rel:"noreferrer",className:"jsx-".concat(ec.__hash),children:"Python API"},"api")}})}),(0,i.jsx)("li",{className:"jsx-".concat(ec.__hash),children:(0,i.jsx)(c.A,{id:"datasetDetails.dataAccess.mapsDescription",defaultMessage:"<b>Maps</b>: The standard mapping service for GIS approach ({qgis} or similar tools).",values:{b:e=>(0,i.jsx)("b",{className:"jsx-".concat(ec.__hash),children:e},String(e)),qgis:(0,i.jsx)("a",{href:"https://help.marine.copernicus.eu/en/articles/6492453-how-to-open-and-visualize-copernicus-marine-data-in-qgis",target:"_blank",rel:"noreferrer",className:"jsx-".concat(ec.__hash),children:"QGIS"},"qgis")}})}),(0,i.jsx)("li",{className:"jsx-".concat(ec.__hash),children:(0,i.jsx)(c.A,{id:"datasetDetails.dataAccess.lazy",defaultMessage:"If you are looking for a lazy-loading data access (<i>xarray/OPeNDAP-like</i>), copy the dataset ID and use it with the Copernicus Marine Toolbox: {api}.",values:{i:e=>(0,i.jsx)("i",{className:"jsx-".concat(ec.__hash),children:e},String(e)),api:(0,i.jsx)("a",{href:"https://help.marine.copernicus.eu/en/articles/8287609-copernicus-marine-toolbox-api-open-a-dataset-or-read-a-dataframe-remotely",target:"_blank",rel:"noreferrer",className:"jsx-".concat(ec.__hash),children:"Python API"},"api")}})})]}),(0,i.jsx)("div",{className:"jsx-".concat(ec.__hash)+" services-wrapper",children:(0,i.jsxs)("div",{className:"jsx-".concat(ec.__hash)+" services-download",children:[(0,i.jsxs)("div",{className:"jsx-".concat(ec.__hash)+" service-row service-row-header",children:[(0,i.jsxs)("div",{className:"jsx-".concat(ec.__hash)+" col col-dataset-title",children:[(0,i.jsx)(c.A,{id:"datasetDetails.dataAccess.dataset",defaultMessage:"Dataset"}),"\xa0\xa0",!a.hideSubdatasetIds&&(0,i.jsx)("a",{href:"https://help.marine.copernicus.eu/en/articles/6820094-how-is-defined-the-nomenclature-of-copernicus-marine-data#h_34a5a6f21d",target:"_blank",rel:"noreferrer",className:"jsx-".concat(ec.__hash),children:(0,i.jsx)(p.Icon,{icon:"info-circle"})})]}),(0,i.jsx)("div",{className:"jsx-".concat(ec.__hash)+" col col-temp-extent",children:(0,i.jsx)(c.A,{id:"datasetDetails.temporalExtent",defaultMessage:"Temporal extent"})}),(0,i.jsxs)("div",{className:"jsx-".concat(ec.__hash)+" col col-subset",children:[(0,i.jsx)(c.A,{id:"datasetDetails.dataAccess.subset",defaultMessage:"Subset"}),(0,i.jsx)("br",{className:"jsx-".concat(ec.__hash)}),(0,i.jsx)("a",{href:"https://help.marine.copernicus.eu/en/articles/8078281-how-to-download-copernicus-marine-products-using-our-graphical-user-interfaces#h_a270cbfc6d",target:"_blank",rel:"noreferrer",title:s.$t({id:"datasetDetails.dataAccess.subsetHint",defaultMessage:"A data extraction service that allows to remotely subset a dataset over variables and coordinates (time, latitude, longitude) and download the result as a file. Click to know more."}),className:"jsx-".concat(ec.__hash),children:(0,i.jsx)(p.Icon,{icon:"info-circle"})})]}),(0,i.jsxs)("div",{className:"jsx-".concat(ec.__hash)+" col col-files",children:[(0,i.jsx)(c.A,{id:"datasetDetails.dataAccess.files",defaultMessage:"Files"}),(0,i.jsx)("br",{className:"jsx-".concat(ec.__hash)}),(0,i.jsx)("a",{href:"https://help.marine.copernicus.eu/en/articles/8006209-what-are-the-advantages-of-the-file-browser-data-access-service",target:"_blank",rel:"noreferrer",title:s.$t({id:"datasetDetails.dataAccess.filesHint",defaultMessage:"Download service that allows to access the original version of the files constituting the dataset. Click to know more."}),className:"jsx-".concat(ec.__hash),children:(0,i.jsx)(p.Icon,{icon:"info-circle"})})]}),(0,i.jsxs)("div",{className:"jsx-".concat(ec.__hash)+" col col-maps",children:[(0,i.jsx)(c.A,{id:"datasetDetails.dataAccess.maps",defaultMessage:"Maps"}),(0,i.jsx)("br",{className:"jsx-".concat(ec.__hash)}),(0,i.jsx)("a",{href:"https://help.marine.copernicus.eu/en/articles/6478168-how-to-use-wms-to-visualize-data",target:"_blank",rel:"noreferrer",title:s.$t({id:"datasetDetails.dataAccess.mapsHint",defaultMessage:"Georeferenced map tiles rendered on the fly and served through the OGC WMTS standard. Click to know more."}),className:"jsx-".concat(ec.__hash),children:(0,i.jsx)(p.Icon,{icon:"info-circle"})})]})]}),e.map(e=>this.renderService(e))]})}),(0,i.jsx)(l(),{id:ec.__hash,children:ec})]})}renderSubdatasetId(e){let{subdatasetId:t}=e,a=(0,Q.getTaglessSubdatasetId)(t),s=(0,Q.getSubdatasetIdExtension)(t);return(0,i.jsxs)(i.Fragment,{children:[a,s&&(0,i.jsx)("span",{className:"jsx-".concat(ec.__hash)+" title-extension",children:s}),(0,i.jsx)(l(),{id:ec.__hash,children:ec})]})}renderServiceTitle(e){let{intl:t,dataset:a}=this.props,{subdatasetId:s,title:n,originalTitle:r}=e,o=(0,Q.getTaglessSubdatasetId)(s),c=a.stacItems[s],d=(0,i.jsxs)(i.Fragment,{children:[c&&(0,i.jsxs)(i.Fragment,{children:["\xa0\xa0",(0,i.jsx)(ea.A,{stacItem:c})]}),this.renderCopy({copy:o,title:t.$t({id:"datasetDetails.dataAccess.copiedDatasetId",defaultMessage:"Copied dataset ID to your clipboard"}),isDataset:!0})]});return(0,i.jsxs)("div",{className:"jsx-".concat(ec.__hash)+" col col-dataset-title",children:[n?(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{className:"jsx-".concat(ec.__hash),children:[(0,i.jsx)(et.A,{title:n,originalTitle:r}),d]})}):(0,i.jsxs)(i.Fragment,{children:[this.renderSubdatasetId(e),d]}),(0,i.jsx)(l(),{id:ec.__hash,children:ec})]})}renderTempExtent(e){let{intl:t,dataset:a}=this.props,s=a.stacItems[e.subdatasetId],n=(0,m.iJ)(t,s,{format:"DD/MM/YYYY",short:!0});return(0,i.jsxs)("div",{className:"jsx-".concat(ec.__hash)+" col col-temp-extent",children:[n?(0,i.jsx)(i.Fragment,{children:n}):"—",(0,i.jsx)(l(),{id:ec.__hash,children:ec})]})}renderSubset(e){let{datasetId:t,dataset:a}=this.props,{subdatasetId:s}=e,n=a.stacItems[s],r=e.arco&&!(0,m.o7)(a)&&!(null==n?void 0:n.properties.admp_in_preparation);return(0,i.jsxs)("div",{className:"jsx-".concat(ec.__hash)+" col col-subset",children:[r?(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(N.A,{href:"/product/".concat(t,"/download?dataset=").concat(s),children:(0,i.jsx)(c.A,{id:"datasetDetails.dataAccess.form",defaultMessage:"Form"})})}):"—",(0,i.jsx)(l(),{id:ec.__hash,children:ec})]})}renderFiles(e){let{intl:t,datasetId:a,standalone:s}=this.props,{subdatasetId:n}=e,{native:r}=e,o="/product/".concat(a,"/files?subdataset=").concat(n),d="".concat("https://data.marine.copernicus.eu").concat(o);return(0,i.jsxs)("div",{className:"jsx-".concat(ec.__hash)+" col col-files",children:[r&&(0,i.jsxs)("div",{className:"jsx-".concat(ec.__hash),children:[(0,i.jsx)(N.A,{href:s?o:"/viewer/expert?view=files&dataset=".concat(a,"&subdataset=").concat(n),children:(0,i.jsx)(c.A,{id:"datasetDetails.dataAccess.browse",defaultMessage:"Browse"})}),this.renderCopy({copy:d,title:t.$t({id:"datasetDetails.dataAccess.copiedFileBrowserUrl",defaultMessage:"Copied File Browser URL to your clipboard"})})]}),!r&&"—",(0,i.jsx)(l(),{id:ec.__hash,children:ec})]})}renderMaps(e){let{intl:t,datasetId:a}=this.props,{subdatasetId:s}=e,n=en(this.props.dataset.stacItems[s])?"".concat("https://wmts.marine.copernicus.eu/teroWmts","/").concat(a,"/").concat(s,"?request=GetCapabilities&service=WMS"):null;return(0,i.jsxs)("div",{className:"jsx-".concat(ec.__hash)+" col col-maps",children:[n?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",className:"jsx-".concat(ec.__hash),children:"WMTS"}),this.renderCopy({copy:n,title:t.$t({id:"datasetDetails.dataAccess.copiedWmtsUrl",defaultMessage:"Copied WMTS URL to your clipboard"}),msg:t.$t({id:"datasetDetails.dataAccess.wmtsUseful",defaultMessage:"You can use it with most mapping and GIS tools"})})]}):"—",(0,i.jsx)(l(),{id:ec.__hash,children:ec})]})}renderMetadata(){return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h3",{className:"jsx-".concat(er.__hash)+" cm-section-title",children:(0,i.jsx)(c.A,{id:"datasetDetails.metadataAccess.title",defaultMessage:"Metadata"})}),(0,i.jsxs)("p",{className:"jsx-".concat(er.__hash),children:[(0,i.jsx)(c.A,{id:"datasetDetails.metadataAccess.hint",defaultMessage:"Click here to fetch the most up-to-date raw metadata for this product from the {csw} service",values:{csw:(0,i.jsx)("a",{href:"https://help.marine.copernicus.eu/en/articles/6643157-how-to-access-to-metadata-using-the-catologue-service-on-the-web-csw",target:"_blank",rel:"noreferrer",className:"jsx-".concat(er.__hash),children:(0,i.jsx)(c.A,{id:"datasetDetails.metadataAccess.csw",defaultMessage:"Catalogue Service for the Web (CSW)"})},"csw")}}),":"]}),(0,i.jsx)("div",{className:"jsx-".concat(er.__hash)+" download-meta",children:(0,i.jsx)("span",{onClick:this.onClickDownloadMeta,className:"jsx-".concat(er.__hash)+" wk-button",children:(0,i.jsx)(c.A,{id:"datasetDetails.metadataAccess.downloadButton",defaultMessage:"Download metadata"})})}),(0,i.jsx)(l(),{id:er.__hash,children:er})]})}renderStacLinks(e){}renderCopy(e){let{copy:t,title:a,msg:s,isDataset:n}=e;return(0,i.jsxs)("span",{className:"jsx-".concat(ec.__hash)+" "+(u()("wk-link btn-copy",{"is-dataset":n})||""),children:[(0,i.jsx)(p.Icon,{icon:"copy",family:"far",onClick:async()=>{await navigator.clipboard.writeText(t),(0,p.notify)({type:"success",title:a,msg:s,icon:"copy",iconFamily:"far",timeOut:1e4})}}),(0,i.jsx)(l(),{id:ec.__hash,children:ec})]})}constructor(...e){super(...e),this.renderService=e=>{let{hideSubdatasetIds:t}=this.props.settings;return(0,i.jsxs)(r.Fragment,{children:[(0,i.jsxs)("div",{className:"jsx-".concat(ec.__hash)+" service-row service-row-body",children:[this.renderServiceTitle(e),this.renderTempExtent(e),this.renderSubset(e),this.renderFiles(e),this.renderMaps(e)]}),!t&&e.title&&(0,i.jsx)("div",{className:"jsx-".concat(ec.__hash)+" subtitle",children:this.renderSubdatasetId(e)}),(0,i.jsx)(l(),{id:ec.__hash,children:ec})]},e.subdatasetId)},this.onClickDownloadMeta=async()=>{let{dataset:e}=this.props,t=await fetch("".concat("https://data-be-prd.marine.copernicus.eu","/api/metadata/").concat(e.id)),a=await t.blob();(0,ee.WN)(a,"".concat(e.id,".xml"))}}}let ei=e=>{let t=[];if(!e)return t;let{subdatasetTitleTranslations:a}=e,{stacItems:s}=e;return s&&(Object.keys(s).forEach(e=>{var i,n;let l=s[e],r=t.find(t=>t.subdatasetId===e);if(!r){let s=l.properties.admp_title;r={subdatasetId:e,title:null!==(n=null==a?void 0:a[s])&&void 0!==n?n:s,originalTitle:s},t.push(r)}let o=null===(i=l.assets.native)||void 0===i?void 0:i.href;o&&(r.native=o);let c=(0,m.jk)(l.assets).find(e=>e.type===x.ZARR_MIME),d=(0,m.jk)(l.assets).find(e=>e.type===x.SQLITE_MIME);r.arco=null!=c||null!=d}),t.sort((e,t)=>(0,X.UT)(e.originalTitle||e.subdatasetId,t.originalTitle||t.subdatasetId))),t},en=e=>{var t;if(null==e||e.properties.admp_in_preparation)return!1;let a=null!==(t=e.assets)&&void 0!==t?t:{};if(!a.wmts)return!1;let s=Object.values(a),i=s.find(e=>{var t;return null===(t=e.type)||void 0===t?void 0:t.includes("zarr")}),n=s.find(e=>{var t;return null===(t=e.type)||void 0===t?void 0:t.includes("vnd.sqlite3")});if(!i&&!n)return!1;let l=Object.keys(e.properties["cube:dimensions"]);return!!["latitude","longitude"].every(e=>l.includes(e))},el=new String("");el.__hash="b3e1b6a7c9b96113";let er=new String(".download-meta.jsx-d6a695c6fba0f1a4{text-align:center}");er.__hash="d6a695c6fba0f1a4";let eo="0.5em",ec=new String(".services-wrapper.jsx-740a7f33ef2c329d{overflow-x:auto;margin-top:1.5em}.services-download.jsx-740a7f33ef2c329d{min-width:100%;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;margin-top:10px;border-bottom:1px solid var(--color-title-bg);--table-min-width:220px}@media screen and (max-width:".concat(x.UI.narrowBreak,'px){.services-download.jsx-740a7f33ef2c329d{--table-min-width:170px}}.service-row.jsx-740a7f33ef2c329d{display:grid;gap:10px;padding:.5em 0;grid-template-columns:minmax(var(--table-min-width),1fr)190px 80px 90px 80px}.service-row-header.jsx-740a7f33ef2c329d{border-top:1px solid var(--color-title-bg);border-bottom:1px solid var(--color-title-bg);font-weight:bold}.col-dataset-title.jsx-740a7f33ef2c329d{word-break:break-all}.col.jsx-740a7f33ef2c329d:not(.col-dataset-title):not(.col-temp-extent){text-align:center}.title-main.jsx-740a7f33ef2c329d{margin-right:.6em}.title-extension.jsx-740a7f33ef2c329d{font-style:italic;margin-left:.3em;margin-right:.6em;word-break:break-word}.title-extension.jsx-740a7f33ef2c329d::before{content:"—";margin-right:.3em}.subtitle.jsx-740a7f33ef2c329d{font-size:.75em;color:var(--color-dim);margin-top:-').concat(eo,";margin-bottom:").concat(eo,"}.btn-copy.jsx-740a7f33ef2c329d{display:none;margin-left:.4em}.btn-copy.is-dataset.jsx-740a7f33ef2c329d{display:inline-block;opacity:0;margin-left:0}@media(hover:hover){.service-row.jsx-740a7f33ef2c329d:hover .btn-copy.jsx-740a7f33ef2c329d{display:inline-block;opacity:1}}@media screen and (max-width:").concat(x.UI.narrowBreak,"px){.services.jsx-740a7f33ef2c329d{font-size:.8rem}}.highlighted-service.jsx-740a7f33ef2c329d{border:1px solid black;-webkit-border-radius:16px;-moz-border-radius:16px;border-radius:16px;padding:0 .5em;margin:0 .1em;font-weight:bold}.info.jsx-740a7f33ef2c329d .wk-icon-button{color:var(--color-dim)}.info.jsx-740a7f33ef2c329d .wk-icon-button:hover{color:black}"));ec.__hash="740a7f33ef2c329d";let ed=(0,o.Ng)((e,t)=>({dataset:(0,g.vh)(e,t.datasetId),settings:(0,g.mt)(e)}),j)((0,d.Ay)(es)),eh=new String('.subvalue.jsx-84f7dc98f05cf014+.subvalue.jsx-84f7dc98f05cf014{margin-left:.4em}.subvalue.jsx-84f7dc98f05cf014+.subvalue.jsx-84f7dc98f05cf014::before{content:"\xb7";color:gray;padding-right:.4em}');eh.__hash="84f7dc98f05cf014";let eu=e=>{let t=(0,o.wA)(),a=(0,o.d4)(t=>(0,g.vh)(t,e.datasetId)),s=()=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("p",{className:"jsx-".concat(eh.__hash),children:[" ",(0,i.jsx)(c.A,{id:"datasetDetails.contactQuestion",defaultMessage:"Do you have a question about this product?","data-sentry-element":"FormattedMessage","data-sentry-source-file":"250-DatasetContacts.tsx"})]}),(0,i.jsxs)("div",{className:"jsx-".concat(eh.__hash)+" cm-tabular-item",children:[(0,i.jsx)("div",{className:"jsx-".concat(eh.__hash)+" label",children:(0,i.jsx)(c.A,{id:"datasetDetails.contactChat",defaultMessage:"Chat","data-sentry-element":"FormattedMessage","data-sentry-source-file":"250-DatasetContacts.tsx"})}),(0,i.jsx)("div",{className:"jsx-".concat(eh.__hash)+" value",children:(0,i.jsxs)("div",{onClick:()=>{t((0,j.chatbotToggle)())},className:"jsx-".concat(eh.__hash)+" subvalue wk-link",children:[(0,i.jsx)(p.Icon,{icon:"comments",family:"far",fixedWidth:!0,"data-sentry-element":"Icon","data-sentry-source-file":"250-DatasetContacts.tsx"}),(0,i.jsx)(c.A,{id:"datasetDetails.chatLatency",defaultMessage:"In a few minutes (during business hours)","data-sentry-element":"FormattedMessage","data-sentry-source-file":"250-DatasetContacts.tsx"})]})})]}),(0,i.jsx)(l(),{id:eh.__hash,children:eh})]});return(0,i.jsxs)("div",{"data-sentry-component":"render","data-sentry-source-file":"250-DatasetContacts.tsx",className:"jsx-".concat(eh.__hash)+" dataset-contacts",children:[(0,i.jsx)("h3",{className:"jsx-".concat(eh.__hash)+" cm-section-title",children:(0,i.jsx)(c.A,{id:"datasetDetails.contact",defaultMessage:"Contact","data-sentry-element":"FormattedMessage","data-sentry-source-file":"250-DatasetContacts.tsx"})}),a.isExternal||"CMEMS"!==a.catalogue?(()=>{let{contacts:e}=a;if(!e||!e.length)return x.APP_CONFIG.noChatbot?(0,i.jsx)("p",{children:(0,i.jsx)(c.A,{id:"datasetDetails.noContact",defaultMessage:"No contact is specified in the catalogue."})}):s();let t=e[0];return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("p",{className:"jsx-".concat(eh.__hash),children:(0,i.jsx)(c.A,{id:"datasetDetails.contactQuestion",defaultMessage:"Do you have a question about this product?","data-sentry-element":"FormattedMessage","data-sentry-source-file":"250-DatasetContacts.tsx"})}),(0,i.jsxs)("div",{className:"jsx-".concat(eh.__hash)+" cm-tabular-item",children:[(0,i.jsx)("div",{className:"jsx-".concat(eh.__hash)+" label",children:"Email"}),(0,i.jsx)("div",{className:"jsx-".concat(eh.__hash)+" value",children:(0,i.jsxs)("a",{href:"mailto:".concat(t.email),className:"jsx-".concat(eh.__hash)+" subvalue",children:[(0,i.jsx)(p.Icon,{icon:"envelope",family:"far",fixedWidth:!0,"data-sentry-element":"Icon","data-sentry-source-file":"250-DatasetContacts.tsx"}),t.name]})})]}),(0,i.jsx)(l(),{id:eh.__hash,children:eh})]})})():s(),(0,i.jsx)(l(),{id:eh.__hash,children:eh})]})};var ep=a(82549),ex=a(37168),em=a(31242),ef=a(38221),eb=a.n(ef),eg=a(88358),ej=a(62020),ev=a(63449),e_=a(78945),ey=a(77226),ew=a(20481),ek=a(19101),eM=a(49650),eN=a(62355),eS=a(18798),eI=a(58657),eA=a(7859),eC=a(94631);let eD={base:eI.tt.light.layer},eT=(e,t)=>{let a=(0,eS.getCrsSpec)(t),[,s,,i]=e,[n,,l]=e;a.shouldWrapHorizontally&&(n<-179&&(n=-1e8),l>179&&(l=1e8));let r=[[n,s],[l,s],[l,i],[n,i],[n,s]];return a.isCylindrical?r:(0,eS.preprocessFeature)({type:"Feature",geometry:{type:"Polygon",coordinates:[r]},properties:{crs:"epsg:4326",isUserDefined:!0}}).properties.interpolated.geometry.coordinates[0]},eL=e=>{let[t,a,s,i]=e;return t<=-180&&s>=180&&a<=-90&&i>=90},eE=new String(".bbox-picker.jsx-7183c47ad2476646{position:relative}");eE.__hash="7183c47ad2476646";let eO=new String(".map.jsx-3dbc91e3cb87164c{border:".concat(1,"px solid var(--color-title-bg)}"));eO.__hash="3dbc91e3cb87164c";let eP=new String(".tero-bbox-user-overlay{z-index:-1}svg.extent.global.jsx-3397564bddb46a59{background:var(--color-bbox-picker-domain)}path.extent.jsx-3397564bddb46a59{stroke:none;fill:var(--color-bbox-picker-domain)}");eP.__hash="3397564bddb46a59";let ez=new String(".controls.jsx-b8fb368e7c91e93c{position:absolute;bottom:20px;left:20px;border:1px solid var(--color-title-bg);background:white;-webkit-box-shadow:10px 10px 15px rgba(0,0,0,.1);-moz-box-shadow:10px 10px 15px rgba(0,0,0,.1);box-shadow:10px 10px 15px rgba(0,0,0,.1)}.bbox.jsx-b8fb368e7c91e93c{padding:20px}.bbox-buttons.jsx-b8fb368e7c91e93c{}.wk-button.active.jsx-b8fb368e7c91e93c{color:var(--color-icon-button-active)}.wk-button.jsx-b8fb368e7c91e93c+.wk-button.jsx-b8fb368e7c91e93c{margin-left:5px}.coords.jsx-b8fb368e7c91e93c{margin-top:10px;text-align:center}.coord.jsx-b8fb368e7c91e93c{padding:2px 0;display:inline-block}.coord-label.jsx-b8fb368e7c91e93c{display:inline-block;margin-right:.3em;min-width:1.4em}.giu-number-input.bbox-input{width:70px}.legend.jsx-b8fb368e7c91e93c{border-top:1px solid var(--color-title-bg);padding:20px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.swath.jsx-b8fb368e7c91e93c{width:30px;height:20px;background:var(--color-bbox-picker-domain);margin-right:.5em}@media screen and (max-width:600px){.controls.jsx-b8fb368e7c91e93c{bottom:0;left:0;font-size:.9rem;-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none}.bbox.jsx-b8fb368e7c91e93c,.legend.jsx-b8fb368e7c91e93c{padding:10px}}");ez.__hash="b8fb368e7c91e93c";let eF=e=>{let[t,a]=(0,r.useState)(!1),[s,n]=(0,r.useState)();(0,r.useEffect)(()=>{let{dataset:t,width:a,height:s}=e,{crs:i,center:l,zoom:r}=(0,eC.A)(t,a,s,{margin:30});n({crs:i,center:l,zoom:r})},[]);let o=(0,r.useRef)(null),d=(0,r.useRef)(null),h=(0,r.useRef)(null),m=(0,r.useRef)(null),f=(0,eA.QQ)(e.dataset),b=t=>{let{variableProjection:a}=t,{crs:n}=s;if(!f)return null;let r=eL(f),o=eT(f,n).map(a);return(0,i.jsxs)("svg",{width:e.width,height:e.height,"data-sentry-element":"svg","data-sentry-component":"renderExtent","data-sentry-source-file":"265-DownloadBboxPicker.tsx",className:"jsx-".concat(eP.__hash)+" "+(u()("extent",{global:r})||""),children:[!r&&(0,i.jsx)("path",{d:"M".concat(o.join("L")),className:"jsx-".concat(eP.__hash)+" extent"}),(0,i.jsx)(l(),{id:eP.__hash,children:eP})]})},g=t=>{var s,i,n,l;let[r,c,u,p]=t;e.setLonMin(r),e.setLatMin(c),e.setLonMax(u),e.setLatMax(p),null===(s=o.current)||void 0===s||s.setValue(r),null===(i=h.current)||void 0===i||i.setValue(c),null===(n=d.current)||void 0===n||n.setValue(u),null===(l=m.current)||void 0===l||l.setValue(p),a(!1)},j=()=>{var t,a,s,i;e.setLonMin(null),e.setLatMin(null),e.setLonMax(null),e.setLatMax(null),null===(t=o.current)||void 0===t||t.setValue(null),null===(a=h.current)||void 0===a||a.setValue(null),null===(s=d.current)||void 0===s||s.setValue(null),null===(i=m.current)||void 0===i||i.setValue(null)},v=()=>{var t,a,s,i;let n=null===(t=o.current)||void 0===t?void 0:t.getValue(),l=null===(a=d.current)||void 0===a?void 0:a.getValue();null!=n&&null!=l&&l<n&&(null===(s=o.current)||void 0===s||s.setValue(l),null===(i=d.current)||void 0===i||i.setValue(n),e.setLonMin(l),e.setLonMax(n))},_=()=>{var t,a,s,i;let n=null===(t=h.current)||void 0===t?void 0:t.getValue(),l=null===(a=m.current)||void 0===a?void 0:a.getValue();null!=n&&null!=l&&l<n&&(null===(s=h.current)||void 0===s||s.setValue(l),null===(i=m.current)||void 0===i||i.setValue(n),e.setLatMin(l),e.setLatMax(n))};return s?(0,i.jsxs)("div",{"data-sentry-component":"render","data-sentry-source-file":"265-DownloadBboxPicker.tsx",className:"jsx-".concat(eE.__hash)+" bbox-picker",children:[(()=>{let{crs:a,center:n,zoom:r}=s,{lonMin:o,lonMax:c,latMin:d,latMax:h}=e;return(0,i.jsxs)("div",{"data-sentry-component":"renderMap","data-sentry-source-file":"265-DownloadBboxPicker.tsx",className:"jsx-".concat(eO.__hash)+" map",children:[(0,i.jsx)(eN.BboxPicker,{active:t,crs:a,value:null!=o&&null!=c&&null!=d&&null!=h?[o,d,c,h]:null,onChange:g,width:e.width-2,height:e.height-2,center:n,zoom:r,layers:eD,zoomLimits:x.UI.zoomLimits,visibleExtentLimits:x.UI.visibleExtentLimits[a],"data-sentry-element":"BboxPicker","data-sentry-source-file":"265-DownloadBboxPicker.tsx",children:b}),(0,i.jsx)(l(),{id:eO.__hash,children:eO})]})})(),(()=>{let{lonMin:s,lonMax:n,latMin:r,latMax:x}=e;return(0,i.jsxs)("div",{"data-sentry-component":"renderControls","data-sentry-source-file":"265-DownloadBboxPicker.tsx",className:"jsx-".concat(ez.__hash)+" controls",children:[(0,i.jsxs)("div",{className:"jsx-".concat(ez.__hash)+" bbox",children:[(0,i.jsxs)("div",{className:"jsx-".concat(ez.__hash)+" bbox-buttons",children:[(0,i.jsx)("div",{onClick:()=>a(!t),className:"jsx-".concat(ez.__hash)+" "+(u()("wk-button small",{active:t})||""),children:(0,i.jsx)(c.A,{id:"bboxPicker.drawOnMapButton",defaultMessage:"Draw on map","data-sentry-element":"FormattedMessage","data-sentry-source-file":"265-DownloadBboxPicker.tsx"})}),(0,i.jsx)("div",{onClick:j,className:"jsx-".concat(ez.__hash)+" "+(u()("wk-button small",{disabled:!(null!=s||null!=n||null!=r||null!=x)})||""),children:(0,i.jsx)(c.A,{id:"bboxPicker.clearButton",defaultMessage:"Clear","data-sentry-element":"FormattedMessage","data-sentry-source-file":"265-DownloadBboxPicker.tsx"})})]}),(0,i.jsxs)("div",{className:"jsx-".concat(ez.__hash)+" coords",children:[(0,i.jsx)("div",{className:"jsx-".concat(ez.__hash),children:(0,i.jsxs)("span",{className:"jsx-".concat(ez.__hash)+" coord",children:[(0,i.jsx)("span",{className:"jsx-".concat(ez.__hash)+" coord-label",children:"N:"}),(0,i.jsx)(p.NumberInput,{ref:m,id:"latMax",className:"bbox-input",value:null,onChange:(t,a)=>e.setLatMax(a),onBlur:_,"data-sentry-element":"NumberInput","data-sentry-source-file":"265-DownloadBboxPicker.tsx"})]})}),(0,i.jsxs)("div",{className:"jsx-".concat(ez.__hash),children:[(0,i.jsxs)("span",{className:"jsx-".concat(ez.__hash)+" coord",children:[(0,i.jsx)("span",{className:"jsx-".concat(ez.__hash)+" coord-label",children:"W:"}),(0,i.jsx)(p.NumberInput,{ref:o,id:"lonMin",className:"bbox-input",value:null,onChange:(t,a)=>e.setLonMin(a),onBlur:v,"data-sentry-element":"NumberInput","data-sentry-source-file":"265-DownloadBboxPicker.tsx"})]}),(0,i.jsx)("span",{className:"jsx-".concat(ez.__hash)+" cm-spacer-md"}),(0,i.jsxs)("span",{className:"jsx-".concat(ez.__hash)+" coord",children:[(0,i.jsx)("span",{className:"jsx-".concat(ez.__hash)+" coord-label",children:"E:"}),(0,i.jsx)(p.NumberInput,{ref:d,id:"lonMax",className:"bbox-input",value:null,onChange:(t,a)=>e.setLonMax(a),onBlur:v,"data-sentry-element":"NumberInput","data-sentry-source-file":"265-DownloadBboxPicker.tsx"})]})]}),(0,i.jsx)("div",{className:"jsx-".concat(ez.__hash),children:(0,i.jsxs)("span",{className:"jsx-".concat(ez.__hash)+" coord",children:[(0,i.jsx)("span",{className:"jsx-".concat(ez.__hash)+" coord-label",children:"S:"}),(0,i.jsx)(p.NumberInput,{ref:h,id:"latMin",className:"bbox-input",value:null,onChange:(t,a)=>e.setLatMin(a),onBlur:_,"data-sentry-element":"NumberInput","data-sentry-source-file":"265-DownloadBboxPicker.tsx"})]})})]})]}),(0,i.jsxs)("div",{className:"jsx-".concat(ez.__hash)+" legend",children:[(0,i.jsx)("div",{className:"jsx-".concat(ez.__hash)+" swath"}),(0,i.jsx)("div",{className:"jsx-".concat(ez.__hash)+" legend-label",children:(0,i.jsx)(c.A,{id:"bboxPicker.availableData",defaultMessage:"Available data","data-sentry-element":"FormattedMessage","data-sentry-source-file":"265-DownloadBboxPicker.tsx"})})]}),(0,i.jsx)(l(),{id:ez.__hash,children:ez})]})})(),(0,i.jsx)(l(),{id:eE.__hash,children:eE})]}):null},eU=e=>{let t=(0,A.A)(),{dataset:a}=e,s=(0,o.wA)(),n=(0,em.useRouter)(),d=(0,o.d4)(g.TO),{layersWithArco:h}=e,f=eG(h,n.query.dataset),[b,v]=(0,r.useState)(f),_=(0,r.useRef)({}),[y,w]=(0,r.useState)(null),[k,M]=(0,r.useState)(null),[I,D]=(0,r.useState)(null),[T,L]=(0,r.useState)(null),[E,O]=(0,r.useState)(null),[P,z]=(0,r.useState)(null),[F,U]=(0,r.useState)(null),[B,V]=(0,r.useState)(null),[G,W]=(0,r.useState)([]),H=(0,r.useRef)(null),$=(0,r.useRef)(null),q=(0,r.useRef)(null),Z=(0,r.useRef)(null),Y={lonMin:y,lonMax:k,latMin:I,latMax:T,timeMin:E,timeMax:P,elevationMin:F,elevationMax:B},[J,K]=(0,r.useState)(!1),[ee,et]=(0,r.useState)(null),ea=(0,r.useRef)(0),[es,ei]=(0,r.useState)(null),[en,el]=(0,r.useState)(!1);(0,r.useEffect)(()=>{eL()},[b,y,k,I,T,E,P,F,B,G]);let[er,eo]=(0,r.useState)(!1);(0,r.useEffect)(()=>{eN(f,!0)},[]),(0,r.useEffect)(()=>{b.hasZarr&&(0,ev.Du)()},[b]);let[ec,ed]=(0,r.useState)(!1),eh=(0,r.useRef)(null),eu=(0,r.useRef)(null);(0,r.useEffect)(()=>(window.addEventListener("scroll",eS),()=>{window.removeEventListener("scroll",eS)}));let ef=()=>{let{bytesStr:e,tooSmall:s,tooLarge:n,tooLargeMsg:r}=(0,e_.IR)(b,es,t);return(0,i.jsxs)("div",{"data-sentry-component":"renderVolume","data-sentry-source-file":"260-DatasetDownload.tsx",className:"jsx-".concat(eZ.__hash)+" "+(u()("size-estimate",{"invalid-size":n||s})||""),children:[(0,i.jsx)("span",{className:"jsx-".concat(eZ.__hash)+" size-estimate-icon",children:en?(0,i.jsx)(S.A,{timeout:0,label:null==es?t.$t({id:"subset.calculatingSize",defaultMessage:"Calculating size…"}):void 0}):(0,i.jsx)(p.Icon,{icon:n?"exclamation-triangle":"weight-hanging"})}),null!=es&&(n?(0,i.jsxs)("span",{className:"jsx-".concat(eZ.__hash)+" size-estimate-error",children:[r,":",(0,i.jsx)("br",{className:"jsx-".concat(eZ.__hash)}),(0,i.jsx)(c.A,{id:"subset.reduceSize",defaultMessage:"Try reducing it or use {linkServices}",values:{linkServices:(0,i.jsx)(N.A,{href:"/product/".concat(a.id,"/services"),children:(0,i.jsx)(c.A,{id:"subset.otherDownloadServices",defaultMessage:"other download services"})},"linkServices")}})]}):(0,i.jsx)("span",{className:"jsx-".concat(eZ.__hash),children:e})),(0,i.jsx)(l(),{id:eZ.__hash,children:eZ})]})},ej=()=>(0,i.jsxs)("span",{"data-sentry-component":"renderUnusedDim","data-sentry-source-file":"260-DatasetDownload.tsx",className:"jsx-".concat(eY.__hash)+" unused-explanation",children:[(0,i.jsx)(c.A,{id:"subset.unusedExplanation",defaultMessage:"Not used in any of the selected variables","data-sentry-element":"FormattedMessage","data-sentry-source-file":"260-DatasetDownload.tsx"}),(0,i.jsx)(l(),{id:eY.__hash,children:eY})]}),eN=function(e){var t;let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=eW(e);_.current.timeMin=s.tMin,_.current.timeMax=s.tMax,_.current.elevationMin=s.zMin,_.current.elevationMax=s.zMax,O(_.current.timeMin),z(_.current.timeMax),U(_.current.elevationMin),V(_.current.elevationMax);let{stacItem:i}=e;if(W(Object.keys(null!==(t=i.properties["cube:variables"])&&void 0!==t?t:{})),v(e),!a){let{subdatasetId:t}=e,a={...n.query,dataset:t};n.replace({query:a},{query:(0,eg.$5)(a,n)},{shallow:!0})}},eS=()=>{var e,t;let a=null===(e=eh.current)||void 0===e?void 0:e.getBoundingClientRect(),s=null===(t=eu.current)||void 0===t?void 0:t.getBoundingClientRect();if(!a||!s)return;let i=a.top<e$&&s.top>50;i!==ec&&ed(i)},eI=()=>{var e,t,a,s;let i=null===(e=H.current)||void 0===e?void 0:e.getValue(),n=null===(t=$.current)||void 0===t?void 0:t.getValue();null!=i&&null!=n&&n<i&&(null===(a=H.current)||void 0===a||a.setValue(n),null===(s=$.current)||void 0===s||s.setValue(i),O(n),z(i))},eA=()=>{var e,t,a,s;let i=(0,e_.gu)(null===(e=q.current)||void 0===e?void 0:e.getValue()),n=(0,e_.gu)(null===(t=Z.current)||void 0===t?void 0:t.getValue());null!=i&&null!=n&&n<i&&(null===(a=q.current)||void 0===a||a.setValue((0,e_.gu)(n)),null===(s=Z.current)||void 0===s||s.setValue((0,e_.gu)(i)),U(n),V(i))},eC=async()=>{let e=(0,e_.Ti)(a.id,b,Y,G),i=(0,e_.LF)(a.id,b,es);(0,e_.Om)(i),K(!0),et(Date.now());let n=[],l=-1;try{let a={username:d,usage:"Subsetter"};for(let s=0;s<e.length;s++){let i=e[s],l=await (0,e_.BQ)(b,i,t,a);if(!l)return;n.push(l)}l=-1,await (0,e_.LR)(b,n,t),(0,e_.Ms)(i)}catch(r){console.error(r),(0,e_.Ig)(r,(0,e_.G3)(a.id,b,Y,G),t,e=>s((0,j.chatbotToggle)(e))),(0,e_.rC)(i);let n=JSON.stringify(e,null,2);ep.Z({type:"user",category:"downloadSubsetError",level:"error",data:{datasetId:i.label,subsetReqs:n,idxReq:l}}),ex.Cp(r)}finally{K(!1),et(null)}},eD=e=>{eo(e),s((0,j.setFeatureHint)("subsetAutomate",!1))},eT=async()=>{let e=ea.current+1;ea.current=e;try{en||el(!0);let t=await (0,e_.X0)(a.id,b,Y,G);if(e!==ea.current)return;ei(t),el(!1)}catch(t){if(console.error(t),e!==ea.current)return;el(!1)}},eL=eb()(eT,400);return(0,i.jsxs)("div",{"data-sentry-component":"render","data-sentry-source-file":"260-DatasetDownload.tsx",className:"jsx-".concat(eH.__hash)+" dataset-download",children:[(()=>{let{tooSmall:s,tooLarge:n}=(0,e_.IR)(b,es,t),r=G.length>0,o=!J&&!(n||s)&&!en&&r,{width:d}=e,h=d<=560,p=d<=450?(0,i.jsx)(c.A,{id:"subset.browseFilesButtonNarrow",defaultMessage:"Files"}):(0,i.jsx)(c.A,{id:"subset.browseFilesButton",defaultMessage:"Browse files"});return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{ref:eh,className:"jsx-".concat(eq.__hash)+" button-area-placeholder"}),(0,i.jsxs)("div",{style:{width:d},className:"jsx-".concat(eq.__hash)+" "+(u()("button-area",{float:ec,narrow:h})||""),children:[(0,i.jsxs)("div",{className:"jsx-".concat(eq.__hash)+" button-area-main",children:[(0,i.jsxs)("div",{className:"jsx-".concat(eq.__hash),children:[(0,i.jsx)("div",{onClick:o?eC:void 0,className:"jsx-".concat(eq.__hash)+" "+(u()("wk-button primary",{disabled:!o,small:h})||""),children:J?(0,i.jsx)(S.A,{timeout:0,label:h?"":t.$t({id:"subset.downloading",defaultMessage:"Downloading…"})}):(0,i.jsx)(c.A,{id:"subset.downloadButton",defaultMessage:"Download"})}),(b.hasZarr||b.hasSqlite)&&(0,i.jsxs)("div",{onClick:()=>eD(!0),className:"jsx-".concat(eq.__hash)+" "+(u()("wk-button",{small:h})||""),children:[(0,i.jsx)(c.A,{id:"subset.automateButton",defaultMessage:"Automate"}),(0,i.jsx)(C.A,{ids:["subsetAutomate"],top:0,right:-8})]}),(0,i.jsx)(N.A,{className:u()("wk-button",{small:h}),href:"/product/".concat(a.id,"/files"),"data-sentry-element":"AppLink","data-sentry-source-file":"260-DatasetDownload.tsx",children:p})]}),ef()]}),J&&(0,i.jsx)(eR,{delay:x.UI.subset.patienceShownAfterMs,children:(0,i.jsxs)("div",{className:"jsx-".concat(eq.__hash)+" "+(u()("patience",{narrow:h})||""),children:[(0,i.jsx)(c.A,{id:"subset.patience",defaultMessage:"Please be patient"}),"…"," ",(0,i.jsx)(c.A,{id:"subset.elapsed",defaultMessage:"Elapsed"}),": ",(0,i.jsx)(ek.A,{format:"mm:ss",refTime:ee})]})})]}),(0,i.jsx)(l(),{id:eq.__hash,children:eq})]})})(),(()=>{let e=eB(h),t=b.subdatasetId;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h3",{className:"jsx-".concat(eY.__hash)+" cm-section-title",children:(0,i.jsx)(c.A,{id:"subset.dataset",defaultMessage:"Dataset","data-sentry-element":"FormattedMessage","data-sentry-source-file":"260-DatasetDownload.tsx"})}),(0,i.jsxs)("div",{className:"jsx-".concat(eY.__hash)+" cm-tabular-item",children:[(0,i.jsx)("div",{className:"jsx-".concat(eY.__hash)+" label",children:(0,i.jsx)(c.A,{id:"subset.productId",defaultMessage:"Product identifier","data-sentry-element":"FormattedMessage","data-sentry-source-file":"260-DatasetDownload.tsx"})}),(0,i.jsx)("div",{className:"jsx-".concat(eY.__hash)+" value",children:a.id})]}),(0,i.jsxs)("div",{className:"jsx-".concat(eY.__hash)+" cm-tabular-item",children:[(0,i.jsx)("div",{className:"jsx-".concat(eY.__hash)+" label",children:(0,i.jsx)(c.A,{id:"subset.productName",defaultMessage:"Product name","data-sentry-element":"FormattedMessage","data-sentry-source-file":"260-DatasetDownload.tsx"})}),(0,i.jsx)("div",{className:"jsx-".concat(eY.__hash)+" value",children:(0,m.AY)(a)})]}),(0,i.jsxs)("div",{className:"jsx-".concat(eY.__hash)+" cm-tabular-item",children:[(0,i.jsx)("div",{className:"jsx-".concat(eY.__hash)+" label",children:(0,i.jsx)(c.A,{id:"subset.dataset",defaultMessage:"Dataset","data-sentry-element":"FormattedMessage","data-sentry-source-file":"260-DatasetDownload.tsx"})}),e.length>1?(0,i.jsxs)("div",{className:"jsx-".concat(eY.__hash)+" value",children:[(0,i.jsx)("div",{className:"jsx-".concat(eY.__hash)+" instructions",children:(0,i.jsx)(c.A,{id:"subset.chooseOneDataset",defaultMessage:"Please choose one of the datasets in this product:"})}),(0,i.jsx)(p.Select,{className:"subdataset-id",items:e.map(e=>({value:e,label:eV(e,a)})),value:t,onChange:(e,t)=>eN(h.find(e=>e.subdatasetId===t)),required:!0})]}):(0,i.jsxs)("div",{className:"jsx-".concat(eY.__hash)+" value",children:[(0,i.jsx)("div",{className:"jsx-".concat(eY.__hash)+" instructions",children:(0,i.jsx)(c.A,{id:"subset.singleDatasetInProduct",defaultMessage:"Single dataset in this product:"})}),(0,i.jsx)("div",{className:"jsx-".concat(eY.__hash),children:eV(t,a)})]})]}),(0,i.jsx)(l(),{id:eY.__hash,children:eY})]})})(),(()=>{var e;let{stacItem:t}=b,a=null!==(e=null==t?void 0:t.properties["cube:variables"])&&void 0!==e?e:{},s=(0,m.jk)(a).map(e=>e.id),n=G.length===s.length,r=0===G.length,o=s.map(e=>{let t=a[e],{unit:s}=t,i=h.find(t=>t.subdatasetId===b.subdatasetId&&t.variableId===e);if(!i)return{value:e,label:(0,Q.getVariableTitle)(e,t),unit:s};let{variableTitle:n,isVariableTitleUntranslated:l}=i;return{value:e,label:n,untranslated:l,unit:s}});return o.sort(X.Y3),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("h3",{className:"jsx-".concat(eY.__hash)+" cm-section-title with-buttons",children:[(0,i.jsx)(c.A,{id:"subset.variables",defaultMessage:"Variables","data-sentry-element":"FormattedMessage","data-sentry-source-file":"260-DatasetDownload.tsx"}),(0,i.jsx)("span",{className:"jsx-".concat(eY.__hash)+" required-hint",children:"*"}),(0,i.jsx)("span",{className:"jsx-".concat(eY.__hash)+" cm-spacer-md"}),(0,i.jsx)("div",{onClick:()=>{W(s)},className:"jsx-".concat(eY.__hash)+" "+(u()("wk-button small",{disabled:n})||""),children:(0,i.jsx)(c.A,{id:"subset.addAllVariables",defaultMessage:"Add all","data-sentry-element":"FormattedMessage","data-sentry-source-file":"260-DatasetDownload.tsx"})}),(0,i.jsx)("div",{onClick:()=>{W([])},className:"jsx-".concat(eY.__hash)+" "+(u()("wk-button small",{disabled:r})||""),children:(0,i.jsx)(c.A,{id:"subset.clearAllVariables",defaultMessage:"Clear all","data-sentry-element":"FormattedMessage","data-sentry-source-file":"260-DatasetDownload.tsx"})})]}),!G.length&&(0,i.jsx)("p",{className:"jsx-".concat(eY.__hash)+" error",children:(0,i.jsx)(c.A,{id:"subset.atLeastOneVariable",defaultMessage:"Please check at least one variable."})}),(0,i.jsx)("div",{className:"jsx-".concat(eY.__hash)+" variables",children:o.map(e=>{let{value:t,label:a,unit:s,untranslated:n}=e;return(0,i.jsx)("div",{className:"jsx-".concat(eY.__hash)+" variable",children:(0,i.jsx)(p.Checkbox,{id:t,value:G.includes(t),onChange:(e,a)=>{let s=G.slice();a?s.push(t):s=s.filter(e=>e!==t),W(s)},label:(0,i.jsxs)("span",{className:"jsx-".concat(eY.__hash),children:[(0,i.jsx)("span",{className:"jsx-".concat(eY.__hash)+" "+(u()("var-name",{untranslated:n})||""),children:a}),(0,i.jsx)("span",{className:"jsx-".concat(eY.__hash)+" var-id",children:t})," ",(0,i.jsx)(ew.A,{units:s,brackets:!0})]})})},t)})}),(0,i.jsx)(l(),{id:eY.__hash,children:eY})]})})(),(()=>{let{stacItem:t}=b;if(!(0,e_.tv)(t,x.DIM_LONGITUDE)||!(0,e_.tv)(t,x.DIM_LATITUDE))return null;let s=!((0,e_.J$)(t,G,x.DIM_LONGITUDE)&&(0,e_.J$)(t,G,x.DIM_LATITUDE));return(0,i.jsxs)("section",{"data-sentry-component":"renderGeographic","data-sentry-source-file":"260-DatasetDownload.tsx",className:"jsx-".concat(eY.__hash)+" "+(u()("subset-section",{unused:s})||""),children:[(0,i.jsxs)("h3",{className:"jsx-".concat(eY.__hash)+" cm-section-title force-margin",children:[(0,i.jsx)(c.A,{id:"subset.areaOfInterest",defaultMessage:"Area of interest","data-sentry-element":"FormattedMessage","data-sentry-source-file":"260-DatasetDownload.tsx"}),s&&ej()]}),(0,i.jsx)(eF,{dataset:a,width:e.width,height:450,lonMin:y,lonMax:k,latMin:I,latMax:T,setLonMin:w,setLonMax:M,setLatMin:D,setLatMax:L,"data-sentry-element":"DownloadBboxPicker","data-sentry-source-file":"260-DatasetDownload.tsx"}),(0,i.jsx)(l(),{id:eY.__hash,children:eY})]})})(),(()=>{var e,t;let{stacItem:a}=b;if(!(0,e_.tv)(a,x.DIM_TIME))return null;let s=!(0,e_.J$)(a,G,x.DIM_TIME),{tMin:n,tMax:r,isSubdaily:o}=(0,ey.l9)(a);if(null==n)return null;let d=n,h=r;o||(d=R().utc(n).startOf("day").valueOf(),h=R().utc(r).endOf("day").valueOf());let f=(0,e_.h_)(null==E?void 0:E.getTime(),null==P?void 0:P.getTime(),d,h);return(0,i.jsxs)("section",{"data-sentry-component":"renderTimeRange","data-sentry-source-file":"260-DatasetDownload.tsx",className:"jsx-".concat(eY.__hash)+" "+(u()("subset-section",{unused:s})||""),children:[(0,i.jsxs)("h3",{className:"jsx-".concat(eY.__hash)+" cm-section-title force-margin with-buttons",children:[(0,i.jsx)(c.A,{id:"subset.dateRange",defaultMessage:"Date range","data-sentry-element":"FormattedMessage","data-sentry-source-file":"260-DatasetDownload.tsx"}),!s&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"jsx-".concat(eY.__hash)+" cm-spacer-md"}),(0,i.jsx)("div",{onClick:()=>{var e,t;let{timeMin:a,timeMax:s}=_.current;null===(e=H.current)||void 0===e||e.setValue(a),null===(t=$.current)||void 0===t||t.setValue(s),O(a),z(s)},className:"jsx-".concat(eY.__hash)+" wk-button small",children:(0,i.jsx)(c.A,{id:"subset.useDefaults",defaultMessage:"Use defaults"})}),(0,i.jsx)("div",{onClick:()=>{var e,t;null===(e=H.current)||void 0===e||e.setValue(null),null===(t=$.current)||void 0===t||t.setValue(null),O(null),z(null)},className:"jsx-".concat(eY.__hash)+" "+(u()("wk-button small",{disabled:null==E&&null==P})||""),children:(0,i.jsx)(c.A,{id:"subset.clear",defaultMessage:"Clear"})})]}),s&&ej()]}),(0,i.jsxs)("div",{className:"jsx-".concat(eY.__hash)+" instructions stand-alone",children:[(0,i.jsx)(c.A,{id:"subset.chooseTimeRange",defaultMessage:"Choose start and end times at least partly within this range:","data-sentry-element":"FormattedMessage","data-sentry-source-file":"260-DatasetDownload.tsx"}),(0,i.jsx)("span",{className:"jsx-".concat(eY.__hash)+" cm-spacer-md"}),(0,m.Kq)(n,{withTime:o}),(0,i.jsx)("span",{className:"jsx-".concat(eY.__hash)+" cm-spacer-md"}),"→",(0,i.jsx)("span",{className:"jsx-".concat(eY.__hash)+" cm-spacer-md"}),(0,m.Kq)(r,{withTime:o})]}),(0,i.jsxs)("div",{className:"jsx-".concat(eY.__hash)+" cm-tabular-item range",children:[(0,i.jsx)("div",{className:"jsx-".concat(eY.__hash)+" label label-range",children:(0,i.jsx)(c.A,{id:"subset.rangeFrom",defaultMessage:"From","data-sentry-element":"FormattedMessage","data-sentry-source-file":"260-DatasetDownload.tsx"})}),(0,i.jsx)("div",{className:"jsx-".concat(eY.__hash)+" value",children:(0,i.jsx)(p.DateInput,{ref:H,id:"timeMin",className:u()("standalone-subsetter-input",{invalid:f,time:o}),time:o,utc:!0,type:"native",value:_.current.timeMin,onChange:(e,t)=>O(t),onBlur:eI,disabled:s,"data-sentry-element":"DateInput","data-sentry-source-file":"260-DatasetDownload.tsx"})},null!==(e=b.id)&&void 0!==e?e:"none")]}),(0,i.jsxs)("div",{className:"jsx-".concat(eY.__hash)+" cm-tabular-item range",children:[(0,i.jsx)("div",{className:"jsx-".concat(eY.__hash)+" label label-range",children:(0,i.jsx)(c.A,{id:"subset.rangeTo",defaultMessage:"To","data-sentry-element":"FormattedMessage","data-sentry-source-file":"260-DatasetDownload.tsx"})}),(0,i.jsx)("div",{className:"jsx-".concat(eY.__hash)+" value",children:(0,i.jsx)(p.DateInput,{ref:$,id:"timeMax",className:u()("standalone-subsetter-input",{invalid:f,time:o}),time:o,utc:!0,type:"native",value:_.current.timeMax,onChange:(e,t)=>z(t),onBlur:eI,disabled:s,"data-sentry-element":"DateInput","data-sentry-source-file":"260-DatasetDownload.tsx"})},null!==(t=b.id)&&void 0!==t?t:"none")]}),(0,i.jsx)(l(),{id:eY.__hash,children:eY})]})})(),(()=>{var e,t;let a;let{stacItem:s}=b;if(!(0,e_.tv)(s,x.DIM_ELEVATION))return null;let n=!(0,e_.J$)(s,G,x.DIM_ELEVATION),{zMin:r,zMax:o,zValues:d}=(0,ey.tQ)(s);if(null==r&&null==o||r===o)return null;let h=(0,e_.h_)(F,B,r,o),m=Array.isArray(d),f=e=>Math.round(100*e)/100;return m&&(a=d.map(e=>-e).slice().sort((e,t)=>e-t).map(e=>({value:e,label:String(f(e))}))),(0,i.jsxs)("section",{"data-sentry-component":"renderDepthRange","data-sentry-source-file":"260-DatasetDownload.tsx",className:"jsx-".concat(eY.__hash)+" "+(u()("subset-section",{unused:n})||""),children:[(0,i.jsxs)("h3",{className:"jsx-".concat(eY.__hash)+" cm-section-title force-margin with-buttons",children:[(0,i.jsx)(c.A,{id:"subset.depthRange",defaultMessage:"Depth range","data-sentry-element":"FormattedMessage","data-sentry-source-file":"260-DatasetDownload.tsx"}),!n&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"jsx-".concat(eY.__hash)+" cm-spacer-md"}),(0,i.jsx)("div",{onClick:()=>{var e,t;let{elevationMin:a,elevationMax:s}=_.current;null===(e=q.current)||void 0===e||e.setValue((0,e_.gu)(a)),null===(t=Z.current)||void 0===t||t.setValue((0,e_.gu)(s)),U(a),V(s)},className:"jsx-".concat(eY.__hash)+" wk-button small",children:(0,i.jsx)(c.A,{id:"subset.useDefaults",defaultMessage:"Use defaults"})}),(0,i.jsx)("div",{onClick:()=>{var e,t;null===(e=q.current)||void 0===e||e.setValue(null),null===(t=Z.current)||void 0===t||t.setValue(null),U(null),V(null)},className:"jsx-".concat(eY.__hash)+" "+(u()("wk-button small",{disabled:null==F&&null==B})||""),children:(0,i.jsx)(c.A,{id:"subset.clear",defaultMessage:"Clear"})})]}),n&&ej()]}),(0,i.jsxs)("div",{className:"jsx-".concat(eY.__hash)+" instructions stand-alone",children:[(0,i.jsx)(c.A,{id:"subset.chooseDepthRange",defaultMessage:"Choose start and end depths at least partly within this range:","data-sentry-element":"FormattedMessage","data-sentry-source-file":"260-DatasetDownload.tsx"}),(0,i.jsx)("span",{className:"jsx-".concat(eY.__hash)+" cm-spacer-md"}),"".concat(-f(o)," m"),(0,i.jsx)("span",{className:"jsx-".concat(eY.__hash)+" cm-spacer-md"}),"→",(0,i.jsx)("span",{className:"jsx-".concat(eY.__hash)+" cm-spacer-md"}),"".concat(-f(r)," m")]}),(0,i.jsxs)("div",{className:"jsx-".concat(eY.__hash)+" cm-tabular-item range",children:[(0,i.jsx)("div",{className:"jsx-".concat(eY.__hash)+" label label-range",children:(0,i.jsx)(c.A,{id:"subset.rangeFrom",defaultMessage:"From","data-sentry-element":"FormattedMessage","data-sentry-source-file":"260-DatasetDownload.tsx"})}),(0,i.jsxs)("div",{className:"jsx-".concat(eY.__hash)+" value",children:[m?(0,i.jsx)(p.Select,{ref:Z,id:"elevationMax",className:"standalone-subsetter-input",items:a,value:(0,e_.gu)(_.current.elevationMax),onChange:(e,t)=>V((0,e_.gu)(t)),onBlur:eA,disabled:n}):(0,i.jsx)(p.NumberInput,{ref:Z,id:"elevationMax",className:u()("standalone-subsetter-input",{invalid:h}),value:(0,e_.gu)(_.current.elevationMax),onChange:(e,t)=>V((0,e_.gu)(t)),onBlur:eA,disabled:n})," ","m"]},null!==(e=b.id)&&void 0!==e?e:"none")]}),(0,i.jsxs)("div",{className:"jsx-".concat(eY.__hash)+" cm-tabular-item range",children:[(0,i.jsx)("div",{className:"jsx-".concat(eY.__hash)+" label label-range",children:(0,i.jsx)(c.A,{id:"subset.rangeTo",defaultMessage:"To","data-sentry-element":"FormattedMessage","data-sentry-source-file":"260-DatasetDownload.tsx"})}),(0,i.jsxs)("div",{className:"jsx-".concat(eY.__hash)+" value",children:[m?(0,i.jsx)(p.Select,{ref:q,id:"elevationMin",className:"standalone-subsetter-input",items:a,value:(0,e_.gu)(_.current.elevationMin),onChange:(e,t)=>U((0,e_.gu)(t)),onBlur:eA,disabled:n}):(0,i.jsx)(p.NumberInput,{ref:q,id:"elevationMin",className:u()("standalone-subsetter-input",{invalid:h}),value:(0,e_.gu)(_.current.elevationMin),onChange:(e,t)=>U((0,e_.gu)(t)),onBlur:eA,disabled:n})," ","m"]},null!==(t=b.id)&&void 0!==t?t:"none")]}),(0,i.jsx)(l(),{id:eY.__hash,children:eY})]})})(),!1,er&&(0,i.jsx)(eM.A,{datasetId:a.id,layerSpec:b,subsetValues:(0,e_.Mj)(b,Y,G),onClose:()=>eD(!1)}),(0,i.jsx)("div",{ref:eu,className:"jsx-".concat(eH.__hash)}),(0,i.jsx)(l(),{id:eH.__hash,children:eH})]})},eR=e=>{let[t,a]=(0,r.useState)(!1),{delay:s}=e;return(0,r.useEffect)(()=>{let e=setTimeout(()=>{a(!0)},s);return()=>clearTimeout(e)},[s]),t?e.children:null},eB=e=>{let t=new Set,a=[];return e.forEach(e=>{let{subdatasetId:s}=e;t.has(s)||(t.add(s),a.push({subdatasetId:s,title:e.subdatasetTitle}))}),a.sort((e,t)=>(0,X.UT)(e.title||e.subdatasetId,t.title||t.subdatasetId)),a.map(e=>e.subdatasetId)},eV=(e,t)=>{var a;let{subdatasetTitleTranslations:s}=t,i=Object.values(t.layers).find(t=>t.subdatasetId===e),n=null==i?void 0:i.subdatasetTitle;n=null!==(a=null==s?void 0:s[n])&&void 0!==a?a:n;let l=(0,Q.getTaglessSubdatasetId)(e),r=(0,Q.getSubdatasetIdExtension)(e);return r&&(l+=" (".concat(r,")")),n?"".concat(n,"\xa0\xa0\xa0\xb7\xa0\xa0\xa0").concat(l):l},eG=(e,t)=>{if(t){let a=e.find(e=>e.subdatasetId===t);if(a)return a}let a=e.filter(e=>!e.subdatasetId.includes("P1Y"));return a.length?a[0]:e[0]},eW=e=>{let{stacItem:t,hasSqlite:a}=e,s={tMin:null,tMax:null,zMin:null,zMax:null},{tMin:i,tMax:n}=(0,ey.l9)(t);if(null!=i&&null!=n){let e,t;e=a?R().utc(n).startOf("hour").subtract(24,"hour").toDate():new Date(n),t=new Date(n),s.tMin=(0,e_.M7)(e,i,n),s.tMax=(0,e_.M7)(t,i,n)}let{zMin:l,zMax:r}=(0,ey.tQ)(t);if(null!=l&&null!=r){let e,t;a?(e=-20,t=20):(e=r,t=r),s.zMin=(0,e_.qE)(e,l,r),s.zMax=(0,e_.qE)(t,l,r)}return s},eH=new String(".dataset-download.jsx-670ef77f04ce7349{position:relative}");eH.__hash="670ef77f04ce7349";let e$=-1,eq=new String(".button-area-placeholder.jsx-927609e4f80fc3f2{padding-top:90px}.button-area.jsx-927609e4f80fc3f2{position:absolute;top:0;background:white;border:1px solid var(--color-title-bg);padding:".concat(20,"px;-webkit-transition:box-shadow ").concat(x.UI.transitionDuration,"ms ease-in-out;-moz-transition:box-shadow ").concat(x.UI.transitionDuration,"ms ease-in-out;-o-transition:box-shadow ").concat(x.UI.transitionDuration,"ms ease-in-out;transition:box-shadow ").concat(x.UI.transitionDuration,"ms ease-in-out}.button-area.float.jsx-927609e4f80fc3f2{position:fixed;z-index:10;top:").concat(e$,"px;-webkit-box-shadow:10px 10px 15px rgba(0,0,0,.2);-moz-box-shadow:10px 10px 15px rgba(0,0,0,.2);box-shadow:10px 10px 15px rgba(0,0,0,.2)}.button-area.narrow.jsx-927609e4f80fc3f2{font-size:.8em}.button-area-main.jsx-927609e4f80fc3f2{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-moz-box-orient:horizontal;-moz-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-moz-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.patience.jsx-927609e4f80fc3f2{color:var(--color-dim);margin-bottom:-4px}@media screen and (max-width:").concat(600,"px){.button-area-placeholder.jsx-927609e4f80fc3f2{padding-top:110px}.button-area-main.jsx-927609e4f80fc3f2{-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:stretch;-webkit-align-items:stretch;-moz-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-box-pack:unset;-webkit-justify-content:unset;-moz-box-pack:unset;-ms-flex-pack:unset;justify-content:unset}}"));eq.__hash="927609e4f80fc3f2";let eZ=new String(".size-estimate.jsx-6109a5c7e7156e18{text-align:right;color:var(--color-dim)}.size-estimate.invalid-size.jsx-6109a5c7e7156e18{color:var(--color-alert)}.size-estimate-icon.jsx-6109a5c7e7156e18{margin-right:.2em}.size-estimate-error.jsx-6109a5c7e7156e18 a{color:inherit;text-decoration:underline}@media screen and (max-width:".concat(600,"px){.size-estimate.jsx-6109a5c7e7156e18{margin-top:3px;text-align:left}}"));eZ.__hash="6109a5c7e7156e18";let eY=new String(".cm-section-title.with-buttons.jsx-1e01a7766a275074{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.cm-section-title.jsx-1e01a7766a275074 .wk-button.jsx-1e01a7766a275074{line-height:1}.value.jsx-1e01a7766a275074 .giu-select-native-wrapper,.value.jsx-1e01a7766a275074 .giu-select-native{max-width:100%}.instructions.jsx-1e01a7766a275074{font-style:italic;color:var(--color-dim)}.instructions.stand-alone.jsx-1e01a7766a275074{margin-bottom:5px}.btn-clear.jsx-1e01a7766a275074{margin-left:.3em}.giu-number-input.standalone-subsetter-input{width:100px}.giu-date-input.standalone-subsetter-input.invalid,.giu-number-input.standalone-subsetter-input.invalid,.giu-text-input.standalone-subsetter-input.invalid{color:var(--color-alert);border:1px solid var(--color-alert)}.label-range.jsx-1e01a7766a275074{-webkit-box-flex:0;-webkit-flex:0 0 80px;-moz-box-flex:0;-ms-flex:0 0 80px;flex:0 0 80px}@media screen and (max-width:".concat(x.UI.narrowBreak,"px){.cm-tabular-item.range.jsx-1e01a7766a275074{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex}}.variables.jsx-1e01a7766a275074{-webkit-columns:2;-moz-columns:2;columns:2}.variables.jsx-1e01a7766a275074 .giu-checkbox{white-space:unset;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:baseline;-webkit-align-items:baseline;-moz-box-align:baseline;-ms-flex-align:baseline;align-items:baseline}.variables.jsx-1e01a7766a275074 .giu-checkbox-input{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:.5em}.var-name.jsx-1e01a7766a275074{}.var-name.untranslated.jsx-1e01a7766a275074{font-style:italic}.var-id.jsx-1e01a7766a275074{margin-left:.4em;font-style:italic;color:var(--color-disabled)}@media screen and (max-width:").concat(x.UI.comfortableBreak,"px){.variables.jsx-1e01a7766a275074{-webkit-columns:1;-moz-columns:1;columns:1}}.error.jsx-1e01a7766a275074{color:var(--color-alert)}.required-hint.jsx-1e01a7766a275074{color:var(--color-alert)}.subset-section.unused.jsx-1e01a7766a275074{color:var(--color-dim)}.subset-section.unused.jsx-1e01a7766a275074 *{pointer-events:none}.unused-explanation.jsx-1e01a7766a275074{font-weight:normal;margin-left:1em}"));eY.__hash="1e01a7766a275074";let eJ=e=>{let t=(0,em.useRouter)(),a=(0,o.d4)(g.iN),s=(0,o.d4)((0,g.DJ)(e.datasetId)),n=(0,r.useRef)(null),l=(0,ej.A)(n),[d,h]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{!d&&"LOGGED_IN"===a&&(0,f.p)(s)&&0!==Object.keys(s.layers).length&&t.isReady&&h(!0)}),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{ref:n}),(()=>{if(!d)return null;if(s.isExternal||"CMEMS"!==s.catalogue)return(0,i.jsx)(V,{dataset:s});if((0,m.o7)(s))return(0,i.jsxs)(p.LargeMessage,{children:[(0,i.jsx)(c.A,{id:"subset.omiNotDownloadable",defaultMessage:"Cannot download Ocean Monitoring Indicators (OMIs) using this tool."}),(0,i.jsx)("br",{}),(0,i.jsx)(c.A,{id:"subset.downloadUsingOtherTools",defaultMessage:"Please use {linkServices}.",values:{linkServices:(0,i.jsx)("u",{children:(0,i.jsx)(N.A,{href:"/product/".concat(e.datasetId,"/services"),children:(0,i.jsx)(c.A,{id:"subset.otherDownloadServices",defaultMessage:"other download services"})})},"linkServices")}})]});let t=(0,m.jk)(s.layers).filter(e=>e.hasZarr||e.hasSqlite);return(t.sort((e,t)=>(0,X.UT)(e.subdatasetTitle||e.subdatasetId,t.subdatasetTitle||t.subdatasetId)),t.length)?(0,i.jsx)(eU,{dataset:s,layersWithArco:t,width:l,"data-sentry-element":"_DatasetDownload","data-sentry-component":"renderContent","data-sentry-source-file":"260-DatasetDownload.tsx"}):(0,i.jsxs)(p.LargeMessage,{children:[(0,i.jsx)(c.A,{id:"subset.nonArcoCannotDownload1",defaultMessage:"Cannot download using this tool:"}),(0,i.jsx)("br",{}),(0,i.jsx)(c.A,{id:"subset.nonArcoCannotDownload2",defaultMessage:"no data cubes are available for this product."}),(0,i.jsx)("br",{}),(0,i.jsx)(c.A,{id:"subset.downloadUsingOtherTools",defaultMessage:"Please use {linkServices}.",values:{linkServices:(0,i.jsx)("u",{children:(0,i.jsx)(N.A,{href:"/product/".concat(e.datasetId,"/services"),children:(0,i.jsx)(c.A,{id:"subset.otherDownloadServices",defaultMessage:"other download services"})})},"linkServices")}})]})})()]})};var eK=a(89174);class eQ extends r.Component{componentDidMount(){let{dataset:e,datasetId:t}=this.props;e||this.props.queryDatasetDetails(t),(0,m.Gb)(this.props.datasetId),this.maybeAutoAdd()}componentDidUpdate(){this.maybeAutoAdd()}maybeAutoAdd(){if(this.hasAutoAddedLayer){this.props.router.replace(this.props.viewerUrl);return}let{dataset:e,mapLayers:t,intl:a}=this.props;if(!e)return;let{layers:s}=e,i=Object.keys(null!=s?s:{}).length;if(!s||i>1)return;let n=i>0?"".concat(e.id,"/").concat(Object.keys(s)[0]):"".concat(e.id,"/").concat(x.PLACEHOLDER_ID,"/").concat(x.PLACEHOLDER_ID);(0,m.jk)(t).find(e=>e.layerId===n)?((0,p.notify)({type:"warn",icon:"layer-group",title:a.$t({id:"datasetAddToMap.alreadyThere",defaultMessage:"Layer was already present on the map"})}),this.props.router.replace(this.props.viewerUrl)):(this.props.addMapLayer(n),this.hasAutoAddedLayer=!0)}render(){let{dataset:e,mapLayers:t,facetValues:a}=this.props,s=!(0,f.p)(e);return(0,i.jsxs)("section",{"data-sentry-component":"DatasetAddToMap","data-sentry-source-file":"300-DatasetAddToMap.tsx",className:"jsx-".concat(eX.__hash)+" dataset-layers",children:[(0,i.jsx)("div",{className:"jsx-".concat(eX.__hash)+" content",children:!s&&(0,i.jsx)(eK.A,{dataset:e,activeTeroLayerIds:(0,m.jk)(t).map(e=>e.layerId),facetValues:a,onClickAdd:e=>this.props.addMapLayer(e),onClickRemove:e=>{var a;let s=null===(a=(0,m.jk)(t).find(t=>t.layerId===e))||void 0===a?void 0:a.id;s&&this.props.removeMapLayer(s)},settings:this.props.settings})}),(0,i.jsx)(l(),{id:eX.__hash,children:eX})]})}constructor(...e){super(...e),this.hasAutoAddedLayer=!1}}let eX=new String("");eX.__hash="b3e1b6a7c9b96113";let e0=(0,em.withRouter)((0,o.Ng)((e,t)=>({dataset:(0,g.vh)(e,t.datasetId),mapLayers:(0,g.b7)(e),facetValues:(0,g.iw)(e),viewerUrl:(0,g.cm)(e),settings:(0,g.mt)(e)}),j)((0,d.Ay)(eQ)));var e1=a(75724),e2=a(71680),e5=a.n(e2),e3=a(25003);let e6="__ROOT__",e4="https://s3.waw3-1.cloudferro.com",e9="native/",e8=async e=>{let[t,a,s]=e;if(""===s){let e=new Set;for(let t=0;t<a.length;t++){let s=a[t].split("/")[0];e.add(s)}return{files:[],dirs:Array.from(e).map(e=>({name:e}))}}let i=te(t,s),n=i.isDefaultBucket?"https://marine.copernicus.eu":e4,l=i.isDefaultBucket?"mdl-native-list":i.bucket,{files:r,dirs:o}=await e7(n,l,s);return{files:r,dirs:o.filter(e=>{let t="".concat(s).concat(e.name,"/");return a.find(e=>t.startsWith(e))})}},e7=async(e,t,a)=>{let s;let{S3Client:i,ListObjectsV2Command:n}=await (0,e3.X)(),l=new i({endpoint:e,region:"waw3-1",signer:{sign:async e=>e},forcePathStyle:void 0}),r="".concat(e9).concat(a),o=[],c=[];for(;;){var d,h;let e;let a={Bucket:t,Prefix:r,Delimiter:"/"};s&&(a.ContinuationToken=s);let i=new n(a),u=await l.send(i);e=null!==(d=null==u?void 0:u.Contents)&&void 0!==d?d:[];for(let t=0;t<e.length;t++){let{Key:a,Size:s,LastModified:i}=e[t];if(a.endsWith("/"))continue;let n=tt(a,r);o.push({name:n,size:s,lastModified:i})}e=null!==(h=null==u?void 0:u.CommonPrefixes)&&void 0!==h?h:[];for(let t=0;t<e.length;t++){let a=tt(e[t].Prefix,r).slice(0,-1);c.push({name:a})}if(!u.IsTruncated)break;s=u.NextContinuationToken}return{files:o,dirs:c}},te=(e,t)=>{let a=t.split("/")[0],{defaultBucket:s,products:i}=e;return null!=i.current[a]?{bucket:i.current[a],isDefaultBucket:!1}:{bucket:s,isDefaultBucket:!0}},tt=(e,t)=>0===t.length?e:e.startsWith(t)?e.slice(t.length):e,ta=new String(".breadcrumbs.jsx-3ec474ec1d825b1c{word-break:break-word}.path-sep.jsx-3ec474ec1d825b1c{color:var(--color-dim);margin-left:.5em;margin-right:.5em}.path-segment.clickable.jsx-3ec474ec1d825b1c{color:var(--color-dim);cursor:pointer}.path-segment.clickable.jsx-3ec474ec1d825b1c:hover{color:var(--color-button-fg)}");ta.__hash="3ec474ec1d825b1c";let ts=new String(".buttons.jsx-a2b8bbff313301fe{margin:14px 0;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.sep.jsx-a2b8bbff313301fe{-webkit-box-flex:1;-webkit-flex:1 0 0px;-moz-box-flex:1;-ms-flex:1 0 0px;flex:1 0 0px}.num-downloads.jsx-a2b8bbff313301fe{margin-left:.4em}");ts.__hash="a2b8bbff313301fe";let ti=new String(".entries-wrapper.jsx-941195f934b4a156{overflow-x:auto}.entries.jsx-941195f934b4a156{border-top:1px solid var(--color-subtle-line);min-width:100%;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content}.entry.jsx-941195f934b4a156{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;display:grid;padding:6px;border:1px solid transparent}.entry.jsx-941195f934b4a156:hover{border-color:var(--color-subtle-line)}.entry.selected.jsx-941195f934b4a156{background-color:var(--color-title-bg)}.entry.selected.jsx-941195f934b4a156 .file-download.jsx-941195f934b4a156{font-weight:bold}.icon.jsx-941195f934b4a156{margin-right:4px}.open{display:none}.dir.jsx-941195f934b4a156{grid-template-columns:1.6em 1fr}.dir.jsx-941195f934b4a156:hover .closed{display:none}.dir.jsx-941195f934b4a156:hover .open{display:inline-block}.file.jsx-941195f934b4a156{grid-template-columns:1.6em 1fr 120px 150px}.file-download.jsx-941195f934b4a156:hover{color:var(--color-dim)}.size.jsx-941195f934b4a156,.last-modified.jsx-941195f934b4a156{color:var(--color-dim);text-align:right}.size.jsx-941195f934b4a156{margin-left:1em}");ti.__hash="941195f934b4a156";let tn=e=>{let t=(0,A.A)(),[n,o]=(0,r.useState)({}),[d,h]=(0,r.useState)(null),[m,f]=(0,r.useState)(0),[b,g]=(0,r.useState)(null),{data:j,error:v,isLoading:_}=(0,e1.A)([e.bucketMapping,e.allowedPaths,e.path],e8),y=t=>{o({}),h(null),e.setPath(t)},w=(e,t,a)=>{t?(o((0,P.set)(n,a,!0)),h(e)):(o((0,P.omit)(n,a)),h(null))},k=(e,t)=>{if(!j)return;if(e>t){let a=e;e=t,t=a}let a=j.files.slice(e,t+1),s=n;for(let e of a)s=(0,P.set)(s,e.name,!0);o(s)},M=async()=>{(0,B.PJ)({category:"catalogue",action:"fileBrowserDownload"});let e=Object.keys(n).map(e=>({url:C(e),filename:e}));await D(e)},N=async(e,t)=>{e.stopPropagation(),(0,B.PJ)({category:"catalogue",action:"fileBrowserDownload"});let a=[{url:C(t),filename:t}];await D(a)},I=()=>{null==b||b.abort()},C=t=>{let{bucket:a}=te(e.bucketMapping,e.path),s="?x-cop-client=".concat(x.APP_CONFIG.clientName,"&x-cop-usage=FileBrowser");return e.username&&(s+="&x-cop-user=".concat(e.username)),"".concat(e4,"/").concat(a,"/").concat(e9).concat(e.path).concat(t).concat(s)},D=async e=>{let t=e.length;f(e.length),s||(s=(await a.e(2762).then(a.t.bind(a,82762,23))).default);let i=new AbortController,n=i.signal;g(i);try{for(let a=0;a<e.length;a++){let{url:i,filename:l}=e[a],r=s.createWriteStream(l),o=await fetch(i,{signal:n});if(!o.body)throw Error("No response body");let c=o.body;await c.pipeTo(r),t-=1,f(t)}}catch(e){console.error(e),f(0)}finally{g(null)}};return(0,i.jsxs)("div",{"data-sentry-component":"render","data-sentry-source-file":"340-S3Browser.tsx",children:[(0,i.jsx)("div",{children:(()=>{let t="".concat(e6,"/").concat(e.path).split("/").slice(0,-1),a=t.length;return(0,i.jsxs)("h3",{"data-sentry-component":"renderPath","data-sentry-source-file":"340-S3Browser.tsx",className:"jsx-".concat(ta.__hash)+" cm-section-title breadcrumbs",children:[t.map((e,s)=>{let n=s===a-1,l=!n;return x.DEBUG.showTagsInS3||2!==s||(e=(0,Q.getTaglessSubdatasetId)(e)),(0,i.jsxs)(r.Fragment,{children:[(0,i.jsx)("span",{onClick:l?()=>{let e=t.slice(1,s+1).join("/");return e.length>0&&(e+="/"),y(e)}:void 0,className:"jsx-".concat(ta.__hash)+" "+(u()("path-segment",{clickable:l})||""),children:e===e6?(0,i.jsx)(p.Icon,{icon:"house"}):e}),!n&&(0,i.jsx)("span",{className:"jsx-".concat(ta.__hash)+" path-sep",children:"/ "})]},s)}),(0,i.jsx)(l(),{id:ta.__hash,children:ta})]})})()}),(0,i.jsx)("div",{children:(()=>{var t;let a=null!==(t=null==j?void 0:j.files)&&void 0!==t?t:[],s=a.length,r=Object.keys(n).length,d=m>0,h=!d&&r>0,{narrow:p}=e;return(0,i.jsxs)("div",{"data-sentry-component":"renderButtons","data-sentry-source-file":"340-S3Browser.tsx",className:"jsx-".concat(ts.__hash)+" buttons",children:[(0,i.jsx)("div",{onClick:()=>{let e={};for(let t=0;t<s;t++)e[a[t].name]=!0;o(e)},className:"jsx-".concat(ts.__hash)+" "+(u()("wk-button",{small:p,disabled:r===s})||""),children:p?(0,i.jsx)(c.A,{id:"fileBrowser.allButton",defaultMessage:"All"}):(0,i.jsx)(c.A,{id:"fileBrowser.selectAllButton",defaultMessage:"Select all"})}),(0,i.jsx)("div",{onClick:()=>o({}),className:"jsx-".concat(ts.__hash)+" "+(u()("wk-button",{small:p,disabled:0===r})||""),children:p?(0,i.jsx)(c.A,{id:"fileBrowser.noneButton",defaultMessage:"None"}):(0,i.jsx)(c.A,{id:"fileBrowser.clearAllButton",defaultMessage:"Clear all"})}),(0,i.jsx)("div",{className:"jsx-".concat(ts.__hash)+" sep"}),d&&(0,i.jsx)("div",{onClick:I,className:"jsx-".concat(ts.__hash)+" "+(u()("wk-button",{small:p})||""),children:(0,i.jsx)(c.A,{id:"fileBrowser.cancelButton",defaultMessage:"Cancel"})}),(0,i.jsx)("div",{onClick:h?M:void 0,className:"jsx-".concat(ts.__hash)+" "+(u()("wk-button","primary",{small:p,disabled:!h})||""),children:d?(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(S.F,{label:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.A,{id:"fileBrowser.downloadingButton",defaultMessage:"Downloading"}),(0,i.jsx)("span",{className:"jsx-".concat(ts.__hash)+" num-downloads",children:m}),"…"]})})}):r>0?(0,i.jsx)(c.A,{id:"fileBrowser.downloadNButton",defaultMessage:"Download {num}",values:{num:r}}):(0,i.jsx)(c.A,{id:"fileBrowser.downloadButton",defaultMessage:"Download"})}),(0,i.jsx)(l(),{id:ts.__hash,children:ts})]})})()}),(0,i.jsx)("div",{children:(()=>{if(_)return(0,i.jsx)(S.A,{label:t.$t({id:"fileBrowser.loadingHint",defaultMessage:"Loading…"})});if(v)return console.error(v.message),(0,i.jsx)(p.LargeMessage,{children:(0,i.jsx)(c.A,{id:"fileBrowser.networkError",defaultMessage:"Error fetching folder content — maybe a network issue?"})});if(!j)return null;let{files:a}=j,{dirs:s}=j;return 0===s.length&&0===a.length?(0,i.jsx)(p.LargeMessage,{children:(0,i.jsx)(c.A,{id:"fileBrowser.noFiles",defaultMessage:"No files in this folder."})}):(x.DEBUG.showTagsInS3||2!==e.path.split("/").length||(s=s.map(e=>(0,P.set)(e,"taglessName",(0,Q.getTaglessSubdatasetId)(e.name)))),(0,i.jsxs)("div",{"data-sentry-component":"renderEntries","data-sentry-source-file":"340-S3Browser.tsx",className:"jsx-".concat(ti.__hash)+" entries-wrapper",children:[(0,i.jsxs)("div",{className:"jsx-".concat(ti.__hash)+" entries",children:[s.map(t=>{var a;return(0,i.jsxs)("div",{onClick:()=>{y("".concat(e.path).concat(t.name,"/"))},className:"jsx-".concat(ti.__hash)+" entry dir",children:[(0,i.jsxs)("span",{className:"jsx-".concat(ti.__hash)+" icon",children:[(0,i.jsx)(p.Icon,{className:"closed",icon:"folder",family:"far",fixedWidth:!0}),(0,i.jsx)(p.Icon,{className:"open",icon:"folder-open",family:"far",fixedWidth:!0})]}),(0,i.jsx)("div",{className:"jsx-".concat(ti.__hash),children:(0,i.jsx)("span",{className:"jsx-".concat(ti.__hash),children:null!==(a=t.taglessName)&&void 0!==a?a:t.name})})]},t.name)}),a.map((e,t)=>{let a=!!n[e.name],s=R()(e.lastModified);return(0,i.jsxs)("div",{onClick:s=>{s.shiftKey&&null!=d?k(d,t):w(t,!a,e.name)},className:"jsx-".concat(ti.__hash)+" "+(u()("entry file",{selected:a})||""),children:[(0,i.jsx)("span",{className:"jsx-".concat(ti.__hash)+" icon",children:(0,i.jsx)(p.Icon,{icon:"file",family:a?"fas":"far",fixedWidth:!0})}),(0,i.jsx)("div",{className:"jsx-".concat(ti.__hash),children:(0,i.jsx)("span",{onClick:t=>N(t,e.name),className:"jsx-".concat(ti.__hash)+" file-download",children:e.name})}),(0,i.jsx)("div",{className:"jsx-".concat(ti.__hash)+" size",children:e5()(e.size)}),(0,i.jsx)("div",{title:s.format("L LTS"),className:"jsx-".concat(ti.__hash)+" last-modified",children:s.format("L")})]},e.name)})]}),(0,i.jsx)(l(),{id:ti.__hash,children:ti})]}))})()})]})},tl=["nc","nc4","nc.gz","nc4.gz","tif","tiff","csv","sqlite"];class tr extends r.Component{async componentDidMount(){let e;let{dataset:t,datasetId:a}=this.props;if(t||this.props.queryDatasetDetails(a),(0,m.Gb)(this.props.datasetId),(0,B.PJ)({category:"catalogue",action:"fileBrowserNavigate",label:a}),!(e=await fetch("https://s3.waw3-1.cloudferro.com/mdl-metadata/nativeBuckets.json")).ok)return;let s=await e.json();if(this.setState({bucketMapping:s}),!(e=await fetch("".concat("https://data-be-prd.marine.copernicus.eu","/api/subdatasetIds"))).ok)return;let i=await e.json(),n=[],l=Object.keys(i);l.sort();for(let e=0;e<l.length;e++){let t=l[e];if(t.startsWith(Q.DATASET_EXTERNAL_ID_PREFIX))continue;let a=i[t];a.sort();let s=null;for(let e=0;e<a.length;e++){let i=a[e],l=(0,Q.getTaglessSubdatasetId)(i,{removeNumericTag:!1});l!==s&&(s=l,n.push("".concat(t,"/").concat(l,"/")))}}this.setState({allowedPaths:n})}render(){let{dataset:e}=this.props,t=!(0,f.p)(e);return(0,i.jsxs)("div",{"data-sentry-component":"DatasetFiles","data-sentry-source-file":"320-DatasetFiles.tsx",className:"jsx-".concat(to.__hash)+" dataset-layers",children:[!t&&this.renderContent(),(0,i.jsx)(l(),{id:to.__hash,children:to})]})}renderContent(){var e;let{bucketMapping:t,allowedPaths:a}=this.state;if(null==t||null==a)return null;let{query:s}=this.props.router,n=s.subdataset,l=this.props.dataset;if(l.isExternal||"CMEMS"!==l.catalogue)return(0,i.jsx)(V,{dataset:l});let r=tc(l,n);if(!r)return(0,i.jsx)(p.LargeMessage,{children:(0,i.jsx)(c.A,{id:"fileBrowser.defaultPathError",defaultMessage:"Cannot browse files for this dataset"})});let o=null!==(e=s.path)&&void 0!==e?e:r;return(0,i.jsx)(tn,{path:o,setPath:this.onChangePath,allowedPaths:a,bucketMapping:t,narrow:this.props.narrow,username:this.props.username})}constructor(...e){super(...e),this.state={bucketMapping:null,allowedPaths:null},this.onChangePath=e=>{let{router:t}=this.props,{query:a}=t,s={...a,path:e};t.push({query:s},(0,eg.kZ)(s,t),{shallow:!0}),(0,B.PJ)({category:"catalogue",action:"fileBrowserNavigate"})}}}let to=new String("");to.__hash="b3e1b6a7c9b96113";let tc=(e,t)=>{var a,s;let i,n,l;let{stacItems:r}=e;if(!r)return null;let o=t?[t]:Object.keys(r);for(let e=0;e<o.length&&!(n=null==(i=r[o[e]])?void 0:null===(a=i.assets)||void 0===a?void 0:a.native);e++);if(!n||!i)return null;let{href:c}=n;if(!c)return null;let d=new URL(c).pathname.split("/"),h=d.indexOf(e.id);if(t){let e=(null!==(s=d[d.length-1])&&void 0!==s?s:"").split(".").pop().toLowerCase(),t=tl.includes(e);(l=d.slice(h,t?-1:void 0).join("/"))&&(l+="/")}else l="".concat(e.id,"/");return l},td=(0,em.withRouter)((0,o.Ng)((e,t)=>({dataset:(0,g.vh)(e,t.datasetId),username:(0,g.TO)(e)}),j)(tr)),th=["dataset","datasetContacts","datasetServices","datasetStatus"];class tu extends r.Component{async componentDidMount(){let{dataset:e,datasetId:t}=this.props;e||this.props.queryDatasetDetails(t),(0,m.Gb)(this.props.datasetId);let a=await y(t);this.isUnmounted||this.setState({shortNotifs:a})}componentWillUnmount(){this.isUnmounted=!0}render(){var e,t;let{intl:a,isInitial:s,dataset:n,width:r,view:o,standalone:d}=this.props,{shortNotifs:h}=this.state,g=!(0,f.p)(n)&&!(d&&(null==n?void 0:n.title)),j=th.includes(o),v="layers"===o,_=r<=x.UI.narrowBreak,y=r<=x.UI.mobileBreak,w=g?(0,i.jsx)(S.A,{}):(0,i.jsx)("span",{title:n.id,children:(0,m.AY)(n)}),k=null===(e=x.PAGE_TITLE[o])||void 0===e?void 0:e.call(x.PAGE_TITLE,a),M=Object.keys(null!==(t=null==n?void 0:n.layers)&&void 0!==t?t:{}).length;return(0,i.jsxs)("section",{"data-sentry-component":"DatasetDetails","data-sentry-source-file":"200-DatasetDetails.tsx",className:"jsx-".concat(tp.__hash)+" dataset-details",children:[!d&&(0,i.jsx)(I.A,{isInitial:s,isNested:!0,title:_?k:g||j?w:k,right:(0,i.jsx)("span",{title:a.$t({id:"titleButton.copy",defaultMessage:"Copy URL"}),onClick:()=>(0,b.yp)(a),className:"jsx-".concat(tp.__hash)+" wk-icon-button",children:(0,i.jsx)(p.Icon,{icon:"share-alt"})})}),!d&&(v||_&&j)&&(0,i.jsx)("h3",{className:"jsx-".concat(tp.__hash)+" dataset-title",children:(0,i.jsxs)("div",{className:"jsx-".concat(tp.__hash)+" dataset-title-inner",children:[(0,i.jsx)("span",{className:"jsx-".concat(tp.__hash)+" dataset-title-label",children:w}),!g&&y&&!d&&!v&&(0,m.nv)(n)&&(0,i.jsx)(N.A,{className:"wk-button small primary",href:"".concat(x.URLS.viewer,"?view=layers&dataset=").concat(n.id),children:(0,i.jsx)(c.A,{id:"datasetSidebar.addToMap",defaultMessage:"{numLayers, plural, one {Add to map} other {Add to map…}}",values:{numLayers:M}})})]})}),(0,i.jsxs)("div",{className:"jsx-".concat(tp.__hash)+" "+(u()("content",{narrow:_,standalone:d,layers:v})||""),children:[g&&d&&(0,i.jsx)("div",{style:{height:"100vh"},className:"jsx-".concat(tp.__hash)}),!g&&(0,i.jsxs)("div",{className:"jsx-".concat(tp.__hash)+" "+(u()("content-row",{"main-details":j})||""),children:[j&&(0,i.jsx)(E,{dataset:n,shortNotifs:h,view:o,narrow:_,standalone:d}),(0,i.jsxs)("div",{className:"jsx-".concat(tp.__hash)+" content-main",children:["dataset"===o&&(0,i.jsx)(O.Ay,{datasetId:n.id,standalone:d}),"datasetContacts"===o&&(0,i.jsx)(eu,{datasetId:n.id}),"datasetServices"===o&&(0,i.jsx)(ed,{datasetId:n.id,standalone:d}),"datasetStatus"===o&&(0,i.jsx)(K,{datasetId:n.id,shortNotifs:h,narrow:_}),"datasetDownload"===o&&(0,i.jsx)(eJ,{datasetId:n.id}),"layers"===o&&(0,i.jsx)(e0,{datasetId:n.id}),"files"===o&&(0,i.jsx)(td,{datasetId:n.id,narrow:_})]})]})]}),(0,i.jsx)(l(),{id:tp.__hash,children:tp})]})}constructor(...e){super(...e),this.state={shortNotifs:[]},this.isUnmounted=!1}}let tp=new String(".dataset-title.jsx-6b6fc09819e86d41{background:var(--color-title-bg);margin:0}.dataset-title-inner.jsx-6b6fc09819e86d41{padding:10px var(--modal-padding);border-top:1px solid var(--color-subtle-line)}.dataset-title-label.jsx-6b6fc09819e86d41{margin-right:.6em}.content.jsx-6b6fc09819e86d41{margin:var(--modal-padding)}.content.standalone.jsx-6b6fc09819e86d41{margin-left:0;margin-right:0}.content.layers.jsx-6b6fc09819e86d41{margin:0}.content-row.jsx-6b6fc09819e86d41{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex}.main-details.jsx-6b6fc09819e86d41{margin-bottom:48px}.content-main.jsx-6b6fc09819e86d41{-webkit-box-flex:1;-webkit-flex:1 0 0px;-moz-box-flex:1;-ms-flex:1 0 0px;flex:1 0 0px;overflow:hidden}@media screen and (max-width:".concat(x.UI.mobileBreak,"px){.content-row.jsx-6b6fc09819e86d41{display:block}}"));tp.__hash="6b6fc09819e86d41";let tx=(0,o.Ng)((e,t)=>({dataset:(0,g.vh)(e,t.datasetId)}),j)((0,d.Ay)(tu))},35744:(e,t,a)=>{a.d(t,{Ay:()=>F,lQ:()=>D,UZ:()=>E});var s=a(31085),i=a(93243),n=a.n(i),l=a(14041),r=a(70541),o=a(99870),c=a.n(o),d=a(20409),h=a(64104),u=a(8953),p=a(99420),x=a.n(p),m=a(61474),f=a(55808),b=a.n(f),g=a(89594),j=a(55065),v=a(49608),_=a(77118),y=a(49872),w=a(83832),k=a(81864),M=a(62020);let N=e=>{let t=(0,l.useRef)(null),a=(0,M.A)(t);return(0,l.useEffect)(()=>{e.onChange(a)},[a]),(0,s.jsx)("div",{className:"width-measurer",ref:t,"data-sentry-component":"render","data-sentry-source-file":"975-WidthMeasurer.tsx"})};var S=a(52191),I=a(58778),A=a(50289);class C extends l.Component{componentDidMount(){let{dataset:e}=this.props,{useCases:t}=e,{length:a}=t,s=0;a>3&&(s=Math.floor(Math.random()*(a-3))),this.setState({useCasesStartingSlicePosition:s}),setTimeout(()=>{this.setState({measureWidth:!0})},20)}render(){return(0,s.jsxs)("div",{"data-sentry-component":"DatasetDescription","data-sentry-source-file":"220-DatasetDescription.tsx",className:"jsx-".concat(P.__hash)+" dataset-overview",children:[this.state.measureWidth&&(0,s.jsx)(N,{onChange:e=>this.setState({contentWidth:e})}),this.renderAbstract(),this.renderDocs(),this.renderUseCases(),this.renderClassification(),(0,s.jsx)(n(),{id:P.__hash,children:P})]})}renderAbstract(){let{intl:e,dataset:t,favoriteIds:a,standalone:i}=this.props,{contentWidth:l}=this.state,r=D(e,t,{autoLink:!0}),{readMore:o}=this.state,d=E(r,i),u=r.length!==d.length;u&&(d+=" …");let{isColumn:p,width:x,height:f}=O(l),b=(0,v.o7)(t),g=null;i&&!b&&null!=x&&null!=f&&(g=(0,y.h)(t,x,f,{basemap:!0,isExternalEmbed:!0}));let j=i||b;return(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" "+(c()("abstract",{column:i&&!b&&p})||""),children:[(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" overview",children:[(0,s.jsxs)("h3",{className:"jsx-".concat(P.__hash)+" cm-section-title abstract-title",children:[(0,s.jsx)(h.A,{id:"datasetDetails.overview",defaultMessage:"Overview"}),!i&&(0,s.jsx)(A.A,{standalone:!!i,dataset:t,isFavorite:(a||[]).indexOf(t.id)>=0})]}),(0,s.jsx)(m.$,{linkTarget:"_blank",components:{del:e=>{let{children:t,...a}=e;return(0,s.jsxs)("span",{...a,className:"jsx-".concat(P.__hash)+" "+(a&&null!=a.className&&a.className||""),children:["~",t,"~"]})}},children:o?r:d}),u&&(0,s.jsx)("p",{className:"jsx-".concat(P.__hash),children:(0,s.jsx)("span",{onClick:this.onClickReadMore,className:"jsx-".concat(P.__hash)+" wk-link",children:o?(0,s.jsx)(h.A,{id:"datasetDetails.readLess",defaultMessage:"Read less"}):(0,s.jsx)(h.A,{id:"datasetDetails.readMore",defaultMessage:"Read more"})})})]}),j&&(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" preview",children:[g&&(0,s.jsx)(I.A,{batchConfig:g,width:x,height:f,exploreButton:!0}),b&&this.renderOmiImage()]}),(0,s.jsx)(n(),{id:P.__hash,children:P})]})}renderOmiImage(){let{omiFigureUrl:e}=this.props.dataset;return e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("img",{src:e,alt:"OMI preview",className:"jsx-".concat(z.__hash)+" omi-preview"}),(0,s.jsx)("div",{className:"jsx-".concat(z.__hash)+" download",children:(0,s.jsx)("a",{href:e,target:"_blank",rel:"noreferrer",className:"jsx-".concat(z.__hash)+" wk-button",children:(0,s.jsx)(h.A,{id:"datasetDetails.downloadImage",defaultMessage:"Download image"})})}),(0,s.jsx)(n(),{id:z.__hash,children:z})]}):(0,s.jsx)(d.LargeMessage,{children:(0,s.jsx)(h.A,{id:"datasetDetails.noPreview",defaultMessage:"No preview available"})})}renderDocs(){let{dataset:e,intl:t}=this.props,a=(0,v.mh)(e,t);return a&&a.length?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h3",{className:"jsx-".concat(P.__hash)+" cm-section-title documentation",children:(0,s.jsx)(h.A,{id:"datasetDetails.documentation",defaultMessage:"Documentation"})}),a.map(e=>{let{icon:t,family:a}=(0,v.mz)(e);if(!e.url)return null;let{url:i}=e;return i=i.replace(/^http:\/\/marine.copernicus.eu/,"https://documentation.marine.copernicus.eu"),(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" cm-tabular-item documentation",children:(0,s.jsxs)("a",{href:i,target:"_blank",rel:"noreferrer",title:e.ref,className:"jsx-".concat(P.__hash),children:[(0,s.jsx)(d.Icon,{icon:t,family:a}),e.title]})},i)}),(0,s.jsx)(n(),{id:P.__hash,children:P})]}):null}renderUseCases(){var e;let{dataset:t}=this.props,{useCasesStartingSlicePosition:a}=this.state;if(!(null==t?void 0:null===(e=t.useCases)||void 0===e?void 0:e.length)||null===a)return null;let{useCases:i}=t,l=a+3,r=i.slice(a,l),o=i.slice(0,a).concat(i.slice(l));return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h3",{ref:this.refUseCases,className:"jsx-".concat(P.__hash)+" cm-section-title",children:(0,s.jsx)(h.A,{id:"datasetDetails.useCases",defaultMessage:"Use cases"})}),(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" use-cases-wrapper",children:r.map(this.renderUseCase)}),this.state.showAllUseCases&&(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" use-cases-wrapper",children:o.map(this.renderUseCase)}),o.length>0&&(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" use-cases-button-wrapper",children:(0,s.jsx)("button",{onClick:()=>{if(this.state.showAllUseCases){var e,t;null===(t=this.refUseCases)||void 0===t||null===(e=t.current)||void 0===e||e.scrollIntoView()}this.setState(e=>({showAllUseCases:!e.showAllUseCases}))},className:"jsx-".concat(P.__hash)+" wk-button",children:this.state.showAllUseCases?(0,s.jsx)(h.A,{id:"datasetDetails.useCasesLess",defaultMessage:"Show fewer cases"}):(0,s.jsx)(h.A,{id:"datasetDetails.useCasesMore",defaultMessage:"Show {numCases, plural, =1 {one more case} other {# more cases}}",values:{numCases:o.length}})})}),(0,s.jsx)(n(),{id:P.__hash,children:P})]})}renderClassification(){var e,t,a,i;let{intl:l,dataset:r}=this.props,o=(0,j.FACET_NAMES)(l),{originatingCenter:c,areas:u,vertLevels:p,communities:m,processingLevel:f,mainVariables:g,allVariables:y,projection:w,assimilatedData:k,formats:M,updateFrequencies:N,featureTypes:S,indicatorFamilies:I}=r,A=null!==(a=null===(e=r.sources)||void 0===e?void 0:e.slice())&&void 0!==a?a:void 0;A&&A.sort(_.w);let C=null!==(i=null===(t=r.tempResolutions)||void 0===t?void 0:t.slice())&&void 0!==i?i:void 0;C&&C.sort(_.uQ);let D=(0,v.Sj)(l,r),T=(0,v.fb)(r),{lonStr:L,latStr:E}=(0,v.ne)(l,r),O=null!=y?y:g,z=r.modifiedDate&&r.modifiedDate>"2023-03-01"?x().utc(r.modifiedDate).format("D MMMM YYYY"):null,F="Hi! I've spotted an error in the metadata for product ".concat(r.id,": ");return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h3",{className:"jsx-".concat(P.__hash)+" cm-section-title",children:(0,s.jsx)(h.A,{id:"datasetDetails.classification",defaultMessage:"Classification"})}),(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" cm-tabular-item",children:[(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" label",children:(0,s.jsx)(h.A,{id:"datasetDetails.fullName",defaultMessage:"Full name"})}),(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" value",children:(0,v.AY)(r)})]}),(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" cm-tabular-item",children:[(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" label",children:(0,s.jsx)(h.A,{id:"datasetDetails.productId",defaultMessage:"Product ID"})}),(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" value",children:r.id})]}),A.length>0&&(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" cm-tabular-item",children:[(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" label",children:o.sources}),(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" value",children:A.map(e=>(0,s.jsx)("span",{className:"jsx-".concat(P.__hash)+" subvalue",children:(0,v.JI)(l,e)},e))})]}),(u.length>0||L||E)&&(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" cm-tabular-item",children:[(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" label",children:(0,s.jsx)(h.A,{id:"datasetDetails.spatialExtent",defaultMessage:"Spatial extent"})}),(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" value",children:[u.length>0&&u.map(e=>(0,s.jsx)("span",{className:"jsx-".concat(P.__hash)+" subvalue",children:(0,v.JI)(l,e)},e)),E&&(0,s.jsx)("span",{className:"jsx-".concat(P.__hash)+" subvalue",children:E}),L&&(0,s.jsx)("span",{className:"jsx-".concat(P.__hash)+" subvalue",children:L})]})]}),T&&(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" cm-tabular-item",children:[(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" label",children:(0,s.jsx)(h.A,{id:"datasetDetails.spatialResolution",defaultMessage:"Spatial resolution"})}),(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" value",children:T})]}),D&&(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" cm-tabular-item",children:[(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" label",children:(0,s.jsx)(h.A,{id:"datasetDetails.temporalExtent",defaultMessage:"Temporal extent"})}),(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" value",children:D})]}),C.length>0&&(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" cm-tabular-item",children:[(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" label",children:o.tempResolutions}),(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" value",children:C.map(e=>(0,s.jsx)("span",{className:"jsx-".concat(P.__hash)+" subvalue",children:(0,v.JI)(l,e)},e))})]}),null!=p&&p>1&&(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" cm-tabular-item",children:[(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" label",children:(0,s.jsx)(h.A,{id:"datasetDetails.vertLevels",defaultMessage:"Elevation (depth) levels"})}),(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" value",children:p})]}),f&&(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" cm-tabular-item",children:[(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" label",children:o.processingLevel}),(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" value",children:(0,v.JI)(l,f)})]}),O.length>0&&(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" cm-tabular-item",children:[(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" label",children:(0,s.jsx)(h.A,{id:"datasetDetails.variables",defaultMessage:"Variables"})}),(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" value",children:O.map(e=>(0,s.jsx)("span",{className:"jsx-".concat(P.__hash)+" subvalue",children:e},e))})]}),(null==I?void 0:I.length)>0&&(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" cm-tabular-item",children:[(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" label",children:(0,s.jsx)(h.A,{id:"datasetDetails.indicatorFamily",defaultMessage:"Indicator family"})}),(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" value",children:I.map(e=>(0,s.jsx)("span",{className:"jsx-".concat(P.__hash)+" subvalue",children:e},e))})]}),(null==S?void 0:S.length)>0&&(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" cm-tabular-item",children:[(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" label",children:(0,s.jsx)(h.A,{id:"datasetDetails.featureType",defaultMessage:"Feature type"})}),(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" value",children:S.map(e=>(0,s.jsx)("span",{className:"jsx-".concat(P.__hash)+" subvalue",children:(0,v.JI)(l,e)},e))})]}),m.length>0&&(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" cm-tabular-item",children:[(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" label",children:o.communities}),(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" value",children:m.map(e=>(0,s.jsx)("span",{className:"jsx-".concat(P.__hash)+" subvalue",children:(0,v.JI)(l,e)},e))})]}),w&&(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" cm-tabular-item",children:[(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" label",children:(0,s.jsx)(h.A,{id:"datasetDetails.projection",defaultMessage:"Projection"})}),(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" value",children:w})]}),(null==k?void 0:k.length)>0&&(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" cm-tabular-item",children:[(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" label",children:(0,s.jsx)(h.A,{id:"datasetDetails.dataAssimilation",defaultMessage:"Data assimilation"})}),(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" value",children:k.map(e=>(0,s.jsx)("span",{className:"jsx-".concat(P.__hash)+" subvalue",children:e},e))})]}),Object.keys(null!=N?N:{}).length>0&&(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" cm-tabular-item",children:[(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" label",children:(0,s.jsx)(h.A,{id:"datasetDetails.updateFrequency",defaultMessage:"Update frequency"})}),(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" value",children:Object.keys(N).map(e=>{let t=(0,v.JI)(l,b()(e)),a=N[e];return(0,s.jsxs)("span",{className:"jsx-".concat(P.__hash)+" subvalue",children:[t,a?(0,s.jsxs)("span",{className:"jsx-".concat(P.__hash),children:[" – ",(0,s.jsx)("i",{className:"jsx-".concat(P.__hash),children:a})]}):null]},e)})})]}),(null==M?void 0:M.length)>0&&(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" cm-tabular-item",children:[(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" label",children:(0,s.jsx)(h.A,{id:"datasetDetails.format",defaultMessage:"Format"})}),(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" value",children:M.map(e=>(0,s.jsx)("span",{className:"jsx-".concat(P.__hash)+" subvalue",children:e},e))})]}),c&&(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" cm-tabular-item",children:[(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" label",children:o.originatingCenter}),(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" value",children:c})]}),z&&(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" cm-tabular-item",children:[(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" label",children:(0,s.jsx)(h.A,{id:"datasetDetails.lastUpdate",defaultMessage:"Last metadata update"})}),(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" value",children:z})]}),this.renderUserDatasetDetails(),!j.APP_CONFIG.noChatbot&&(0,s.jsxs)("p",{className:"jsx-".concat(P.__hash)+" feedback",children:[(0,s.jsx)(d.Icon,{icon:"bug"}),"\xa0\xa0",(0,s.jsx)(h.A,{id:"datasetDetails.spottedError",defaultMessage:"Spotted an error?"}),"\xa0\xa0",(0,s.jsx)("span",{onClick:()=>{this.props.chatbotToggle(F)},className:"jsx-".concat(P.__hash)+" wk-link",children:(0,s.jsx)(h.A,{id:"datasetDetails.chatInvitation",defaultMessage:"Send us a note through the chat!"})})]}),(0,s.jsx)(n(),{id:P.__hash,children:P})]})}renderUserDatasetDetails(){let{userDatasetDetails:e}=this.props.dataset;if(!e)return null;let{username:t,dateCreated:a,deleteAt:i}=e;return(0,s.jsxs)(s.Fragment,{children:[t&&(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" cm-tabular-item",children:[(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" label",children:(0,s.jsx)(h.A,{id:"datasetDetails.username",defaultMessage:"Created by"})}),(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" value",children:t})]}),a&&(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" cm-tabular-item",children:[(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" label",children:(0,s.jsx)(h.A,{id:"datasetDetails.createdAt",defaultMessage:"Creation date"})}),(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" value",children:x().utc(a).format("D MMMM YYYY")})]}),i&&(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" cm-tabular-item",children:[(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" label",children:(0,s.jsx)(h.A,{id:"datasetDetails.deleteAt",defaultMessage:"Deletion planned"})}),(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" value",children:x().utc(i).format("D MMMM YYYY")})]}),(0,s.jsx)(n(),{id:P.__hash,children:P})]})}constructor(...e){super(...e),this.refUseCases=l.createRef(),this.state={readMore:!1,showAllUseCases:!1,useCasesStartingSlicePosition:null,contentWidth:null,measureWidth:!1},this.renderUseCase=(e,t)=>{let{href:a,title:i,imageSrc:l}=e;return(0,s.jsxs)(S.A,{className:"wk-use-case",href:a,openInNewTab:!0,children:[(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash),children:[(0,s.jsx)("img",{src:l,alt:"".concat(i," image"),className:"jsx-".concat(P.__hash)+" use-case-image"}),(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" use-case-title",children:i})]}),(0,s.jsx)(n(),{id:P.__hash,children:P})]},"".concat(i,"-").concat(t))},this.onClickReadMore=()=>{this.setState({readMore:!this.state.readMore}),(0,g.PJ)({category:"catalogue",action:"expandAbstract"})}}}let D=function(e,t){var a;let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=(null===(a=t.abstract)||void 0===a?void 0:a.trim())||e.$t({id:"unfurl.none",defaultMessage:"No description."}),{externalInfoUrl:n,externalProviderUrl:l,externalProductUrl:r}=t,o=n||r||l;return o&&(i+="\n\n**For further information, please refer to:** ".concat(o)),s.autoLink&&(i=L(i)),i},T=/(?:(?:https?|ftp|file):\/\/|www\.|ftp\.)(?:\([-A-Z0-9+&@#/%=~_|$?!:,.]*\)|[-A-Z0-9+&@#/%=~_|$?!:,.])*(?:\([-A-Z0-9+&@#/%=~_|$?!:,.]*\)|[A-Z0-9+&@#/%=~_|$])/gim,L=e=>e.replace(T,e=>"[".concat(e,"](").concat(e,")")),E=(e,t)=>{let a;let s=t?1300:400,i=e.matchAll(/\.\s+?/g),n=0;for(;;){var l;let{value:t}=i.next();if(!t)break;let r=t.index+1,o=r+85*(null!==(l=e.slice(0,r).match(/\n/g))&&void 0!==l?l:[]).length;if(o>s){let e=Math.abs(s-n),t=Math.abs(s-o);(!a||t<=e)&&(a=r);break}n=o}let r=e;return a&&a<e.length-100&&(r=r.slice(0,a)),r},O=e=>{if(!e)return{isColumn:!1,width:null,height:null};let t=e>800;return{isColumn:t,width:t?e/2:e,height:500}},P=new String('.abstract.column.jsx-d89044a2fe95523f{display:grid;grid-template-columns:50%50%}.abstract.column.jsx-d89044a2fe95523f .overview.jsx-d89044a2fe95523f{padding-right:30px}.abstract.jsx-d89044a2fe95523f .preview.jsx-d89044a2fe95523f{margin-top:20px;margin-bottom:20px}.abstract.column.jsx-d89044a2fe95523f .preview.jsx-d89044a2fe95523f{margin-top:0;margin-bottom:20px}.abstract-title.jsx-d89044a2fe95523f{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-moz-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.subvalue.jsx-d89044a2fe95523f+.subvalue.jsx-d89044a2fe95523f{margin-left:.4em}.subvalue.jsx-d89044a2fe95523f+.subvalue.jsx-d89044a2fe95523f::before{content:"\xb7";color:gray;padding-right:.4em}.tag.jsx-d89044a2fe95523f{display:inline-block}.tag.jsx-d89044a2fe95523f+.tag.jsx-d89044a2fe95523f::before{margin:0 .5em;content:"\xb7";color:#999}.feedback.jsx-d89044a2fe95523f{margin-top:40px;font-style:italic}.use-cases-wrapper.jsx-d89044a2fe95523f{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-top:15px}.use-case-image.jsx-d89044a2fe95523f{width:100%}.use-case-title.jsx-d89044a2fe95523f{font-size:.9rem;margin-bottom:1em}.use-cases-button-wrapper.jsx-d89044a2fe95523f{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;align-item:center;margin-top:1em}.wk-use-case{width:100%}@media screen and (min-width:'.concat(j.UI.mobileBreak+1,"px){.documentation.jsx-d89044a2fe95523f{display:none}}@media screen and (min-width:").concat(j.UI.narrowBreak+1,"px){.documentation.jsx-d89044a2fe95523f{display:none}.use-cases-wrapper.jsx-d89044a2fe95523f{grid-template-columns:1fr 1fr 1fr}}"));P.__hash="d89044a2fe95523f";let z=new String(".omi-preview.jsx-ce860c8164a9da6d{display:block;width:100%}.download.jsx-ce860c8164a9da6d{text-align:center}");z.__hash="ce860c8164a9da6d";let F=(0,r.Ng)((e,t)=>({dataset:(0,w.vh)(e,t.datasetId),favoriteIds:(0,w.ZL)(e)}),k)((0,u.Ay)(C))},89174:(e,t,a)=>{a.d(t,{A:()=>C});var s=a(31085),i=a(93243),n=a.n(i),l=a(14041),r=a(64104),o=a(8953),c=a(99870),d=a.n(c),h=a(24626),u=a(20409),p=a(51893),x=a(55065),m=a(49608),f=a(77118),b=a(20481),g=a(64725),j=a(68476);let v="relevant-",_="relevant";class y extends l.Component{componentDidMount(){let e=Object.keys(this.props.dataset.layers||{}).length,t={},{relevantGroups:a}=this,s=a.length>0;a.forEach(e=>{let{id:a}=e;t[a]=!0});let{groups:i}=this;s||(e<12||i.length<=1?i.forEach(e=>{let{id:a}=e;t[a]=!0}):i.forEach(e=>{e.isActive&&(t[e.id]=!0)}));let{expandedSections:n}=this.state;s&&(n=(0,h.set)(n,"all",!1)),this.setState({expandedGroups:t,expandedSections:n})}render(){let{dataset:e,activeTeroLayerIds:t,facetValues:a,mini:i}=this.props,{textSearch:n}=this.state;this.groups=w(e,t,{textSearch:n}),this.relevantGroups=i?[]:w(e,t,{facetValues:a});let l=this.relevantGroups.length>0;return(0,s.jsxs)(s.Fragment,{children:[this.renderSection(this.relevantGroups,(0,s.jsxs)("span",{children:[(0,s.jsx)(r.A,{id:"datasetLayers.relevantLayersHeading",defaultMessage:"Layers relevant to:"})," ",this.renderFilters()]}),_),this.renderSection(this.groups,l?(0,s.jsx)(r.A,{id:"datasetLayers.allLayersHeading",defaultMessage:"All layers"}):null,"all")]})}constructor(...e){super(...e),this.state={expandedGroups:{},expandedSections:{[_]:!0,all:!0},textSearch:""},this.groups=[],this.relevantGroups=[],this.renderFilters=()=>{var e,t;let a=null!==(t=(null!==(e=this.props.facetValues)&&void 0!==e?e:{}).mainVariables)&&void 0!==t?t:"";return(0,s.jsxs)("span",{className:"jsx-".concat(N.__hash)+" filters",children:[a&&(0,s.jsx)("i",{className:"jsx-".concat(N.__hash)+" filter",children:a}),(0,s.jsx)(n(),{id:N.__hash,children:N})]})},this.renderSection=(e,t,a)=>{if(!e.length)return null;let{mini:i}=this.props,l=a===_,{expandedSections:r}=this.state,o=r[a],c=!l,p=t&&!l,x=!l&&e.length>10&&o&&"";return(0,s.jsxs)("section",{className:"jsx-".concat(S.__hash)+" "+(d()({deemphasise:p,mini:i})||""),children:[t&&(0,s.jsxs)("h2",{onClick:c?()=>{r=(0,h.set)(r,a,!o),this.setState({expandedSections:r})}:void 0,className:"jsx-".concat(S.__hash)+" "+(d()({clickable:c})||""),children:[t,!l&&(0,s.jsx)("span",{className:"jsx-".concat(S.__hash)+" icon-expand",children:(0,s.jsx)(u.Icon,{icon:o?"caret-up":"caret-down"})})]}),x&&this.renderSearch(),o&&e.map(e=>this.renderLayerGroup(e,l)),(0,s.jsx)(n(),{id:S.__hash,children:S})]})},this.renderSearch=()=>{let{textSearch:e}=this.state;return(0,s.jsxs)("div",{className:"jsx-".concat(S.__hash)+" search",children:[(0,s.jsx)("input",{type:"text",placeholder:this.props.intl.$t({id:"datasetLayers.search",defaultMessage:"Search by title or ID"}),value:e,onChange:e=>this.setState({textSearch:e.target.value}),className:"jsx-".concat(S.__hash)+" search-input"}),(0,s.jsx)(n(),{id:S.__hash,children:S})]})},this.renderLayerGroup=(e,t)=>{let{mini:a,settings:i}=this.props,{expandedGroups:l}=this.state,{id:r,title:o,originalTitle:c,matchesFilter:h}=e;if(!h)return null;let{subdatasetId:m,extension:f,layers:b}=e,j=!!l[r],v=!j&&e.isActive,_=m===x.PLACEHOLDER_ID||"default"===m||"all"===m,y=_?null:(0,s.jsxs)(s.Fragment,{children:[(0,p.getTaglessSubdatasetId)(m),f&&(0,s.jsx)("span",{className:"jsx-".concat(I.__hash)+" title-extension",children:f}),(0,s.jsx)(n(),{id:I.__hash,children:I})]}),w=i.hideSubdatasetIds||this.props.mini;return(0,s.jsxs)("div",{className:"jsx-".concat(I.__hash)+" "+(d()("layer-group",{mini:a})||""),children:[(0,s.jsxs)("h3",{onClick:()=>this.onToggleGroup(r),className:"jsx-".concat(I.__hash)+" "+(d()("group-title",{active:v,hidden:_})||""),children:[(0,s.jsx)("span",{title:o&&w?m:void 0,className:"jsx-".concat(I.__hash)+" group-title-text",children:o?(0,s.jsx)(g.A,{title:o,originalTitle:c}):(0,s.jsxs)(s.Fragment,{children:["Dataset: ",(0,s.jsx)("i",{className:"jsx-".concat(I.__hash),children:y})]})}),this.renderGroupExtras(e,t),(0,s.jsx)(u.Icon,{icon:j?"caret-up":"caret-down"})]}),o&&!w&&y&&(0,s.jsx)("div",{className:"jsx-".concat(I.__hash)+" subtitle",children:y}),j&&(0,s.jsx)("ul",{className:"jsx-".concat(I.__hash)+" layers",children:b.map(t=>this.renderLayer(t,e.variableTitleCounts[t.variableTitle]>1))}),(0,s.jsx)(n(),{id:I.__hash,children:I})]},r)},this.renderGroupExtras=(e,t)=>{let{intl:a}=this.props,{stacItem:i,layers:l}=e,r=l.some(e=>e.isViewable),o=l.length;return(0,s.jsxs)("span",{className:"jsx-".concat(I.__hash)+" group-extras",children:[!t&&(0,s.jsx)("span",{title:a.$t({id:"datasetLayers.numLayers",defaultMessage:"{numLayers, plural, one {1 layer} other {# layers}} in this dataset"},{numLayers:o}),className:"jsx-".concat(I.__hash)+" group-num-layers",children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.Icon,{icon:"layer-group"})," ",(0,s.jsx)("span",{className:"jsx-".concat(I.__hash)+" num-layers",children:o})]})}),!r&&(0,s.jsx)("span",{title:a.$t({id:"datasetLayers.nonViewableHint",defaultMessage:"This dataset contains no viewable layers, but you can add it to the map and use the download tool to access the data you need."}),className:"jsx-".concat(I.__hash)+" group-num-layers",children:(0,s.jsx)(u.Icon,{icon:"fa-eye-slash"})}),i&&(0,s.jsx)(j.A,{stacItem:i}),(0,s.jsx)(n(),{id:I.__hash,children:I})]})},this.renderLayer=(e,t)=>{var a;let i;let{intl:l,dataset:o,activeTeroLayerIds:c,mini:h}=this.props,{onClickAdd:p,onClickRemove:f,onClickSelect:g}=this.props,j=o.id,{id:v,variableId:_,hasVectorStyle:y}=e,w=e.isVariableTitleUntranslated&&_!==x.PLACEHOLDER_ID,k="".concat(j,"/").concat(v),M=c.indexOf(k)>=0;return!M&&g&&(i=e=>g(k,e.altKey)),(0,s.jsxs)("li",{onClick:i,className:"jsx-".concat(A.__hash)+" "+(d()("layer",{active:M,selectable:null!=i,mini:h})||""),children:[(0,s.jsxs)("div",{title:v,className:"jsx-".concat(A.__hash)+" layer-title",children:[(0,s.jsx)("svg",{viewBox:"0 0 512 312",className:"jsx-".concat(A.__hash)+" bullet",children:(0,s.jsx)("path",{fill:"currentColor",d:"M12.41 148.02l232.94 105.67c6.8 3.09 14.49 3.09 21.29 0l232.94-105.67c16.55-7.51 16.55-32.52 0-40.03L266.65 2.31a25.607 25.607 0 0 0-21.29 0L12.41 107.98c-16.55 7.51-16.55 32.53 0 40.04z",className:"jsx-".concat(A.__hash)})}),(0,s.jsxs)("div",{className:"jsx-".concat(A.__hash)+" "+(d()("layer-title-label",{untranslated:w})||""),children:[null===(a=e.variableTitle)||void 0===a?void 0:a.replace(/_/g," "),y&&(0,s.jsx)("span",{title:l.$t({id:"datasetLayers.vectorHint",defaultMessage:"Vector field, calculated from E and N components"}),className:"jsx-".concat(A.__hash)+" layer-feature",children:(0,s.jsx)(u.Icon,{icon:"fa-arrows-split-up-and-left"})}),(0,s.jsxs)("span",{className:"jsx-".concat(A.__hash)+" variable-id",children:[t&&(0,s.jsxs)(s.Fragment,{children:[(0,m.JM)(e)," "]}),(0,s.jsx)(b.A,{units:e.units,brackets:!0})]}),!e.isViewable&&(0,s.jsx)("span",{title:x.UI.messages.notViewableButDownloadable(l),className:"jsx-".concat(A.__hash)+" layer-feature",children:(0,s.jsx)(u.Icon,{icon:"fa-eye-slash"})})]})]}),!M&&p&&(0,s.jsx)("div",{onClick:()=>p(k),className:"jsx-".concat(A.__hash)+" wk-button small add-remove",children:(0,s.jsx)(r.A,{id:"datasetLayers.addToMap",defaultMessage:"Add to map"})}),M&&f&&(0,s.jsx)("div",{onClick:()=>f(k),className:"jsx-".concat(A.__hash)+" wk-button small add-remove",children:(0,s.jsx)(r.A,{id:"datasetLayers.remove",defaultMessage:"Remove"})}),(0,s.jsx)(n(),{id:A.__hash,children:A})]},v)},this.onToggleGroup=e=>{let{expandedGroups:t}=this.state;t=t[e]?(0,h.omit)(t,[e]):(0,h.set)(t,e,!0),this.setState({expandedGroups:t})}}}let w=function(e,t){var a,s,i;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{facetValues:l}=n,r=null!==(i=null===(s=n.textSearch)||void 0===s?void 0:null===(a=s.toLowerCase())||void 0===a?void 0:a.trim())&&void 0!==i?i:"",o={},c=e.id,d=Object.keys(e.layers),h={},u=null!=l,m=!!r,{subdatasetTitleTranslations:b}=e,g=null==l?void 0:l.mainVariables;if(u&&!g)return[];if(d.forEach(a=>{let s=e.layers[a],{subdatasetId:i,subdatasetTitle:n}=s;if(g&&!M(e,a,g))return;let l=(0,p.getSubdatasetIdExtension)(i),d="".concat(u?v:"").concat(i),x=o[d];if(!x){var f;let t=null!==(f=null==b?void 0:b[n])&&void 0!==f?f:n;t&&h[t]?(h[t]+=1,t+=" (".concat(h[t],")")):h[t]=1;let a=!0;m&&(a=i.toLowerCase().includes(r)||(null==t?void 0:t.toLowerCase().includes(r))||(null==n?void 0:n.toLowerCase().includes(r))),x={id:d,subdatasetId:i,taglessSubdatasetId:(0,p.getTaglessSubdatasetId)(i),extension:l,title:t,originalTitle:n,layers:[],variableTitleCounts:{},isActive:!1,matchesFilter:a,stacItem:e.stacItems[i]},o[d]=x}x.layers.push(s);let{variableTitle:j}=s;null==x.variableTitleCounts[j]&&(x.variableTitleCounts[j]=0),x.variableTitleCounts[j]+=1;let _="".concat(c,"/").concat(a);t.indexOf(_)>=0&&(x.isActive=!0)}),k(e)){let e=[];Object.values(o).forEach(t=>{e.push(...t.layers)});let t={id:"".concat(u?v:"").concat(x.PLACEHOLDER_ID),subdatasetId:x.PLACEHOLDER_ID,taglessSubdatasetId:x.PLACEHOLDER_ID,extension:null,title:x.PLACEHOLDER_ID,originalTitle:x.PLACEHOLDER_ID,layers:e,variableTitleCounts:{},isActive:!1,matchesFilter:!0};o={[t.id]:t}}let j=Object.keys(o).map(e=>o[e]);return j.sort((e,t)=>(0,f.UT)(e.originalTitle||e.subdatasetId,t.originalTitle||t.subdatasetId)),j.forEach(e=>{e.layers.sort((e,t)=>{let a=e.variableTitle,s=t.variableTitle;return null==a&&null!=s?1:null!=a&&null==s?-1:null!=a&&null!=s&&a!==s?a<s?-1:1:e.id<t.id?-1:1})}),j},k=e=>"EMODnet_via_EDITO"===e.catalogue,M=(e,t,a)=>{var s,i,n;let l=e.layers[t];if((null!==(s=null==l?void 0:l.mainVariables)&&void 0!==s?s:[]).includes(a))return!0;let r=null!==(i=null==l?void 0:l.vectorComponentIds)&&void 0!==i?i:[];if(r.length>1){let t=r[0],s="".concat(l.subdatasetId,"/").concat(t),i=e.layers[s];if((null!==(n=null==i?void 0:i.mainVariables)&&void 0!==n?n:[]).includes(a))return!0}return!1},N=new String(".filters.jsx-838283046a4d9471{font-weight:normal}");N.__hash="838283046a4d9471";let S=new String("section.jsx-edc03568807a1c69{padding:var(--modal-padding)}section.mini.jsx-edc03568807a1c69{padding:0}section.deemphasise.jsx-edc03568807a1c69{background:var(--color-title-bg)}section.jsx-edc03568807a1c69+section.jsx-edc03568807a1c69{border-top:1px solid var(--color-subtle-line)}h2.jsx-edc03568807a1c69{margin:0 0 var(--modal-padding);color:var(--color-text-dim)}h2.clickable.jsx-edc03568807a1c69{cursor:pointer}.icon-expand.jsx-edc03568807a1c69{margin-left:.6em}.search.jsx-edc03568807a1c69{text-align:center;margin-bottom:.6em}.search-input.jsx-edc03568807a1c69{width:15em;padding:.2em .5em}");S.__hash="edc03568807a1c69";let I=new String('.layer-group.jsx-ac57885fa4a8decc+.layer-group.jsx-ac57885fa4a8decc{margin-top:9px;border-top:1px solid var(--color-subtle-line);padding-top:9px}.layer-group.mini.jsx-ac57885fa4a8decc+.layer-group.mini.jsx-ac57885fa4a8decc{margin-top:6px;padding-top:6px}.group-title.jsx-ac57885fa4a8decc{margin:0;padding:0;cursor:pointer}.group-title.hidden.jsx-ac57885fa4a8decc,.mini.jsx-ac57885fa4a8decc .group-title.hidden.jsx-ac57885fa4a8decc{display:none}.mini.jsx-ac57885fa4a8decc .group-title.jsx-ac57885fa4a8decc{font-size:inherit;margin:0;padding:0;border-bottom:none;word-break:break-word;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:4;overflow:hidden;color:var(--color-text-dim);font-weight:normal}.group-title.active.jsx-ac57885fa4a8decc,.mini.jsx-ac57885fa4a8decc .group-title.active.jsx-ac57885fa4a8decc{color:var(--color-icon-button-active)}.group-title-text.jsx-ac57885fa4a8decc{margin-right:.6em}.title-extension.jsx-ac57885fa4a8decc{margin-left:.3em;word-break:break-word}.title-extension.jsx-ac57885fa4a8decc::before{content:"— "}.subtitle.jsx-ac57885fa4a8decc{font-size:.75em;color:var(--color-dim)}.group-extras.jsx-ac57885fa4a8decc{display:inline-block}.group-num-layers.jsx-ac57885fa4a8decc{color:var(--color-text-dim);margin-right:.6em}.group-datacube.jsx-ac57885fa4a8decc{color:var(--color-text-dim);opacity:.4;margin-right:.6em}ul.layers.jsx-ac57885fa4a8decc{padding:0}.mini.jsx-ac57885fa4a8decc ul.layers.jsx-ac57885fa4a8decc{margin:8px 0 10px}@media screen and (max-width:'.concat(x.UI.narrowBreak,"px){h3.jsx-ac57885fa4a8decc{font-size:1rem}}"));I.__hash="ac57885fa4a8decc";let A=new String(".layer.jsx-9cb61b97329175b{list-style-type:none;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-moz-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.layer.active.jsx-9cb61b97329175b{color:var(--color-icon-button-active)}.layer.selectable.jsx-9cb61b97329175b{cursor:pointer}.layer.jsx-9cb61b97329175b+.layer.jsx-9cb61b97329175b{margin-top:.6em}.layer.mini.jsx-9cb61b97329175b+.layer.mini.jsx-9cb61b97329175b{margin-top:1px}.layer.jsx-9cb61b97329175b .add-to-map.jsx-9cb61b97329175b{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-left:10px}.layer.active.jsx-9cb61b97329175b .add-to-map.jsx-9cb61b97329175b{opacity:0;pointer-events:none}.layer-title.jsx-9cb61b97329175b{-webkit-box-flex:1;-webkit-flex:1 1 0px;-moz-box-flex:1;-ms-flex:1 1 0px;flex:1 1 0px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:baseline;-webkit-align-items:baseline;-moz-box-align:baseline;-ms-flex-align:baseline;align-items:baseline}.layer-feature.jsx-9cb61b97329175b{margin-left:.3em;color:var(--color-text-dim)}.bullet.jsx-9cb61b97329175b{display:block;width:13px;margin-right:.3em;color:var(--color-text-dim)}.layer-title-label.jsx-9cb61b97329175b{-webkit-box-flex:1;-webkit-flex:1 1 0px;-moz-box-flex:1;-ms-flex:1 1 0px;flex:1 1 0px}.layer-title-label.untranslated.jsx-9cb61b97329175b{font-style:italic}.variable-id.jsx-9cb61b97329175b{color:var(--color-disabled);margin-left:.4em}.add-remove.jsx-9cb61b97329175b{color:black;margin-left:.4em}");A.__hash="9cb61b97329175b";let C=(0,o.Ay)(y)},64725:(e,t,a)=>{a.d(t,{A:()=>h});var s=a(31085),i=a(93243),n=a.n(i);a(14041);var l=a(99870),r=a.n(l),o=a(8867);let c=[{regex:/interim/i,url:"https://help.marine.copernicus.eu/en/articles/4872705-what-are-the-main-differences-between-nearrealtime-and-multiyear-products"},{regex:/AMSR/,msg:"Satellite microwave radiometer"},{regex:/SSMIS/,msg:"Special Sensor Microwave Imager/Sounder"},{regex:/SSMI/,msg:"Special Sensor Microwave/Imager"},{regex:/OLCI/,msg:"Ocean and Land Colour Instrument"}],d=new String(".info.jsx-e2d5ff74dbd790de{padding-left:.1em;padding-right:.05em}.info.no-hover.jsx-e2d5ff74dbd790de:hover{color:var(--color-dim)}.fragment.jsx-e2d5ff74dbd790de{word-break:break-word}");d.__hash="e2d5ff74dbd790de";let h=e=>{let t=(0,o.A)(),a=e=>{let a=c.find(t=>t.regex.test(e));if(!a)return null;let{url:i,msg:l}=a,o=l||(i?t.$t({id:"subdatasetTitle.clickHint",defaultMessage:"Click for more info"}):void 0);return(0,s.jsxs)("a",{href:i,target:"_blank",rel:"noopener noreferrer",title:o,"data-sentry-component":"renderFragmentInfo","data-sentry-source-file":"315-SubdatasetTitle.tsx",className:"jsx-".concat(d.__hash)+" "+(r()("info",{"no-hover":!i})||""),children:[(0,s.jsx)("sup",{className:"jsx-".concat(d.__hash),children:"?"}),(0,s.jsx)(n(),{id:d.__hash,children:d})]})};return(()=>{let{title:t,originalTitle:i}=e,l=t.split(/([^a-zA-Z0-9\u00C0-\u017F]+)/),r=(null!=i?i:t).split(/([^a-zA-Z0-9\u00C0-\u017F]+)/),o=[];for(let e=0;e<l.length;e+=2){var c;let t=l[e],i=null!==(c=null==r?void 0:r[e])&&void 0!==c?c:t,h=l[e+1];o.push((0,s.jsxs)("span",{className:"jsx-".concat(d.__hash)+" fragment",children:[t,a(i),(0,s.jsx)(n(),{id:d.__hash,children:d})]},e)),h&&o.push((0,s.jsx)("span",{children:h},e+1))}return(0,s.jsx)(s.Fragment,{children:o})})()}},58778:(e,t,a)=>{a.d(t,{A:()=>v});var s=a(31085),i=a(93243),n=a.n(i),l=a(14041),r=a(99870),o=a.n(r),c=a(70541),d=a(31242),h=a(20409),u=a(64104),p=a(83832),x=a(73859),m=a(81864),f=a(71096);class b extends l.Component{componentDidCatch(e){console.error("EmbeddedViewer caught the following error:",e),this.setState({error:e})}render(){return this.state.error?(0,s.jsx)(h.LargeMessage,{"data-sentry-element":"LargeMessage","data-sentry-component":"EmbeddedViewer","data-sentry-source-file":"400-EmbeddedViewer.tsx",children:(0,s.jsx)(u.A,{id:"embeddedViewer.genericError",defaultMessage:"The embedded viewer cannot currently be used. Please report using the chat.","data-sentry-element":"FormattedMessage","data-sentry-source-file":"400-EmbeddedViewer.tsx"})}):(0,s.jsx)(g,{...this.props,"data-sentry-element":"_EmbeddedViewer","data-sentry-component":"EmbeddedViewer","data-sentry-source-file":"400-EmbeddedViewer.tsx"})}constructor(...e){super(...e),this.state={error:null}}}let g=e=>{let t=(0,c.Pj)(),[a]=(0,l.useState)(()=>{let a=(0,x.e)(t.getState());return a.dispatch((0,m.setIsSubstore)(!0)),a.dispatch((0,m.setMapObjects)({})),a.dispatch((0,m.setActiveTool)(null)),a.dispatch((0,m.modalCloseAll)()),a.dispatch((0,m.batchConfigure)(e.batchConfig,{forceMapView:!0})),a}),i=(0,c.d4)(p.wz),r=(0,c.d4)(p.c4);(0,l.useEffect)(()=>{null!=i&&null!=r?a.dispatch((0,m.logInSucceeded)(i,r)):a.dispatch((0,m.logOutSucceeded)())},[a,i,r]);let{onStoreChange:h}=e;(0,l.useEffect)(()=>{if(h){let e=a.subscribe(()=>{h(a.getState())});return()=>e()}},[a,h]);let b=(0,d.useRouter)(),g=()=>{let e=a.getState(),t=(0,p.cm)(e,{forceMapView:!0,removeBasemap:!0});b.push(t)};return(()=>{let{width:t,height:i,noBorder:l}=e;if(null==t||null==i)return null;let r=l?0:1;return(0,s.jsxs)("div",{"data-sentry-component":"render","data-sentry-source-file":"400-EmbeddedViewer.tsx",className:"jsx-".concat(j.__hash)+" embedded-viewer",children:[(0,s.jsx)("div",{style:{width:t,height:i},className:"jsx-".concat(j.__hash)+" "+(o()("viewer-wrapper",{"no-border":l})||""),children:(0,s.jsx)(c.Kq,{store:a,"data-sentry-element":"StoreProvider","data-sentry-source-file":"400-EmbeddedViewer.tsx",children:(0,s.jsx)(f.A,{width:t-2*r,height:i-2*r,"data-sentry-element":"ViewerApp","data-sentry-source-file":"400-EmbeddedViewer.tsx"})})}),e.exploreButton&&(0,s.jsx)("div",{onClick:g,className:"jsx-".concat(j.__hash)+" link-full-viewer",children:(0,s.jsx)(u.A,{id:"embeddedViewer.exploreButton",defaultMessage:"Explore in MyOcean Pro"})}),(0,s.jsx)(n(),{id:j.__hash,children:j})]})})()},j=new String(".viewer-wrapper.jsx-dd9227c6182ea3e{border:1px solid var(--color-subtle-line)}.viewer-wrapper.no-border.jsx-dd9227c6182ea3e{border:none}.link-full-viewer.jsx-dd9227c6182ea3e{display:block;margin-top:10px;background:var(--color-title-bg-slightly-darker);padding:10px;text-align:center;color:black;cursor:pointer}.link-full-viewer.jsx-dd9227c6182ea3e:hover{opacity:.85}");j.__hash="dd9227c6182ea3e";let v=b},68476:(e,t,a)=>{a.d(t,{A:()=>s}),a(31085),a(93243),a(14041),a(99420),a(20409),a(52191),new String(".cm-warn-released.jsx-771339bfd36c0cba{color:darkgreen;margin-right:.6em}.cm-warn-retired{color:orange;margin-right:.6em}.cm-warn-retired:hover{color:darkorange}").__hash="771339bfd36c0cba";let s=e=>{let{stacItem:t}=e;return null}},13037:(e,t,a)=>{a.d(t,{A:()=>et,s:()=>J});var s=a(31085),i=a(93243),n=a.n(i),l=a(14041),r=a(70541),o=a(64104),c=a(8953),d=a(99870),h=a.n(d),u=a(24626),p=a(45833),x=a(31242),m=a(20409),f=a(55065),b=a(88358),g=a(41821),j=a(81864),v=a(83832),_=a(89594),y=a(45511),w=a(52191),k=a(38221),M=a.n(k),N=a(71096),S=a(49608),I=a(70226),A=a(77118),C=a(19416),D=a(2866);class T extends l.Component{componentDidMount(){let{multiObject:e}=this.props;(null==e?void 0:e.features.length)===0&&this.setState({showExtendedConfig:!0})}render(){let{width:e,multiObject:t}=this.props;return t?(0,I.p)(t)?(0,s.jsxs)("div",{"data-sentry-component":"GraphCardContent","data-sentry-source-file":"110-GraphCardContent.tsx",className:"jsx-".concat(L.__hash)+" graph-card-outer",children:[this.renderCardConfig(),(0,s.jsx)(D.A,{mapObject:t,feature:null,isMainPin:!0,coords:[NaN,NaN],inCard:!0,onDragMove:()=>{},onDragEnd:()=>{},width:e,"data-sentry-element":"PinBox","data-sentry-source-file":"110-GraphCardContent.tsx"}),(0,s.jsx)(n(),{id:L.__hash,children:L})]}):(0,s.jsx)(C.A,{"data-sentry-element":"Spinner","data-sentry-component":"GraphCardContent","data-sentry-source-file":"110-GraphCardContent.tsx"}):null}renderCardConfig(){return(0,s.jsxs)("div",{className:"jsx-".concat(L.__hash)+" card-config",children:[this.renderLayerSelect(),this.renderFeatureSelect(),(0,s.jsx)(n(),{id:L.__hash,children:L})]})}renderLayerSelect(){let{showExtendedConfig:e}=this.state,{intl:t,mapLayers:a,multiObject:i,datasets:l}=this.props,r=[];return Object.keys(a).forEach(e=>{let s=a[e];if(s.isDashboardOverlay)return;let i=l[(0,S.ei)(s.layerId).datasetId],n=!(0,I.p)(i),o=(0,S.VF)(l,s.layerId);if(n||!o)return;let c={context:s.dashboardLabel},d=(0,S.ez)(o,i,t,c);r.push({label:d,value:e})}),r.sort(A.Y3),r.unshift({label:"— "+t.$t({id:"dashboard.card.selectVariable",defaultMessage:"Select a variable:"}),value:""}),(0,s.jsxs)("div",{className:"jsx-".concat(L.__hash)+" config-section",children:[(0,s.jsxs)("div",{className:"jsx-".concat(L.__hash)+" config-line",children:[(0,s.jsx)("select",{value:i.mapLayerId,onChange:this.onChangeLayer,className:"jsx-".concat(L.__hash)+" layer",children:r.map(e=>{let{label:t,value:a}=e;return(0,s.jsx)("option",{value:a,className:"jsx-".concat(L.__hash),children:t},a)})}),(0,s.jsx)("div",{className:"jsx-".concat(L.__hash)+" "+(h()("btn-extend-config",{active:e})||""),children:(0,s.jsx)(m.Icon,{icon:"cog",onClick:()=>this.setState({showExtendedConfig:!e})})})]}),(0,s.jsx)(n(),{id:L.__hash,children:L})]})}renderFeatureSelect(){let{showExtendedConfig:e}=this.state;if(!e)return null;let{intl:t,mapObjects:a,multiObject:i}=this.props,l=i.features.map(e=>e.properties.id),r=[];return Object.values(a).forEach(e=>{var a;if(e.isMulti)return;let s=null==e?void 0:null===(a=e.features)||void 0===a?void 0:a[0];if(!s||"string"==typeof s)return;let{id:i}=s.properties,n=(0,S._9)(s,t);r.push({label:n||i,value:i})}),(0,s.jsxs)("div",{className:"jsx-".concat(L.__hash)+" config-section",children:[(0,s.jsx)("div",{title:"",className:"jsx-".concat(L.__hash)+" config-label",children:(0,s.jsx)(o.A,{id:"dashboard.card.geometries",defaultMessage:"Geometries"})}),(0,s.jsx)("select",{multiple:!0,value:l,onChange:this.onChangeFeatures,title:t.$t({id:"dashboard.card.geometriesHint",defaultMessage:"Press Shift/{altKey} to select multiple entries"},{altKey:(0,S.cX)()?"⌘":"Ctrl"}),className:"jsx-".concat(L.__hash)+" feature",children:r.map(e=>(0,s.jsx)("option",{value:e.value,className:"jsx-".concat(L.__hash),children:e.label},e.value))}),(0,s.jsx)(n(),{id:L.__hash,children:L})]})}constructor(...e){super(...e),this.state={showExtendedConfig:!1},this.onChangeLayer=e=>{let t=e.target.value;if(""===t)return;let{multiObject:a}=this.props;this.props.setMultiObjectLayer(a.id,t),(0,_.PJ)({category:"dashboard",action:"cardReconfigure"})},this.onChangeFeatures=e=>{let{multiObject:t}=this.props,a=Array.from(e.target.selectedOptions).map(e=>e.value),s=t.features.map(e=>e.properties.id);JSON.stringify(a)!==JSON.stringify(s)&&(this.props.setMultiObjectFeatures(t.id,a),(0,_.PJ)({category:"dashboard",action:"cardReconfigure"}))}}}let L=new String(".card-config.jsx-fe40b6377a7bf0c6{padding:8px;font-size:.8rem}.config-section.jsx-fe40b6377a7bf0c6{width:100%;max-width:100%}.config-section.jsx-fe40b6377a7bf0c6+.config-section.jsx-fe40b6377a7bf0c6{margin-top:5px}.config-line.jsx-fe40b6377a7bf0c6{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:baseline;-webkit-align-items:baseline;-moz-box-align:baseline;-ms-flex-align:baseline;align-items:baseline}.btn-extend-config.jsx-fe40b6377a7bf0c6{padding-left:8px}.btn-extend-config.active.jsx-fe40b6377a7bf0c6{color:var(--color-accent-bg)}.config-label.jsx-fe40b6377a7bf0c6{color:var(--color-text-dim)}select.layer.jsx-fe40b6377a7bf0c6,select.feature.jsx-fe40b6377a7bf0c6{width:100%;background:none;border:1px solid var(--color-dim);color-scheme:dark;padding:3px}");L.__hash="fe40b6377a7bf0c6";let E=(0,r.Ng)((e,t)=>{var a;let s=(0,v.B_)(e),{cardId:i}=t,n=null!==(a=Object.values(s).find(e=>e.cardId===i))&&void 0!==a?a:null;return{datasets:(0,v.yT)(e),mapLayers:(0,v.b7)(e),mapObjects:s,multiObject:n,card:(0,v.vB)(e,t.cardId)}},j)((0,c.Ay)(T));var O=a(8867);let P=new String(".omi-figure.jsx-4f7e96fae5d8d43f{display:block;padding:8px 15px;text-align:center;-webkit-filter:invert(1);filter:invert(1)}.card-config.jsx-4f7e96fae5d8d43f{padding:8px;font-size:.8rem}.config-section.jsx-4f7e96fae5d8d43f{width:100%;max-width:100%}.config-line.jsx-4f7e96fae5d8d43f{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:baseline;-webkit-align-items:baseline;-moz-box-align:baseline;-ms-flex-align:baseline;align-items:baseline}.btn-extend-config.jsx-4f7e96fae5d8d43f{padding-left:8px}.btn-extend-config.active.jsx-4f7e96fae5d8d43f{color:var(--color-accent-bg)}select.layer.jsx-4f7e96fae5d8d43f{width:100%;background:none;border:1px solid var(--color-dim);color-scheme:dark;padding:3px}.info-button.jsx-4f7e96fae5d8d43f{padding:3px 0 3px 8px;opacity:1}.info-button.jsx-4f7e96fae5d8d43f a,.info-button.jsx-4f7e96fae5d8d43f a:hover{color:white!important}");P.__hash="4f7e96fae5d8d43f";let z=e=>{let t=(0,O.A)(),a=(0,r.wA)(),i=(0,r.d4)(t=>(0,v.vB)(t,e.cardId)),l=i.datasetId,c=(0,r.d4)(v.yT),d=(0,r.d4)(v.YO),h=e=>{let t=e.target.value;if(""===t)return;let s={...i,datasetId:t};a((0,j.updateCard)(i.id,s)),(0,_.PJ)({category:"dashboard",action:"cardReconfigure"})};return(0,s.jsxs)("div",{"data-sentry-component":"render","data-sentry-source-file":"120-OmiCardContent.tsx",className:"jsx-".concat(P.__hash)+" omi-card-outer",children:[(0,s.jsxs)("div",{"data-sentry-component":"renderCardConfig","data-sentry-source-file":"120-OmiCardContent.tsx",className:"jsx-".concat(P.__hash)+" card-config",children:[(()=>{let e=[];return d.availableOmis.forEach(a=>{var s;let{datasetId:i,label:n}=a,l=c[i];(0,I.p)(l)&&(n=(null===(s=f.DASH_LABEL_TRANSLATIONS[n])||void 0===s?void 0:s.call(f.DASH_LABEL_TRANSLATIONS,t))||n,e.push({label:n,value:i}))}),e.sort(A.Y3),e.unshift({label:"— "+t.$t({id:"dashboard.card.selectOmi",defaultMessage:"Select an indicator:"}),value:""}),(0,s.jsxs)("div",{"data-sentry-component":"renderOmiSelect","data-sentry-source-file":"120-OmiCardContent.tsx",className:"jsx-".concat(P.__hash)+" config-section",children:[(0,s.jsxs)("div",{className:"jsx-".concat(P.__hash)+" config-line",children:[(0,s.jsx)("select",{value:i.datasetId,onChange:h,className:"jsx-".concat(P.__hash)+" layer",children:e.map(e=>{let{label:t,value:a}=e;return(0,s.jsx)("option",{value:a,className:"jsx-".concat(P.__hash),children:t},a)})}),i.datasetId&&(0,s.jsx)("div",{className:"jsx-".concat(P.__hash)+" button wk-icon-button info-button",children:(0,s.jsx)(w.A,{href:"".concat(f.URLS.product,"/").concat(l),openInNewTab:!0,children:(0,s.jsx)("span",{title:t.$t({id:"layer.productPageHint",defaultMessage:"Show in the catalogue"}),className:"jsx-".concat(P.__hash),children:(0,s.jsx)(m.Icon,{icon:"info",fixedWidth:!0})})})})]}),(0,s.jsx)(n(),{id:P.__hash,children:P})]})})(),(0,s.jsx)(n(),{id:P.__hash,children:P})]}),(()=>{let e=c[l];if((null==e?void 0:e._loadStatus)==="FAILED")return(0,s.jsx)(m.LargeMessage,{children:(0,s.jsx)(o.A,{id:"dashboard.card.errorLoadingOmi",defaultMessage:"Could not load indicator"})});if(!(0,I.p)(e))return null;let{omiFigureUrl:a}=e;return a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("img",{src:a,alt:t.$t({id:"dashboard.card.omiFigureHint",defaultMessage:"OMI figure"}),style:{width:"100%"},className:"jsx-".concat(P.__hash)+" omi-figure"}),(0,s.jsx)(n(),{id:P.__hash,children:P})]}):(0,s.jsx)(m.LargeMessage,{children:(0,s.jsx)(o.A,{id:"dashboard.card.noOmiFigure",defaultMessage:"No figure available"})})})(),(0,s.jsx)(n(),{id:P.__hash,children:P})]})};var F=a(61474);let U=new String(".md-card.jsx-82ca27f894291bd7{padding:0 15px 8px}.content.jsx-82ca27f894291bd7{}textarea.jsx-82ca27f894291bd7{width:100%;resize:vertical;background-color:transparent;color:#fff;theme:dark}.buttons.jsx-82ca27f894291bd7{margin-top:5px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex}.md-hint.jsx-82ca27f894291bd7 .cm-markdown-link{color:#ccc}");U.__hash="82ca27f894291bd7";let R=e=>{let{cardId:t,isEditing:a}=e,i=(0,O.A)(),c=(0,r.wA)(),d=(0,r.d4)(e=>(0,v.vB)(e,t)),h=l.createRef();(0,l.useEffect)(()=>{a&&h.current.focus()},[a,h]);let u=e=>{"Escape"===e.key&&p(),13===e.keyCode&&e.metaKey&&x()},p=()=>{e.onClickToggleEdit()},x=()=>{let t=h.current.value,a={...d,markdown:t};c((0,j.updateCard)(d.id,a)),(0,_.PJ)({category:"dashboard",action:"cardReconfigure"}),e.onClickToggleEdit()};return(0,s.jsxs)("div",{"data-sentry-component":"render","data-sentry-source-file":"130-TextCardContent.tsx",className:"jsx-".concat(U.__hash)+" md-card",children:[e.isEditing?(()=>{let{availHeight:t}=e;return(0,s.jsxs)("div",{"data-sentry-component":"renderEditor","data-sentry-source-file":"130-TextCardContent.tsx",className:"jsx-".concat(U.__hash)+" editor",children:[(0,s.jsx)("textarea",{ref:h,defaultValue:d.markdown,onKeyDown:u,style:{height:t?t-60:140},className:"jsx-".concat(U.__hash)}),(0,s.jsxs)("div",{className:"jsx-".concat(U.__hash)+" buttons",children:[(0,s.jsx)("div",{title:i.$t({id:"dashboard.card.markdownCheatsheet",defaultMessage:"Markdown cheatsheet"}),className:"jsx-".concat(U.__hash)+" md-hint wk-icon-button",children:(0,s.jsx)(w.A,{href:f.URLS.markdownCheatsheet,openInNewTab:!0,className:"cm-markdown-link","data-sentry-element":"AppLink","data-sentry-source-file":"130-TextCardContent.tsx",children:(0,s.jsx)(m.Icon,{icon:"markdown",family:"fab","data-sentry-element":"Icon","data-sentry-source-file":"130-TextCardContent.tsx"})})}),(0,s.jsx)("div",{className:"jsx-".concat(U.__hash)+" sep"}),(0,s.jsx)("button",{onClick:p,className:"jsx-".concat(U.__hash)+" action-button wk-button small dark",children:(0,s.jsx)(o.A,{id:"dashboard.card.cancelButton",defaultMessage:"Cancel","data-sentry-element":"FormattedMessage","data-sentry-source-file":"130-TextCardContent.tsx"})}),(0,s.jsx)("button",{onClick:x,className:"jsx-".concat(U.__hash)+" action-button wk-button small primary",children:(0,s.jsx)(o.A,{id:"dashboard.card.saveButton",defaultMessage:"Save","data-sentry-element":"FormattedMessage","data-sentry-source-file":"130-TextCardContent.tsx"})})]}),(0,s.jsx)(n(),{id:U.__hash,children:U})]})})():(0,s.jsxs)("div",{"data-sentry-component":"renderContent","data-sentry-source-file":"130-TextCardContent.tsx",className:"jsx-".concat(U.__hash)+" content",children:[(0,s.jsx)(F.$,{linkTarget:"_blank","data-sentry-element":"Markdown","data-sentry-source-file":"130-TextCardContent.tsx",children:d.markdown}),(0,s.jsx)(n(),{id:U.__hash,children:U})]}),(0,s.jsx)(n(),{id:U.__hash,children:U})]})};class B extends l.Component{componentDidMount(){this.resizeObserverAvailSpace=new ResizeObserver(this.onResizeAvailSpace),this.resizeObserverReqSpace=new ResizeObserver(this.onResizeReqSpace),this.resizeObserverAvailSpace.observe(this.refMeasureAvailSpace.current),this.resizeObserverReqSpace.observe(this.refMeasureReqSpace.current);let{width:e,height:t}=this.refMeasureAvailSpace.current.getBoundingClientRect();this.setState({availWidth:e,availHeight:t});let{createdAt:a}=this.props.card,s=a?new Date(a).getTime():0;if(Date.now()-s<300){var i;null===(i=this.refCard.current)||void 0===i||i.scrollIntoView({behavior:"smooth",block:"nearest"})}}componentWillUnmount(){this.resizeObserverAvailSpace&&(this.resizeObserverAvailSpace.disconnect(),this.resizeObserverAvailSpace=null),this.resizeObserverReqSpace&&(this.resizeObserverReqSpace.disconnect(),this.resizeObserverReqSpace=null),this.isUnmounted=!0}render(){let{cardId:e,card:t,isFullscreen:a}=this.props,i="text"===t.type,{isEditing:l}=this.state;return(0,s.jsxs)("div",{ref:this.refCard,"data-sentry-component":"Card","data-sentry-source-file":"100-Card.tsx",className:"jsx-".concat(G.__hash)+" "+(h()("card",t.type,{fullscreen:a})||""),children:[f.DEBUG.dashboards&&(0,s.jsx)("div",{className:"jsx-".concat(G.__hash)+" card-id",children:e}),this.renderCardHeader(),(0,s.jsx)("div",{ref:this.refMeasureAvailSpace,onClick:i&&!l?this.onClickTextCardContent:void 0,className:"jsx-".concat(G.__hash)+" "+(h()("card-content",{editable:i&&!l})||""),children:(0,s.jsx)("div",{ref:this.refMeasureReqSpace,className:"jsx-".concat(G.__hash)+" card-measure-inner-content",children:this.renderCardContentByType()})}),(0,s.jsx)(n(),{id:G.__hash,children:G})]})}renderCardHeader(){let{intl:e,card:t,isFullscreen:a}=this.props,{isEditing:i}=this.state;return(0,s.jsxs)("div",{className:"jsx-".concat(G.__hash)+" "+(h()("card-header",{fullscreen:a})||""),children:[(0,s.jsx)("span",{title:e.$t({id:"dashboard.card.dragHint",defaultMessage:"Drag card to a new position"}),className:"jsx-".concat(G.__hash)+" card-button drag-handle",children:(0,s.jsx)(m.Icon,{fixedWidth:!0,icon:"grip-vertical"})}),(0,s.jsx)("div",{className:"jsx-".concat(G.__hash)+" title-separator"}),(0,s.jsxs)("div",{className:"jsx-".concat(G.__hash)+" card-buttons",children:["text"===t.type&&(0,s.jsx)("span",{title:e.$t({id:"dashboard.card.editHint",defaultMessage:"Edit"}),className:"jsx-".concat(G.__hash)+" "+(h()("card-button edit",{active:i})||""),children:(0,s.jsx)(m.Icon,{fixedWidth:!0,icon:"pen",onClick:this.onClickToggleEdit})}),(0,s.jsx)("span",{title:e.$t({id:"dashboard.card.duplicateHint",defaultMessage:"Duplicate card"}),className:"jsx-".concat(G.__hash)+" card-button",children:(0,s.jsx)(m.Icon,{fixedWidth:!0,icon:"copy",family:"far",onClick:this.onClickDuplicate})}),(0,s.jsx)("span",{title:e.$t({id:"dashboard.card.removeHint",defaultMessage:"Remove card"}),className:"jsx-".concat(G.__hash)+" card-button",children:(0,s.jsx)(m.Icon,{fixedWidth:!0,icon:"times",onClick:this.onClickRemove})})]}),(0,s.jsx)(n(),{id:G.__hash,children:G})]})}renderCardContentByType(){let{card:e}=this.props;if(!e)return null;switch(e.type){case"viewer":return this.renderViewerContent();case"graph":return this.renderGraphContent();case"omi":return this.renderOmiContent();case"text":return this.renderTextContent();default:return null}}renderViewerContent(){let{availWidth:e,availHeight:t}=this.state;return null==e||null==t?null:(0,s.jsx)(N.A,{width:e,height:t,cardId:this.props.card.id})}renderGraphContent(){let{availWidth:e}=this.state;return null==e?null:(0,s.jsx)(E,{cardId:this.props.card.id,width:e})}renderOmiContent(){return(0,s.jsx)(z,{cardId:this.props.card.id})}renderTextContent(){let{isEditing:e}=this.state;return(0,s.jsx)(R,{cardId:this.props.card.id,isEditing:e,onClickToggleEdit:this.onClickToggleEdit,availHeight:this.state.availHeight})}constructor(...e){super(...e),this.state={availWidth:null,availHeight:null,isEditing:!1},this.isUnmounted=!1,this.refCard=l.createRef(),this.refMeasureAvailSpace=l.createRef(),this.refMeasureReqSpace=l.createRef(),this.resizeObserverAvailSpace=null,this.resizeObserverReqSpace=null,this._onResizeAvailSpace=e=>{if(this.isUnmounted)return;let{width:t,height:a}=e[0].contentRect;(t!==this.state.availWidth||a!==this.state.availHeight)&&this.setState({availWidth:t,availHeight:a})},this.onResizeAvailSpace=M()(this._onResizeAvailSpace,300,{leading:!1,trailing:!0}),this.onResizeReqSpace=e=>{var t;if(this.isUnmounted)return;let a=null===(t=this.props.card)||void 0===t?void 0:t.type;if("graph"!==a&&"omi"!==a&&"text"!==a)return;let{height:s}=e[0].contentRect,{availHeight:i}=this.state;null!=i&&s>i&&this.props.setCardHeight(this.props.card.id,s)},this.onClickDuplicate=()=>{this.props.duplicateCard(this.props.cardId),(0,_.PJ)({category:"dashboard",action:"cardDuplicate"})},this.onClickRemove=()=>{this.props.removeCard(this.props.cardId),(0,_.PJ)({category:"dashboard",action:"cardRemove"})},this.onClickTextCardContent=e=>{let t=e.target;for(;t;){if("A"===t.tagName)return;t=t.parentElement}this.onClickToggleEdit()},this.onClickToggleEdit=()=>{this.setState({isEditing:!this.state.isEditing})}}}let V=f.UI.cardHeaderHeight,G=new String(".card.jsx-a994804d8310f5fa{position:relative;height:100%;-webkit-border-radius:".concat(f.UI.cardBorderRadius,"px;-moz-border-radius:").concat(f.UI.cardBorderRadius,"px;border-radius:").concat(f.UI.cardBorderRadius,"px;overflow:hidden;border:1px solid var(--color-card-border);background:var(--color-card-bg);-webkit-transition:background ").concat(f.UI.transitionDuration,"ms;-moz-transition:background ").concat(f.UI.transitionDuration,"ms;-o-transition:background ").concat(f.UI.transitionDuration,"ms;transition:background ").concat(f.UI.transitionDuration,"ms}.card-id.jsx-a994804d8310f5fa{font-size:10px;position:absolute;color:var(--color-card-fg-faint);top:1px;right:2px}.card.text.fullscreen.jsx-a994804d8310f5fa:not(:hover){background:transparent;border:1px solid transparent}.card-header.jsx-a994804d8310f5fa{height:").concat(V,"px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;padding:0 ").concat(10,"px}.card-button.jsx-a994804d8310f5fa{-webkit-transition:color ").concat(f.UI.transitionDuration,"ms;-moz-transition:color ").concat(f.UI.transitionDuration,"ms;-o-transition:color ").concat(f.UI.transitionDuration,"ms;transition:color ").concat(f.UI.transitionDuration,"ms;color:var(--color-card-fg-faint)}.card-header.fullscreen.jsx-a994804d8310f5fa .card-button.jsx-a994804d8310f5fa{color:transparent}.card-button.edit.jsx-a994804d8310f5fa{margin-right:.15em}.card-button.active.jsx-a994804d8310f5fa{color:var(--color-accent-complementary)!important}.card-button.jsx-a994804d8310f5fa+.card-button.jsx-a994804d8310f5fa{margin-left:.3em}.card.jsx-a994804d8310f5fa:hover .card-button.jsx-a994804d8310f5fa{color:var(--color-card-fg)}.card-button.drag-handle.jsx-a994804d8310f5fa{cursor:move;cursor:-webkit-grab;cursor:-moz-grab;cursor:grab}.title-separator.jsx-a994804d8310f5fa{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1}.card-content.jsx-a994804d8310f5fa{height:-webkit-calc(100% - ").concat(V,"px);height:-moz-calc(100% - ").concat(V,"px);height:calc(100% - ").concat(V,"px)}.card-content.editable.jsx-a994804d8310f5fa{cursor:text}.omi-content.jsx-a994804d8310f5fa{padding:").concat(5,"px ").concat(10,"px}"));G.__hash="a994804d8310f5fa";let W=(0,r.Ng)((e,t)=>({mapObjects:(0,v.B_)(e),card:(0,v.vB)(e,t.cardId),isFullscreen:(0,v.g0)(e)}),j)((0,c.Ay)(B));var H=a(93714);let $=p.Responsive;class q extends l.Component{componentDidMount(){this.setState({width:window.innerWidth}),this.resizeObserver=new ResizeObserver(this.onResize),this.resizeObserver.observe(this.refMeasure.current)}componentWillUnmount(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}render(){return(0,s.jsxs)("div",{"data-sentry-component":"Dashboard","data-sentry-source-file":"030-Dashboard.tsx",className:"jsx-".concat(Q.__hash)+" dashboard",children:[(0,s.jsx)("div",{ref:this.refMeasure,className:"jsx-".concat(Q.__hash)}),this.renderTitleBlock(),f.DEBUG.dashboards&&this.renderDebug(),this.renderContent(),this.renderLogos(),(0,s.jsx)(n(),{id:Q.__hash,children:Q})]})}renderTitleBlock(){if((0,b.d4)())return null;let{intl:e,username:t,dashId:a,dashOwner:i,dashSettings:l}=this.props,r=l.availableOmis.length>0,c=l.backButton;return(0,s.jsxs)(H.A,{children:[c&&(0,s.jsx)("span",{onClick:()=>{window.history.back()},className:"jsx-".concat(Q.__hash)+" back-button",children:(0,s.jsx)(m.Icon,{icon:"chevron-left"})}),(0,s.jsx)("span",{className:"jsx-".concat(Q.__hash)+" title-text",children:l.title}),(0,s.jsxs)("div",{className:"jsx-".concat(Q.__hash)+" buttons",children:[(0,s.jsx)("button",{onClick:()=>(0,g.yp)(e),className:"jsx-".concat(Q.__hash)+" cm-dashboard-action-button wk-button dark",children:(0,s.jsx)(o.A,{id:"dashboard.shareButton",defaultMessage:"Share"})}),t===i&&(0,s.jsx)(w.A,{className:"cm-dashboard-action-button wk-button dark",href:"".concat(a,"/edit"),children:(0,s.jsx)(o.A,{id:"dashboard.editButton",defaultMessage:"Edit"})}),null!=t&&(0,s.jsx)("button",{onClick:this.onClickDuplicate,title:t!==i?e.$t({id:"dashboard.copyHint",defaultMessage:"Copy dashboard to my account"}):e.$t({id:"dashboard.duplicateHint",defaultMessage:"Duplicate dashboard"}),className:"jsx-".concat(Q.__hash)+" cm-dashboard-action-button wk-button dark",children:(0,s.jsx)(o.A,{id:"dashboard.duplicateButton",defaultMessage:"Duplicate"})}),(0,s.jsx)("div",{className:"jsx-".concat(Q.__hash)+" sep"}),(0,s.jsxs)("div",{className:"jsx-".concat(Q.__hash)+" add-card",children:[(0,s.jsx)("button",{onClick:()=>{let e=!this.state.showAddCardOptions;this.setState({showAddCardOptions:e})},className:"jsx-".concat(Q.__hash)+" cm-dashboard-action-button wk-button primary",children:(0,s.jsx)(o.A,{id:"dashboard.addCardButton",defaultMessage:"Add card"})}),this.state.showAddCardOptions&&(0,s.jsxs)("div",{className:"jsx-".concat(Q.__hash)+" add-card-items",children:[(0,s.jsx)("button",{onClick:()=>this.onClickAddCardType("viewer"),className:"jsx-".concat(Q.__hash)+" wk-button dark add-card-item",children:(0,s.jsx)(o.A,{id:"dashboard.addMapButton",defaultMessage:"Map"})}),(0,s.jsx)("button",{onClick:()=>this.onClickAddCardType("graph"),className:"jsx-".concat(Q.__hash)+" wk-button dark add-card-item",children:(0,s.jsx)(o.A,{id:"dashboard.addGraphsButton",defaultMessage:"Graphs"})}),r&&(0,s.jsx)("button",{onClick:()=>this.onClickAddCardType("omi"),className:"jsx-".concat(Q.__hash)+" wk-button dark add-card-item",children:(0,s.jsx)(o.A,{id:"dashboard.addOmiButton",defaultMessage:"Indicator"})}),(0,s.jsx)("button",{onClick:()=>this.onClickAddCardType("text"),className:"jsx-".concat(Q.__hash)+" wk-button dark add-card-item",children:(0,s.jsx)(o.A,{id:"dashboard.addTextButton",defaultMessage:"Text"})})]})]})]}),(0,s.jsx)(n(),{id:Q.__hash,children:Q})]})}renderContent(){let{width:e}=this.state;if(null==e)return null;let{intl:t,username:a,dashOwner:i,isFullscreen:l}=this.props;return(0,s.jsxs)(s.Fragment,{children:[a!==i&&!l&&!(0,b.d4)()&&(0,s.jsxs)("div",{className:"jsx-".concat(Q.__hash)+" guest-instructions",children:["⚠️"," ",(0,s.jsx)(o.A,{id:"dashboard.guestInstructions",defaultMessage:"You are viewing this dashboard as a guest. Your changes will not be saved. To copy the dashboard to your account, {logInAnd} click on the Duplicate button.",values:{logInAnd:null!=a?"":t.$t({id:"dashboard.guestLogInAnd",defaultMessage:"log in and"})}})]}),(0,s.jsx)("div",{className:"jsx-".concat(Q.__hash)+" card-container",children:(0,s.jsx)($,{className:"layout",breakpoints:f.UI.dashboardBreakpoints,layouts:this.props.layouts,cols:f.UI.dashboardCols,rowHeight:f.UI.cardRowHeight,margin:[f.UI.cardRglMargin,f.UI.cardRglMargin],width:e+2*f.UI.modalPadding,draggableHandle:".drag-handle",onLayoutChange:this.onLayoutChange,onResizeStop:this.onResizeStop,children:this.props.cards.map(e=>(0,s.jsx)("div",{className:"jsx-".concat(Q.__hash),children:(0,s.jsx)(W,{cardId:e.id})},e.id))})}),(0,s.jsx)(y.A,{}),(0,s.jsx)(n(),{id:Q.__hash,children:Q})]})}renderLogos(){let{isFullscreen:e,dashId:t}=this.props;if(!e||(0,b.d4)())return null;let a=["cmems","unep","all"].includes(f.APP_CONFIG.id),i=t.startsWith("unoc-");return(0,s.jsxs)("div",{className:"jsx-".concat(X.__hash)+" logos",children:[a&&(0,s.jsxs)("a",{href:f.URLS.cmems,className:"jsx-".concat(X.__hash)+" logo-link logo-link-cmems",children:[(0,s.jsx)("img",{src:"/images/logo-small.png",alt:"Copernicus Marine logo",title:"Copernicus Marine Home",className:"jsx-".concat(X.__hash)+" logo logo-cmems"}),!1]}),i&&(0,s.jsx)("a",{href:"https://mercator-ocean.eu/en",target:"_blank",rel:"noopener noreferrer",className:"jsx-".concat(X.__hash)+" "+(h()("logo-link logo-link-mo",{"hide-label":!0})||""),children:(0,s.jsx)("img",{src:"/images/logo-mo.png",alt:"MO logo",className:"jsx-".concat(X.__hash)+" logo logo-mo"})}),(0,s.jsx)(n(),{id:X.__hash,children:X})]})}renderDebug(){return(0,s.jsxs)("div",{className:"jsx-".concat(ee.__hash)+" debug",children:[(0,s.jsx)("table",{className:"jsx-".concat(ee.__hash),children:(0,s.jsxs)("tbody",{className:"jsx-".concat(ee.__hash),children:[(0,s.jsxs)("tr",{className:"jsx-".concat(ee.__hash),children:[(0,s.jsx)("td",{className:"jsx-".concat(ee.__hash),children:"Width"}),(0,s.jsxs)("td",{className:"jsx-".concat(ee.__hash),children:[this.state.width," — ",JSON.stringify(f.UI.dashboardBreakpoints)]})]}),(0,s.jsxs)("tr",{className:"jsx-".concat(ee.__hash),children:[(0,s.jsx)("td",{className:"jsx-".concat(ee.__hash),children:"Layouts"}),(0,s.jsx)("td",{className:"jsx-".concat(ee.__hash),children:(0,s.jsx)("pre",{className:"jsx-".concat(ee.__hash),children:Z(this.props.layouts)})})]}),(0,s.jsxs)("tr",{className:"jsx-".concat(ee.__hash),children:[(0,s.jsx)("td",{className:"jsx-".concat(ee.__hash),children:"Layers"}),(0,s.jsx)("td",{className:"jsx-".concat(ee.__hash),children:(0,s.jsx)("pre",{className:"jsx-".concat(ee.__hash),children:Y(this.props.mapLayers)})})]}),(0,s.jsxs)("tr",{className:"jsx-".concat(ee.__hash),children:[(0,s.jsx)("td",{className:"jsx-".concat(ee.__hash),children:"Objects"}),(0,s.jsx)("td",{className:"jsx-".concat(ee.__hash),children:(0,s.jsx)("pre",{className:"jsx-".concat(ee.__hash),children:J(this.props.mapObjects)})})]}),(0,s.jsxs)("tr",{className:"jsx-".concat(ee.__hash),children:[(0,s.jsx)("td",{className:"jsx-".concat(ee.__hash),children:"OMIs"}),(0,s.jsx)("td",{className:"jsx-".concat(ee.__hash),children:(0,s.jsx)("pre",{className:"jsx-".concat(ee.__hash),children:K(this.props.dashSettings)})})]})]})}),(0,s.jsx)(n(),{id:ee.__hash,children:ee})]})}constructor(...e){super(...e),this.state={width:null,showAddCardOptions:!1},this.refMeasure=l.createRef(),this.resizeObserver=null,this.cardChangedHeight=null,this.onResize=e=>{let{width:t}=e[0].contentRect;t!==this.state.width&&this.setState({width:t})},this.onResizeStop=(e,t,a)=>{let{i:s,h:i}=t,{h:n}=a;n!==i&&(this.cardChangedHeight={id:s,h:n})},this.onLayoutChange=(e,t)=>{if(this.cardChangedHeight){let{id:e,h:a}=this.cardChangedHeight;Object.keys(t).forEach(s=>{let i=t[s].findIndex(t=>t.i===e);-1!==i&&(t=(0,u.setIn)(t,[s,i,"h"],a))}),this.cardChangedHeight=null}this.props.setLayouts(t)},this.onClickDuplicate=async()=>{let e=await this.props.duplicateDashboard();this.props.router.push("/dashboard/".concat(e))},this.onClickAddCardType=e=>{let{intl:t}=this.props,a={};"text"===e&&(a.sampleText=t.$t({id:"dashboard.card.sampleText",defaultMessage:"**Click on this card** to edit its content.\n\nYou can use [Markdown]({url}) formatting."},{url:f.URLS.markdownCheatsheet}));try{this.props.addCardWithType(e,a),(0,_.PJ)({category:"dashboard",action:"cardAdd",label:e})}finally{this.setState({showAddCardOptions:!1})}}}}let Z=e=>{let t=[];return Object.keys(e).forEach(a=>{let s=e[a].map(e=>"".concat(e.i," (").concat(e.x,",").concat(e.y,") w=").concat(e.w," h=").concat(e.h));t.push("".concat(a,": ").concat(s.join("\n    ")))}),t.join("\n")},Y=e=>{let t=[];return Object.keys(e).forEach(a=>{let{layerId:s,cardId:i}=e[a];t.push("".concat(a).concat(i?" [card ".concat(i,"]"):"",": ").concat(s))}),t.join("\n")},J=e=>{let t=[];return Object.keys(e).forEach(a=>{let{features:s,graphs:i,beingDrawn:n,isMulti:l,cardId:r,mapLayerId:o}=e[a],c=s.map(e=>"string"==typeof e?e:e.properties.id).join(", "),d="".concat(s.length," [").concat(c,"]"),h=Object.values(i).length;t.push("".concat(a).concat(n?"*":"").concat(l?"-multi [card ".concat(null!=r?r:"??","]"):"").concat(o?" [layer ".concat(o,"]"):"",": features ").concat(d,", graphs ").concat(h))}),t.join("\n")},K=e=>{let{availableOmis:t}=e;return t.map(e=>"".concat(e.datasetId,": ").concat(e.label)).join("\n")},Q=new String(".back-button.jsx-fe74c8601a2bf2b2{margin-left:.2em;margin-right:.3em;cursor:pointer}.title-text.jsx-fe74c8601a2bf2b2{margin-right:.6em}.buttons.jsx-fe74c8601a2bf2b2{-webkit-box-flex:1;-webkit-flex:1 1 0px;-moz-box-flex:1;-ms-flex:1 1 0px;flex:1 1 0px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;font-size:1.3rem}.add-card.jsx-fe74c8601a2bf2b2{display:inline-block;position:relative;margin-left:20px}.add-card-items.jsx-fe74c8601a2bf2b2{position:absolute;top:100%;width:100%;z-index:10}.add-card-item.jsx-fe74c8601a2bf2b2{width:100%;margin-left:0}.cm-dashboard-action-button{line-height:inherit;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;white-space:nowrap}.card-container.jsx-fe74c8601a2bf2b2{margin:0 -webkit-calc(0px - var(--modal-padding));margin:0 -moz-calc(0px - var(--modal-padding));margin:0 calc(0px - var(--modal-padding))}");Q.__hash="fe74c8601a2bf2b2";let X=new String(".logos.jsx-12edb22a214ceaf3{position:fixed;bottom:20px;left:20px;color:white;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-moz-box-orient:horizontal;-moz-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.logo-link.jsx-12edb22a214ceaf3{display:block;-webkit-transition:all 300ms;-moz-transition:all 300ms;-o-transition:all 300ms;transition:all 300ms}.logo-link.jsx-12edb22a214ceaf3+.logo-link.jsx-12edb22a214ceaf3{margin-left:20px}.logo-link.jsx-12edb22a214ceaf3:hover{opacity:.8}.logo-link-cmems.jsx-12edb22a214ceaf3{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.logo-link-mo.hide-label.jsx-12edb22a214ceaf3{width:47px;overflow:hidden}.logo.jsx-12edb22a214ceaf3{display:block;height:47px;-webkit-filter:brightness(0)hue-rotate(0deg)invert(1)drop-shadow(0px 0px 2px rgba(0,0,0,.8));filter:brightness(0)hue-rotate(0deg)invert(1)drop-shadow(0px 0px 2px rgba(0,0,0,.8));-webkit-transition:all 300ms;-moz-transition:all 300ms;-o-transition:all 300ms;transition:all 300ms}.logo-cmems-text.jsx-12edb22a214ceaf3{margin-left:.4em;color:white;font-size:1.1rem;font-weight:bold;line-height:1.1}");X.__hash="12edb22a214ceaf3";let ee=new String(".debug.jsx-35dce46cc7959ba2{font-size:.7em;width:100%;overflowx:scroll}.debug.jsx-35dce46cc7959ba2 td.jsx-35dce46cc7959ba2{vertical-align:top;padding:5px}.debug.jsx-35dce46cc7959ba2 pre.jsx-35dce46cc7959ba2{margin:0}");ee.__hash="35dce46cc7959ba2";let et=(0,x.withRouter)((0,r.Ng)(e=>({username:(0,v.TO)(e),dashId:(0,v.KL)(e),dashOwner:(0,v.Es)(e),mapObjects:(0,v.B_)(e),mapLayers:(0,v.b7)(e),cards:(0,v.k_)(e),layouts:(0,v.Yy)(e),dashSettings:(0,v.YO)(e),isFullscreen:(0,v.g0)(e)}),j)((0,c.Ay)(q)))},93714:(e,t,a)=>{a.d(t,{A:()=>o});var s=a(31085),i=a(93243),n=a.n(i);a(14041);var l=a(55065);let r=new String("h1.jsx-affd0c8baf81c9f8{margin:0;padding-top:28px;padding-bottom:46px;font-size:49px;font-weight:normal;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}@media screen and (max-width:".concat(l.UI.comfortableBreak,"px){h1.jsx-affd0c8baf81c9f8{display:block}}"));r.__hash="affd0c8baf81c9f8";let o=e=>(0,s.jsxs)("h1",{"data-sentry-component":"DashboardTitle","data-sentry-source-file":"200-DashboardTitle.tsx",className:"jsx-".concat(r.__hash),children:[e.children,(0,s.jsx)(n(),{id:r.__hash,children:r})]})},2866:(e,t,a)=>{a.d(t,{n:()=>tv,A:()=>tN});var s=a(31085),i=a(93243),n=a.n(i),l=a(14041),r=a(99870),o=a.n(r),c=a(70541),d=a(64104),h=a(8953),u=a(24626),p=a(20409),x=a(93197),m=a(8539),f=a(7350),b=a.n(f),g=a(38361),j=a(4591),v=a(55065),_=a(49608),y=a(70226),w=a(5332),k=a(15617),M=a(89594),N=a(81864),S=a(83832);let I=e=>{let{label:t,maxLength:a}=e;if(null==t)return null;let i=t.length<=a?t:"".concat(t.slice(0,a),"…");return(0,s.jsx)("span",{title:i.length!==t.length?t:void 0,"data-sentry-component":"TruncatedLabel","data-sentry-source-file":"992-TruncatedLabel.tsx",children:i})};var A=a(35269),C=a(98461),D=a(77118),T=a(77226),L=a(19416),E=a(20481),O=a(68198);let P=e=>e._seriesData.map((t,a)=>{var s,i,n;if(null==t)return{series:null};let{id:l}=t,r=e._seriesSpecs[a],o=null!==(n=null===(s=e.hiddenSeries)||void 0===s?void 0:s[null!==(i=null==t?void 0:t.id)&&void 0!==i?i:""])&&void 0!==n&&n;return{idxSeries:a,id:l,series:t,seriesSpec:r,isHidden:o}}).filter(e=>null!=e.series),z=function(e,t,a){var s,i;let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return e.isHidden?"transparent":a?"var(--color-stale-dark)":t>1?(0,O.ep)(null!==(i=null===(s=e.seriesSpec)||void 0===s?void 0:s.color)&&void 0!==i?i:"light",e.idxSeries):n.accentByDefault?"var(--color-accent-bg)":"white"},F={id:"_fake_",idxSeries:0,series:null,seriesSpec:null,isHidden:!1};class U extends l.PureComponent{render(){let{mapObject:e,graph:t,layerSpec:a}=this.props;return e&&t&&a?(0,s.jsx)(R,{...this.props,"data-sentry-element":"_PinValueDashboard","data-sentry-component":"PinValueDashboard","data-sentry-source-file":"250-PinValueDashboard.tsx"}):null}}class R extends l.PureComponent{componentDidMount(){this.updateIsFetching()}componentDidUpdate(){this.updateIsFetching()}componentWillUnmount(){this.timerFetching&&clearTimeout(this.timerFetching)}render(){let e=P(this.props.graph);if(0===e.length){let{layerSpec:e,dashSettings:t}=this.props,a=e&&(0,T.hU)(e,{dashSettings:t});return this.isReallyFetching()||a?(0,s.jsxs)("div",{"data-sentry-component":"_PinValueDashboard","data-sentry-source-file":"250-PinValueDashboard.tsx",className:"jsx-".concat(V.__hash)+" cm-pin-values",children:[this.renderSeries(F),(0,s.jsx)(n(),{id:V.__hash,children:V})]}):null}let t={showFeatureName:!0};return(0,s.jsxs)("div",{"data-sentry-component":"_PinValueDashboard","data-sentry-source-file":"250-PinValueDashboard.tsx",className:"jsx-".concat(V.__hash)+" cm-pin-values",children:[e.map(e=>this.renderSeries(e,t)),(0,s.jsx)(n(),{id:V.__hash,children:V})]})}renderSpinner(e){return this.isReallyFetching()?(0,s.jsxs)("span",{className:"jsx-".concat(V.__hash)+" spinner",children:[(0,s.jsx)(L.A,{timeout:e}),(0,s.jsx)(n(),{id:V.__hash,children:V})]}):null}renderStats(e){if(null==e)return null;let{isLight:t,settings:a}=this.props;if(t||a.hideGraphStats)return null;let{min:i,max:l,avg:r}=e.stats;if(null==i||null==l||i===r&&l===r)return null;let o=(0,s.jsxs)("span",{className:"jsx-".concat(V.__hash)+" stats-part",children:[(0,s.jsx)("span",{className:"jsx-".concat(V.__hash)+" stats-label",children:(0,s.jsx)(p.Icon,{icon:"arrow-down"})}),B(i,3),(0,s.jsx)(n(),{id:V.__hash,children:V})]}),c=(0,s.jsxs)("span",{className:"jsx-".concat(V.__hash)+" stats-part",children:[(0,s.jsx)("span",{className:"jsx-".concat(V.__hash)+" stats-label",children:(0,s.jsx)(p.Icon,{icon:"arrow-up"})}),B(l,3),(0,s.jsx)(n(),{id:V.__hash,children:V})]});return(0,s.jsxs)("span",{className:"jsx-".concat(V.__hash)+" stats",children:[c,o,(0,s.jsx)(n(),{id:V.__hash,children:V})]})}isReallyFetching(){let{graph:e}=this.props;return e._subsetStatus.some(e=>"fetching"===e)}constructor(...e){var t;super(...e),t=this,this.state={showAsFetching:!1},this.timerFetching=null,this.updateIsFetching=()=>{if(!this.isReallyFetching()){this.timerFetching&&(clearTimeout(this.timerFetching),this.timerFetching=null),this.state.showAsFetching&&this.setState({showAsFetching:!1});return}this.state.showAsFetching||this.timerFetching||(this.timerFetching=setTimeout(()=>{this.timerFetching=null,this.isReallyFetching()&&this.setState({showAsFetching:!0})},150))},this.renderSeries=function(e){var a;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{series:l,seriesSpec:r,idxSeries:c}=e,{graph:d}=t.props,h=[],u=null;if(l){let{min:e,max:t,avg:a}=l.stats;u=a,(e!==a||t!==a)&&h.push("min: ".concat(e.toPrecision(4),", max: ").concat(t.toPrecision(4)))}let p=z(e,d._seriesData.length,t.state.showAsFetching||null==u,{accentByDefault:!1}),x=null!=u?v.UI.graphSpinnerValue:v.UI.graphSpinnerNoValue;return(0,s.jsxs)("div",{title:h.length?h.join(". "):void 0,className:"jsx-".concat(V.__hash)+" "+(o()("pin-value",{nested:i.nested})||""),children:[i.showFeatureName&&r&&(0,s.jsxs)("span",{className:"jsx-".concat(V.__hash)+" feature-name",children:[(0,s.jsx)(I,{label:i.useShortLabel?r.label:r.longLabel,maxLength:v.UI.displayedFeatureNameLength}),t.renderSpinner(x)]}),(0,s.jsxs)("span",{className:"jsx-".concat(V.__hash)+" value-and-stats",children:[(0,s.jsx)("span",{style:{color:p},className:"jsx-".concat(V.__hash)+" value",children:null!=u?Number(u.toPrecision(4)):"—"}),(0,s.jsx)(E.A,{units:null!==(a=null==l?void 0:l.units)&&void 0!==a?a:null}),t.renderStats(l)]}),(0,s.jsx)(n(),{id:V.__hash,children:V})]},c)}}}let B=(e,t)=>null==e?e:parseFloat(e.toPrecision(t)),V=new String(".cm-pin-values.jsx-8562bf899ff1e7f8{white-space:normal}.pin-value.jsx-8562bf899ff1e7f8{display:inline-block}.pin-value.jsx-8562bf899ff1e7f8:not(:last-child){margin-right:1em}.var-name.jsx-8562bf899ff1e7f8{}.feature-name.jsx-8562bf899ff1e7f8{display:block;position:relative;top:.2em;color:var(--color-text-dim)}.value-and-stats.jsx-8562bf899ff1e7f8{}.value.jsx-8562bf899ff1e7f8{white-space:nowrap;font-weight:bold;margin-right:.15em;font-size:2rem;line-height:1.1;font-weight:normal;margin-right:.05em}.pin-value.nested.jsx-8562bf899ff1e7f8{padding-left:15px}.spinner.jsx-8562bf899ff1e7f8{color:var(--color-stale-dark);margin-left:.4em}.stats.jsx-8562bf899ff1e7f8{margin-left:.2em;color:var(--color-text-dim);display:inline-block;line-height:1.1}.stats-part.jsx-8562bf899ff1e7f8{white-space:nowrap;display:block}.stats-label.jsx-8562bf899ff1e7f8{font-size:.8em;margin-left:.6em;margin-right:.15em}");V.__hash="8562bf899ff1e7f8";let G=(0,c.Ng)((e,t)=>{let{mapObjectId:a,graphId:s}=t,i=(0,S.yT)(e),n=(0,S.UD)(e,a),l=null==n?void 0:n.graphs[s],r=(0,S.Yj)(e,null==l?void 0:l.mapLayerId);return{mapObject:n,graph:l,layerSpec:(0,_.VF)(i,null==r?void 0:r.layerId),settings:(0,S.mt)(e),isLight:(0,S.H9)(e),dashSettings:(0,S.YO)(e)}},N)(U);class W extends l.Component{componentDidMount(){this.updateIsFetching()}componentDidUpdate(){this.updateIsFetching()}componentWillUnmount(){this.timerFetching&&clearTimeout(this.timerFetching)}render(){let{showAsFetching:e}=this.state,{children:t}=this.props;return t?t({showAsFetching:e}):null}constructor(...e){super(...e),this.state={showAsFetching:!1},this.timerFetching=null,this.updateIsFetching=()=>{if(!this.props.isFetching){this.timerFetching&&(clearTimeout(this.timerFetching),this.timerFetching=null),this.state.showAsFetching&&this.setState({showAsFetching:!1});return}this.state.showAsFetching||this.timerFetching||(this.timerFetching=setTimeout(()=>{this.timerFetching=null,this.props.isFetching&&this.setState({showAsFetching:!0})},150))}}}let H=new String(".coord-label.jsx-49d62946b35d10d5{margin-left:.1em;font-size:.8em}.coord-label.color.jsx-49d62946b35d10d5{color:var(--color-dim)}");H.__hash="49d62946b35d10d5";let $=e=>{let{coords:t,noColorLabels:a}=e,i=t[0],l=t[1];(i%=360)>=180&&(i-=360),i<-180&&(i+=360);let r=i>=0?"E":"W",c=Math.abs(l).toFixed(3),d=Math.abs(i).toFixed(3);return(0,s.jsxs)("span",{"data-sentry-component":"LonLat","data-sentry-source-file":"920-LonLat.tsx",className:"jsx-".concat(H.__hash)+" lon-lat",children:[(0,s.jsxs)("span",{className:"jsx-".concat(H.__hash),children:[d,(0,s.jsx)("span",{className:"jsx-".concat(H.__hash)+" "+(o()("coord-label",{color:!a})||""),children:r})]}),","," ",(0,s.jsxs)("span",{className:"jsx-".concat(H.__hash),children:[c,(0,s.jsx)("span",{className:"jsx-".concat(H.__hash)+" "+(o()("coord-label",{color:!a})||""),children:l>=0?"N":"S"})]}),(0,s.jsx)(n(),{id:H.__hash,children:H})]})};class q extends l.PureComponent{render(){let{mapObject:e}=this.props;return e?(0,s.jsx)(Z,{...this.props,"data-sentry-element":"_PinValues","data-sentry-component":"PinValues","data-sentry-source-file":"200-PinValues.tsx"}):null}}class Z extends l.PureComponent{render(){let e=this.props.mapObject,t=e.features;t=t.slice().sort((e,t)=>{let a=(0,_.mo)(e),s=(0,_.mo)(t);return a.localeCompare(s)});let a=Object.values(e.graphs).filter(e=>e.graphSpecId===v.PIN_VALUE_DENSE_PSEUDOGRAPH||e.graphSpecId===v.PIN_VALUE_SPARSE_PSEUDOGRAPH);if(!a.length)return null;let i=(0,D.Hw)(this.props.mapLayers);return(a.sort((e,t)=>{let a=i.indexOf(e.mapLayerId);return i.indexOf(t.mapLayerId)-a}),this.props.isDashboard)?this.renderForDashboard(a):(0,s.jsxs)("div",{"data-sentry-component":"_PinValues","data-sentry-source-file":"200-PinValues.tsx",className:"jsx-".concat(et.__hash)+" cm-pin-values outer",children:[(0,s.jsxs)("div",{style:{gridTemplateColumns:"minmax(".concat(v.UI.pinValueLabelMinWidth,"px, auto) repeat(").concat(t.length,", 1fr)")},className:"jsx-".concat(et.__hash)+" table",children:[this.renderHeader(t),a.map(e=>this.renderRow(t,e))]}),(0,s.jsx)(n(),{id:et.__hash,children:et})]})}renderForDashboard(e){let t=this.props.mapObject;return(0,s.jsxs)(s.Fragment,{children:[e.map(e=>(0,s.jsx)(G,{mapObjectId:t.id,graphId:e.id},e.id)),(0,s.jsx)(n(),{id:et.__hash,children:et})]})}renderHeader(e){return e.length<=1?null:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"jsx-".concat(et.__hash)}),e.map(e=>{let{id:t}=e.properties,a=(0,_.mo)(e);return(0,s.jsx)("div",{className:"jsx-".concat(et.__hash)+" cell header",children:(0,s.jsx)(I,{label:a,maxLength:v.UI.displayedFeatureNameLength})},t)}),(0,s.jsx)(n(),{id:et.__hash,children:et})]})}renderQcWarning(e){let{sparseSample:t}=e;if(!t)return null;let{intl:a}=this.props,i=t[C.s.valueQc];if((0,C.Z1)(t))return null;let l=[a.$t({id:"pinValues.invalidInsituHint",defaultMessage:"Invalid insitu data; quality flag: {qc}."},{qc:i}),a.$t({id:"pinValues.toggleInvalidInsituHint",defaultMessage:"Click here or press {key} to hide flagged values."},{key:v.UI.keys.filterInsitu.toUpperCase()})].join("\n\n");return(0,s.jsxs)("span",{onClick:()=>this.props.updateSettings({showInvalidInsituData:!1}),title:l,className:"jsx-".concat(et.__hash)+" qc-warning",children:["\xa0\xa0",(0,s.jsx)(p.Icon,{icon:"exclamation-triangle"}),(0,s.jsx)(n(),{id:et.__hash,children:et})]})}getTransientDataWarning(e,t){var a,s,i,n;let{intl:l}=this.props,r=null===(a=t._subsets)||void 0===a?void 0:a[0],o=r&&"deletedDimCoords"in r&&null!==(n=null==r?void 0:null===(i=r.deletedDimCoords)||void 0===i?void 0:null===(s=i[v.DIM_TIME])||void 0===s?void 0:s.values[0])&&void 0!==n?n:null;return null==o?null:(0,T.$d)(e,o,l)}renderTransientDataWarning(e){return e?(0,s.jsxs)("span",{title:e,className:"jsx-".concat(et.__hash)+" qc-warning",children:["\xa0\xa0",(0,s.jsx)(p.Icon,{icon:"exclamation-triangle"}),(0,s.jsx)(n(),{id:et.__hash,children:et})]}):null}renderDenseStats(e,t){if(null==t?void 0:t.isCategorical)return null;let{showDetails:a}=this.state;if(this.props.isLight||!a)return null;let{intl:i,mapObject:l}=this.props,{min:r,max:c,avg:d}=e.stats;if(null==r||null==c||r===d&&c===d)return null;let h=!l.isMulti;return(0,s.jsxs)("div",{onClick:()=>this.setState({showDetails:!a}),title:i.$t({id:"pinValues.toggleDetailsHint",defaultMessage:"Click to show/hide details"}),className:"jsx-".concat(et.__hash)+" "+(o()("details",{inline:h})||""),children:[(0,s.jsxs)("span",{className:"jsx-".concat(et.__hash)+" details-part",children:[(0,s.jsx)("span",{className:"jsx-".concat(et.__hash)+" details-label",children:(0,s.jsx)(p.Icon,{icon:"arrow-down",fixedWidth:!0})}),Q(r,3)]}),(0,s.jsxs)("span",{className:"jsx-".concat(et.__hash)+" details-part",children:[(0,s.jsx)("span",{className:"jsx-".concat(et.__hash)+" details-label",children:(0,s.jsx)(p.Icon,{icon:"arrow-up",fixedWidth:!0})}),Q(c,3)]}),(0,s.jsx)(n(),{id:et.__hash,children:et})]})}renderSparseSampleDetails(e){let{showDetails:t}=this.state;if(this.props.isLight||!t)return null;let{intl:a}=this.props,i=e.sparseSample;if(!i)return null;let l=i[C.s.longitude],r=i[C.s.latitude],o=i[C.s.elevation],c=i[C.s.time];return(0,s.jsxs)("div",{onClick:()=>this.setState({showDetails:!t}),title:a.$t({id:"pinValues.toggleDetailsHint",defaultMessage:"Click to show/hide details"}),className:"jsx-".concat(et.__hash)+" details",children:[(0,s.jsx)("span",{className:"jsx-".concat(et.__hash)+" details-label",children:(0,s.jsx)(p.Icon,{icon:"location-dot",fixedWidth:!0})}),"\xa0",(0,s.jsx)($,{coords:[l,r],noColorLabels:!0}),(0,s.jsx)("br",{className:"jsx-".concat(et.__hash)}),(0,s.jsx)("span",{className:"jsx-".concat(et.__hash)+" details-label",children:(0,s.jsx)(p.Icon,{icon:"arrow-down",fixedWidth:!0})}),"\xa0",o," m",(0,s.jsx)("br",{className:"jsx-".concat(et.__hash)}),(0,s.jsx)("span",{className:"jsx-".concat(et.__hash)+" details-label",children:(0,s.jsx)(p.Icon,{icon:"clock",family:"far",fixedWidth:!0})}),"\xa0",(0,s.jsx)("span",{className:"jsx-".concat(et.__hash)+" details-part",children:(0,_.Kq)(c,{withTime:!0})}),(0,s.jsx)(n(),{id:et.__hash,children:et})]})}constructor(...e){super(...e),this.state={showDetails:!this.props.settings.hideGraphStats},this.renderRow=(e,t)=>{var a,i;let{mapObject:l,datasets:r,mapLayers:o}=this.props,c=o[t.mapLayerId],d=(0,_.VF)(r,null==c?void 0:c.layerId),h=this.getTransientDataWarning(d,t);return(0,s.jsxs)("div",{style:{display:"contents"},onMouseEnter:e=>this.onMouseEnter(t.mapLayerId),onMouseLeave:this.onMouseLeave,className:"jsx-".concat(et.__hash),children:[(0,s.jsxs)("div",{className:"jsx-".concat(et.__hash)+" cell variable-name",children:[(0,s.jsx)("span",{className:"jsx-".concat(et.__hash)+" variable-label",children:K(d)}),l.isMulti&&(0,s.jsx)(E.A,{units:null!==(i=null===(a=t._seriesData[0])||void 0===a?void 0:a.units)&&void 0!==i?i:null})]}),e.map((a,i)=>{let n=X(t,a),r=a.properties.id,o=ee(t,a),{seriesData:c,seriesSpec:u}=null!=o?o:{};return o&&c&&u?(0,s.jsx)(W,{isFetching:n,children:t=>{let{showAsFetching:a}=t;return this.renderCell(i,e,c,u,d,{showUnits:!l.isMulti,showAsFetching:a,isReallyFetching:n,transientDataWarning:h})}},c.id):n?(0,s.jsx)(J,{timeout:0},r):(0,s.jsx)(Y,{},r)}),(0,s.jsx)(n(),{id:et.__hash,children:et})]},t.id)},this.renderCell=(e,t,a,i,l,r)=>{var c;let d=!this.props.isLight,{showDetails:h}=this.state,{intl:u}=this.props,p=null;if(a){if(null==l?void 0:l.isCategorical)p=(0,_.EL)(l,a.stats.mode);else{let{min:e,max:t,avg:s}=a.stats;p=s,(e!==s||t!==s)&&[].push("min: ".concat(e.toPrecision(4),", max: ").concat(t.toPrecision(4)))}}let x=z({idxSeries:e,id:a.id,series:a,seriesSpec:i},t.length,!1,{accentByDefault:!0});return(0,s.jsxs)("span",{className:"jsx-".concat(et.__hash)+" value-and-details",children:[(0,s.jsx)("span",{style:{color:x},onClick:d?()=>this.setState({showDetails:!h}):void 0,title:d?u.$t({id:"pinValues.toggleDetailsHint",defaultMessage:"Click to show/hide details"}):void 0,className:"jsx-".concat(et.__hash)+" "+(o()("value-number",{clickable:d,"loading-value":r.showAsFetching})||""),children:"string"==typeof p?p:"number"==typeof p?Number(p.toPrecision(4)):(0,s.jsx)(Y,{})}),r.showUnits&&(0,s.jsxs)(s.Fragment,{children:[" ",(0,s.jsx)(E.A,{units:null!==(c=a.units)&&void 0!==c?c:null})]}),this.renderQcWarning(a),this.renderTransientDataWarning(r.transientDataWarning),this.renderDenseStats(a,l),this.renderSparseSampleDetails(a),(0,s.jsx)(n(),{id:et.__hash,children:et})]},a.id)},this.onMouseEnter=e=>{this.props.isDashboard||this.props.highlightMapLayer(e)},this.onMouseLeave=()=>{this.props.isDashboard||this.props.highlightMapLayer(null)}}}let Y=()=>(0,s.jsxs)("span",{"data-sentry-component":"NullValue","data-sentry-source-file":"200-PinValues.tsx",className:"jsx-".concat(et.__hash)+" null-value",children:["—",(0,s.jsx)(n(),{id:et.__hash,children:et})]}),J=e=>{let{timeout:t}=e;return(0,s.jsxs)("span",{"data-sentry-component":"PinValueSpinner","data-sentry-source-file":"200-PinValues.tsx",className:"jsx-".concat(et.__hash)+" spinner",children:[(0,s.jsx)(L.A,{timeout:t,"data-sentry-element":"Spinner","data-sentry-source-file":"200-PinValues.tsx"}),(0,s.jsx)(n(),{id:et.__hash,children:et})]})},K=e=>null==e?null:(0,_.JM)(e),Q=(e,t)=>null==e?e:parseFloat(e.toPrecision(t)),X=(e,t)=>{let{_subsetStatus:a,_subsetReqs:s}=e;for(let e=0;e<a.length;e++){if("fetching"!==a[e])continue;let n=s[e];if(null!=n){if(n.isSparse){if(n.platformId!==t.properties.sparsePlatformId)continue}else{var i;let e=n.dimReqs[v.DIM_LON_LAT];if((null==e?void 0:null===(i=e.filterCoords)||void 0===i?void 0:i[0])!==t.properties.id)continue}return!0}}return!1},ee=(e,t)=>{let{id:a}=t.properties,{_seriesData:s,_seriesSpecs:i}=e,n=i.findIndex(e=>e.featureId===a);return n<0?null:{seriesData:s[n],seriesSpec:i[n]}},et=new String(".outer.jsx-638b31ec1893bc89{min-width:100%;overflow:auto}.table.jsx-638b31ec1893bc89{width:-webkit-max-content;width:-moz-max-content;width:max-content;display:grid;grid-column-gap:10px}.cell.jsx-638b31ec1893bc89{}.cell.header.jsx-638b31ec1893bc89{max-width:150px}.variable-label.jsx-638b31ec1893bc89{margin-right:.4em}.value-and-details.jsx-638b31ec1893bc89{}.value-number.jsx-638b31ec1893bc89{white-space:nowrap;font-weight:bold}.value-number.clickable.jsx-638b31ec1893bc89{cursor:pointer}.details.jsx-638b31ec1893bc89{color:var(--color-text-dim);white-space:nowrap;cursor:pointer;display:block;margin-left:-2px}.details.inline.jsx-638b31ec1893bc89{display:inline;margin-left:.75em}.details-part.jsx-638b31ec1893bc89+.details-part.jsx-638b31ec1893bc89{margin-left:.5em}.details-label.jsx-638b31ec1893bc89{font-size:.8em}.spinner.jsx-638b31ec1893bc89{color:var(--color-stale-dark)}.null-value.jsx-638b31ec1893bc89{color:var(--color-stale-dark)}.qc-warning.jsx-638b31ec1893bc89{color:var(--color-warning);cursor:pointer}.loading-value.jsx-638b31ec1893bc89{background-image:-webkit-linear-gradient(left,#555,#666,#777,#666,#555);background-image:-moz-linear-gradient(left,#555,#666,#777,#666,#555);background-image:-o-linear-gradient(left,#555,#666,#777,#666,#555);background-image:linear-gradient(to right,#555,#666,#777,#666,#555);-webkit-background-clip:text;-webkit-text-fill-color:transparent;-webkit-animation:loading-animation 35s linear infinite;-moz-animation:loading-animation 35s linear infinite;-o-animation:loading-animation 35s linear infinite;animation:loading-animation 35s linear infinite}@-webkit-keyframes loading-animation{to{background-position:200vh}}@-moz-keyframes loading-animation{to{background-position:200vh}}@-o-keyframes loading-animation{to{background-position:200vh}}@keyframes loading-animation{to{background-position:200vh}}");et.__hash="638b31ec1893bc89";let ea=(0,c.Ng)((e,t)=>{let{mapObjectId:a}=t;return{mapObject:(0,S.UD)(e,a),mapLayers:(0,S.b7)(e),datasets:(0,S.yT)(e),settings:(0,S.mt)(e),isLight:(0,S.H9)(e),isDashboard:(0,S.N0)(e)}},N)((0,h.Ay)(q));var es=a(99420),ei=a.n(es),en=a(97937),el=a(38221),er=a.n(el),eo=a(52018),ec=a(58772),ed=a(87672),eh=a(44916),eu=a(21671),ep=a(77059),ex=a(56377),em=a(83170),ef=a(57806),eb=a(51893),eg=a(22978),ej=a(94036),ev=a(69328),e_=a(75791),ey=a(30520),ew=a(1216),ek=a(78945),eM=a(8867),eN=a(20084);let eS=e=>{let t=(0,eM.A)(),[a,i]=(0,l.useState)(!1),r=t=>{if(a)return;if(t)return e.onOpenLoginModal;let{item:s}=e;return s.onClick?s.onClick:s.onClickAsync?async()=>{i(!0);try{await s.onClickAsync()}finally{i(!1)}}:void 0};return(()=>{let{item:i}=e,l=!!i.loggedIn&&!e.isLoggedIn;return(0,s.jsxs)("div",{onClick:r(l),title:i.tooltip,"data-sentry-component":"render","data-sentry-source-file":"510-PinMenu.tsx",className:"jsx-".concat(eA.__hash)+" "+(o()("menu-item",{disabled:a,enabled:i.enabled})||""),children:[(0,s.jsx)("span",{className:"jsx-".concat(eA.__hash)+" "+((l?"needs-to-log-in":void 0)||""),children:i.label}),l&&(0,s.jsx)("span",{title:t.$t({id:"pinMenu.logInHint",defaultMessage:"Log in first"}),className:"jsx-".concat(eA.__hash)+" menu-item-log-in",children:(0,s.jsx)(p.Icon,{icon:"sign-in-alt"})}),a&&(0,s.jsx)("span",{className:"jsx-".concat(eA.__hash)+" menu-item-spinner",children:(0,s.jsx)(L.A,{})}),(0,s.jsx)(n(),{id:eA.__hash,children:eA})]})})()},eI=new String(".menu.jsx-7047ad3bfe4d216c{display:inline-block;color:inherit;cursor:pointer;white-space:nowrap}a.menu.jsx-7047ad3bfe4d216c:hover{color:inherit}.cm-pin-menu-title.jsx-7047ad3bfe4d216c{margin:0 -".concat(6,"px;padding:0 ").concat(6,"px}.menu.jsx-7047ad3bfe4d216c .menu-content.jsx-7047ad3bfe4d216c{display:none;position:absolute;z-index:var(--z-pin-graph-menu);right:-").concat(6,"px;border:1px solid var(--color-accent-bg);background:rgba(0,0,0,.8);padding:4px 2px}.menu.jsx-7047ad3bfe4d216c:hover .cm-pin-menu-title.jsx-7047ad3bfe4d216c{background:var(--color-accent-bg);color:var(--color-accent-fg)}.menu.jsx-7047ad3bfe4d216c:hover .menu-content.jsx-7047ad3bfe4d216c{display:block}.menu-sep.jsx-7047ad3bfe4d216c{cursor:default;padding:4px 0}.menu-sep-inner.jsx-7047ad3bfe4d216c{border-top:1px solid var(--color-dark-sep)}"));eI.__hash="7047ad3bfe4d216c";let eA=new String(".menu-item.jsx-fd6621d3cba366b3{padding:2px 10px;text-align:right}.menu-item.enabled.jsx-fd6621d3cba366b3{color:var(--color-accent-bg)}.menu-item.disabled.jsx-fd6621d3cba366b3{color:var(--color-dark-sep);cursor:not-allowed}.menu-item.jsx-fd6621d3cba366b3:hover:not(.disabled){background:var(--color-dark-button-bg)}.menu-item-log-in.jsx-fd6621d3cba366b3{margin-left:.4em}.menu-item-spinner.jsx-fd6621d3cba366b3{margin-left:.4em;color:var(--color-dim)}.needs-to-log-in.jsx-fd6621d3cba366b3{color:var(--color-dark-sep)}");eA.__hash="fd6621d3cba366b3";let eC=e=>{let[t,a]=(0,l.useState)(!1),i="LOGGED_IN"===(0,c.d4)(S.iN),r=e.items;r.length&&"separator"===r[0]&&(r=r.slice(1)),r.length&&"separator"===r[r.length-1]&&(r=r.slice(0,-1));let o=()=>{a(!0)};return(0,s.jsxs)("div",{"data-testid":e.testId,"data-sentry-component":"render","data-sentry-source-file":"510-PinMenu.tsx",className:"jsx-".concat(eI.__hash)+" menu",children:[(0,s.jsx)("div",{title:e.tooltip,className:"jsx-".concat(eI.__hash)+" cm-pin-menu-title",children:(0,s.jsx)(p.Icon,{icon:"ellipsis-h","data-sentry-element":"Icon","data-sentry-source-file":"510-PinMenu.tsx"})}),(0,s.jsx)("div",{className:"jsx-".concat(eI.__hash)+" menu-content",children:r.map((e,t)=>"separator"===e?(0,s.jsx)("div",{className:"jsx-".concat(eI.__hash)+" menu-sep",children:(0,s.jsx)("div",{className:"jsx-".concat(eI.__hash)+" menu-sep-inner"})},t):(0,s.jsx)(eS,{item:e,isLoggedIn:i,onOpenLoginModal:o},t))}),t&&(0,s.jsx)(eN.A,{onClose:()=>{a(!1)}}),(0,s.jsx)(n(),{id:eI.__hash,children:eI})]})};class eD extends l.Component{render(){var e;let{graph:t,graphSpec:a}=this.props,i=(0,_.Et)(a),l=null!==(e=t.subsetDimReqOverrides)&&void 0!==e?e:{};return(0,s.jsxs)("div",{"data-sentry-component":"PinGraphAdjustAxes","data-sentry-source-file":"310-PinGraphAdjustAxes.tsx",className:"jsx-".concat(eT.__hash)+" customize-axes",children:[(0,s.jsxs)("form",{action:"",method:"",onSubmit:this.onSubmit,className:"jsx-".concat(eT.__hash),children:[i[v.DIM_TIME]&&this.renderTime(l),i[v.DIM_ELEVATION]&&this.renderElevation(l),(0,s.jsxs)("div",{className:"jsx-".concat(eT.__hash)+" button-row",children:[(0,s.jsx)("button",{type:"button",onClick:this.props.onClose,className:"jsx-".concat(eT.__hash)+" wk-button dark small",children:(0,s.jsx)(d.A,{id:"pinBox.cancelButton",defaultMessage:"Cancel","data-sentry-element":"FormattedMessage","data-sentry-source-file":"310-PinGraphAdjustAxes.tsx"})}),(0,s.jsx)("span",{className:"jsx-".concat(eT.__hash)+" sep"}),(0,s.jsx)("button",{type:"submit",className:"jsx-".concat(eT.__hash)+" wk-button dark small",children:(0,s.jsx)(d.A,{id:"pinBox.applyButton",defaultMessage:"Apply","data-sentry-element":"FormattedMessage","data-sentry-source-file":"310-PinGraphAdjustAxes.tsx"})})]})]}),(0,s.jsx)(n(),{id:eT.__hash,children:eT})]})}renderTime(e){var t,a;let i=null!==(a=null===(t=e[v.DIM_TIME])||void 0===t?void 0:t.range)&&void 0!==a?a:null,{layerSpec:l,dashSettings:r}=this.props;return(i||(i=(0,T.nj)(l,{dashSettings:r})),i)?(0,s.jsxs)("div",{className:"jsx-".concat(eT.__hash)+" dim",children:[(0,s.jsx)("div",{className:"jsx-".concat(eT.__hash)+" dim-label",children:(0,s.jsx)(d.A,{id:"pinBox.adjustAxes.time",defaultMessage:"Time"})}),(0,s.jsxs)("div",{className:"jsx-".concat(eT.__hash)+" dim-fields",children:[(0,s.jsxs)("div",{className:"jsx-".concat(eT.__hash)+" field",children:[(0,s.jsxs)("span",{className:"jsx-".concat(eT.__hash)+" field-label",children:[(0,s.jsx)(d.A,{id:"pinBox.adjustAxes.rangeFrom",defaultMessage:"From"}),":"]}),(0,s.jsx)("input",{name:"timeMin",type:"date",defaultValue:ei().utc(i[0]).toISOString().slice(0,10),className:"jsx-".concat(eT.__hash)})]}),(0,s.jsxs)("div",{className:"jsx-".concat(eT.__hash)+" field",children:[(0,s.jsxs)("span",{className:"jsx-".concat(eT.__hash)+" field-label",children:[(0,s.jsx)(d.A,{id:"pinBox.adjustAxes.rangeTo",defaultMessage:"To"}),":"]}),(0,s.jsx)("input",{name:"timeMax",type:"date",defaultValue:ei().utc(i[1]).toISOString().slice(0,10),className:"jsx-".concat(eT.__hash)})]})]}),(0,s.jsx)(n(),{id:eT.__hash,children:eT})]}):null}renderElevation(e){var t,a;let i=null!==(a=null===(t=e[v.DIM_ELEVATION])||void 0===t?void 0:t.range)&&void 0!==a?a:null;return(i||(i=(0,T.P4)(this.props.layerSpec)),i)?(0,s.jsxs)("div",{className:"jsx-".concat(eT.__hash)+" dim",children:[(0,s.jsx)("div",{className:"jsx-".concat(eT.__hash)+" dim-label",children:(0,s.jsx)(d.A,{id:"pinBox.adjustAxes.depth",defaultMessage:"Depth"})}),(0,s.jsxs)("div",{className:"jsx-".concat(eT.__hash)+" dim-fields",children:[(0,s.jsxs)("div",{className:"jsx-".concat(eT.__hash)+" field",children:[(0,s.jsxs)("span",{className:"jsx-".concat(eT.__hash)+" field-label",children:[(0,s.jsx)(d.A,{id:"pinBox.adjustAxes.rangeFrom",defaultMessage:"From"}),":"]}),(0,s.jsx)("input",{name:"depthMin",type:"number",step:"any",defaultValue:-i[1],onMouseDownCapture:e=>e.stopPropagation(),className:"jsx-".concat(eT.__hash)}),(0,s.jsx)("span",{className:"jsx-".concat(eT.__hash)+" field-units",children:"m"})]}),(0,s.jsxs)("div",{className:"jsx-".concat(eT.__hash)+" field",children:[(0,s.jsxs)("span",{className:"jsx-".concat(eT.__hash)+" field-label",children:[(0,s.jsx)(d.A,{id:"pinBox.adjustAxes.rangeTo",defaultMessage:"To"}),":"]}),(0,s.jsx)("input",{name:"depthMax",type:"number",step:"any",defaultValue:-i[0],onMouseDownCapture:e=>e.stopPropagation(),className:"jsx-".concat(eT.__hash)}),(0,s.jsx)("span",{className:"jsx-".concat(eT.__hash)+" field-units",children:"m"})]})]}),(0,s.jsx)(n(),{id:eT.__hash,children:eT})]}):null}constructor(...e){super(...e),this.onSubmit=e=>{let{intl:t}=this.props;try{return this._onSubmit(e)}catch(e){if("NO_DATA"===e.message){(0,p.notify)({type:"warn",icon:"download",title:t.$t({id:"notif.noDataInInterval",defaultMessage:"No data found for the selected interval"})});return}throw e}},this._onSubmit=e=>{e.preventDefault();let{layerSpec:t,graphSpec:a,dashSettings:s}=this.props,i=(0,_.Et)(a),{tExplicitCoords:n,zExplicitCoords:l}=t,r=e.target,o={},c={};if(i[v.DIM_ELEVATION]){let e=r.depthMin.value,a=r.depthMax.value,s=e?parseFloat(e):-1/0,i=a?parseFloat(a):Infinity,n=Math.min(s,i),d=-Math.max(s,i),h=-n,[u,p]=(0,T.P4)(t);if(h<u||d>p)throw Error("NO_DATA");d<u&&(d=u),h>p&&(h=p);let x=[d,h];if(o[v.DIM_ELEVATION]={range:x,maxInclusive:!0},l){let e=(0,eg.b4)(l,x,{maxInclusive:!0});if(!e)throw Error("NO_DATA");c[v.DIM_ELEVATION]=e[1]-e[0]}else c[v.DIM_ELEVATION]=x[1]-x[0]}if(i[v.DIM_TIME]){let e=r.timeMin.value,a=r.timeMax.value,i=e?ei().utc(e).valueOf():-1/0,l=a?ei().utc(a).valueOf():Infinity,d=Math.min(i,l),h=Math.max(i,l),[u,p]=(0,T.nj)(t,{dashSettings:s});if(h<u||d>p)throw Error("NO_DATA");d<u&&(d=u),h>p&&(h=p);let x=[d,h];if(o[v.DIM_TIME]={range:x,maxInclusive:!0},n){let e=(0,eg.b4)(n,x,{maxInclusive:!0});if(!e)throw Error("NO_DATA");c[v.DIM_TIME]=e[1]-e[0]}else c[v.DIM_TIME]=x[1]-x[0]}this.props.onApply(o,c),this.props.onClose()}}}let eT=new String('.customize-axes.jsx-bf1af3eb8b2507b4{margin:8px 8px;padding:0 0 5px;color:black;line-height:1.6}.dim.jsx-bf1af3eb8b2507b4{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-moz-box-orient:horizontal;-moz-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:start;-webkit-align-items:flex-start;-moz-box-align:start;-ms-flex-align:start;align-items:flex-start;color:var(--color-dim)}.dim-label.jsx-bf1af3eb8b2507b4{width:60px}.field-label.jsx-bf1af3eb8b2507b4{display:inline-block;width:40px}.field-units.jsx-bf1af3eb8b2507b4{margin-left:.3em}input.jsx-bf1af3eb8b2507b4{color-scheme:dark;background-color:inherit;color:white;width:100px}input[type="number"].jsx-bf1af3eb8b2507b4{}.button-row.jsx-bf1af3eb8b2507b4{line-height:1.3;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;margin-top:5px}.sep.jsx-bf1af3eb8b2507b4{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1}');eT.__hash="bf1af3eb8b2507b4";let eL=(0,h.Ay)(eD),eE=new Date("2013-04-27T00:00:00Z").getTime(),eO=new Date("2019-04-27T00:00:00Z").getTime(),eP=[31,28,31,30,31,30,31,31,30,31,30,31],ez=[],eF={};!function(){let e=1;ez[0]=e,eF[String(e)]=0;for(let t=1;t<12;t++)e+=eP[t],ez[t]=e,eF[String(e)]=t}();class eU extends l.PureComponent{componentDidMount(){this.plotInit(),this.plotUpdate(),this.didMountOrUpdate()}componentDidUpdate(){this.plotUpdate(),this.prevSeries=P(this.props.graph),this.didMountOrUpdate()}componentWillUnmount(){this.onDragEnd(),this.isUnmounted=!0}didMountOrUpdate(){var e;if(this.hasData&&!this.usedJustGotInitialData&&(this.usedJustGotInitialData=!0,this.setState({justGotInitialData:!0}),setTimeout(()=>{this.isUnmounted||this.setState({justGotInitialData:!1})},1200)),(null===(e=this.graphSpec)||void 0===e?void 0:e.type)==="image"){let{idxSelected2dGraphSeries:e}=this.state,t=P(this.props.graph).length;t>0&&e>=t?this.setState({idxSelected2dGraphSeries:t-1}):0===t&&e>0&&this.setState({idxSelected2dGraphSeries:0})}}render(){let{mapObject:e,graph:t,mapLayer:a,layerSpec:i,isDashboard:l}=this.props;if(!e||!t||!a||!i)return null;let{graphSpecId:r}=t;if(this.graphSpec=v.SYSTEM_GRAPH_SPECS[r],!this.graphSpec)throw Error("No graphSpec with ID ".concat(r));return this.hasData=eW(t),this.hasEverHadData||(this.hasEverHadData=this.hasData),this.hasError=eH(t),this.isFetching=eq(t),this.calcAllPaginationFlags(this.graphSpec),(0,s.jsxs)("div",{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,"data-sentry-component":"_PinGraph","data-sentry-source-file":"300-PinGraph.tsx",className:"jsx-".concat(tl.__hash)+" "+(o()("cm-pin-graph",{"in-card":l})||""),children:[(0,s.jsxs)("div",{className:"jsx-".concat(tl.__hash)+" cm-svg-outer",children:[this.renderSvg(),this.renderPagination(),this.renderIndicators()]}),this.renderButtons(),this.renderStats(),this.renderTransientDataWarning(),this.renderMovingPlatformWarning(),this.renderAdjustAxes(),(0,s.jsx)(n(),{id:tl.__hash,children:tl})]})}renderSvg(){var e;let{mapObject:t,isDashboard:a}=this.props,{graphSpec:i}=this;this.width=Math.floor(this.props.width);let l=a?Math.max(1,(this.width/282)**.45):t.enlargeGraphs?1.5:1;this.height=Math.round((null!==(e=i.height)&&void 0!==e?e:110)*l);let{className:r}=i,c="graph-threshold-pattern-".concat(this.randomId);return(0,s.jsxs)("svg",{ref:this.refSvg,width:this.width,height:this.height,className:o()("le-graph",r)||"",children:[(0,s.jsx)("defs",{children:(0,s.jsx)("pattern",{id:c,patternUnits:"userSpaceOnUse",width:16,height:16,children:(0,s.jsx)("image",{href:e_.k,width:16,height:16})})}),(0,s.jsxs)("g",{ref:this.refRoot,transform:"translate(0.5, 0.5)",children:[(0,s.jsx)("g",{className:"le-graph-base"}),(0,s.jsx)("g",{fill:"url(#".concat(c,")"),className:"le-graph-thresholds"}),(0,s.jsx)("g",{className:"le-graph-data"}),(0,s.jsx)("g",{className:"le-graph-thumbs-x"}),(0,s.jsx)("g",{className:"le-graph-thumbs-y"}),(0,s.jsx)("g",{className:"le-graph-axis-labels"})]}),(0,s.jsx)(n(),{id:tu.__hash,children:tu})]})}renderPagination(){let{intl:e}=this.props,{xMoreBelow:t,xMoreAbove:a,yMoreBelow:i,yMoreAbove:l}=this,{justGotInitialData:r,paginationFlash:c}=this.state,d=o()("more",{"just-got-initial-data":r}),h=e.$t({id:"pinGraph.loadMoreHint",defaultMessage:"Load more data along this dimension"});return(0,s.jsxs)(s.Fragment,{children:[t&&(0,s.jsx)("div",{onClick:this.onClickMoreBelowX,title:h,className:"jsx-".concat(th.__hash)+" "+"".concat(d," left"),children:(0,s.jsx)(p.Icon,{icon:"plus"})}),a&&(0,s.jsx)("div",{onClick:this.onClickMoreAboveX,title:h,className:"jsx-".concat(th.__hash)+" "+"".concat(d," right"),children:(0,s.jsx)(p.Icon,{icon:"plus"})}),i&&(0,s.jsx)("div",{onClick:this.onClickMoreBelowY,title:h,className:"jsx-".concat(th.__hash)+" "+"".concat(d," bottom"),children:(0,s.jsx)(p.Icon,{icon:"plus"})}),l&&(0,s.jsx)("div",{onClick:this.onClickMoreAboveY,title:h,className:"jsx-".concat(th.__hash)+" "+"".concat(d," top"),children:(0,s.jsx)(p.Icon,{icon:"plus"})}),c&&(0,s.jsx)("div",{className:"jsx-".concat(th.__hash)+" "+(o()("pagination-flash",c.position)||""),children:c.label},c.label),(0,s.jsx)(n(),{id:th.__hash,children:th})]})}renderButtons(){var e;let{intl:t,mapObject:a,layerSpec:i,graph:l,isDashboard:r}=this.props,o=(0,_.Et)(this.graphSpec),c=o[v.DIM_TIME]||o[v.DIM_ELEVATION],d=(null==i?void 0:i.hasZarr)&&(null===(e=this.graphSpec)||void 0===e?void 0:e.denseCsvCols)!=null,h=null==i?void 0:i.hasSqlite,{xZoom:u,yZoom:x}=this,m=[];return c&&m.push({label:t.$t({id:"pinMenu.adjustAxes",defaultMessage:"Adjust axes"}),enabled:this.state.isAdjustingAxes,onClick:this.onToggleAdjustAxes}),this.hasData&&(m.push("separator"),(null==i?void 0:i.hasZarr)&&m.push({label:t.$t({id:"pinMenu.exportToNetcdf",defaultMessage:"Export to netCDF"}),tooltip:t.$t({id:"pinMenu.exportToNetcdfHint",defaultMessage:"Export raw graph data to a netCDF file"}),onClickAsync:this.onClickExportDenseNetcdf,loggedIn:!0}),d&&m.push({label:t.$t({id:"pinMenu.exportToCsv",defaultMessage:"Export to CSV"}),tooltip:t.$t({id:"pinMenu.exportToCsvHint",defaultMessage:"Export raw graph data to a CSV file"}),onClick:this.onClickExportDenseCsv,loggedIn:!0}),h&&m.push({label:t.$t({id:"pinMenu.exportToCsv",defaultMessage:"Export to CSV"}),tooltip:t.$t({id:"pinMenu.exportToCsvHint",defaultMessage:"Export raw graph data to a CSV file"}),onClick:this.onClickExportSparseCsv,loggedIn:!0}),m.push({label:t.$t({id:"pinMenu.exportToSvg",defaultMessage:"Export to SVG"}),onClick:this.onClickExportSvg,loggedIn:!0})),m.push("separator"),m.push({label:t.$t({id:"pinMenu.removeGraph",defaultMessage:"Remove graph"}),onClick:()=>{this.props.removeGraph(a.id,l.id)}}),r&&m.push({label:t.$t({id:"pinMenu.removeAllGraphs",defaultMessage:"Remove all graphs"}),tooltip:t.$t({id:"pinMenu.removeAllGraphsHint",defaultMessage:"Remove all graphs for this geometry/platform"}),onClick:()=>{this.props.removeGraphsForMapObject(a.id)}}),(0,s.jsxs)("div",{className:"jsx-".concat(tr.__hash)+" graph-buttons",children:[(1!==u||1!==x)&&(0,s.jsx)("span",{title:t.$t({id:"pinGraph.resetZoomHint",defaultMessage:"Reset zoom"}),onClick:this.resetZoom,className:"jsx-".concat(tr.__hash)+" cm-pinbox-button reset-zoom",children:(0,s.jsx)(p.Icon,{icon:"expand"})}),(0,s.jsx)("span",{className:"jsx-".concat(tr.__hash)+" pin-menu-wrapper",children:(0,s.jsx)(eC,{items:m,tooltip:t.$t({id:"pinMenu.title",defaultMessage:"Graph options"})})}),(0,s.jsx)(n(),{id:tr.__hash,children:tr})]})}renderIndicators(){let{isFetching:e,hasData:t,hasError:a}=this,{intl:i}=this.props;return!e&&t?null:(0,s.jsxs)("div",{className:"jsx-".concat(to.__hash)+" indicators",children:[!t&&!a&&!e&&(0,s.jsxs)("span",{className:"jsx-".concat(to.__hash)+" no-data",children:[(0,s.jsx)(d.A,{id:"pinGraph.noData",defaultMessage:"No data"})," "]}),a&&!e&&(0,s.jsxs)("span",{className:"jsx-".concat(to.__hash)+" no-data",children:[(0,s.jsx)(d.A,{id:"pinGraph.tryAgain",defaultMessage:"Please try again or request less data"})," "]}),e&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(L.A,{timeout:t?v.UI.graphSpinnerValue:v.UI.graphSpinnerNoValue}),(0,s.jsx)(L.A,{timeout:5e3,label:i.$t({id:"pinGraph.patience",defaultMessage:"Please be patient!"}),noSpinner:!0})]}),(0,s.jsx)(n(),{id:to.__hash,children:to})]})}renderStats(){var e;if(!this.hasData)return(0,s.jsxs)("div",{className:"jsx-".concat(tc.__hash)+" stats",children:["\xa0",(0,s.jsx)(n(),{id:tc.__hash,children:tc})]});if(this.props.isLight||this.props.settings.hideGraphStats)return null;let{intl:t,layerSpec:a}=this.props,{graphSpec:i}=this,{isCategorical:l}=null!=a?a:{},r=P(this.props.graph),o=r.length,c=(null===(e=this.props.mapObject)||void 0===e?void 0:e.isMulti)||this.props.isDashboard,h=[];return r.forEach(e=>{var t,a;let s,{series:n,seriesSpec:l,idxSeries:r,isHidden:c}=e;if(null==n)return;let{min:d,avg:u,max:p,mode:x}=null!==(t=n.stats)&&void 0!==t?t:{};s="image"===i.type?r===this.state.idxSelected2dGraphSeries?"white":"var(--color-text-dim)":c?"var(--color-text-dim)":o>1?(0,O.ep)(null!==(a=l.color)&&void 0!==a?a:"light",r):"white",h.push({title:l.label,color:s,sparseLabel:l.sparseLabel,seriesDataId:n.id,min:d,avg:u,max:p,mode:x,units:n.units})}),(0,s.jsxs)("div",{className:"jsx-".concat(tc.__hash)+" stats",children:["image"===i.type&&h.length>1&&(0,s.jsxs)("div",{className:"jsx-".concat(tc.__hash)+" instructions",children:[(0,s.jsx)(d.A,{id:"pinGraph.chooseSeriesPrompt",defaultMessage:"Click to choose a different geometry"}),":"]}),h.map((e,n)=>{let{color:r,title:h,min:u,avg:x,max:m,mode:f,units:b}=e,{sparseLabel:g,seriesDataId:j}=e,y="image"!==i.type&&o>1,w="image"===i.type?null!=this.state.idxSelected2dGraphSeries&&n!==this.state.idxSelected2dGraphSeries:o>1;return(0,s.jsxs)("div",{style:{"--color-series":r,cursor:w?"pointer":void 0},onClick:w?e=>this.onClickToggleSeries(e,n,j):void 0,title:w?"image"===i.type?t.$t({id:"pinGraph.chooseSeriesHint",defaultMessage:"Show this graph series"}):t.$t({id:"pinGraph.toggleSeriesHint",defaultMessage:"Toggle this graph series. Alt-click to show only this series or to show all."}):void 0,className:"jsx-".concat(tc.__hash),children:[y&&(0,s.jsx)("span",{className:"jsx-".concat(tc.__hash)+" stats-swatch"}),!!h&&c&&(0,s.jsx)("span",{className:"jsx-".concat(tc.__hash)+" stats-elem",children:(0,s.jsx)(I,{label:h,maxLength:v.UI.displayedFeatureNameLength})}),null!=g&&(0,s.jsx)("span",{className:"jsx-".concat(tc.__hash)+" stats-elem stats-sparse-label",children:g}),null!=x||null!=u||null!=m||null!=f?(0,s.jsxs)("span",{className:"jsx-".concat(tc.__hash)+" stats-elem avg-min-max",children:[l&&null!=f&&(0,s.jsxs)("span",{className:"jsx-".concat(tc.__hash)+" stats-elem",children:[(0,s.jsx)("span",{className:"jsx-".concat(tc.__hash)+" stats-label textual mode",children:(0,s.jsx)(d.A,{id:"pinGraph.mode",defaultMessage:"mode"})}),(0,s.jsx)("span",{className:"jsx-".concat(tc.__hash)+" stats-value",children:(0,_.EL)(a,f)})]}),!l&&null!=x&&(0,s.jsxs)("span",{title:t.$t({id:"pinGraph.avgHint",defaultMessage:"Average value"}),className:"jsx-".concat(tc.__hash)+" stats-elem",children:[(0,s.jsx)("span",{className:"jsx-".concat(tc.__hash)+" stats-label textual avg",children:"x"}),(0,s.jsx)("span",{className:"jsx-".concat(tc.__hash)+" stats-value",children:ti(x,3)})]}),!l&&null!=u&&(0,s.jsxs)("span",{title:t.$t({id:"pinGraph.minHint",defaultMessage:"Minimum value"}),className:"jsx-".concat(tc.__hash)+" stats-elem",children:[(0,s.jsx)("span",{className:"jsx-".concat(tc.__hash)+" stats-label min",children:(0,s.jsx)(p.Icon,{icon:"arrow-down"})}),(0,s.jsx)("span",{className:"jsx-".concat(tc.__hash)+" stats-value",children:ti(u,3)})]}),!l&&null!=m&&(0,s.jsxs)("span",{title:t.$t({id:"pinGraph.maxHint",defaultMessage:"Maximum value"}),className:"jsx-".concat(tc.__hash)+" stats-elem",children:[(0,s.jsx)("span",{className:"jsx-".concat(tc.__hash)+" stats-label max",children:(0,s.jsx)(p.Icon,{icon:"arrow-up"})}),(0,s.jsx)("span",{className:"jsx-".concat(tc.__hash)+" stats-value",children:ti(m,3)})]})]}):(0,s.jsx)("span",{className:"jsx-".concat(tc.__hash)+" stats-elem",children:(0,s.jsx)("span",{className:"jsx-".concat(tc.__hash)+" stats-value",children:"—"})}),null!=b&&(0,s.jsx)("span",{className:"jsx-".concat(tc.__hash)+" units",children:(0,s.jsx)(E.A,{units:b,plain:!0})})]},"".concat(n))}),(0,s.jsx)(n(),{id:tc.__hash,children:tc})]})}renderTransientDataWarning(){let e;let{graphSpec:t}=this;if(t.isSparse)return null;let{layerSpec:a,graph:s,intl:i}=this.props,{xAxis:n,yAxis:l}=t;if("parameter"===n.type&&n.dimId===v.DIM_TIME||"parameter"===l.type&&l.dimId===v.DIM_TIME)e=Infinity;else{var r,o,c,d;let t=null===(r=s._subsets)||void 0===r?void 0:r[0];e=t&&"deletedDimCoords"in t&&null!==(d=null==t?void 0:null===(c=t.deletedDimCoords)||void 0===c?void 0:null===(o=c[v.DIM_TIME])||void 0===o?void 0:o.values[0])&&void 0!==d?d:null}if(null==e)return null;let h=(0,T.$d)(a,e,i);return this.renderWarning(h)}renderMovingPlatformWarning(){var e;let{graphSpec:t}=this,{intl:a,mapObject:s}=this.props,i=null==s?void 0:s.features[0];if(!i||"object"!=typeof i)return null;let n=null!==(e=i.properties.sparsePlatformType)&&void 0!==e?e:"";if(!j.BB[n])return null;let l=t.isSparse?a.$t({id:"pinGraph.movingPlatform1",defaultMessage:"This graph shows the measurements of a moving platform."}):a.$t({id:"pinGraph.movingPlatform2",defaultMessage:"This graph shows data at this (fixed) location."});return this.renderWarning(l)}renderWarning(e){return e?(0,s.jsxs)("div",{className:"jsx-".concat(td.__hash)+" warning",children:[(0,s.jsx)("span",{className:"jsx-".concat(td.__hash)+" icon",children:(0,s.jsx)(p.Icon,{icon:"exclamation-triangle"})}),(0,s.jsx)("span",{className:"jsx-".concat(td.__hash),children:e}),(0,s.jsx)(n(),{id:td.__hash,children:td})]}):null}renderAdjustAxes(){return this.state.isAdjustingAxes?(0,s.jsx)(eL,{graph:this.props.graph,graphSpec:this.graphSpec,layerSpec:this.props.layerSpec,dashSettings:this.props.dashSettings,onClose:()=>this.setState({isAdjustingAxes:!1}),onApply:this.onApplyAdjustedAxes}):null}plotInit(){let e=this.refSvg.current,t=(0,x.A)(e);(0,g.A)().on("start",this.onDragStart).on("drag",this.onDragMove).on("end",this.onDragEnd).container(e)(t),t.on("wheel",this.onZoom)}plotUpdate(){let{graph:e,mapLayer:t,layerSpec:a,settings:s}=this.props,i=(0,_.WV)(t,a,s),{graphSpec:n,isFetching:l,hasData:r}=this,o=this.shouldAnimate()?v.UI.transitionDuration:0,c=(0,eo.kY)().duration(o),d=(0,x.A)(this.refRoot.current),h=this.processAxis({isY:!1});this.xProps=h;let u=h.scale;this.xRange=h.range;let p=this.xScale;r&&(this.xScale=u);let m=this.processAxis({isY:!0});this.yProps=m;let f=m.scale;this.yRange=m.range;let b=this.yScale;r&&(this.yScale=f);let g=this.getClipPathId();e3({selRoot:d,xProps:h,yProps:m,clipPath:g});let{threshold:j}=i;if((h.isValue||m.isValue)&&e1({selRoot:d,transition:c,xProps:h,yProps:m,threshold:j,hasData:r,clipPath:g}),e0({selRoot:d,transition:c,axisProps:h,crossProps:m,prevScale:p}),e0({selRoot:d,transition:c,axisProps:m,crossProps:h,prevScale:b}),e2({selRoot:d,transition:c,axisProps:h,crossProps:m}),e2({selRoot:d,transition:c,axisProps:m,crossProps:h}),e5({selRoot:d,transition:c,axisProps:h,crossProps:m,hasData:r}),e5({selRoot:d,transition:c,axisProps:m,crossProps:h,hasData:r}),"image"===n.type){let e=this.get2DImgDataUrl({xProps:h,yProps:m,layerProps:i});e8({selRoot:d,transition:c,isFetching:l,xProps:h,yProps:m,dataUrl:e,clipPath:g})}else if("line"===n.type){let{prevSeries:t,xZoomedDomain:a,yZoomedDomain:s}=this;e6({selRoot:d,transition:c,graph:e,prevSeries:t,xProps:h,yProps:m,isFetching:l,xPrevScale:p,yPrevScale:b,hasData:r,clipPath:g,xZoomedDomain:a,yZoomedDomain:s})}else"bar"===n.type?e9({selRoot:d,transition:c,graph:e,xProps:h,yProps:m,isFetching:l,hasData:r,clipPath:g}):"boxplot"===n.type&&e4({selRoot:d,transition:c,graph:e,xProps:h,yProps:m,isFetching:l,hasData:r,clipPath:g});e7({selRoot:d,transition:c,axisProps:h,crossProps:m,hasData:r,clipPath:g}),e7({selRoot:d,transition:c,axisProps:m,crossProps:h,hasData:r,clipPath:g})}processAxis(e){var t;let a,s,i,n,l,r,o,c,d,h;let{mapObject:u,graph:p,mapLayer:x}=this.props,{settings:m,layerSpec:f,intl:b}=this.props,{isY:g}=e,j=g?this.graphSpec.yAxis:this.graphSpec.xAxis,y="value"===j.type,w="image"===this.graphSpec.type,{dimId:k}=j,M=k===v.DIM_TIME,N=k===v.DIM_LON_LAT,S=k===v.DIM_HIST_COORDS,I="histogram"===j.analyse,A=!1;(S||y&&!I)&&(A=!!x.logScale);let C=null!==(t=e.reduceSpace)&&void 0!==t?t:1,D=Infinity,T=-1/0,L=null,E=[],O=P(p);for(let e=0;e<O.length;e++){let t;let{series:a,isHidden:s}=O[e];if(!a||s)continue;if(S){let{min:s,max:i}=a.stats;t=[s,i],E[e]=eJ(a)}else if(I){let e=eJ(a);t=[0,(0,eu.A)(e,e=>e.value)]}else if(y){let{min:e,max:s}=a.stats;t=[e,s]}else t=g?a.yDomain:a.xDomain;let[i,n]=t;null!=i&&i<D&&(D=i),null!=n&&n>T&&(T=n)}null!=L||(L=0),Infinity===D&&(M?(D=eE,T=eO):(D=.1,T=1));let z=[D,T],F=[D,T-2*L];if(N){let e=m.unitsLength;"mi"===e?a=e=>e/1.609344:"nmi"===e&&(a=e=>e/1.852),a?(z[0]=a(z[0]),z[1]=a(z[1]),s=e=>a(e.distance)):s=e=>e.distance}if(A&&eX(z),z[1]===z[0]){if(A)z[1]*=2*C,z[0]/=2*C;else{let e=Math.abs(.1*z[0]*C);z[1]+=e,z[0]-=e}}let U=g?this.yZoom:this.xZoom;1===U?g?this.yUnzoomedDomain=z:this.xUnzoomedDomain=z:z=g?this.yZoomedDomain:this.xZoomedDomain;let{vOrigin:R,splitSign:B}=eK(z,A,C,M,U,w);1===U&&(R<z[0]?z[0]=R:R>z[1]&&(z[1]=R));let{width:V,height:G}=this;g?(i=[G-6,4],n=[G-6,30]):(i=[8,V-8],n=[8,V-8-45]);let W=(l=(l=M&&!j.groupTimeBy?(0,eh.Pp)():A?(0,eh.ZE)():(0,eh.m4)()).domain(z).rangeRound(n))(R),H=W+(g?-1:1)*B*7,$=l.copy().domain([z[0]-L,z[1]-L]),q=[];if(this.hasData){if(M){let{groupTimeBy:e}=j;if("month"===e){let[e,t]=z;for(let a=0;a<12;a++)a>=e&&a<=t&&q.push(a);o=e=>"JFMAMJJASOND"[e]}else if("dayOfYear"===e){let[e,t]=z;for(let a=0;a<12;a++){let s=ez[a],i=a<11?ez[a+1]:400;t<s||e>i||q.push(s)}o=e=>"JFMAMJJASOND"[eF[e]]}else if("hour"===e){let[e,t]=z;for(let a=0;a<24;a+=6)a>=e&&a<=t&&q.push(a);o=(0,ed.GP)("02d")}else{let e=(0,ev.O)(z,n,b.locale,g);q=(0,_.jk)(e.tickValues),r=e=>e.t,o=e=>e.label}}else q=g?l.ticks(u.enlargeGraphs?5:3):l.ticks(3);g||(c=M||S?e=>e>W-20&&e<W+45:N?e=>e<W+45:e=>e>W-30&&e<W+10)}I?d="hist":y||S?(d=tt(f),j.analyseDimId&&(d+="[".concat(ta(j.analyseDimId,p),"]"))):(d=ta(k,p),g&&w&&(d+=" – ".concat(tt(f))));let Z=!1;!y&&!S&&[v.DIM_TIME,v.DIM_ELEVATION].includes(k)&&(Z=!0,h=[ts(k===v.DIM_TIME?this.props.time:this.props.elevation,0)]);let Y=!!j.isDefaultZoom;return{spec:j,isY:g,isValue:y,isParam:!y,dimId:k,label:d,isHistBins:S,isHistValues:I,hists:E,domain:z,strictDomain:F,range:n,rangeFull:i,scale:l,dataScale:$,logScale:A,vOrigin:R,origin:W,split:H,extractParam:s,ticks:q,tickValue:r,tickLabel:o,tickHideLabel:c,thumbs:h,canDrag:Z,isDefaultZoom:Y}}get2DImgDataUrl(e){let{xProps:t,yProps:a,layerProps:s}=e,{idxSelected2dGraphSeries:i}=this.state;try{var n,l,r;let{graph:e,layerSpec:o}=this.props;if(!o)return"";let{logScale:c,valueClamp:d,threshold:h}=s,{colormapId:u,colormapInvert:p,colormapStops:x}=s,{valueMin:m,valueMax:f}=(0,_.$9)(s),b=null===(n=e._seriesData)||void 0===n?void 0:n[i];if(null==b)return"";let g=[!!d,m,f,!!c,(0,ew.nG)(h),u,!!p,(null!==(l=s.colormapStops)&&void 0!==l?l:[]).join("-"),t.domain,a.domain].join(".");if(b===this.imgUrlCacheSeriesData&&g===this.imgUrlCacheKey&&this.imgUrl)return this.imgUrl;let{xCoords:j,yCoords:v}=b,{extractParam:y,range:w}=t,{extractParam:k,range:M}=a;y&&(j=j.map(y)),k&&(v=v.map(k));let{data:N}=b,S=j.length,I=Math.abs(w[1]-w[0]),A=Math.abs(M[1]-M[0]),C=null!=o.flagColormap,D=C?o.flagColormap.raw:(0,O.Co)(u,p,x).raw,T=Object.values(D).length,L=Array(I*A),{dataScale:E}=t,{dataScale:P}=a;for(let e=0;e<A;e++){let t=P.invert(e/(A-1)*(M[0]-M[1])+M[1]),a=te(v,t);for(let t=0;t<I;t++){let s=E.invert(t/I*(w[1]-w[0])+w[0]);s instanceof Date&&(s=s.getTime());let i=te(j,s),n=N[a*S+i];L[e*I+t]=n}}let z=document.createElement("canvas");z.width=I,z.height=A;let F=z.getContext("2d"),U=F.getImageData(0,0,I,A),R=U.data,B=null,V=null,G=null,W=null;h&&((G=document.createElement("canvas")).width=I,G.height=A,V=(B=(W=G.getContext("2d")).getImageData(0,0,I,A)).data);for(let e=0;e<A;e++)for(let t=0;t<I;t++){let a=e*I+t,s=L[a];if(null==s)continue;let i=h&&(0,ew.bF)(h,s);c&&(s=s>0?Math.log10(s):-1/0);let n=null;if(C){if(n=D[s],null==n)continue}else{if(s<m){if(!d)continue;s=m}if(s>f){if(!d)continue;s=f}let e=(s-m)/(f-m),t=Math.floor(e*T);t>=T&&(t=T-1),n=D[t]}let l=4*a;R[l+0]=n[0],R[l+1]=n[1],R[l+2]=n[2],R[l+3]=null!==(r=n[3])&&void 0!==r?r:255,h&&i&&(V[l+0]=255,V[l+1]=255,V[l+2]=255,V[l+3]=255)}return F.putImageData(U,0,0),h&&(W.putImageData(B,0,0),W.globalCompositeOperation="source-in",W.fillStyle=this.props.hatchingPattern,W.fillRect(0,0,I,A),F.drawImage(G,0,0)),this.imgUrlCacheSeriesData=b,this.imgUrlCacheKey=g,this.imgUrl=z.toDataURL("image/png"),this.imgUrl}catch(e){return console.error(e),""}}calcAllPaginationFlags(e){let[t,a]=this.calcPaginationFlags(e,!1),[s,i]=this.calcPaginationFlags(e,!0);this.xMoreBelow=t,this.xMoreAbove=a,this.yMoreBelow=s,this.yMoreAbove=i}calcPaginationFlags(e,t){var a,s;let i=[!1,!1],n=t?e.yAxis:e.xAxis;if("parameter"!==n.type)return i;let{dimId:l}=n;if(!(null===(a=e.paginate)||void 0===a?void 0:a[l])||!this.hasData)return i;let r=this.props.graph.subsetDimReqOverrides,o=null==r?void 0:null===(s=r[l])||void 0===s?void 0:s.range;if(!o)return i;let{layerSpec:c,dashSettings:d}=this.props;if(!c)return i;let h=l===v.DIM_TIME?(0,T.nj)(c,{dashSettings:d}):l===v.DIM_ELEVATION?(0,T.P4)(c):null;if(!h)return i;let[u,p]=h;return[o[0]>u,o[1]<p]}_onDragStart(e){if(!e.isParam||!e.canDrag)return;let{dimId:t}=e,{graphId:a}=this.props;t===v.DIM_TIME?this.props.timeDragStarted(a):t===v.DIM_ELEVATION&&this.props.elevationDragStarted(a)}_onDragMove(e){let{layerSpec:t}=this.props;if(!e.isParam||!e.canDrag)return;let{isY:a}=e;if(!e.thumbs[0])return;let s=a?m.f0.y:m.f0.x,i=this.screenToDimCoord(s,e);if(null==i)return;let{strictDomain:n}=e,l=n[0],r=n[1];i<l&&(i=l),i>r&&(i=r);let{dimId:o}=e,c=(null==t?void 0:t.isNonperiodic)||(null==t?void 0:t.hasSqlite);o===v.DIM_TIME?this.props.setTime(i,{noRound:c}):o===v.DIM_ELEVATION&&this.props.setElevation(i)}_onDragEnd(e){if(!e.isParam||!e.canDrag)return;let{dimId:t}=e,{graphId:a}=this.props;t===v.DIM_TIME?this.props.timeDragStopped(a):t===v.DIM_ELEVATION&&this.props.elevationDragStopped(a)}updateGraphDimReqOverrides(e){let{graph:t}=this.props,{mapObject:a}=this.props;a=(0,u.setIn)(a,["graphs",t.id,"subsetDimReqOverrides"],e),this.props.updateMapObject(a,{versionChanged:!0})}constructor(...e){super(...e),this.randomId=Math.random().toString(36).slice(2),this.refSvg=l.createRef(),this.refRoot=l.createRef(),this.hasData=!1,this.hasEverHadData=!1,this.hasError=!1,this.isFetching=!1,this.isZooming=!1,this.xZoom=1,this.yZoom=1,this.xZoomedDomain=null,this.yZoomedDomain=null,this.xUnzoomedDomain=null,this.yUnzoomedDomain=null,this.imgUrl=null,this.imgUrlCacheKey=null,this.xMoreBelow=!1,this.xMoreAbove=!1,this.yMoreBelow=!1,this.yMoreAbove=!1,this.prevSeries=[],this.usedJustGotInitialData=!1,this.isUnmounted=!1,this.state={justGotInitialData:!1,isAdjustingAxes:!1,idxSelected2dGraphSeries:0,paginationFlash:null},this.shouldAnimate=()=>!this.isZooming&&!(this.hasEverHadData&&!this.hasData),this.getClipPathId=()=>"graph-clip-".concat(this.randomId),this.onDragStart=()=>{this.hasData&&(this._onDragStart(this.xProps),this._onDragStart(this.yProps),this.onDragMove())},this.onDragMove=()=>{this.hasData&&(this._onDragMove(this.xProps),this._onDragMove(this.yProps))},this.onDragEnd=()=>{this.hasData&&this.xProps&&this.yProps&&(this._onDragEnd(this.xProps),this._onDragEnd(this.yProps))},this.screenToDimCoord=(e,t)=>{var a;let s=null!==(a=t.scale.invert(e))&&void 0!==a?a:null;return null==s||s instanceof Date&&(s=s.getTime()),s},this.onZoom=()=>{var e;let t;if(m.f0.stopImmediatePropagation(),m.f0.preventDefault(),!this.hasData)return;let{xProps:a,yProps:s}=this,i=!!s.isDefaultZoom,{altKey:n,shiftKey:l}=m.f0;(n||l)&&(i=!i);let r=i?s:a,{clientX:o,clientY:c,deltaMode:d,deltaX:h,deltaY:u}=m.f0,p=Math.abs(h)>Math.abs(u)?h:u;p*=1===d?25:1;let[x,f]=null!==(e=this.calcScreenCoords(o,c))&&void 0!==e?e:[],b=i?f:x,g=this.screenToDimCoord(b,r);if(null==g)return;let j=i?this.yZoom:this.xZoom,v=j*Math.pow(1.001,-p);if(v<1&&(v=1),v===j)return;let _=i?this.yUnzoomedDomain:this.xUnzoomedDomain;if(!_)return;let y=i?this.yZoomedDomain:this.xZoomedDomain,[w,k]=null!=y?y:_;if(g<w&&(g=w),g>k&&(g=k),1===v)t=_.slice();else{r.logScale?(k=Math.log(g)+(Math.log(k)-Math.log(g))/(v/j),w=Math.log(g)-(Math.log(g)-Math.log(w))/(v/j),k=Math.exp(k),w=Math.exp(w)):(k=g+(k-g)/(v/j),w=g-(g-w)/(v/j));let[e,a]=_;w<e&&(w=e),k>a&&(k=a),t=[w,k]}i?(this.yZoom=v,this.yZoomedDomain=1===v?null:t):(this.xZoom=v,this.xZoomedDomain=1===v?null:t),this.isZooming=!0,this.forceUpdate(),this.debouncedDisableIsZooming()},this.resetZoom=()=>{(1!==this.xZoom||1!==this.yZoom)&&(this.xZoom=1,this.yZoom=1,this.xZoomedDomain=null,this.yZoomedDomain=null,this.forceUpdate())},this.disableIsZooming=()=>{this.isZooming=!1},this.debouncedDisableIsZooming=er()(this.disableIsZooming,300,{leading:!1,trailing:!0}),this.calcScreenCoords=(e,t)=>{let{refSvg:a}=this;if(!a.current)return;let s=a.current.getBoundingClientRect();if(s)return[e-s.left,t-s.top]},this.onClickExportSvg=()=>{let e=this.refSvg.current;if(null==e)return;let t=e.outerHTML;t=(t=(t=(t=(t=(t=(t='<?xml version="1.0" encoding="utf-8"?>\n'+t).replace(/<svg.*?>/g,'<svg \n        version="1.1"\n        xmlns="http://www.w3.org/2000/svg"\n        xmlns:xlink="http://www.w3.org/1999/xlink"\n        viewBox="0 0 '.concat(e.clientWidth," ").concat(e.clientHeight,'"\n        fill="none"\n      >\n        <style type="text/css">\n          path, line { \n            stroke: black;\n            stroke-width: .5px;\n          }\n          path.le-data-line {\n            stroke-linejoin: round;\n            stroke-linecap: round;\n          }\n          text { \n            fill: gray;\n            font-family: sans-serif;\n            font-size: 11px;\n          }\n          .le-axis-tick line {\n            stroke: lightgray;\n          }\n          path.le-axis-split-fill {\n            stroke: none;\n            fill: white;\n          }\n          .le-graph-thumb {\n            fill: darkred;\n            fill-opacity: 0.5;\n          }\n          .le-graph-threshold {\n            stroke: none;\n            opacity: 0.2;\n          }\n          .le-axis-tick.overlapping text {\n            display: none;\n          }\n        </style>\n      '))).replace(/stroke: white;/g,"stroke: black;")).replace(/opacity: 0.8;/g,"opacity: 0.9;")).replace(/href="/g,'xlink:href="')).replace(/le-axis-tick([^>]*?)opacity: 0.3/g,"le-axis-tick overlapping$1opacity: 0.3")).replace(/<text([^>]*?)opacity: 0.3/g,"<text$1opacity: 0");let{graph:a,variable:s}=this.props,i=s?"_".concat(s.id):"",n="cmems".concat(i,"_").concat(a.graphSpecId,".svg"),l=new Blob([t],{type:"image/svg+xml"});(0,ey.WN)(l,n),(0,M.PJ)({category:"viewer",action:"exportSvg"})},this.onClickExportDenseNetcdf=async()=>{let{layerSpec:e,graph:t,intl:a}=this.props;if(!e||!this.hasData)return;let s=t._seriesSpecs;for(let i=0;i<s.length;i++){let n=s[i];if(null==n)continue;let{idxSubsets:l}=n,r=l.map(e=>t._subsets[e]);if(r.some(e=>null==e)||0===r.length)continue;let o=r.map(e=>eR(e,t.graphSpecId));await (0,ek.LR)(e,o,a,{noNotification:!0})}},this.onClickExportDenseCsv=()=>{let{layerSpec:e,graph:t}=this.props;if(!e||!this.hasData)return;let a=t._seriesSpecs;for(let s=0;s<a.length;s++){let i=a[s];if(null==i)continue;let{idxSubsets:n}=i,l=n.map(e=>t._subsets[e]);if(l.some(e=>null==e)||0===l.length)continue;let r=(0,eb.getTaglessSubdatasetId)(e.subdatasetId),o="".concat(r,"_").concat(Date.now(),".csv"),c=new Blob([this.getDenseCsv(l)],{type:v.CSV_MIME});(0,ey.WN)(c,o)}(0,M.PJ)({category:"viewer",action:"exportDenseCsv"})},this.getDenseCsv=e=>{var t,a,s,i,n,l;let{intl:r,layerSpec:o,settings:c}=this.props,{graphSpec:d}=this,h=d.denseCsvCols(e,c.unitsLength),u=d.denseCsvRows(e,c.unitsLength);u.unshift(h);let p=u.join("\n"),x="",m=eQ(e[0]);m&&(x=(0,en.stringify)(m.geometry));let f=r.$t({id:"csv.geometry",defaultMessage:"Geometry"}),b=r.$t({id:"csv.graphType",defaultMessage:"Values from graph"}),g=[...(0,ey.Pg)(o,r),"# ".concat(f,": ").concat(x),"# ".concat(b,": ").concat(d.selectTitle(r))],j=e[0],_=null===(s=j.deletedDimCoords)||void 0===s?void 0:null===(a=s[v.DIM_TIME])||void 0===a?void 0:null===(t=a.values)||void 0===t?void 0:t[0];if(null!=_){let e=ei().utc(_).format("DD/MM/YYYY HH:mm"),t=r.$t({id:"csv.date",defaultMessage:"Date"});g.push("# ".concat(t,": ").concat(e))}let y=null===(l=j.deletedDimCoords)||void 0===l?void 0:null===(n=l[v.DIM_ELEVATION])||void 0===n?void 0:null===(i=n.values)||void 0===i?void 0:i[0];if(null!=y){let e=r.$t({id:"csv.depth",defaultMessage:"Depth"});g.push("# ".concat(e,": ").concat(-y," m"))}let w=g.join("\n");return"".concat(w,"\n\n").concat(p)},this.onClickExportSparseCsv=async()=>{let{intl:e,layerSpec:t,graph:a}=this.props;if(!t||!this.hasData)return;let s=a._subsets.filter(e=>null!=e&&e.isSparse),i=(0,eb.getTaglessSubdatasetId)(t.subdatasetId),n="".concat(i,"_").concat(Date.now(),".csv");await (0,ej.sL)(t,s,e,n),(0,M.PJ)({category:"viewer",action:"exportSparseCsv"})},this.onToggleAdjustAxes=()=>{let e=!this.state.isAdjustingAxes;this.setState({isAdjustingAxes:e}),e&&(0,M.PJ)({category:"viewer",action:"graphAdjustAxes"})},this.onApplyAdjustedAxes=(e,t)=>{let{graphId:a}=this.props,{mapObject:s}=this.props;s=(0,u.mergeIn)(s,["graphs",a],{subsetDimReqOverrides:e,subsetPageLengths:t}),this.props.updateMapObject(s,{versionChanged:!0}),this.resetZoom()},this.onClickMoreButton=(e,t)=>()=>{var a;let{layerSpec:s,graph:i}=this.props;if(!s||!this.hasData)return;let{dimId:n}=e?this.graphSpec.yAxis:this.graphSpec.xAxis,l=i.subsetDimReqOverrides;if(!l)return;let r=i.subsetPageLengths[n];if(null==r)return;let o=l[n],c=s.hasSqlite?this.calcLargerRangeSparse(o,r,n,t):this.calcLargerRangeDense(o,r,n,t);if(void 0===c)return;l=null===c?(0,u.omit)(l,n):(0,u.set)(l,n,{range:c,maxInclusive:!0});let d=null!==(a=null==c?void 0:c[t?1:0])&&void 0!==a?a:null;null!=d&&this.showPaginationFlash(n,e,t,d),this.updateGraphDimReqOverrides(l),this.resetZoom()},this.onClickMoreBelowX=this.onClickMoreButton(!1,!1),this.onClickMoreAboveX=this.onClickMoreButton(!1,!0),this.onClickMoreBelowY=this.onClickMoreButton(!0,!1),this.onClickMoreAboveY=this.onClickMoreButton(!0,!0),this.calcLargerRangeDense=(e,t,a,s)=>{let i=this.getDatasetCoords(this.props.layerSpec,a);if(!i)return;let n=i.values.length,l=this.getSubsetIdxRange(i,e);if(!l)return;let[r,o]=l;return(s?o+=t:r-=t,r<0&&(r=0),o>=n&&(o=n-1),0===r&&o===n-1)?null:[i.values[r],i.values[o]]},this.calcLargerRangeSparse=(e,t,a,s)=>{let{layerSpec:i,dashSettings:n}=this.props,l=a===v.DIM_TIME?(0,T.nj)(i,{dashSettings:n}):a===v.DIM_ELEVATION?(0,T.P4)(i):null;if(!l)return;let[r,o]=l,{range:c}=e;if(!c)return;let[d,h]=c;return(s?h+=t:d-=t,d<r&&(d=r),h>o&&(h=o),d<=r&&h>=o)?null:[d,h]},this.showPaginationFlash=(e,t,a,s)=>{let i=Date.now(),n=e===v.DIM_ELEVATION?"".concat(ti(s,1)," m"):e===v.DIM_TIME?(0,_.Kq)(s):"";this.setState({paginationFlash:{label:n,tStarted:i,position:t?a?"top":"bottom":a?"right":"left"}}),setTimeout(()=>{if(this.isUnmounted)return;let{paginationFlash:e}=this.state;e&&e.tStarted===i&&this.setState({paginationFlash:null})},4e3)},this.getDatasetCoords=(e,t)=>{if(t===v.DIM_TIME)return e.tExplicitCoords;if(t===v.DIM_ELEVATION)return e.zExplicitCoords;throw Error("Unknown coords in layer for dimId ".concat(t))},this.getSubsetIdxRange=(e,t)=>{let{range:a,maxInclusive:s}=null!=t?t:{};return a?(0,eg.b4)(e,a,{maxInclusive:s}):null},this.onClickToggleSeries=(e,t,a)=>{var s;let{graphSpec:i}=this;if("image"===i.type){this.setState({idxSelected2dGraphSeries:t});return}let{graph:n}=this.props,l=null!==(s=n.hiddenSeries)&&void 0!==s?s:{},r=P(n),o=!r.find(e=>!e.isHidden&&e.id!==a);if(e.altKey)l={},o||r.forEach(e=>{let{id:t}=e;t!==a&&(l[t]=!0)});else{if(o)return;l=l[a]?(0,u.omit)(l,[a]):(0,u.set)(l,a,!0)}let c=this.props.mapObject;c=(0,u.setIn)(c,["graphs",n.id,"hiddenSeries"],l),this.props.updateMapObject(c),(0,M.PJ)({category:"viewer",action:"toggleGraphSeries"})},this.onMouseEnter=()=>{this.props.isDashboard||this.props.highlightMapLayer(this.props.mapLayer.id)},this.onMouseLeave=()=>{this.props.isDashboard||this.props.highlightMapLayer(null)}}}let eR=(e,t)=>{e.dims[v.DIM_FEATURE]&&(e=eB(e));let{xAxis:a,yAxis:s}=v.SYSTEM_GRAPH_SPECS[t],i="parameter"===a.type&&a.dimId===v.DIM_HIST_COORDS||"parameter"===s.type&&s.dimId===v.DIM_HIST_COORDS;return e.dims[v.DIM_LON_LAT]&&(e=i?eV(e):eG(e)),e},eB=e=>{let{dimIds:t,dims:a,deletedDimCoords:s,shape:i,strides:n}=e,l=t.indexOf(v.DIM_FEATURE);if(l<0)return e;let r=e.dims[v.DIM_FEATURE];return s=(0,u.set)(s,v.DIM_FEATURE,r.coords),t=(0,u.removeAt)(t,l),i=(0,u.removeAt)(i,l),n=(0,u.removeAt)(n,l),a=(0,u.omit)(a,[v.DIM_FEATURE]),e=(0,u.merge)(e,{deletedDimCoords:s,dimIds:t,dims:a,shape:i,strides:n})},eV=e=>{let{dimIds:t,dims:a}=e,s=t.indexOf(v.DIM_LON_LAT);if(s<0)return e;let i=e.dims[v.DIM_LON_LAT].coords.values.map((e,t)=>t),n={coords:{type:"explicit",values:i},len:i.length};return t=(0,u.replaceAt)(t,s,v.DIM_LOCATION_INDICES),a=(0,u.omit)(a,[v.DIM_LON_LAT]),a=(0,u.set)(a,v.DIM_LOCATION_INDICES,n),e=(0,u.merge)(e,{dimIds:t,dims:a})},eG=e=>{let{dimIds:t,dims:a}=e,s=t.indexOf(v.DIM_LON_LAT);if(s<0)return e;let i=e.dims[v.DIM_LON_LAT].coords.values.map(e=>e.distance),n={coords:{type:"explicit",values:i},len:i.length,units:"kilometers"};return t=(0,u.replaceAt)(t,s,v.DIM_DISTANCE),a=(0,u.omit)(a,[v.DIM_LON_LAT]),a=(0,u.set)(a,v.DIM_DISTANCE,n),e=(0,u.merge)(e,{dimIds:t,dims:a})},eW=e=>{let{_seriesData:t}=e;return null!=t&&t.some(e$)},eH=e=>{let{_subsetStatus:t}=e;return null==t?void 0:t.some(e=>"errored"===e)},e$=e=>{if(null==e)return!1;let{data:t}=e;for(let e=0;e<t.length;e++)if(null!=t[e])return!0;return!1},eq=e=>{let{_subsetStatus:t}=e;return null==t?void 0:t.some(e=>"fetching"===e)},eZ=e=>{let t=Math.log10(e[0]);return Math.log10(e[1])-t<1?e=>(0,_.Ex)(Math.log10(e),1)>=.7:e=>0!==(0,_.Ex)(Math.log10(e),1)},eY=e=>e,eJ=e=>{let{data:t}=e,a=t.length,s=Math.round(a/10);if(s<5?s=5:s>50&&(s=50),!a)return[];let i=[],n=0,l=t[0],r=0;for(let e=0;e<s-1;e++){let o=Math.round((e+1)/(s-1)*(a-1)),c=t[o];if(c===l)continue;let d=(o-n)/(c-l);i.push({coord:t[n],value:d}),r+=d,n=o,l=c}for(let e=0;e<i.length;e++)i[e].value/=r;return i},eK=(e,t,a,s,i,n)=>{let l;let r=0,[o,c]=e,d=Math.abs(c-o),h=1===i&&!n,u=Math.min(Math.abs(o),Math.abs(c))<.1*d;return s?(l=o,r=0):t?(l=h?o/2/a:o,r=1):o<=0&&c>=0?(l=0,r=0):u&&h?(l=0,r=0):o>=0?(l=h?o-.1*(c-o)*a:o,r=u?0:1):(l=h?c+.1*(c-o)*a:c,r=u?0:-1),{vOrigin:l,splitSign:r}},eQ=e=>{var t,a,s,i,n;let l=null==e?void 0:null===(t=e.subsetReq)||void 0===t?void 0:t.dimReqs;if(!l)return null;let r=null!==(i=null==l?void 0:l[v.DIM_FEATURE])&&void 0!==i?i:null==l?void 0:l[v.DIM_LON_LAT];if(!r)return null;let o=null==r?void 0:null===(a=r.filterCoords)||void 0===a?void 0:a[0];return o&&null!==(n=null==r?void 0:null===(s=r.filterFeatureset)||void 0===s?void 0:s.features[o])&&void 0!==n?n:null},eX=e=>{1e-12>Math.abs(e[0])&&null!=e[1]&&(e[0]=Math.abs(e[1])/1e3)},e0=e=>{let{selRoot:t,transition:a,axisProps:s,prevScale:i,crossProps:n}=e,{ticks:l,tickValue:r=eY,tickLabel:o=eY,tickHideLabel:c=()=>!1,origin:d,scale:h,logScale:u,isY:p}=s,x=n.rangeFull,m=eZ(h.domain()),f=p?"le-axis-ticks-y":"le-axis-ticks-x";t.select(".le-graph-base").selectAll("g.".concat(f)).data([1]).join(e=>e.append("g").attr("class",f));let b=i||h,g=(e,t)=>e.attr("transform",e=>{let a=r(e);if("number"!=typeof a)return null;let s=t(a);return s!=s&&(s=-1e3),p?"translate(0, ".concat(s,")"):"translate(".concat(s,", 0)")}),j=e=>e.attr(p?"x1":"y1",x[0]).attr(p?"x2":"y2",x[1]),v=e=>e.attr(p?"x":"y",x[1]).attr("dx",p?0:3).attr("dy",p?-2:8);t.select("g.".concat(f)).selectAll("g.le-axis-tick").data(l,r).join(e=>e.append("g").attr("class","le-axis-tick").style("opacity",0).call(e=>g(e,b)).call(e=>e.append("line").call(j)).call(e=>e.append("text").call(v).attr("text-anchor",p?"end":"start")),e=>e,e=>e.transition(a).call(e=>g(e,h)).style("opacity",0).remove()).call(e=>e.select("text").text(e=>o(u?Number(e.toPrecision(2)):e)).transition(a).call(v).style("opacity",e=>u&&m(e)?0:c(h(r(e)))?.3:1)).call(e=>e.select("line").transition(a).call(j)).transition(a).call(e=>g(e,h)).style("opacity",e=>{let t=h(r(e));return p&&10>Math.abs(t-d)?.3:t===d?0:1})},e1=e=>{let{selRoot:t,transition:a,xProps:s,yProps:i,threshold:n}=e,{clipPath:l}=e,r=s.isValue||s.isHistBins,{scale:o,rangeFull:c}=s,{scale:d,rangeFull:h}=i,u=(0,ew.uk)(n),p=(null==n?void 0:n.type)==="different",x=e=>e.attr("x",r?e=>{let[t]=(0,ew.dp)(e,o,c,p);return t}:c[0]).attr("width",r?e=>{let[t,a]=(0,ew.dp)(e,o,c,p);return Math.max(0,a-t)}:c[1]-c[0]).attr("y",r?h[1]:e=>{let[t]=(0,ew.dp)(e,d,h,p,!0);return t}).attr("height",r?h[0]-h[1]:e=>{let[t,a]=(0,ew.dp)(e,d,h,p,!0);return Math.max(0,a-t)});t.select(".le-graph-thresholds").selectAll("rect.le-graph-threshold").data(e.hasData?u:[]).join(e=>e.append("rect").attr("class","le-graph-threshold").attr("clip-path","url(#".concat(l,")")).attr("opacity",.6).call(x)).transition(a).call(x)},e2=e=>{let{selRoot:t,transition:a,axisProps:s,crossProps:i}=e,{isY:n}=s,l=n?"y":"x",r=i.origin,{rangeFull:o}=s,c=e=>e.attr("x1",n?r:o[0]).attr("x2",n?r:o[1]).attr("y1",n?o[1]:r).attr("y2",n?o[0]:r);t.select(".le-graph-base").selectAll("line.le-axis-".concat(l)).data([1]).join(e=>e.append("line").attr("class","le-axis-".concat(l," le-graph-axis-line")).call(c)).transition(a).call(c);let d=e=>e.attr("x",n?r:o[1]).attr("y",n?o[1]:r).attr("dx",n?3:0).attr("dy",n?8:-4);t.select(".le-graph-axis-labels").selectAll("text.le-axis-label-".concat(l)).data([1]).join(e=>e.append("text").attr("class","le-axis-label le-axis-label-".concat(l)).call(d).attr("text-anchor",n?"start":"end").on("mousedown",()=>{m.f0.stopPropagation()})).text(s.label).transition(a).call(d)},e5=e=>{let{selRoot:t,transition:a,axisProps:s,crossProps:i,hasData:n}=e,{isY:l,origin:r,split:o}=s,c=i.origin,d=l?"translate(".concat(c,", ").concat(o,")"):"translate(".concat(o,", ").concat(c,") rotate(90)"),h=l?"y":"x";t.select(".le-graph-base").selectAll("g.le-axis-split-".concat(h)).data([1]).join(e=>e.append("g").attr("class","le-axis-split-".concat(h," le-axis-split")).attr("transform",d).style("opacity",0).call(e=>{e.append("path").attr("class","le-axis-split-fill").attr("d","M-2,0L2,-4L2,0L-2,4"),e.append("path").attr("class","le-axis-split").attr("d","M-2,0L2,-4M-2,4L2,0")})).transition(a).attr("transform",d).style("opacity",n&&o!==r?1:0)},e3=e=>{let{selRoot:t,xProps:a,yProps:s,clipPath:i}=e,n=a.rangeFull,l=s.rangeFull,r="clipPath",o=e=>{e.attr("x",n[0]).attr("y",l[1]).attr("width",n[1]-n[0]).attr("height",l[0]-l[1])};t.selectAll("".concat(r,".cm-data-clip")).data([1]).join(e=>e.append(r).attr("class","cm-data-clip").attr("id",i).append("rect").call(o).attr("fill","rgba(255,255,255,0.3)"),e=>e).select("rect").call(o)},e6=e=>{let{selRoot:t,xProps:a,yProps:s,transition:i,clipPath:n}=e,{prevSeries:l,xPrevScale:r,yPrevScale:o}=e,{xZoomedDomain:c,yZoomedDomain:d}=e,h=a.dataScale,u=s.dataScale,p=s.isParam,x=p?s:a,m=p?a:s,f=p?d:c,{isHistValues:b}=m,{extractParam:g,hists:j,dimId:_}=x;h=h.copy().interpolate(ec.A),u=u.copy().interpolate(ec.A);let y=P(e.graph),w=y.length,k=e=>{var t;let a,s,i,{idxSeries:n,series:l,seriesSpec:r}=e;if(b){let e=j[n];if(a=e.map(e=>e.value),s=e.map(e=>e.coord),x.logScale){s=s.slice();let e=x.domain[0]/1.5;for(let t=0;t<s.length;t++)s[t]<=0&&(s[t]=e)}}else{if(a=l.data,m.logScale){a=a.slice();let e=m.domain[0]/1.5;for(let t=0;t<a.length;t++){let s=a[t];null!=s&&s<=0&&(a[t]=e)}}s=p?l.yCoords:l.xCoords;let e=5e4/Math.min(Math.max(1,w),5),t=_===v.DIM_TIME&&r.isSparse;if(g&&(s=s.map(g)),x.dimId!==v.DIM_LON_LAT){let i=tn(s,a,f,e,t);s=i.coords,a=i.data}}let o=null!==(t=r.interpolation)&&void 0!==t?t:"linear";if(p){let e=ep.N;"linear"===o?e=ex.A:"step"===o&&(e=em.Ay),i=(0,ef.A)().curve(e).x(e=>h(e)).y((e,t)=>u(s[t]))}else{let e=ep.G;"linear"===o?e=ex.A:"step"===o&&(e=em.Ay),i=(0,ef.A)().curve(e).x((e,t)=>h(s[t])).y(e=>u(e))}return(i=i.defined(e=>null!=e))(a)};t.select(".le-graph-data").selectAll("path.le-data-line").data(e.hasData?y:[]).join(e=>e.append("path").attr("class","le-data-line").attr("clip-path","url(#".concat(n,")")).style("opacity",0).attr("d",k),e=>e,e=>e.transition(i).style("opacity",0).remove()).style("stroke",t=>z(t,w,e.isFetching)).attr("d",function(e){var t;let a=this.getAttribute("d"),s=e.series,i=null===(t=Object.values(l).find(e=>{var t;return(null===(t=e.series)||void 0===t?void 0:t.id)===s.id}))||void 0===t?void 0:t.series;if(!i||!s)return a;let n=i.data.length,c=s.data.length;if(c<=n||0===n||0===c)return a;let d=p?i.yCoords:i.xCoords,h=p?s.yCoords:s.xCoords;if(!d||!h)return a;let u=d[0];if(h[0]<u){let e=c-n,t="",s=i.data[0],l=p?"M".concat(null!=s?r(s):m.origin,",").concat(o(u)):"M".concat(r(u),",").concat(null!=s?o(s):m.origin);for(let a=0;a<e;a++)t+=l;return t+a}let x=d[n-1];if(h[c-1]>x){let e=c-n,t="",s=i.data[n-1],l=p?"M".concat(null!=s?r(s):m.origin,",").concat(o(x)):"M".concat(r(x),",").concat(null!=s?o(s):m.origin);for(let a=0;a<e;a++)t+=l;return a+t}return a}).transition(i).style("opacity",1).attr("d",k)},e4=e=>{let{selRoot:t,xProps:a,yProps:s,transition:i,clipPath:n}=e,l=s.isParam,r=l?s:a,o=l?a:s,{dataScale:c,range:d,extractParam:h}=r,{dataScale:u,logScale:p}=o,x=P(e.graph),m=x.length,f=(e,t)=>{let{series:a}=e,{data:s}=a,i=s.length;if(!i)return"";if(p){s=s.map(e=>e.slice());let e=o.domain[0]/1.5;for(let t=0;t<i;t++){let a=s[t];if(null!=a[0])for(let t=0;t<5;t++)a[t]<=0&&(a[t]=e)}}let n=l?a.yCoords:a.xCoords;h&&(n=n.map(h));let r=i>1?c(n[1])-c(n[0]):Math.abs(d[1]-d[0]),x=.8*r/m,f=.35*x,b="";for(let e=0;e<i;e++){let a=s[e];if(null==a[0])continue;let i=a.map(u),o=c(n[e])-.4*r+x*(t+.5),d=l?[[i[1],o],[i[0],o],[i[0],o-f],[i[0],o+f],[i[0],o],[i[1],o],[i[1],o-f],[i[2],o-f],[i[2],o+f],[i[2],o-f],[i[3],o-f],[i[3],o],[i[4],o],[i[4],o-f],[i[4],o+f],[i[4],o],[i[3],o],[i[3],o+f],[i[1],o+f],[i[1],o]]:[[o,i[1]],[o,i[0]],[o-f,i[0]],[o+f,i[0]],[o,i[0]],[o,i[1]],[o-f,i[1]],[o-f,i[2]],[o+f,i[2]],[o-f,i[2]],[o-f,i[3]],[o,i[3]],[o,i[4]],[o-f,i[4]],[o+f,i[4]],[o,i[4]],[o,i[3]],[o+f,i[3]],[o+f,i[1]],[o,i[1]]];b+="M".concat(d.join("L"))}return b};t.select(".le-graph-data").selectAll("path.le-data-boxplot").data(e.hasData?x:[]).join(e=>e.append("path").attr("class","le-data-boxplot").attr("clip-path","url(#".concat(n,")")).style("opacity",0).attr("d",f),e=>e,e=>e.transition(i).style("opacity",0).remove()).style("stroke",t=>z(t,m,e.isFetching)).transition(i).style("opacity",1).attr("d",f)},e9=e=>{let{selRoot:t,xProps:a,yProps:s,transition:i,clipPath:n}=e,l=s.isParam,r=l?s:a,o=l?a:s,{dataScale:c,range:d,extractParam:h}=r,{origin:u,dataScale:p,logScale:x}=o,m=P(e.graph),f=m.length,b=(e,t)=>{let{series:a}=e,{data:s}=a,i=s.length;if(!i)return"";if(x){s=s.slice();let e=o.domain[0]/1.5;for(let t=0;t<s.length;t++)s[t]<=0&&(s[t]=e)}let n=l?a.yCoords:a.xCoords;h&&(n=n.map(h));let r=i>1?c(n[1])-c(n[0]):Math.abs(d[1]-d[0]),m=.8*r/f,b=.35*m,g="";for(let e=0;e<i;e++){let a=s[e];if(null==a)continue;let i=p(a),o=c(n[e])-.4*r+m*(t+.5),d=l?[[u,o-b],[i,o-b],[i,o+b],[u,o+b],[u,o-b]]:[[o-b,u],[o-b,i],[o+b,i],[o+b,u],[o-b,u]];g+="M".concat(d.join("L"))}return g};t.select(".le-graph-data").selectAll("path.le-data-boxplot").data(e.hasData?m:[]).join(e=>e.append("path").attr("class","le-data-boxplot").attr("clip-path","url(#".concat(n,")")).style("opacity",0).attr("d",b),e=>e,e=>e.transition(i).style("opacity",0).remove()).style("stroke",t=>z(t,f,e.isFetching)).transition(i).style("opacity",1).attr("d",b)},e8=e=>{let{selRoot:t,transition:a,xProps:s,yProps:i,dataUrl:n,isFetching:l}=e,{clipPath:r}=e,{domain:o,scale:c}=s,{domain:d,scale:h}=i,u=c(o[0]),p=c(o[1]),x=h(d[0]),m=h(d[1]);t.select(".le-graph-data").selectAll("image.le-image").data([1]).join(e=>e.append("image").attr("class","le-image").attr("preserveAspectRatio","none").attr("clip-path","url(#".concat(r,")")).style("opacity","0")).attr("href",n).transition(a).attr("x",u).attr("width",p-u).attr("y",m).attr("height",x-m).style("opacity",l?.5:.8)},e7=e=>{var t;let{selRoot:a,transition:s,axisProps:i,crossProps:n,clipPath:l}=e,{isY:r,scale:c,origin:d}=i,h=n.rangeFull,u=null!==(t=i.thumbs)&&void 0!==t?t:[],p=u.length,x=e=>e.attr(r?"x":"y",h[r?0:1]).attr(r?"width":"height",Math.abs(h[1]-h[0])).attr(r?"y":"x",e=>{let t=c(e[0]),a=c(e[1]),s=t===d||a===d?3:1,i=Math.abs(a-t),n=r?a:t;return i<s&&(n=(t+a)/2-s/2),n}).attr(r?"height":"width",e=>{let t=c(e[0]),a=c(e[1]),s=t===d||a===d?3:1,i=Math.abs(a-t);return i<s?s:i});a.select(".le-graph-thumbs-".concat(r?"y":"x")).selectAll("g.le-graph-thumb").data(u).join(e=>e.append("g").style("opacity",0),e=>e,e=>e.transition(s).style("opacity",0).remove()).attr("class",(e,t)=>o()("le-graph-thumb",{"is-a":p>1&&0===t,"is-b":p>1&&1===t})).call(e=>{e.selectAll("rect.le-graph-thumb-segment").data(e=>e.segments).join(e=>e.append("rect").attr("class","le-graph-thumb-segment").attr("clip-path","url(#".concat(l,")")).call(x),e=>e,e=>e.remove()).call(x)}).transition(s).style("opacity",e.hasData?1:0)},te=(e,t)=>{let a,s=1/0;for(let i=0;i<e.length;i++){let n=Math.abs(t-e[i]);n<s&&(s=n,a=i)}return a},tt=e=>null==e?null:(0,_.JM)(e),ta=(e,t)=>{if(e===v.DIM_TIME)return"t";if(e===v.DIM_ELEVATION)return"h";if(e===v.DIM_LON_LAT){let{_subsets:e}=t,a=e.find(e=>null!=e);if(!a)return"geom";let s=eQ(a),i=null==s?void 0:s.geometry.type;return"LineString"===i||"MultiLineString"===i?"dist":"geom"}return e},ts=(e,t)=>({min:e,max:e,center:e,ref:e,idxPosition:t,segments:[[e,e]]}),ti=(e,t)=>null==e?e:parseFloat(e.toPrecision(t)),tn=(e,t,a,s,i)=>{let n;let l=e.length,r=e[0],o=e[l-1],c=Math.min((o-r)/l*20,(o-r)*.8);if(l<10&&(i=!1),a){let[s,i]=a,n=te(e,s),l=te(e,i);e=e.slice(n,l+1),t=t.slice(n,l+1)}let d=t.length,h=Math.min(d,s),u=(d-1)/(h-1),p=u>1;if(1===u&&!i)return{coords:e,data:t};let x=[],m=[];for(let a=0;a<h;a++){let s=p?Math.round(a*u):a,l=e[s];i&&null!=n&&l-n>c&&(x.push(n),m.push(null)),x.push(l),m.push(t[s]),n=l}return{coords:e=x,data:t=m}},tl=new String(".cm-pin-graph.jsx-d53f5dc59d3a467f{position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.cm-pin-graph.jsx-d53f5dc59d3a467f+.cm-pin-graph.jsx-d53f5dc59d3a467f{margin-top:4px}.cm-pin-graph.in-card.jsx-d53f5dc59d3a467f+.cm-pin-graph.in-card.jsx-d53f5dc59d3a467f{margin-top:13px}.cm-pin-graph.le-graph-hist-v.jsx-d53f5dc59d3a467f+.cm-pin-graph.jsx-d53f5dc59d3a467f{margin-top:6px}.cm-pin-graph.jsx-d53f5dc59d3a467f:has(.warning){margin-bottom:8px}.cm-svg-outer.jsx-d53f5dc59d3a467f{position:relative}");tl.__hash="d53f5dc59d3a467f";let tr=new String(".graph-buttons.jsx-4f8cbc1a4fcedd1c{position:absolute;top:0;right:6px}.pin-menu-wrapper.jsx-4f8cbc1a4fcedd1c{position:relative}.reset-zoom.jsx-4f8cbc1a4fcedd1c{cursor:pointer;padding:0 10px}");tr.__hash="4f8cbc1a4fcedd1c";let to=new String(".indicators.jsx-abcdcc9d1fdfe2a6{position:absolute;top:-webkit-calc(50%);top:-moz-calc(50%);top:calc(50%);left:-webkit-calc(50%);left:-moz-calc(50%);left:calc(50%);-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);-o-transform:translate(-50%,-50%);transform:translate(-50%,-50%);text-align:center;width:65%}.no-data.jsx-abcdcc9d1fdfe2a6{white-space:normal;color:var(--color-disabled)}");to.__hash="abcdcc9d1fdfe2a6";let tc=new String(".stats.jsx-b4efc57fa0d2ae3f{font-size:.8em;margin:-3px ".concat(8,"px 0 ").concat(8,"px}.instructions.jsx-b4efc57fa0d2ae3f{color:var(--color-text-dim)}.stats-swatch.jsx-b4efc57fa0d2ae3f{display:inline-block;width:6px;height:6px;background-color:var(--color-series);margin-right:3px}.stats-elem.jsx-b4efc57fa0d2ae3f{white-space:nowrap}.stats-elem.jsx-b4efc57fa0d2ae3f+.stats-elem.jsx-b4efc57fa0d2ae3f{margin-left:8px}.avg-min-max.jsx-b4efc57fa0d2ae3f{white-space:nowrap}.stats-sparse-label.jsx-b4efc57fa0d2ae3f{color:var(--color-text-dim)}.stats-label.jsx-b4efc57fa0d2ae3f{color:var(--color-text-dim);margin-right:2px}.stats-label.min.jsx-b4efc57fa0d2ae3f,.stats-label.max.jsx-b4efc57fa0d2ae3f{font-size:.85em}.stats-label.textual.jsx-b4efc57fa0d2ae3f{display:inline-block;margin-right:3px;line-height:.75}.stats-label.avg.jsx-b4efc57fa0d2ae3f{font-style:italic;border-top:1px solid var(--color-text-dim)}.stats-value.jsx-b4efc57fa0d2ae3f{color:var(--color-series)}.units.jsx-b4efc57fa0d2ae3f{margin-left:3px;color:var(--color-series)}"));tc.__hash="b4efc57fa0d2ae3f";let td=new String(".warning.jsx-79576434f92f1870{font-size:.8em;margin:0px ".concat(8,"px 0 ").concat(8,"px;color:var(--color-warning);display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex}.icon.jsx-79576434f92f1870{margin-right:4px}"));td.__hash="79576434f92f1870";let th=new String(".cm-svg-outer:hover .more.jsx-1e53b236640d47a5,.more.just-got-initial-data.jsx-1e53b236640d47a5{opacity:.8;pointer-events:auto}.more.jsx-1e53b236640d47a5{position:absolute;border:1px solid white;-webkit-border-radius:15px;-moz-border-radius:15px;border-radius:15px;padding:2px 4.7px;background-color:rgba(0,0,0,.5);opacity:0;pointer-events:none;color:white;-webkit-transition:opacity ".concat(v.UI.transitionDuration,"ms,color ").concat(v.UI.transitionDuration,"ms,border-color ").concat(v.UI.transitionDuration,"ms;-moz-transition:opacity ").concat(v.UI.transitionDuration,"ms,color ").concat(v.UI.transitionDuration,"ms,border-color ").concat(v.UI.transitionDuration,"ms;-o-transition:opacity ").concat(v.UI.transitionDuration,"ms,color ").concat(v.UI.transitionDuration,"ms,border-color ").concat(v.UI.transitionDuration,"ms;transition:opacity ").concat(v.UI.transitionDuration,"ms,color ").concat(v.UI.transitionDuration,"ms,border-color ").concat(v.UI.transitionDuration,"ms}.more.jsx-1e53b236640d47a5:hover{opacity:1!important;color:var(--color-accent-bg);border-color:var(--color-accent-bg)}.more.left.jsx-1e53b236640d47a5,.more.right.jsx-1e53b236640d47a5{top:50%;-webkit-transform:translatey(-50%);-moz-transform:translatey(-50%);-ms-transform:translatey(-50%);-o-transform:translatey(-50%);transform:translatey(-50%);cursor:pointer}.more.left.jsx-1e53b236640d47a5{left:").concat(4,"px}.more.right.jsx-1e53b236640d47a5{right:").concat(4,"px}.more.top.jsx-1e53b236640d47a5,.more.bottom.jsx-1e53b236640d47a5{left:50%;-webkit-transform:translatex(-50%);-moz-transform:translatex(-50%);-ms-transform:translatex(-50%);-o-transform:translatex(-50%);transform:translatex(-50%);cursor:pointer}.more.top.jsx-1e53b236640d47a5{top:").concat(2,"px}.more.bottom.jsx-1e53b236640d47a5{bottom:").concat(2,"px}.pagination-flash.jsx-1e53b236640d47a5{position:absolute;opacity:0;color:var(--color-accent-bg)}.pagination-flash.left.jsx-1e53b236640d47a5,.pagination-flash.right.jsx-1e53b236640d47a5{top:50%;-webkit-transform:translatey(-50%);-moz-transform:translatey(-50%);-ms-transform:translatey(-50%);-o-transform:translatey(-50%);transform:translatey(-50%)}.pagination-flash.left.jsx-1e53b236640d47a5{text-align:left;-webkit-animation:flash-left ").concat(2e3,"ms ease-in-out;-moz-animation:flash-left ").concat(2e3,"ms ease-in-out;-o-animation:flash-left ").concat(2e3,"ms ease-in-out;animation:flash-left ").concat(2e3,"ms ease-in-out}.pagination-flash.right.jsx-1e53b236640d47a5{text-align:right;-webkit-animation:flash-right ").concat(2e3,"ms ease-in-out;-moz-animation:flash-right ").concat(2e3,"ms ease-in-out;-o-animation:flash-right ").concat(2e3,"ms ease-in-out;animation:flash-right ").concat(2e3,"ms ease-in-out}.pagination-flash.top.jsx-1e53b236640d47a5,.pagination-flash.bottom.jsx-1e53b236640d47a5{left:50%;-webkit-transform:translatex(-50%);-moz-transform:translatex(-50%);-ms-transform:translatex(-50%);-o-transform:translatex(-50%);transform:translatex(-50%);text-align:center}.pagination-flash.top.jsx-1e53b236640d47a5{-webkit-animation:flash-top ").concat(2e3,"ms ease-in-out;-moz-animation:flash-top ").concat(2e3,"ms ease-in-out;-o-animation:flash-top ").concat(2e3,"ms ease-in-out;animation:flash-top ").concat(2e3,"ms ease-in-out}.pagination-flash.bottom.jsx-1e53b236640d47a5{-webkit-animation:flash-bottom ").concat(2e3,"ms ease-in-out;-moz-animation:flash-bottom ").concat(2e3,"ms ease-in-out;-o-animation:flash-bottom ").concat(2e3,"ms ease-in-out;animation:flash-bottom ").concat(2e3,"ms ease-in-out}@-webkit-keyframes flash-left{from{opacity:1;left:").concat(30,"px}to{opacity:0;left:").concat(40,"px}}@-moz-keyframes flash-left{from{opacity:1;left:").concat(30,"px}to{opacity:0;left:").concat(40,"px}}@-o-keyframes flash-left{from{opacity:1;left:").concat(30,"px}to{opacity:0;left:").concat(40,"px}}@keyframes flash-left{from{opacity:1;left:").concat(30,"px}to{opacity:0;left:").concat(40,"px}}@-webkit-keyframes flash-right{from{opacity:1;right:").concat(30,"px}to{opacity:0;right:").concat(40,"px}}@-moz-keyframes flash-right{from{opacity:1;right:").concat(30,"px}to{opacity:0;right:").concat(40,"px}}@-o-keyframes flash-right{from{opacity:1;right:").concat(30,"px}to{opacity:0;right:").concat(40,"px}}@keyframes flash-right{from{opacity:1;right:").concat(30,"px}to{opacity:0;right:").concat(40,"px}}@-webkit-keyframes flash-top{from{opacity:1;top:").concat(26,"px}to{opacity:0;top:").concat(36,"px}}@-moz-keyframes flash-top{from{opacity:1;top:").concat(26,"px}to{opacity:0;top:").concat(36,"px}}@-o-keyframes flash-top{from{opacity:1;top:").concat(26,"px}to{opacity:0;top:").concat(36,"px}}@keyframes flash-top{from{opacity:1;top:").concat(26,"px}to{opacity:0;top:").concat(36,"px}}@-webkit-keyframes flash-bottom{from{opacity:1;bottom:").concat(26,"px}to{opacity:0;bottom:").concat(36,"px}}@-moz-keyframes flash-bottom{from{opacity:1;bottom:").concat(26,"px}to{opacity:0;bottom:").concat(36,"px}}@-o-keyframes flash-bottom{from{opacity:1;bottom:").concat(26,"px}to{opacity:0;bottom:").concat(36,"px}}@keyframes flash-bottom{from{opacity:1;bottom:").concat(26,"px}to{opacity:0;bottom:").concat(36,"px}}"));th.__hash="1e53b236640d47a5";let tu=new String(".le-graph{position:relative;display:block;fill:none;cursor:crosshair}.le-graph-v-t{cursor:ew-resize}.le-graph-v-z,.le-graph-v-sz{cursor:ns-resize}.le-graph-v-tz{cursor:move}.le-graph text{fill:white}.le-graph-axis-line{stroke:var(--color-accent-complementary)}.le-graph-threshold{stroke:none}.le-axis-split-fill{stroke:none;fill:black}.le-axis-split{stroke:var(--color-accent-complementary)}.le-axis-label{}.le-axis-tick line{stroke:#444}.le-axis-tick text{fill:var(--color-dim);font-size:10px}.le-data-line,.le-data-boxplot{stroke:var(--color-graph);stroke-width:1.5px;-webkit-transition:stroke ".concat(v.UI.transitionDuration,"ms;-moz-transition:stroke ").concat(v.UI.transitionDuration,"ms;-o-transition:stroke ").concat(v.UI.transitionDuration,"ms;transition:stroke ").concat(v.UI.transitionDuration,"ms}.le-data-line{stroke-linejoin:round;stroke-linecap:round}.le-data-boxplot{fill:var(--color-graph);fill-opacity:.2}.le-graph-thumb{fill:var(--color-accent-bg)}.le-graph-thumb.is-a{fill:var(--color-compare-a)}.le-graph-thumb.is-b{fill:var(--color-compare-b)}"));tu.__hash="3d70e8d74120ef88";let tp=(0,c.Ng)((e,t)=>{var a,s,i;let{mapObjectId:n,graphId:l}=t,r=(0,S.yT)(e),o=(0,S.UD)(e,n),c=null!==(s=null==o?void 0:o.graphs[l])&&void 0!==s?s:null,d=c?(0,S.Yj)(e,null==c?void 0:c.mapLayerId):null,h=d?(0,_.VF)(r,d.layerId):null,u=null!==(i=null==h?void 0:null===(a=h.tzDataset)||void 0===a?void 0:a.variables[h.variableId])&&void 0!==i?i:null;return{loginStatus:(0,S.iN)(e),mapObject:o,graph:c,mapLayer:d,layerSpec:h,variable:u,time:(0,S.WB)(e),elevation:(0,S.S1)(e),settings:(0,S.mt)(e),isLight:(0,S.H9)(e),isDashboard:(0,S.N0)(e),dashSettings:(0,S.YO)(e)}},N)((0,h.Ay)(e=>{let[t,a]=l.useState();(0,l.useEffect)(()=>{(async()=>{a(await (0,e_.$)(1))})()},[]);let{mapObject:i,graph:n,mapLayer:r,layerSpec:o}=e;return i&&n&&r&&o&&t?(0,s.jsx)(eU,{...e,hatchingPattern:t,"data-sentry-element":"_PinGraph","data-sentry-component":"PinGraph","data-sentry-source-file":"300-PinGraph.tsx"},"".concat(n.id,"/").concat(o.id)):null})),tx=(e,t)=>{if(null==e)return null;switch(t){case"km":if(e>=10)return"".concat((0,_.VA)(e)," km");if(e>=1)return"".concat((0,_.VA)(e,1)," km");return"".concat((0,_.VA)(1e3*e)," m");case"mi":{let t=1e3*e/1609.344;if(t>=10)return"".concat((0,_.VA)(t)," mi");if(t>=1)return"".concat((0,_.VA)(t,1)," mi");let a=5280*t;return"".concat((0,_.VA)(a)," ft")}case"nmi":{let t=1e3*e/1852;if(t>=10)return"".concat((0,_.VA)(t)," nmi");if(t>=1)return"".concat((0,_.VA)(t,1)," nmi");return"".concat((0,_.VA)(1e3*e)," m")}default:return null}},tm=new String(".length-label.jsx-58c2ed0f1138a332{cursor:pointer;margin-left:.4em;font-weight:bold;color:var(--color-accent-bg)}");tm.__hash="58c2ed0f1138a332";let tf=e=>{let t=(0,eM.A)(),a=(0,c.wA)(),i=(0,c.d4)(S.mt),l=e=>{(0,p.cancelEvent)(e),a((0,N.selectNextUnitsLength)())};return(()=>{let{lengthKm:a}=e,r=tx(a,i.unitsLength);return(0,s.jsxs)("span",{onClick:e=>l(e),title:t.$t({id:"pinBox.header.lengthClickHint",defaultMessage:"Click to change units (km, mi, nmi)"}),"data-sentry-component":"render","data-sentry-source-file":"900-LengthLabel.tsx",className:"jsx-".concat(tm.__hash)+" length-label",children:[r,(0,s.jsx)(n(),{id:tm.__hash,children:tm})]})})()},tb=(e,t)=>{if(null==e)return null;switch(t){case"km2":if(e>=10)return"".concat((0,_.VA)(e)," km\xb2");if(e>=1)return"".concat((0,_.VA)(e,1)," km\xb2");return"".concat((0,_.VA)(1e6*e)," m\xb2");case"ha":{let t=100*e;if(t>=10)return"".concat((0,_.VA)(t)," ha");if(t>=1)return"".concat((0,_.VA)(t,1)," ha");return"".concat((0,_.VA)(1e6*e)," m\xb2")}case"sq mi":{let t=e/2.589988110336;if(t>=10)return"".concat((0,_.VA)(t)," mi\xb2");if(t>=1)return"".concat((0,_.VA)(t,1)," mi\xb2");let a=0x1a96400*t;return"".concat((0,_.VA)(a)," ft\xb2")}default:return null}},tg=new String(".area-label.jsx-8938facf6849980a{cursor:pointer;margin-left:.4em;font-weight:bold;color:var(--color-accent-bg)}");tg.__hash="8938facf6849980a";let tj=e=>{let t=(0,eM.A)(),a=(0,c.wA)(),i=(0,c.d4)(S.mt),l=e=>{(0,p.cancelEvent)(e),a((0,N.selectNextUnitsArea)())};return(()=>{let{areaKm2:a}=e,r=tb(a,i.unitsArea);return(0,s.jsxs)("span",{onClick:e=>l(e),title:t.$t({id:"pinBox.header.areaClickHint",defaultMessage:"Click to change units (km2, ha, mi2)"}),"data-sentry-component":"render","data-sentry-source-file":"905-AreaLabel.tsx",className:"jsx-".concat(tg.__hash)+" area-label",children:[r,(0,s.jsx)(n(),{id:tg.__hash,children:tg})]})})()},tv="pin-box",t_={};class ty extends l.Component{static getDerivedStateFromProps(e,t){let{datasets:a,mapObject:s,mapLayers:i}=e;if(!s)return{};let n=Object.values(i),l=(0,_.Cv)(s,n,a),{isAddingGraph:r,addGraphMapLayerId:o,addGraphSpecId:c}=t;if(l.length){let e=tw(l);o&&e.includes(o)||(o=l[0].mapLayerId);let t=tk(l,o);c&&t.includes(c)||(c=t[0])}else r=!1;return{isAddingGraph:r,addGraphMapLayerId:o,addGraphSpecId:c}}componentDidMount(){this.plotInit(),this.resizeObserver=new ResizeObserver(this.onResize),this.resizeObserver.observe(this.refMeasure.current),this.maybeLoadSparsePlatform()}componentDidUpdate(e){let{mapObject:t}=this.props;t!==e.mapObject&&this.maybeLoadSparsePlatform()}componentWillUnmount(){this.isUnmounted=!0,this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}render(){let{mapObject:e,inCard:t}=this.props,{mapLayers:a,datasets:i,hint:l}=this.props,r=Object.values(a);this.availableGraphs=e?(0,_.Cv)(e,r,i):[];let c=this.hasFixedWidth();return(0,s.jsxs)("div",{ref:this.refOuter,"data-sentry-component":"PinBox","data-sentry-source-file":"100-PinBox.tsx",className:"jsx-".concat(tM.__hash)+" pin-box-wrapper",children:[(0,s.jsxs)("div",{onClick:e=>e.stopPropagation(),className:"jsx-".concat(tM.__hash)+" "+(o()(tv,{sparse:null==e?void 0:e.isSparse,"fixed-width":c,enlarged:c&&(null==e?void 0:e.enlargeGraphs),"in-card":t,"is-on-target":this.props.isOnTarget,"can-be-drag-target":this.props.canBeDragTarget,"is-drag-target":this.props.isDragTarget})||""),children:[(0,s.jsx)("div",{ref:this.refMeasure,className:"jsx-".concat(tM.__hash)}),!t&&this.renderHeader(),this.renderBody(),c&&(0,s.jsx)("div",{className:"jsx-".concat(tM.__hash)+" drop-target-hint",children:(0,s.jsx)("div",{className:"jsx-".concat(tM.__hash)+" drop-target-hint-inner",children:(null==e?void 0:e.isSparse)?(0,s.jsx)(d.A,{id:"pinBox.dropPlatformsHint",defaultMessage:"Drop here to group platforms{br}and compare them",values:{br:(0,s.jsx)("br",{className:"jsx-".concat(tM.__hash)},"br")}}):(0,s.jsx)(d.A,{id:"pinBox.dropGeometriesHint",defaultMessage:"Drop here to group geometries{br}and compare them",values:{br:(0,s.jsx)("br",{className:"jsx-".concat(tM.__hash)},"br")}})})})]}),v.DEBUG.mapObjects&&this.renderDebug(),(0,s.jsx)(A.A,{hint:l,"data-sentry-element":"PinBoxHint","data-sentry-source-file":"100-PinBox.tsx"}),(0,s.jsx)(n(),{id:tM.__hash,children:tM})]})}hasFixedWidth(){if(!this.state.isExpanded)return!1;let{isMainPin:e,mapObject:t,inCard:a}=this.props;if(!e||a||!t||!(0,y.p)(t)||t.beingDrawn)return!1;let s=t.features.length>1,i=t.features[0],n=(null==i?void 0:i.geometry.type)==="Point"&&!Object.values(t.graphs).some(e=>e.graphSpecId!==v.PIN_VALUE_DENSE_PSEUDOGRAPH&&e.graphSpecId!==v.PIN_VALUE_SPARSE_PSEUDOGRAPH),l=!Object.values(t.graphs).length;return!!s||!!this.state.isAddingGraph||!!this.state.platformMeta||!!Object.values(t._wmsFeatures).length||!n&&!l}renderDebug(){let{mapObject:e}=this.props;if(!e)return;let t=[],a=e.isMulti?"-multi":"";return t.push("".concat(e.id).concat(a)),e.features.forEach(e=>{if("string"==typeof e)return;let{geometry:a,properties:s}=e;if("Point"!==a.type)return;let{id:i,isUnlocated:n}=s;t.push("  ".concat(i,": ").concat(a.coordinates).concat(n?" (unlocated)":""))}),(0,s.jsxs)("pre",{className:"jsx-".concat(tM.__hash)+" debug",children:[t.join("\n"),(0,s.jsx)(n(),{id:tM.__hash,children:tM})]})}renderHeader(){var e;let t;let{intl:a,mapObject:i,coords:l,feature:r,isMainPin:o}=this.props,{platformMeta:c}=this.state,d=null==i?void 0:i.isMulti;if(d){let e=i.features.length,s=i.isSparse?a.$t({id:"pinBox.header.numPlatforms",defaultMessage:"{numFeatures, plural, one {1 platform} other {# platforms}}"},{numFeatures:e}):a.$t({id:"pinBox.header.numGeometries",defaultMessage:"{numFeatures, plural, one {1 geometry} other {# geometries}}"},{numFeatures:e});t=this.renderTitleLabel(s)}else if((null==i?void 0:i.isSparse)&&c)t=this.renderTitleSparse(c);else if((null==r?void 0:r.properties)&&!r.properties.isUserDefined){let{name:e,displayType:a}=r.properties;e&&!e.startsWith("_")&&(t=this.renderTitleLabel(e,a))}t||(t=(0,s.jsx)($,{coords:l}));let{lengthKm:h,areaKm2:u}=null!==(e=null==r?void 0:r.properties)&&void 0!==e?e:{};return(0,s.jsxs)("div",{className:"jsx-".concat(tM.__hash)+" pin-header",children:[(0,s.jsxs)("span",{className:"jsx-".concat(tM.__hash)+" pin-header-info",children:[t,!d&&o&&null!=h&&(0,s.jsx)(tf,{lengthKm:h}),!d&&o&&null!=u&&(0,s.jsx)(tj,{areaKm2:u}),this.renderExpandCollapseButton()]}),this.renderOverflowMenu(),this.renderRemoveButton(),(0,s.jsx)(n(),{id:tM.__hash,children:tM})]})}renderTitleLabel(e,t){var a;return(0,s.jsxs)("span",{className:"jsx-".concat(tM.__hash)+" pin-location",children:[(0,s.jsx)(I,{label:null!==(a=t_[e])&&void 0!==a?a:e,maxLength:v.UI.displayedFeatureNameLength}),t&&(0,s.jsx)("span",{className:"jsx-".concat(tM.__hash)+" title-type",children:t}),(0,s.jsx)(n(),{id:tM.__hash,children:tM})]})}renderTitleSparse(e){var t;let a=(0,k.Ie)(e.id),i=null!==(t=j.g7[e.type])&&void 0!==t?t:e.type;return(0,s.jsxs)("span",{className:"jsx-".concat(tM.__hash),children:[a,(0,s.jsx)("span",{title:i!==e.type?e.type:void 0,className:"jsx-".concat(tM.__hash)+" title-type",children:i}),(0,s.jsx)(n(),{id:tM.__hash,children:tM})]})}renderOverflowMenu(){var e;let{intl:t,mapObject:a,isDashboard:i}=this.props,l=[],r=!!(null==a?void 0:a.enlargeGraphs),o=(null==a?void 0:a.isMulti)&&!i,c=this.state.isExpanded&&!!Object.values(null!==(e=null==a?void 0:a.graphs)&&void 0!==e?e:{}).find(e=>e.graphSpecId!==v.PIN_VALUE_DENSE_PSEUDOGRAPH&&e.graphSpecId!==v.PIN_VALUE_SPARSE_PSEUDOGRAPH);if(this.hasFixedWidth()&&l.push({label:r?t.$t({id:"pinBox.menu.minimize",defaultMessage:"Minimise"}):t.$t({id:"pinBox.menu.maximize",defaultMessage:"Maximise"}),onClick:this.onToggleEnlarged}),o&&l.push({label:t.$t({id:"pinBox.menu.ungroup",defaultMessage:"Ungroup"}),onClick:()=>{this.props.ungroupMapObjects(a.id)}}),c&&(l.push("separator"),l.push({label:t.$t({id:"pinBox.menu.removeAllGraphs",defaultMessage:"Remove all graphs"}),tooltip:t.$t({id:"pinBox.menu.removeAllGraphsHint",defaultMessage:"Remove all graphs from this geometry/platform"}),onClick:()=>{this.props.removeGraphsForMapObject(a.id)}})),l.length)return(0,s.jsxs)("span",{className:"jsx-".concat(tM.__hash)+" pin-menu-wrapper",children:[(0,s.jsx)(eC,{items:l,tooltip:t.$t({id:"pinBox.menu.overflowMenuHint",defaultMessage:"Options"}),testId:"geometry-options-button"}),(0,s.jsx)(n(),{id:tM.__hash,children:tM})]})}renderExpandCollapseButton(){let{intl:e,mapObject:t}=this.props;if(!t||t.beingDrawn)return null;let{isExpanded:a}=this.state;return(0,s.jsxs)("span",{title:e.$t({id:"pinBox.menu.expandHint",defaultMessage:"Toggle details"}),className:"jsx-".concat(tM.__hash)+" cm-pinbox-button btn-expand",children:[(0,s.jsx)(p.Icon,{icon:a?"caret-up":"caret-down",onClick:()=>this.setState({isExpanded:!this.state.isExpanded})}),(0,s.jsx)(n(),{id:tM.__hash,children:tM})]})}renderRemoveButton(){let{intl:e,mapObject:t}=this.props;if(!t)return null;let a=t.isMulti&&t.beingDrawn,i=a?e.$t({id:"pinBox.cancelSelectionHint",defaultMessage:"Cancel selection"}):e.$t({id:"pinBox.removeHint",defaultMessage:"Remove (alt-click to remove all geometries and platforms)"});return(0,s.jsxs)("span",{title:i,className:"jsx-".concat(tM.__hash)+" cm-pinbox-button",children:[(0,s.jsx)(p.Icon,{icon:"times",onClick:e=>a?this.props.setActiveTool(null,{cancelMultiObject:!0}):e.altKey?this.props.removeAllMapObjects():this.props.removeMapObject(t.id)}),(0,s.jsx)(n(),{id:tM.__hash,children:tM})]})}renderBody(){let{mapObject:e,inCard:t}=this.props;return e&&this.props.isMainPin?e.isMulti&&!t&&e.beingDrawn?this.renderMultiObjectDashboardActions():e.beingDrawn?null:(0,s.jsxs)("div",{className:"jsx-".concat(tM.__hash)+" "+(o()("pin-body",{hidden:!this.state.isExpanded})||""),children:[this.renderPlatformMeta(),(0,s.jsxs)("div",{className:"jsx-".concat(tM.__hash)+" all-pin-values",children:[(0,s.jsx)(ea,{mapObjectId:e.id}),this.renderPinValuesWmsFeatureInfos()]}),this.renderGraphs(e),(0,s.jsx)(n(),{id:tM.__hash,children:tM})]}):null}renderMultiObjectDashboardActions(){let{mapObject:e,isEditingDashboard:t}=this.props;return e?(0,s.jsxs)("div",{className:"jsx-".concat(tM.__hash)+" card-object-actions",children:[(0,s.jsxs)("div",{className:"jsx-".concat(tM.__hash)+" card-object-action-buttons",children:[(0,s.jsxs)("button",{onClick:()=>{this.deleteMultiObjectChildren(),this.props.setActiveTool(null,{cancelMultiObject:!0})},className:"jsx-".concat(tM.__hash)+" wk-button dark small",children:[(0,s.jsx)("span",{className:"jsx-".concat(tM.__hash)+" button-icon",children:(0,s.jsx)(p.Icon,{icon:"trash-can",family:"far"})}),(0,s.jsx)(d.A,{id:"pinBox.dashActions.deleteButton",defaultMessage:"Delete"})]}),!t&&(0,s.jsxs)("button",{onClick:()=>{this.props.setActiveTool(null)},className:"jsx-".concat(tM.__hash)+" wk-button dark small",children:[(0,s.jsx)("span",{className:"jsx-".concat(tM.__hash)+" button-icon",children:(0,s.jsx)(p.Icon,{icon:"plus"})}),(0,s.jsx)(d.A,{id:"pinBox.dashActions.addCardButton",defaultMessage:"Add card"})]})]}),(0,s.jsx)(n(),{id:tM.__hash,children:tM})]}):null}renderPlatformMeta(){let{platformMeta:e}=this.state;if(!e)return null;let{institution:t}=e;return t&&(t=t.trim().split(";").join(", ")),(0,s.jsxs)("div",{className:"jsx-".concat(tM.__hash)+" sparse-meta",children:[t&&(0,s.jsx)("div",{className:"jsx-".concat(tM.__hash)+" cm-pin-values",children:(0,s.jsx)(I,{label:t,maxLength:100})}),(0,s.jsx)(n(),{id:tM.__hash,children:tM})]})}renderPinValuesWmsFeatureInfos(){let{_wmsFeatures:e}=this.props.mapObject,{mapLayers:t}=this.props;return Object.keys(e).map(a=>{let i=t[a],l=e[a];if(!i||!l)return null;let r=(0,_.VF)(this.props.datasets,i.layerId);if(!r)return null;let c=(0,_.JM)(r),d=(0,w.fg)(r,l);if(!d)return null;let h=(0,w.De)(l,d),{showWmsDetailsPage:u}=this.state,x=u[a],m=Object.keys(l.properties).length>0;return(0,s.jsxs)("div",{className:"jsx-".concat(tM.__hash)+" cm-pin-values wms-feature-info",children:[(0,s.jsx)("div",{className:"jsx-".concat(tM.__hash)+" wms-feature-info-label",children:c}),(0,s.jsxs)("div",{className:"jsx-".concat(tM.__hash)+" wms-feature-info-value",children:[(0,s.jsxs)("div",{onClick:()=>this.onShowWmsDetails(a),className:"jsx-".concat(tM.__hash)+" value-and-caret",children:[(0,s.jsx)("span",{title:d,className:"jsx-".concat(tM.__hash)+" "+(o()("wms-value",{"no-value":null==h})||""),children:null!=h?h:"—"}),m&&(0,s.jsx)("span",{className:"jsx-".concat(tM.__hash)+" cm-pinbox-button",children:(0,s.jsx)(p.Icon,{icon:null!=x?"caret-up":"caret-down"})})]}),this.renderWmsFeatureDetails(a,r,l,d)]}),(0,s.jsx)(n(),{id:tM.__hash,children:tM})]},a)}).filter(e=>null!=e)}renderWmsFeatureDetails(e,t,a,i){let{intl:l}=this.props,{showWmsDetailsPage:r}=this.state,c=r[e];if(null==c)return;let d=Object.keys(a.properties),h=Math.ceil(d.length/5),u=d.slice(5*c,(c+1)*5);return(0,s.jsxs)("div",{className:"jsx-".concat(tM.__hash)+" wms-details",children:[h>1&&(0,s.jsxs)("div",{className:"jsx-".concat(tM.__hash)+" wms-details-pager",children:[(0,s.jsx)("span",{title:l.$t({id:"pinBox.wmsFeature.previousHint",defaultMessage:"Previous"}),onClick:()=>this.onShowWmsDetailsPage(e,c-1),className:"jsx-".concat(tM.__hash)+" "+(o()("btn-page",{disabled:0===c})||""),children:(0,s.jsx)(p.Icon,{icon:"chevron-left"})}),(0,s.jsxs)("span",{className:"jsx-".concat(tM.__hash)+" page-num",children:[c+1," / ",h]}),(0,s.jsx)("span",{title:l.$t({id:"pinBox.wmsFeature.nextHint",defaultMessage:"Next"}),onClick:()=>this.onShowWmsDetailsPage(e,c+1),className:"jsx-".concat(tM.__hash)+" "+(o()("btn-page",{disabled:c===h-1})||""),children:(0,s.jsx)(p.Icon,{icon:"chevron-right"})})]}),u.map(e=>{var n;let r=e===i;return(0,s.jsxs)("div",{onClick:()=>{r||((0,w.Ps)(t,e),this.forceUpdate())},title:r?l.$t({id:"pinBox.wmsFeature.setAsMainPropHint",defaultMessage:"Set as main property"}):void 0,className:"jsx-".concat(tM.__hash)+" "+(o()("wms-detail",{"is-main":r})||""),children:[(0,s.jsxs)("span",{className:"jsx-".concat(tM.__hash)+" var-name",children:[e,": "]}),(0,s.jsx)("span",{className:"jsx-".concat(tM.__hash)+" wms-value",children:null!==(n=(0,w.De)(a,e))&&void 0!==n?n:"—"})]},e)}).filter(e=>null!=e),(0,s.jsx)(n(),{id:tM.__hash,children:tM})]})}renderGraphs(e){var t;let a=null!==(t=this.props.width)&&void 0!==t?t:this.state.width;if(!a)return null;let{inCard:i}=this.props;return(0,s.jsxs)("div",{className:"jsx-".concat(tM.__hash)+" "+(o()("cm-pin-graphs",{"in-card":i})||""),children:[Object.values(e.graphs).filter(e=>e.graphSpecId!==v.PIN_VALUE_DENSE_PSEUDOGRAPH&&e.graphSpecId!==v.PIN_VALUE_SPARSE_PSEUDOGRAPH).map(t=>(0,s.jsx)(tp,{mapObjectId:e.id,graphId:t.id,width:a},t.id)),this.renderAddGraph(),(0,s.jsx)(n(),{id:tM.__hash,children:tM})]})}renderAddGraph(){return this.availableGraphs.length?this.state.isAddingGraph?this.renderAddGraphOpen():this.renderAddGraphClosed():null}renderAddGraphClosed(){return(0,s.jsxs)("div",{onClick:this.onOpenAddGraphForm,className:"jsx-".concat(tM.__hash)+" add-graph-button",children:[(0,s.jsx)(p.Icon,{icon:"plus"}),(0,s.jsx)("span",{className:"jsx-".concat(tM.__hash)+" add-graph-button-label",children:(0,s.jsx)(d.A,{id:"pinBox.addGraphButton",defaultMessage:"Add graph"})}),(0,s.jsx)(n(),{id:tM.__hash,children:tM})]})}renderAddGraphOpen(){let{availableGraphs:e}=this,{addGraphMapLayerId:t,addGraphSpecId:a}=this.state,{intl:i,datasets:l,mapLayers:r}=this.props,{isDashboard:o}=this.props,c=tw(e).map(e=>{let t=r[e],a=(0,_.VF)(l,t.layerId);if(!a)return{value:null,label:null};let{datasetId:s}=(0,_.ei)(t.layerId),n=l[s],o=(0,_.JM)(a),c={context:t.dashboardLabel},d=(0,_.ez)(a,n,i,c);return{value:e,label:"".concat(o," (").concat(d,")")}}),h=tk(e,t).map(e=>{let t=v.SYSTEM_GRAPH_SPECS[e].selectTitle(i);return{value:e,label:t}});return(0,s.jsxs)("div",{className:"jsx-".concat(tM.__hash)+" add-graph open",children:[(0,s.jsxs)("form",{className:"jsx-".concat(tM.__hash),children:[!o&&(0,s.jsxs)("div",{className:"jsx-".concat(tM.__hash),children:[(0,s.jsxs)("span",{className:"jsx-".concat(tM.__hash)+" add-graph-label",children:[(0,s.jsx)(d.A,{id:"pinBox.addGraphLayer",defaultMessage:"Layer"}),":"]}),(0,s.jsxs)("span",{onMouseDown:p.cancelEvent,onMouseUp:p.cancelEvent,onClick:p.cancelEvent,className:"jsx-".concat(tM.__hash)+" add-graph-select",children:[(0,s.jsx)(p.Select,{className:"add-graph-displayed",items:c,value:null!=t?t:""}),(0,s.jsx)(p.Select,{items:c,value:null!=t?t:"",onChange:(e,t)=>this.setState({addGraphMapLayerId:t}),required:!0})]})]}),(0,s.jsxs)("div",{className:"jsx-".concat(tM.__hash),children:[(0,s.jsxs)("span",{className:"jsx-".concat(tM.__hash)+" add-graph-label",children:[(0,s.jsx)(d.A,{id:"pinBox.addGraphType",defaultMessage:"Type"}),":"]}),(0,s.jsxs)("span",{className:"jsx-".concat(tM.__hash)+" add-graph-select",children:[(0,s.jsx)(p.Select,{className:"add-graph-displayed",items:h,value:null!=a?a:""}),(0,s.jsx)(p.Select,{items:h,value:null!=a?a:"",onChange:(e,t)=>this.setState({addGraphSpecId:t}),required:!0})]})]}),(0,s.jsxs)("div",{className:"jsx-".concat(tM.__hash)+" button-row",children:[(0,s.jsx)("div",{onClick:()=>this.setState({isAddingGraph:!1}),className:"jsx-".concat(tM.__hash)+" wk-button dark small",children:(0,s.jsx)(d.A,{id:"pinBox.cancelButton",defaultMessage:"Cancel"})}),(0,s.jsx)("span",{className:"jsx-".concat(tM.__hash)+" sep"}),(0,s.jsx)("div",{onClick:this.onAddGraph,className:"jsx-".concat(tM.__hash)+" wk-button dark small",children:(0,s.jsx)(d.A,{id:"pinBox.addGraphButton",defaultMessage:"Add graph"})})]})]}),(0,s.jsx)(n(),{id:tM.__hash,children:tM})]})}plotInit(){if(!this.props.isMainPin)return;let{mapObject:e}=this.props;if(!e)return;let t=document.querySelector(".tero-map");if(!t)return;let a=(0,g.A)().container(t).on("start",this.onDragStart).on("drag",this.onDragMove).on("end",this.onDragEnd);(0,x.A)(this.refOuter.current).call(a)}deleteMultiObjectChildren(){let{mapObject:e}=this.props;e&&e.features.forEach(e=>{this.props.removeNormalObjectWithFeature("string"==typeof e?e:e.properties.id)})}constructor(...e){super(...e),this.state={width:null,isExpanded:!v.DEBUG.initiallyClosedPinBoxes,isAddingGraph:!1,addGraphMapLayerId:null,addGraphSpecId:null,showWmsDetailsPage:{},platformMeta:void 0},this.refOuter=l.createRef(),this.refMeasure=l.createRef(),this.resizeObserver=null,this.prevDragCoords=null,this.availableGraphs=[],this.inhibitDrag=!1,this.isUnmounted=!1,this.onResize=e=>{let{width:t}=e[0].contentRect;t!==this.state.width&&this.setState({width:t})},this.maybeLoadSparsePlatform=async()=>{if(void 0!==this.state.platformMeta)return;let{mapObject:e,datasets:t}=this.props;if(!(0,y.p)(e)||e.isMulti)return;let{isSparse:a,sparseDatasetId:s,sparseSubdatasetId:i}=e;if(!a)return;let n=t[s];if(!(0,y.p)(n))return;let l=n.stacItems[i];if(!l)return;let r=e.features[0];if(!r)return;let{sparsePlatformId:o}=r.properties,c=await (0,k.nf)(l,o);this.isUnmounted||this.setState({platformMeta:c})},this.onDragStart=()=>{var e,t;if(!this.props.isMainPin||(this.inhibitDrag=(null===m.f0||void 0===m.f0?void 0:null===(t=m.f0.sourceEvent)||void 0===t?void 0:null===(e=t.target)||void 0===e?void 0:e.tagName)==="SELECT",this.inhibitDrag))return;let{x:a,y:s}=m.f0;this.prevDragCoords=[a,s]},this.onDragMove=()=>{if(!this.props.isMainPin||this.inhibitDrag)return;let{x:e,y:t}=m.f0;this.throttledDragMove(e,t)},this.throttledDragMove=b()((e,t)=>{if(this.isUnmounted)return;let{mapObject:a}=this.props;if(!a||!this.prevDragCoords)return;let[s,i]=this.prevDragCoords;this.prevDragCoords=[e,t],this.props.onDragMove(a.id,e-s,t-i,e,t)},50),this.onDragEnd=()=>{setTimeout(()=>{let{mapObject:e}=this.props;e&&(this.props.onDragEnd(e.id),this.prevDragCoords=null)},50)},this.onOpenAddGraphForm=()=>{this.setState({isAddingGraph:!0,addGraphMapLayerId:null,addGraphSpecId:null})},this.onAddGraph=()=>{let{mapObject:e}=this.props;if(!e)return;let{addGraphMapLayerId:t,addGraphSpecId:a}=this.state;this.props.addGraph(e.id,t,a),this.setState({isAddingGraph:!1})},this.onShowWmsDetails=e=>{let{showWmsDetailsPage:t}=this.state,a=null==t[e]?0:null;this.setState({showWmsDetailsPage:(0,u.set)(t,e,a)})},this.onShowWmsDetailsPage=(e,t)=>{this.setState({showWmsDetailsPage:(0,u.set)(this.state.showWmsDetailsPage,e,t)})},this.onToggleEnlarged=()=>{let{mapObject:e}=this.props;e&&(e=(0,u.set)(e,"enlargeGraphs",!e.enlargeGraphs),this.props.updateMapObject(e),this.state.isExpanded||this.setState({isExpanded:!0}),(0,M.PJ)({category:"viewer",action:e.enlargeGraphs?"enlargeGraphs":"reduceGraphs"}))}}}let tw=e=>{let t=new Set;return e.forEach(e=>{t.add(e.mapLayerId)}),Array.from(t)},tk=(e,t)=>{let a=new Set;return e.filter(e=>e.mapLayerId===t).forEach(e=>{a.add(e.graphSpecId)}),Array.from(a)},tM=new String(".pin-box-wrapper.jsx-3e2a1c6aa516e01d{position:relative}.debug.jsx-3e2a1c6aa516e01d{position:absolute;bottom:-webkit-calc(100% - 8px);bottom:-moz-calc(100% - 8px);bottom:calc(100% - 8px);font-size:.6rem;overflow:show;color:white;background:black;padding:.2em .4em}.pin-box.jsx-3e2a1c6aa516e01d{white-space:nowrap;border:1px solid white;background:#111;color:white;font-size:.8rem;cursor:-webkit-grab;cursor:-moz-grab;cursor:grab}.pin-box.fixed-width.jsx-3e2a1c6aa516e01d{white-space:normal;width:".concat(280,"px}.pin-box.fixed-width.can-be-drag-target.jsx-3e2a1c6aa516e01d{width:").concat(282,"px}.pin-box.fixed-width.enlarged.jsx-3e2a1c6aa516e01d{white-space:normal;width:").concat(377,"px}.pin-box.fixed-width.enlarged.can-be-drag-target.jsx-3e2a1c6aa516e01d{width:").concat(379,'px}.pin-box.sparse.jsx-3e2a1c6aa516e01d{}.pin-box.is-on-target.jsx-3e2a1c6aa516e01d{opacity:.5}.pin-box.can-be-drag-target.jsx-3e2a1c6aa516e01d{border:2px solid var(--color-accent-bg);margin-top:-1px;margin-left:-1px;-webkit-box-shadow:0 0 4px 0 var(--color-accent-bg);-moz-box-shadow:0 0 4px 0 var(--color-accent-bg);box-shadow:0 0 4px 0 var(--color-accent-bg)}.pin-box.is-drag-target.jsx-3e2a1c6aa516e01d{-webkit-box-shadow:0 0 20px 0 var(--color-accent-bg);-moz-box-shadow:0 0 20px 0 var(--color-accent-bg);box-shadow:0 0 20px 0 var(--color-accent-bg)}.pin-box.in-card.jsx-3e2a1c6aa516e01d{white-space:normal;border:none;background:none}.pin-box.jsx-3e2a1c6aa516e01d *{-webkit-font-feature-settings:"lnum";-moz-font-feature-settings:"lnum";font-feature-settings:"lnum"}@media(hover:none){.pin-box-wrapper.jsx-3e2a1c6aa516e01d{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}}.pin-header.jsx-3e2a1c6aa516e01d{padding:3px 8px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex}.pin-header-info.jsx-3e2a1c6aa516e01d{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1}.pin-menu-wrapper.jsx-3e2a1c6aa516e01d{position:relative;margin-left:.8em}.cm-pinbox-button{margin-left:.8em;cursor:pointer}@media(hover:hover){.cm-pinbox-button,.cm-pin-menu-title{opacity:0;-webkit-transition:opacity 300ms;-moz-transition:opacity 300ms;-o-transition:opacity 300ms;transition:opacity 300ms}}.pin-box.jsx-3e2a1c6aa516e01d:hover .cm-pinbox-button,.pin-box.jsx-3e2a1c6aa516e01d:hover .cm-pin-menu-title{opacity:1}.btn-expand.jsx-3e2a1c6aa516e01d{display:none}.pin-box-wrapper.jsx-3e2a1c6aa516e01d:has(.cm-pin-values) .btn-expand.jsx-3e2a1c6aa516e01d,.pin-box-wrapper.jsx-3e2a1c6aa516e01d:has(.cm-pin-graph) .btn-expand.jsx-3e2a1c6aa516e01d,.pin-box-wrapper.jsx-3e2a1c6aa516e01d:has(.add-graph-button) .btn-expand.jsx-3e2a1c6aa516e01d{display:inline}.pin-body.hidden.jsx-3e2a1c6aa516e01d{display:none}.card-object-actions.jsx-3e2a1c6aa516e01d{}.card-object-action-buttons.jsx-3e2a1c6aa516e01d{margin:8px 8px 4px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-webkit-justify-content:flex-start;-moz-box-pack:start;-ms-flex-pack:start;justify-content:flex-start}.button-icon.jsx-3e2a1c6aa516e01d{margin-right:.4em}.sparse-meta.jsx-3e2a1c6aa516e01d{white-space:normal}.sparse-left.jsx-3e2a1c6aa516e01d{margin-right:8px;padding-top:3px;padding-bottom:3px}.sparse-right.jsx-3e2a1c6aa516e01d{-webkit-box-flex:1;-webkit-flex:1 1 0px;-moz-box-flex:1;-ms-flex:1 1 0px;flex:1 1 0px}.org-logo-img.jsx-3e2a1c6aa516e01d{display:block;max-width:100px;max-height:80px;-webkit-filter:drop-shadow(0 0 1px white)drop-shadow(0 0 1px white);filter:drop-shadow(0 0 1px white)drop-shadow(0 0 1px white)}.cm-pin-values{padding-left:8px;padding-right:8px}.cm-pin-values:first-of-type{padding-top:3px;border-top:1px solid#555}.cm-pin-values:last-of-type{padding-bottom:3px}.pin-box.in-card.jsx-3e2a1c6aa516e01d .cm-pin-values{white-space:normal;border-top:none}.sparse-value.jsx-3e2a1c6aa516e01d{font-weight:bold;color:var(--color-accent-bg);white-space:normal;word-break:break-word}.wms-feature-info.jsx-3e2a1c6aa516e01d{display:grid;grid-template-columns:minmax(').concat(v.UI.pinValueLabelMinWidth,"px,auto)1fr;grid-column-gap:10px}.wms-feature-info-label.jsx-3e2a1c6aa516e01d{}.wms-main-prop.jsx-3e2a1c6aa516e01d{min-width:").concat(v.UI.pinValueLabelMinWidth,'px}.wms-value.jsx-3e2a1c6aa516e01d{font-weight:bold;color:var(--color-accent-bg);white-space:normal;word-break:break-word;cursor:pointer}.wms-value.no-value.jsx-3e2a1c6aa516e01d{color:var(--color-stale-dark)}.wms-details.jsx-3e2a1c6aa516e01d{}.wms-details-pager.jsx-3e2a1c6aa516e01d{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-webkit-justify-content:flex-start;-moz-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;color:var(--color-dim);margin-left:-4px}.btn-page.jsx-3e2a1c6aa516e01d{margin:0 4px;cursor:pointer}.btn-page.disabled.jsx-3e2a1c6aa516e01d{opacity:.6;cursor:not-allowed;pointer-events:none}.btn-page.jsx-3e2a1c6aa516e01d:not(.disabled):hover{color:white}.page-num.jsx-3e2a1c6aa516e01d{-webkit-font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";font-feature-settings:"tnum"}.wms-detail.jsx-3e2a1c6aa516e01d .wms-value.jsx-3e2a1c6aa516e01d{color:var(--color-dim);font-weight:normal}.wms-detail.is-main.jsx-3e2a1c6aa516e01d{font-style:italic}.cm-pin-graphs.jsx-3e2a1c6aa516e01d:has(.cm-pin-graph),.cm-pin-graphs.jsx-3e2a1c6aa516e01d:has(.add-graph-button),.cm-pin-graphs.jsx-3e2a1c6aa516e01d:has(.add-graph){border-top:1px solid#555;padding:3px 0}.cm-pin-graphs.in-card.jsx-3e2a1c6aa516e01d{border-top:none;padding-top:13px}.add-graph-button.jsx-3e2a1c6aa516e01d{text-align:center;background-color:var(--color-dark-button-bg);margin:8px 4px 1px;padding:3px 0px;color:var(--color-dim);line-height:1.3;cursor:pointer}.add-graph-button.jsx-3e2a1c6aa516e01d:hover{background-color:var(--color-dark-button-bg-hover)}.add-graph-button-label.jsx-3e2a1c6aa516e01d{margin-left:.3em}.add-graph.jsx-3e2a1c6aa516e01d{padding:3px 8px;min-width:').concat(v.UI.graphWidth,"px;color:white;line-height:1.6}.add-graph.open.jsx-3e2a1c6aa516e01d{margin-top:5px}.add-graph-label.jsx-3e2a1c6aa516e01d{display:inline-block;color:var(--color-dim);min-width:40px;margin-right:.3em}.add-graph-select.jsx-3e2a1c6aa516e01d{display:inline-block;position:relative}.add-graph-displayed{pointer-events:none}.add-graph-select.jsx-3e2a1c6aa516e01d .giu-input+.giu-input{position:absolute;top:0;left:0;opacity:0;height:20px;overflow:hidden;font-size:16px;color:black}.add-graph.jsx-3e2a1c6aa516e01d .giu-button{color:white;border-color:white}.add-graph.jsx-3e2a1c6aa516e01d .giu-select-native{background-color:inherit;max-width:190px}.button-row.jsx-3e2a1c6aa516e01d{line-height:1.3;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;margin-top:5px}.sep.jsx-3e2a1c6aa516e01d{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1}.title-type.jsx-3e2a1c6aa516e01d{margin-left:.4em;color:var(--color-text-dim)}.drop-target-hint.jsx-3e2a1c6aa516e01d{opacity:0;position:absolute;top:0px;left:0px;right:0px;bottom:0px;margin:2px;background:rgba(0,0,0,.7);color:white;font-size:1rem;pointer-events:none;-webkit-transition:opacity ").concat(v.UI.transitionDuration,"ms;-moz-transition:opacity ").concat(v.UI.transitionDuration,"ms;-o-transition:opacity ").concat(v.UI.transitionDuration,"ms;transition:opacity ").concat(v.UI.transitionDuration,"ms;text-align:center;padding:1em;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center}.pin-box.can-be-drag-target.jsx-3e2a1c6aa516e01d .drop-target-hint.jsx-3e2a1c6aa516e01d{opacity:.9;pointer-events:initial}"));tM.__hash="3e2a1c6aa516e01d";let tN=(0,c.Ng)(e=>({mapLayers:(0,S.b7)(e),datasets:(0,S.yT)(e),isDashboard:(0,S.N0)(e),isEditingDashboard:(0,S.Rp)(e)}),N)((0,h.Ay)(ty))},35269:(e,t,a)=>{a.d(t,{A:()=>r});var s=a(31085),i=a(93243),n=a.n(i);let l=new String(".pin-box-hint.jsx-4b7be858f3306845{white-space:nowrap;position:absolute;bottom:-webkit-calc(100% + 3px);bottom:-moz-calc(100% + 3px);bottom:calc(100% + 3px);border:1px solid black;font-size:.8rem;background-color:var(--color-accent-bg);color:black;padding:2px 8px}");l.__hash="4b7be858f3306845";let r=e=>{let{hint:t}=e;return t?(0,s.jsxs)("div",{"data-sentry-component":"PinBoxHint","data-sentry-source-file":"500-PinBoxHint.tsx",className:"jsx-".concat(l.__hash)+" pin-box-hint",children:[t,(0,s.jsx)(n(),{id:l.__hash,children:l})]}):null}},89384:(e,t,a)=>{a.d(t,{V7:()=>eY,x8:()=>eZ,Ay:()=>eQ});var s=a(31085),i=a(93243),n=a.n(i),l=a(14041),r=a(70541),o=a(99870),c=a.n(o),d=a(8953),h=a(20409),u=a(81864),p=a(89594),x=a(55065),m=a(49608),f=a(77226),b=a(83832),g=a(64104),j=a(99420),v=a.n(j),_=a(38221),y=a.n(_),w=a(52018),k=a(93197),M=a(8539),N=a(44916),S=a(38877),I=a(41821),A=a(69328);let C=e=>v().utc(e).format("YYYY-MM-DDTHH:mm:ss"),D=e=>""!=e?v().utc(e).valueOf():null,T=new String(".time-controls.jsx-68f51732ff3e582{--touch-target-size-x:42px;--touch-target-size-y:22px;--visible-toggle-width:28px;position:absolute;width:0;height:0;z-index:var(--z-time-elevation-tooltip)}.time-controls-toggle-event-target.jsx-68f51732ff3e582{cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:end;-webkit-align-items:flex-end;-moz-box-align:end;-ms-flex-align:end;align-items:flex-end;position:absolute;left:-webkit-calc(var(--touch-target-size-x)/-2);left:-moz-calc(var(--touch-target-size-x)/-2);left:calc(var(--touch-target-size-x)/-2);bottom:0;width:var(--touch-target-size-x);height:var(--touch-target-size-y);visibility:hidden}.time-controls-toggle.jsx-68f51732ff3e582{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;width:var(--visible-toggle-width);height:14px;margin-bottom:6px;border:solid 1px white;background:black;color:white}.time-input-and-controls:hover .time-controls-toggle-event-target.jsx-68f51732ff3e582{visibility:visible}.time-controls.open.jsx-68f51732ff3e582 .time-controls-toggle-event-target.jsx-68f51732ff3e582{display:none}.time-controls-close-button.jsx-68f51732ff3e582{-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;margin-left:.3em;width:2em;height:2em;border:none;background:none;color:white}.time-controls-content.jsx-68f51732ff3e582{display:none;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;position:absolute;bottom:6px;right:-webkit-calc(-.5*var(--visible-toggle-width));right:-moz-calc(-.5*var(--visible-toggle-width));right:calc(-.5*var(--visible-toggle-width));width:-webkit-max-content;width:-moz-max-content;width:max-content;border:solid 1px white;padding:4px;background:black;color:white;font-size:.8rem}.time-controls.open.jsx-68f51732ff3e582 .time-controls-content.jsx-68f51732ff3e582{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex}.time-controls.flipped.jsx-68f51732ff3e582 .time-controls-content.jsx-68f51732ff3e582{right:auto;left:-webkit-calc(-.5*var(--visible-toggle-width));left:-moz-calc(-.5*var(--visible-toggle-width));left:calc(-.5*var(--visible-toggle-width))}.time-controls-content.jsx-68f51732ff3e582 fieldset.jsx-68f51732ff3e582{border:none;padding:0}.time-controls-content.jsx-68f51732ff3e582 input.jsx-68f51732ff3e582{color-scheme:dark;background:black;border:1px solid var(--color-dim)}@media screen and (max-width:".concat(x.UI.narrowBreak,"px){.time-controls-content.jsx-68f51732ff3e582{position:fixed;left:-webkit-calc(50% - 140px)!important;left:-moz-calc(50% - 140px)!important;left:calc(50% - 140px)!important;bottom:60px;right:auto;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-webkit-align-items:flex-start;-moz-box-align:start;-ms-flex-align:start;align-items:flex-start}.time-controls-content.jsx-68f51732ff3e582 fieldset.jsx-68f51732ff3e582{margin-bottom:.3em}.time-controls-close-button.jsx-68f51732ff3e582{position:absolute;bottom:0;right:0}}"));T.__hash="68f51732ff3e582";let L=x.UI.timeElevationRight,E=x.UI.timeElevationBottom,O=32+E,P=O+40,z="TimeInput";class F extends l.Component{componentDidMount(){this.plotInit(),this.plotUpdate(),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp)}componentDidUpdate(){this.plotUpdate()}componentWillUnmount(){document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),this.removeDragListeners&&(this.removeDragListeners(),this.onThumbEnd()),this.isUnmounted=!0}get thumbRight(){return this.props.width-this.state.thumbX}get flipTimeControlsHorizontalOrigin(){return this.state.thumbX<340}render(){let{isHidden:e,hasTime:t,activeTool:a}=this.props,i={"is-hidden":e,"is-inactive":!t,"can-pan":this.state.isAltPressed,"is-panning":this.isPanning};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"jsx-".concat(U.__hash)+" "+(c()("backdrop",i)||"")}),this.renderReset(i),(0,s.jsxs)("div",{onMouseEnter:()=>this.setState({isHovered:!0}),onMouseLeave:()=>this.setState({isHovered:!1}),className:"jsx-".concat(U.__hash)+" "+(c()("time-input-and-controls",{"controls-open":a===x.UI.tools.timeControls,...i})||""),children:[(0,s.jsx)("svg",{ref:this.refSvg,onMouseDownCapture:this.onMouseDown,onTouchStartCapture:this.onMouseDown,"data-sentry-element":"svg","data-sentry-source-file":"120-TimeInput.tsx",className:"jsx-".concat(U.__hash)+" "+(c()("wk-time-elevation time-input",i)||""),children:(0,s.jsx)("g",{transform:"translate(0.5, 0.5)","data-sentry-element":"g","data-sentry-source-file":"120-TimeInput.tsx",className:"jsx-".concat(U.__hash),children:(0,s.jsx)("g",{ref:this.refAxis,transform:"translate(0, ".concat(O-E,")"),"data-testid":"time-input-axis","data-sentry-element":"g","data-sentry-source-file":"120-TimeInput.tsx",className:"jsx-".concat(U.__hash)+" wk-axis-x"})})}),(0,s.jsx)("div",{ref:this.refTooltip,className:"jsx-".concat(U.__hash)+" time-input-tooltip"}),!1]}),(0,s.jsx)(n(),{id:U.__hash,children:U})]})}getLayerDomains(e){let{intl:t,mapLayers:a,datasets:s,cardId:i,dashSettings:n}=this.props,l=Object.keys(a);i&&(l=l.filter(e=>a[e].cardId===i));let r={tMin:1/0,tMax:-1/0,layerDomains:[]};if(!e||!a)return r;for(let e=0;e<l.length;e++){let i=l[e],{layerId:o}=a[i],c=(0,m.VF)(s,o);if(!c)continue;let{tMin:d,tMax:h}=(0,f.w6)(c,{dashSettings:n});if(null==d||null==h)continue;let{datasetId:u}=(0,m.ei)(o),p=(0,m.ez)(c,s[u],t);r.layerDomains.push({id:i,layerId:o,tMin:d,tMax:h,layerTitle:p}),d<r.tMin&&(r.tMin=d),h>r.tMax&&(r.tMax=h)}return r}constructor(...e){super(...e),this.state={zoom:1,isZooming:!1,isHovered:!1,isAltPressed:!1,thumbX:0,hasPanZoomed:!1},this.refSvg=l.createRef(),this.refAxis=l.createRef(),this.refTooltip=l.createRef(),this.dragFinalTime=null,this.tMinRef=null,this.tMaxRef=null,this.prevTMin=null,this.prevTMax=null,this.prevZoom=1,this.isPanning=!1,this.pxOffset=0,this.prevCoordPan=0,this.isUnmounted=!1,this.toggleControls=()=>{let e=this.props.activeTool===x.UI.tools.timeControls?null:x.UI.tools.timeControls;this.props.setActiveTool(e)},this.renderReset=e=>{if(!this.state.hasPanZoomed)return null;let{xScale:t}=this;if(!t)return null;let a=null!=this.tMinRef&&null!=this.prevTMin?Math.abs(t(this.prevTMin)-t(this.tMinRef)):null,i=null!=this.tMaxRef&&null!=this.prevTMax?Math.abs(t(this.prevTMax)-t(this.tMaxRef)):null;return 1!==this.state.zoom||null!=a&&a>4||null!=i&&i>4?(0,s.jsxs)("div",{onClick:this.onClickResetZoom,className:"jsx-".concat(U.__hash)+" "+(c()("reset-zoom",e)||""),children:[(0,s.jsx)(g.A,{id:"tzInput.reset",defaultMessage:"Reset"}),(0,s.jsx)(n(),{id:U.__hash,children:U})]}):null},this.plotInit=()=>{(0,k.A)(this.refSvg.current).on("wheel",this.onZoom)},this.plotUpdate=()=>{let e,t;let{intl:a,hasTime:s,time:i,width:n,activeTool:l}=this.props,{zoom:r,isZooming:o,hasPanZoomed:d}=this.state,h=null!=this.props.timeDragger||l===x.UI.tools.timeControls,u=o||h?0:x.UI.transitionDuration,p=(0,w.kY)().duration(u),m=(0,k.A)(this.refAxis.current),f=n-L,b=f-x.UI.timeElevationGuardX,g=this.getLayerDomains(s),{layerDomains:j}=g;if(d){if(e=this.prevTMin,t=this.prevTMax,r!==this.prevZoom){var _;let a=null!==(_=this.zoomCoord)&&void 0!==_?_:i;t=a+(t-a)/(r/this.prevZoom),e=a-(a-e)/(r/this.prevZoom)}if(this.pxOffset&&this.xScale){let a=(this.xScale(t)-this.xScale(e))/(t-e),s=this.pxOffset/a;e-=s,t-=s,this.pxOffset=0}}else e=g.tMin,t=g.tMax,isFinite(e)&&isFinite(t)||(e=i,t=i),e=v().utc(e).subtract(2,"months").startOf("month").valueOf(),t=v().utc(t).add(2,"months").startOf("month").valueOf(),e=Math.min(i,e),t=Math.max(i,t),this.tMinRef=e,this.tMaxRef=t;this.prevTMin=e,this.prevTMax=t,this.prevZoom=r;let y=[new Date(e),new Date(t)];this.xDomain=y;let M=[70,b],I=(0,N.Pp)().domain(y).range(M).clamp(!0);this.xScale=I,m.selectAll("line.wk-axis-line").data([1]).join(e=>e.append("line").attr("class","wk-axis-line").attr("x1",f)).attr("x2",f).transition(p).attr("x1",s?70:f).style("opacity",s?1:0),m.selectAll("g.wk-ticks").data([1]).join(e=>e.append("g").attr("class","wk-ticks").style("opacity",0)).transition(p).style("opacity",s?1:0);let{tickValues:C,highlighted:D}=(0,A.O)(y,M,a.locale),T=(0,S.l7)(I).tickValues(Object.keys(C).map(e=>C[e].t)).tickFormat(e=>{let t=C["t".concat(e)];return t?t.label:""}).tickSizeOuter(0).tickSizeInner(10);m.select(".wk-ticks").transition(p).call(T).selectAll("text").attr("opacity",e=>{let t=C["t".concat(e)];return t?D?t.highlighted?1:.6:1:0}),m.selectAll("g.wk-layer-domains").data([1]).join("g").attr("class","wk-layer-domains");let E=e=>e.attr("x1",e=>I(e.tMin)).attr("x2",e=>I(e.tMax));m.select("g.wk-layer-domains").selectAll("line.wk-layer-domain").data(j,e=>"".concat(e.id,"/").concat(e.layerId)).join(e=>e.append("line").attr("class",e=>c()("wk-layer-domain",{"wk-layer-domain-point":e.tMax===e.tMin})).style("opacity",0).call(E).call(e=>e.append("title").text(e=>a.$t({id:"tzInput.timeHighlightTooltip",defaultMessage:"The highlighted line represents the time range of '{layerTitle}' that can be shown on the map."},{layerTitle:e.layerTitle}))),e=>e,e=>e.transition(p).style("opacity",0).remove()).transition(p).style("opacity",1).call(E);let O=e=>{let t=I(i);e.attr("transform","translate(".concat(t,", 2), scale(").concat(x.UI.thumbScale,")")),this.state.thumbX!==t&&this.setState({thumbX:t})};m.selectAll("path.wk-thumb").data([1]).join(e=>e.append("path").attr("class","wk-thumb").style("opacity",0).attr("d",x.UI.thumbPath).call(O)).transition(p).style("opacity",()=>i>t||i<e?0:s?1:0).call(O);let P=(h||this.state.isHovered)&&!this.props.isHidden&&s,z=v().utc(i).format("D MMM YYYY, HH:mm");(0,k.A)(this.refTooltip.current).text(P?z:"").style("left","".concat(I(i),"px")).style("opacity",P?.8:0)},this.onZoom=()=>{M.f0.stopImmediatePropagation(),M.f0.preventDefault();let{clientX:e,deltaY:t,deltaMode:a}=M.f0,{zoom:s}=this.state;(s*=Math.pow(1.001,-t*(1===a?25:1)))<1&&(s=1),this.zoomCoord=this.screenToDimCoord(e),this.setState({zoom:s,isZooming:!0,hasPanZoomed:!0}),this.debouncedResetIsZooming()},this.debouncedResetIsZooming=y()(()=>{this.isUnmounted||this.setState({isZooming:!1})},1e3),this.onClickResetZoom=()=>{this.pxOffset=0,this.setState({zoom:1,isZooming:!1,hasPanZoomed:!1})},this.onMouseDown=e=>{let t=e.altKey;t&&(this.pxOffset=0,this.prevCoordPan=e.clientX),this.isPanning=t,this.removeDragListeners=(0,I.RH)({onMove:this.onThumbMove,onEnd:this.onThumbEnd,initialEvent:e}),this.props.timeDragStarted(z)},this.onThumbMove=e=>{let{clientX:t}=e,a=this.screenToDimCoord(t);if(null==a)return;let s=this.clampTime(a);if(this.isPanning){let e=t-this.prevCoordPan;if(!e)return;this.pxOffset+=e,this.prevCoordPan=t,this.state.hasPanZoomed?this.forceUpdate():this.setState({hasPanZoomed:!0})}else this.props.setTime(s),this.dragFinalTime=s},this.screenToDimCoord=e=>{let{refSvg:t}=this;if(!t.current)return null;let a=t.current.getBoundingClientRect();if(!a)return;let s=e-a.left;return this.xScale.invert(s).getTime()},this.clampTime=e=>{let t=this.xDomain[0].getTime(),a=this.xDomain[1].getTime();return e<t?t:e>a?a:e},this.onThumbEnd=()=>{this.isPanning||null==this.dragFinalTime||(this.hasZarrLayers()&&this.props.setTime(this.dragFinalTime,{immediateEffects:!0}),this.dragFinalTime=null),this.isPanning=!1,this.removeDragListeners=null,this.props.timeDragStopped(z)},this.hasZarrLayers=()=>{let{mapLayers:e,datasets:t}=this.props;return null!=Object.values(e).find(e=>{var a;return null===(a=(0,m.VF)(t,e.layerId))||void 0===a?void 0:a.hasZarr})},this.onKeyDown=e=>{"Alt"===e.key&&this.setState({isAltPressed:!0})},this.onKeyUp=e=>{"Alt"===e.key&&this.setState({isAltPressed:!1})}}}let U=new String(".backdrop.jsx-9561fdb444ab8cec{position:absolute;z-index:var(--z-time-elevation-backdrop);bottom:0;right:0;height:".concat(P,"px;width:100%;pointer-events:none;background:-webkit-linear-gradient(bottom,rgba(0,0,0,.6),transparent);background:-moz-linear-gradient(bottom,rgba(0,0,0,.6),transparent);background:-o-linear-gradient(bottom,rgba(0,0,0,.6),transparent);background:linear-gradient(to top,rgba(0,0,0,.6),transparent);opacity:0;-webkit-transition:all ").concat(x.UI.transitionDuration,"ms ease-in-out;-moz-transition:all ").concat(x.UI.transitionDuration,"ms ease-in-out;-o-transition:all ").concat(x.UI.transitionDuration,"ms ease-in-out;transition:all ").concat(x.UI.transitionDuration,"ms ease-in-out}.backdrop.jsx-9561fdb444ab8cec:not(.is-inactive){opacity:1}.reset-zoom.jsx-9561fdb444ab8cec{position:absolute;z-index:var(--z-time-elevation-tooltip);left:").concat(70,"px;bottom:").concat(E+10,"px;opacity:.8;background:black;border:1px solid white;padding:2px 4px;color:var(--color-accent-bg);font-size:.7rem;cursor:pointer}.reset-zoom.is-hidden.jsx-9561fdb444ab8cec,.reset-zoom.is-inactive.jsx-9561fdb444ab8cec{display:none}.time-input-and-controls.jsx-9561fdb444ab8cec{position:absolute;right:0;bottom:0;width:100%;height:").concat(O,"px}.time-input-and-controls.is-hidden.jsx-9561fdb444ab8cec,.time-input-and-controls.is-inactive.jsx-9561fdb444ab8cec{pointer-events:none}.time-input.jsx-9561fdb444ab8cec{width:100%;height:").concat(O,"px}.time-input.is-inactive.jsx-9561fdb444ab8cec{pointer-events:none}.time-input.is-hidden.jsx-9561fdb444ab8cec,.backdrop.is-hidden.jsx-9561fdb444ab8cec{bottom:").concat(-P,'px}.time-input.can-pan.jsx-9561fdb444ab8cec{cursor:-webkit-grab;cursor:-moz-grab;cursor:grab}.time-input.is-panning.jsx-9561fdb444ab8cec{cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}.time-input-tooltip.jsx-9561fdb444ab8cec{position:absolute;z-index:var(--z-time-elevation-tooltip);opacity:0;pointer-events:none;background:black;font-size:.7rem;color:white;padding:2px 4px;border:1px solid white;bottom:7px;text-align:center;-webkit-font-feature-settings:"lnum"on;-moz-font-feature-settings:"lnum"on;font-feature-settings:"lnum"on;-webkit-transform:translatex(-50%);-moz-transform:translatex(-50%);-ms-transform:translatex(-50%);-o-transform:translatex(-50%);transform:translatex(-50%)}'));U.__hash="9561fdb444ab8cec";let R=(0,r.Ng)(e=>({activeTool:(0,b.Z9)(e),time:(0,b.WB)(e),timeDragger:(0,b.YW)(e),mapLayers:(0,b.b7)(e),datasets:(0,b.yT)(e),dashSettings:(0,b.YO)(e)}),u)((0,d.Ay)(F));var B=a(87672);let V=e=>String(e),G=e=>{if(""==e)return null;let t=Number(e);return isNaN(t)?null:Math.round(t)},W=new String(".elevation-controls.jsx-5dbc9579326f30aa{--touch-target-size-x:22px;--touch-target-size-y:42px;--visible-toggle-height:28px;position:absolute;width:0;height:0;z-index:var(--z-time-elevation-tooltip)}.elevation-controls-toggle-event-target.jsx-5dbc9579326f30aa{cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-moz-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;position:absolute;right:0;bottom:-webkit-calc(var(--touch-target-size-y)/-2);bottom:-moz-calc(var(--touch-target-size-y)/-2);bottom:calc(var(--touch-target-size-y)/-2);width:var(--touch-target-size-x);height:var(--touch-target-size-y);visibility:hidden}.elevation-controls-toggle.jsx-5dbc9579326f30aa{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;width:14px;height:var(--visible-toggle-height);margin-right:6px;border:solid 1px white;background:black;color:white}.elevation-input-and-controls:hover .elevation-controls-toggle-event-target.jsx-5dbc9579326f30aa{visibility:visible}.elevation-controls.open.jsx-5dbc9579326f30aa .elevation-controls-toggle-event-target.jsx-5dbc9579326f30aa{display:none}.elevation-controls-content.jsx-5dbc9579326f30aa{display:none;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;position:absolute;bottom:0;right:6px;-webkit-transform:translatey(50%);-moz-transform:translatey(50%);-ms-transform:translatey(50%);-o-transform:translatey(50%);transform:translatey(50%);width:-webkit-max-content;width:-moz-max-content;width:max-content;border:solid 1px white;padding:4px;background:black;color:white;font-size:.8rem}.elevation-controls.open.jsx-5dbc9579326f30aa .elevation-controls-content.jsx-5dbc9579326f30aa{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex}.elevation-input.jsx-5dbc9579326f30aa{width:64px}.elevation-controls-close-button.jsx-5dbc9579326f30aa{-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;margin-left:.3em;width:2em;height:2em;border:none;background:none;color:white}.elevation-controls-content.jsx-5dbc9579326f30aa fieldset.jsx-5dbc9579326f30aa{border:none;padding:0}.elevation-controls-content.jsx-5dbc9579326f30aa input.jsx-5dbc9579326f30aa{color-scheme:dark;background:black;border:1px solid var(--color-dim)}");W.__hash="5dbc9579326f30aa";let H=x.UI.timeElevationRight,$=x.UI.timeElevationBottom,q=x.UI.timeElevationHeight,Z=32+H,Y=Z+50,J="ElevationInput";class K extends l.Component{componentDidMount(){this.plotInit(),this.plotUpdate(),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp)}componentDidUpdate(){this.plotUpdate()}componentWillUnmount(){document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),this.removeDragListeners&&(this.removeDragListeners(),this.onThumbEnd()),this.isUnmounted=!0}render(){let{isHidden:e,hasElevation:t,activeTool:a}=this.props,i={"is-hidden":e,"is-inactive":!t,"can-pan":this.state.isAltPressed,"is-panning":this.isPanning},l=q-x.UI.timeElevationBottom;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{style:{height:l},className:"jsx-".concat(Q.__hash)+" "+(c()("backdrop",i)||"")}),this.renderReset(i),(0,s.jsxs)("div",{onMouseEnter:()=>this.setState({isHovered:!0}),onMouseLeave:()=>this.setState({isHovered:!1}),className:"jsx-".concat(Q.__hash)+" "+(c()("elevation-input-and-controls",{"controls-open":a===x.UI.tools.elevationControls,...i})||""),children:[(0,s.jsx)("svg",{ref:this.refSvg,onMouseDownCapture:this.onMouseDown,onTouchStartCapture:this.onMouseDown,style:{height:q},"data-sentry-element":"svg","data-sentry-source-file":"130-ElevationInput.tsx",className:"jsx-".concat(Q.__hash)+" "+(c()("wk-time-elevation elevation-input",i)||""),children:(0,s.jsx)("g",{transform:"translate(0.5, 0.5)","data-sentry-element":"g","data-sentry-source-file":"130-ElevationInput.tsx",className:"jsx-".concat(Q.__hash),children:(0,s.jsx)("g",{ref:this.refAxis,transform:"translate(".concat(Z-H,", 0)"),"data-sentry-element":"g","data-sentry-source-file":"130-ElevationInput.tsx",className:"jsx-".concat(Q.__hash)+" wk-axis-y"})})}),(0,s.jsx)("div",{ref:this.refTooltip,className:"jsx-".concat(Q.__hash)+" elevation-input-tooltip"}),!1]}),(0,s.jsx)(n(),{id:Q.__hash,children:Q})]})}getLayerDomains(e){let{intl:t,mapLayers:a,datasets:s,cardId:i}=this.props,n=Object.keys(a);i&&(n=n.filter(e=>a[e].cardId===i));let l={zMin:1/0,zMax:-1/0,layerDomains:[]};if(!e||!a)return l;for(let e=0;e<n.length;e++){let i=n[e],{layerId:r}=a[i],o=(0,m.VF)(s,r);if(!o)continue;let{zMin:c,zMax:d}=(0,f.OE)(o);if(null==c||null==d)continue;let{datasetId:h}=(0,m.ei)(r),u=(0,m.ez)(o,s[h],t);l.layerDomains.push({id:i,layerId:r,zMin:c,zMax:d,layerTitle:u}),c<l.zMin&&(l.zMin=c),d>l.zMax&&(l.zMax=d)}return l}constructor(...e){super(...e),this.state={zoom:1,isZooming:!1,isHovered:!1,isAltPressed:!1,thumbY:0,hasPanZoomed:!1},this.refSvg=l.createRef(),this.refAxis=l.createRef(),this.refTooltip=l.createRef(),this.dragFinalElevation=null,this.zMinRef=null,this.zMaxRef=null,this.prevZMin=null,this.prevZMax=null,this.prevZoom=1,this.isPanning=!1,this.pxOffset=0,this.prevCoordPan=0,this.isUnmounted=!1,this.toggleControls=()=>{let e=this.props.activeTool===x.UI.tools.elevationControls?null:x.UI.tools.elevationControls;this.props.setActiveTool(e)},this.renderReset=e=>{if(!this.state.hasPanZoomed)return null;let{yScale:t}=this;if(!t)return null;let a=null!=this.zMinRef&&null!=this.prevZMin?Math.abs(t(this.prevZMin)-t(this.zMinRef)):null,i=null!=this.zMaxRef&&null!=this.prevZMax?Math.abs(t(this.prevZMax)-t(this.zMaxRef)):null;return 1!==this.state.zoom||null!=a&&a>4||null!=i&&i>4?(0,s.jsxs)("div",{onClick:this.onClickResetZoom,className:"jsx-".concat(Q.__hash)+" "+(c()("reset-zoom",e)||""),children:[(0,s.jsx)(g.A,{id:"tzInput.reset",defaultMessage:"Reset"}),(0,s.jsx)(n(),{id:Q.__hash,children:Q})]}):null},this.plotInit=()=>{(0,k.A)(this.refSvg.current).on("wheel",this.onZoom)},this.plotUpdate=()=>{let e,t;let{intl:a,hasElevation:s,elevation:i,activeTool:n}=this.props,{zoom:l,isZooming:r,hasPanZoomed:o}=this.state,d=null!=this.props.elevationDragger||n===x.UI.tools.elevationControls,h=r||d?0:x.UI.transitionDuration,u=(0,w.kY)().duration(h),p=(0,k.A)(this.refAxis.current),m=q-$,f=m-x.UI.timeElevationGuardY,b=this.getLayerDomains(s),{layerDomains:g}=b;if(o){if(e=this.prevZMin,t=this.prevZMax,l!==this.prevZoom){var j;let a=null!==(j=this.zoomCoord)&&void 0!==j?j:i;t=a+(t-a)/(l/this.prevZoom),e=a-(a-e)/(l/this.prevZoom)}if(this.pxOffset&&this.yScale){let a=(this.yScale(t)-this.yScale(e))/(t-e),s=this.pxOffset/a;e-=s,t-=s,this.pxOffset=0}}else e=b.zMin,t=b.zMax,isFinite(e)&&isFinite(t)||(e=i,t=i),e-=10,t+=10,e=Math.min(i,e,0),t=Math.max(i,t,0),this.zMinRef=e,this.zMaxRef=t;this.prevZMin=e,this.prevZMax=t,this.prevZoom=l;let v=[e,t];this.yDomain=v;let _=[f,10];this.yRange=_;let y=(0,N.m4)().domain(v).range(_).clamp(!0);this.yScale=y,p.selectAll("line.wk-axis-line").data([1]).join(e=>e.append("line").attr("class","wk-axis-line").attr("y2",m).attr("y1",m)).join("line").attr("class","wk-axis-line").transition(u).attr("y1",s?10:m).style("opacity",s?1:0),p.selectAll("g.wk-ticks").data([1]).join(e=>e.append("g").attr("class","wk-ticks").style("opacity",0)).transition(u).style("opacity",s?1:0);let M=(0,B.GP)("+,.0f"),I=(0,S.eH)(y).ticks(4).tickFormat(e=>0===e?"0 m":M(e)).tickSizeOuter(0).tickSizeInner(10);p.select(".wk-ticks").transition(u).call(I).selectAll("text").attr("x",15),p.selectAll("g.wk-layer-domains").data([1]).join("g").attr("class","wk-layer-domains");let A=e=>e.attr("y1",e=>y(e.zMin)).attr("y2",e=>y(e.zMax));p.select("g.wk-layer-domains").selectAll("line.wk-layer-domain").data(g,e=>"".concat(e.id,"/").concat(e.layerId)).join(e=>e.append("line").attr("class",e=>c()("wk-layer-domain",{"wk-layer-domain-point":e.zMax===e.zMin})).style("opacity",0).call(A).call(e=>e.append("title").text(e=>a.$t({id:"tzInput.elevationHighlightTooltip",defaultMessage:"The highlighted line represents the depth range of '{layerTitle}' that can be shown on the map."},{layerTitle:e.layerTitle}))),e=>e,e=>e.transition(u).style("opacity",0).remove()).transition(u).style("opacity",1).call(A);let C=e=>{let t=y(i);e.attr("transform","translate(2, ".concat(t,"), rotate(-90), scale(").concat(x.UI.thumbScale,")")),this.state.thumbY!==t&&this.setState({thumbY:t})};p.selectAll("path.wk-thumb").data([1]).join(e=>e.append("path").attr("class","wk-thumb").style("opacity",0).attr("d",x.UI.thumbPath).call(C)).transition(u).style("opacity",()=>i>t||i<e?0:s?1:0).call(C);let D=(d||this.state.isHovered)&&!this.props.isHidden&&s,T="".concat(Math.round(i),"&nbsp;m");(0,k.A)(this.refTooltip.current).html(D?T:"").style("bottom","".concat(q-y(i)-10,"px")).style("opacity",D?.8:0)},this.onZoom=()=>{M.f0.stopImmediatePropagation(),M.f0.preventDefault();let{clientY:e,deltaY:t,deltaMode:a}=M.f0,{zoom:s}=this.state;(s*=Math.pow(1.001,-t*(1===a?25:1)))<1&&(s=1),this.zoomCoord=this.screenToDimCoord(e),this.setState({zoom:s,isZooming:!0,hasPanZoomed:!0}),this.debouncedResetIsZooming()},this.debouncedResetIsZooming=y()(()=>{this.isUnmounted||this.setState({isZooming:!1})},1e3),this.onClickResetZoom=()=>{this.pxOffset=0,this.setState({zoom:1,isZooming:!1,hasPanZoomed:!1})},this.onMouseDown=e=>{let t=e.altKey;t&&(this.pxOffset=0,this.prevCoordPan=e.clientY),this.isPanning=t,this.removeDragListeners=(0,I.RH)({onMove:this.onThumbMove,onEnd:this.onThumbEnd,initialEvent:e}),this.props.elevationDragStarted(J)},this.onThumbMove=e=>{let{clientY:t}=e,a=this.screenToDimCoord(t);if(null==a)return;let s=this.stepAndClampElevation(a);if(this.isPanning){let e=t-this.prevCoordPan;if(!e)return;this.pxOffset+=e,this.prevCoordPan=t,this.forceUpdate(),this.state.hasPanZoomed?this.forceUpdate():this.setState({hasPanZoomed:!0})}else this.props.setElevation(s),this.dragFinalElevation=s},this.screenToDimCoord=e=>{let{refSvg:t}=this;if(!t.current)return;let a=t.current.getBoundingClientRect();if(!a)return;let s=e-a.top;return this.yScale.invert(s)},this.stepAndClampElevation=e=>{let t=this.yDomain[0],a=this.yDomain[1],s=Math.log10((a-t)/(this.yRange[0]-this.yRange[1])),i=Math.pow(10,Math.ceil(s)),n=s%1;n<0&&(n+=1),n<Math.log10(2.5)?i/=4:n<Math.log10(5)&&(i/=2);let l=Math.round(e/i)*i;return l<t?t:l>a?a:l},this.onThumbEnd=()=>{this.isPanning||null==this.dragFinalElevation||(this.hasZarrLayers()&&this.props.setElevation(this.dragFinalElevation,{immediateEffects:!0}),this.dragFinalElevation=null),this.isPanning=!1,this.removeDragListeners=null,this.props.elevationDragStopped(J)},this.hasZarrLayers=()=>{let{mapLayers:e,datasets:t}=this.props;return null!=Object.values(e).find(e=>{var a;return null===(a=(0,m.VF)(t,e.layerId))||void 0===a?void 0:a.hasZarr})},this.onKeyDown=e=>{"Alt"===e.key&&this.setState({isAltPressed:!0})},this.onKeyUp=e=>{"Alt"===e.key&&this.setState({isAltPressed:!1})}}}let Q=new String(".backdrop.jsx-e14b0f298e7efe1a{position:absolute;z-index:var(--z-time-elevation-backdrop);bottom:".concat(x.UI.timeElevationBottom,"px;right:0;width:0;pointer-events:none;-webkit-box-shadow:0px 0px ").concat(Y,"px 30px black;-moz-box-shadow:0px 0px ").concat(Y,"px 30px black;box-shadow:0px 0px ").concat(Y,"px 30px black;opacity:0;-webkit-transition:all ").concat(x.UI.transitionDuration,"ms ease-in-out;-moz-transition:all ").concat(x.UI.transitionDuration,"ms ease-in-out;-o-transition:all ").concat(x.UI.transitionDuration,"ms ease-in-out;transition:all ").concat(x.UI.transitionDuration,"ms ease-in-out}.backdrop.jsx-e14b0f298e7efe1a:not(.is-inactive){opacity:1}.reset-zoom.jsx-e14b0f298e7efe1a{position:absolute;z-index:var(--z-time-elevation-tooltip);right:").concat(H+10,"px;bottom:").concat(q-10-20,"px;opacity:.8;background:black;border:1px solid white;padding:2px 4px;color:var(--color-accent-bg);font-size:.7rem;cursor:pointer}.reset-zoom.is-hidden.jsx-e14b0f298e7efe1a,.reset-zoom.is-inactive.jsx-e14b0f298e7efe1a{display:none}.elevation-input-and-controls.jsx-e14b0f298e7efe1a{position:absolute;right:0;bottom:0;width:").concat(Z,"px;height:").concat(q,"px}.elevation-input-and-controls.is-hidden.jsx-e14b0f298e7efe1a,.elevation-input-and-controls.is-inactive.jsx-e14b0f298e7efe1a{pointer-events:none}.elevation-input.jsx-e14b0f298e7efe1a{width:").concat(Z,"px}.elevation-input.is-inactive.jsx-e14b0f298e7efe1a{pointer-events:none}.elevation-input.is-hidden.jsx-e14b0f298e7efe1a,.backdrop.is-hidden.jsx-e14b0f298e7efe1a{right:").concat(-Y,'px}.elevation-input.can-pan.jsx-e14b0f298e7efe1a{cursor:-webkit-grab;cursor:-moz-grab;cursor:grab}.elevation-input.is-panning.jsx-e14b0f298e7efe1a{cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}.elevation-input-tooltip.jsx-e14b0f298e7efe1a{position:absolute;z-index:var(--z-time-elevation-tooltip);opacity:0;pointer-events:none;background:black;font-size:.7rem;color:white;padding:2px 4px;border:1px solid white;right:4px;text-align:right;-webkit-font-feature-settings:"lnum"on;-moz-font-feature-settings:"lnum"on;font-feature-settings:"lnum"on}'));Q.__hash="e14b0f298e7efe1a";let X=(0,r.Ng)(e=>({activeTool:(0,b.Z9)(e),elevation:(0,b.S1)(e),elevationDragger:(0,b.Gx)(e),mapLayers:(0,b.b7)(e),datasets:(0,b.yT)(e)}),u)((0,d.Ay)(K));var ee=a(8867);let et=new String(".button-crs.jsx-5fadac0cd094a7d2{color:white;position:absolute;left:-webkit-calc(50% - ".concat(60,"px / 2);left:-moz-calc(50% - ").concat(60,"px / 2);left:calc(50% - ").concat(60,"px / 2);cursor:pointer;padding:15px;border:1px solid white;background:rgba(0,0,0,.4);height:").concat(60,"px;width:").concat(60,"px;overflow:hidden;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-border-radius:").concat(30,"px;-moz-border-radius:").concat(30,"px;border-radius:").concat(30,"px;font-size:2rem;-webkit-transform:scale(.86666);-moz-transform:scale(.86666);-ms-transform:scale(.86666);-o-transform:scale(.86666);transform:scale(.86666);opacity:.7;-webkit-transition:all 300ms;-moz-transition:all 300ms;-o-transition:all 300ms;transition:all 300ms}.button-crs.jsx-5fadac0cd094a7d2:hover{-webkit-transform:scale(1);-moz-transform:scale(1);-ms-transform:scale(1);-o-transform:scale(1);transform:scale(1);opacity:1}.crs-up.jsx-5fadac0cd094a7d2{top:-").concat(60,"px}.crs-up.visible.jsx-5fadac0cd094a7d2{top:28px}.crs-down.jsx-5fadac0cd094a7d2{bottom:-").concat(60,"px}.crs-down.visible.jsx-5fadac0cd094a7d2{bottom:").concat(x.UI.timeElevationBottom+20,"px}.button-crs.narrow.jsx-5fadac0cd094a7d2{height:").concat(54,"px;width:").concat(54,"px;left:-webkit-calc(50% - ").concat(54,"px / 2);left:-moz-calc(50% - ").concat(54,"px / 2);left:calc(50% - ").concat(54,"px / 2);-webkit-border-radius:-webkit-calc(").concat(54,"px / 2);-moz-border-radius:-moz-calc(").concat(54,"px / 2);border-radius:-webkit-calc(").concat(54,"px / 2);border-radius:-moz-calc(").concat(54,"px / 2);border-radius:calc(").concat(54,"px / 2);font-size:1.3rem}.button-crs.narrow.crs-up.visible.jsx-5fadac0cd094a7d2{top:12px}.crs-chevron-up{position:relative;top:-2px}.crs-chevron-down{position:relative;top:2px}"));et.__hash="5fadac0cd094a7d2";let ea=new String("svg.label.jsx-4d08296b24ea06cd{position:absolute;top:-1px;left:-1px;width:".concat(60,"px;height:").concat(60,"px}svg.label.jsx-4d08296b24ea06cd path.jsx-4d08296b24ea06cd{fill:none}svg.label.jsx-4d08296b24ea06cd .label-text.jsx-4d08296b24ea06cd{font-weight:bold;font-size:19px;fill:#ccc}.label-top.jsx-4d08296b24ea06cd{letter-spacing:1.4px}.label-bottom.jsx-4d08296b24ea06cd{letter-spacing:8px}svg.label.narrow.jsx-4d08296b24ea06cd{width:").concat(54,"px;height:").concat(54,"px}"));ea.__hash="4d08296b24ea06cd";let es=e=>{let t=(0,ee.A)(),a=(0,r.wA)(),i=(0,r.d4)(b.tT),l=(0,r.d4)(b.Z9),o=(0,r.d4)(t=>(0,b.Be)(t,e.cardId)),d=(t,a)=>{let i="".concat(t,"-top"),l="".concat(t,"-bottom"),r=e.width<=x.UI.narrowBreak;return(0,s.jsxs)("svg",{viewBox:"-50 -50 100 100","data-sentry-element":"svg","data-sentry-component":"renderLabels","data-sentry-source-file":"135-CrsSelectButtons.tsx",className:"jsx-".concat(ea.__hash)+" "+(c()("label",{narrow:r})||""),children:[a[0]&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("path",{id:i,d:"M-".concat(30,",0A").concat(30,",").concat(30,",0,0,1,").concat(30,",0"),className:"jsx-".concat(ea.__hash)}),(0,s.jsx)("text",{textAnchor:"middle",className:"jsx-".concat(ea.__hash)+" label-text label-top",children:(0,s.jsx)("textPath",{startOffset:"50%",href:"#".concat(i),className:"jsx-".concat(ea.__hash),children:a[0]})})]}),(0,s.jsx)("path",{id:l,d:"M-".concat(43,",0A").concat(43,",").concat(43,",0,0,0,").concat(43,",0"),"data-sentry-element":"path","data-sentry-source-file":"135-CrsSelectButtons.tsx",className:"jsx-".concat(ea.__hash)}),a[1]&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("text",{textAnchor:"middle",className:"jsx-".concat(ea.__hash)+" label-text label-bottom",children:(0,s.jsx)("textPath",{startOffset:"50%",href:"#".concat(l),className:"jsx-".concat(ea.__hash),children:a[1]})})}),(0,s.jsx)(n(),{id:ea.__hash,children:ea})]})},m=e=>{e&&(a((0,u.setCrs)(e)),(0,p.PJ)({category:"viewer",action:"changeProjection",label:e}))};return(()=>{let a,r;let{isHidden:u}=e;if(null==i)return null;let p=e.width<=x.UI.narrowBreak,f=t.$t({id:"crsSelect.tooltip4326",defaultMessage:"Equatorial projection"}),b=t.$t({id:"crsSelect.tooltip32661",defaultMessage:"North-Polar projection"}),g=t.$t({id:"crsSelect.tooltip32761",defaultMessage:"South-Polar projection"}),j=t.$t({id:"crsSelect.equator",defaultMessage:"EQUATOR"}),v=t.$t({id:"crsSelect.north",defaultMessage:"NORTH/POLE"}),_=t.$t({id:"crsSelect.south",defaultMessage:"SOUTH/POLE"}),y=null,w=null,k=[],M=[];if(l!==x.UI.tools.area&&l!==x.UI.tools.line){if("epsg:32661"===i)w="epsg:4326",r=f,M=["",j];else if("epsg:32761"===i)y="epsg:4326",a=f,k=[j];else if(null!=o){let[e,t]=o;t>50&&(y="epsg:32661",a=b,k=v.split("/")),e<-50&&(w="epsg:32761",r=g,M=_.split("/"))}}return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{onClick:()=>m(y),title:a,className:"jsx-".concat(et.__hash)+" "+(c()("button-crs crs-up",{visible:y&&!u,narrow:p})||""),children:[(0,s.jsx)(h.Icon,{className:"crs-chevron-up",icon:"chevron-up","data-sentry-element":"Icon","data-sentry-source-file":"135-CrsSelectButtons.tsx"}),d("crs-top",k)]}),(0,s.jsxs)("div",{onClick:()=>m(w),title:r,className:"jsx-".concat(et.__hash)+" "+(c()("button-crs crs-down",{visible:w&&!u,narrow:p})||""),children:[(0,s.jsx)(h.Icon,{className:"crs-chevron-down",icon:"chevron-down","data-sentry-element":"Icon","data-sentry-source-file":"135-CrsSelectButtons.tsx"}),d("crs-bottom",M)]}),(0,s.jsx)(n(),{id:et.__hash,children:et})]})})()};var ei=a(18355),en=a(97937),el=a(18798),er=a(7859),eo=a(70226),ec=a(25003),ed=a(33638),eh=a(68547),eu=a(53432),ep=a(20084),ex=a(85317),em=a(52191),ef=a(19416),eb=a(59916),eg=a(61708),ej=a(40808);let ev=new String(".file-drop.jsx-db9a4a6a1b245b70{border:1px solid var(--color-title-bg);padding:20px;cursor:pointer}.file-drop.dropping.jsx-db9a4a6a1b245b70{background-color:var(--color-title-bg)}.icon.jsx-db9a4a6a1b245b70{display:block;font-size:2em}");ev.__hash="db9a4a6a1b245b70";let e_=e=>{let t=(0,l.useCallback)(t=>{t.forEach(t=>{let a=new FileReader;a.onabort=()=>console.log("file reading was aborted"),a.onerror=()=>console.log("file reading has failed"),a.onload=()=>{let s=a.result;e.onDropFile(s,t.name)},a.readAsArrayBuffer(t)})},[]),{getRootProps:a,getInputProps:i,isDragActive:r}=(0,ej.VB)({onDrop:t,accept:e.acceptFileTypes});return(0,s.jsxs)("div",{...a(),"data-sentry-component":"render","data-sentry-source-file":"990-FileDropZone.tsx",className:"jsx-".concat(ev.__hash)+" "+(c()("file-drop",{dropping:r})||""),children:[(0,s.jsx)("input",{...i(),className:"jsx-".concat(ev.__hash)}),(0,s.jsxs)(h.LargeMessage,{"data-sentry-element":"LargeMessage","data-sentry-source-file":"990-FileDropZone.tsx",children:[(0,s.jsx)("span",{className:"jsx-".concat(ev.__hash)+" icon",children:(0,s.jsx)(h.Icon,{icon:"file",family:"far","data-sentry-element":"Icon","data-sentry-source-file":"990-FileDropZone.tsx"})}),(0,s.jsx)(g.A,{id:"fileDrop.instructions",defaultMessage:"Drag a file here, or click to select one","data-sentry-element":"FormattedMessage","data-sentry-source-file":"990-FileDropZone.tsx"})]}),(0,s.jsx)(n(),{id:ev.__hash,children:ev})]})};var ey=a(82989),ew=a(41723);let ek=[0,0],eM={bottomLeft:[-180,-89.9999],topRight:[180,89.9999]},eN={basemap:x.BASEMAPS.bathymetry.layer},eS=(e,t)=>t||e.length>40?[0]:e.map((e,t)=>t),eI=e=>{let t=[],a={},s={};for(let i=0;i<e.length;i++){let n=e[i],l=n.geometry.type;if("MultiPoint"!==l&&"MultiLineString"!==l&&"MultiPolygon"!==l){let e=t.length;s[i]=[e],a[e]=i,t.push(n);continue}s[i]=[];for(let e=0;e<n.geometry.coordinates.length;e++){let l=(0,m.oo)(n,e);if(l){let e=t.length;s[i].push(e),a[e]=i,t.push(l)}}}return{features:t,mapSplitToUnsplit:a,mapUnsplitToSplit:s}},eA=new String(".feature-selector.jsx-6c272a5628f085a0{margin:var(--modal-padding)}p.jsx-6c272a5628f085a0{margin:10px 0}label.jsx-6c272a5628f085a0{margin-left:6px}.feature-selector.jsx-6c272a5628f085a0{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex}.feature-selector.vertical.jsx-6c272a5628f085a0{-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.feature-selector.no-margin.jsx-6c272a5628f085a0{margin-left:0;margin-right:0}.feature-selector.no-margin.jsx-6c272a5628f085a0 p.jsx-6c272a5628f085a0{margin-top:0}.feature-selector-list.jsx-6c272a5628f085a0{margin-right:20px}.feature-selector.vertical.jsx-6c272a5628f085a0 .feature-selector-list.jsx-6c272a5628f085a0{margin-right:0}.select-property.jsx-6c272a5628f085a0{font-weight:bold}.select-features.jsx-6c272a5628f085a0{width:100%;height:200px}.select-features.jsx-6c272a5628f085a0 .feature-label.missing.jsx-6c272a5628f085a0{font-style:italic;color:var(--color-disabled)}.cm-preview-map-point{fill:blue;stroke:none}.cm-preview-map-line{stroke:blue;fill:none}.centered-buttons.jsx-6c272a5628f085a0{text-align:center}");eA.__hash="6c272a5628f085a0";let eC=e=>{let{features:t,displayProp:a}=e,{isHistory:i,isUploading:r}=e,[o,d]=(0,l.useState)(!1),[u,p]=(0,l.useState)(null),[f,b]=(0,l.useState)(()=>eS(t,i)),j=o?u.features:t,v=()=>{let t=f.map(e=>j[e]),l=t.length,d=j.map((e,t)=>{let s=String(t),i=!1,n=e.properties[a];return(null==n||""===n||n===x.PLACEHOLDER_ID)&&(n="[Geometry ".concat(t+1,"]"),i=!0),{value:s,label:n,missing:i,idx:t}});return i||d.sort((e,t)=>e.missing&&!t.missing?1:!e.missing&&t.missing?-1:e.missing&&t.missing?e.idx-t.idx:e.label<t.label?-1:1),(0,s.jsxs)("div",{"data-sentry-component":"renderSelectAndButtons","data-sentry-source-file":"211-SelectFeature.tsx",className:"jsx-".concat(eA.__hash)+" feature-selector-list",children:[(0,s.jsxs)("p",{className:"jsx-".concat(eA.__hash),children:[i?(0,s.jsx)(g.A,{id:"importGeometries.selectFromHistoryHint",defaultMessage:"Select the geometries to be imported from this browser’s history"}):(0,s.jsx)(g.A,{id:"importGeometries.selectHint",defaultMessage:"Select the geometries to be imported"}),e.canChooseDisplayProp&&(0,s.jsxs)(s.Fragment,{children:[" ","(",(0,s.jsx)(g.A,{id:"importGeometries.listedBy",defaultMessage:"listed by"})," ",(0,s.jsx)("select",{value:null!=a?a:"",onChange:t=>{e.changeDisplayProp(t.target.value)},className:"jsx-".concat(eA.__hash)+" select-property",children:Object.keys(j[0].properties).map(e=>(0,s.jsx)("option",{value:e,className:"jsx-".concat(eA.__hash),children:e},e))}),")"]}),"."," ",(0,s.jsx)(g.A,{id:"importGeometries.selectKeyboardHint",defaultMessage:"Shift-click or {specialKey}-click to select multiple geometries.",values:{specialKey:(0,m.cX)()?"⌘":"Ctrl"},"data-sentry-element":"FormattedMessage","data-sentry-source-file":"211-SelectFeature.tsx"})]}),(0,s.jsx)("p",{className:"jsx-".concat(eA.__hash),children:(0,s.jsx)("select",{multiple:!0,size:10,value:f.map(String),onChange:e=>{b(Array.from(e.target.selectedOptions,e=>Number(e.value)))},className:"jsx-".concat(eA.__hash)+" select-features",children:d.map(e=>{let{value:t,label:a,missing:i}=e;return(0,s.jsx)("option",{value:t,className:"jsx-".concat(eA.__hash)+" "+(c()("feature-label",{missing:i})||""),children:a},t)})})}),e.canSplitMultipart&&(0,s.jsxs)("p",{className:"jsx-".concat(eA.__hash),children:[(0,s.jsx)("input",{type:"checkbox",disabled:r,checked:o,onChange:N,name:"splitInParts",id:"splitInParts",className:"jsx-".concat(eA.__hash)}),(0,s.jsxs)("label",{htmlFor:"splitInParts",className:"jsx-".concat(eA.__hash),children:[(0,s.jsx)(g.A,{id:"importGeometries.splitInParts",defaultMessage:"Split multi-part geometries"}),(0,s.jsx)(ew.A,{ids:["importGeometriesSplitMultipart"]})]})]}),l>40&&(0,s.jsxs)("p",{className:"jsx-".concat(eA.__hash),children:[(0,s.jsx)("span",{className:"jsx-".concat(eA.__hash)+" icon",children:(0,s.jsx)(h.Icon,{icon:"exclamation-triangle"})})," ",(0,s.jsx)(g.A,{id:"importGeometries.tooManyWarning",defaultMessage:"<b>Warning:</b> Importing more than {limit} geometries may slow down the viewer, depending on the complexity of the geometries.",values:{limit:40,b:e=>(0,s.jsx)("b",{className:"jsx-".concat(eA.__hash),children:e},String(e))}})]}),(0,s.jsxs)("p",{className:"jsx-".concat(eA.__hash)+" centered-buttons",children:[i&&(0,s.jsx)("span",{onClick:M,className:"jsx-".concat(eA.__hash)+" "+(c()("wk-button",{disabled:!j.length})||""),children:(0,s.jsx)(g.A,{id:"importGeometries.clearButton",defaultMessage:"Clear"})}),(0,s.jsx)("span",{onClick:()=>{l!==j.length&&b(j.map((e,t)=>t))},className:"jsx-".concat(eA.__hash)+" "+(c()("wk-button",{disabled:l===j.length})||""),children:(0,s.jsx)(g.A,{id:"importGeometries.selectAllButton",defaultMessage:"Select all","data-sentry-element":"FormattedMessage","data-sentry-source-file":"211-SelectFeature.tsx"})}),(0,s.jsx)("span",{onClick:a=>{0===l||r||e.importFeatures(a,t)},className:"jsx-".concat(eA.__hash)+" "+(c()("wk-button primary",{disabled:0===l||r})||""),children:r?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.A,{id:"importGeometries.importing",defaultMessage:"Importing"}),"… ",(0,s.jsx)(ef.A,{})]}):(0,s.jsx)(g.A,{id:"importGeometries.importWithNumberButton",defaultMessage:"Import {numSelected, plural, =0 {} other {#}}",values:{numSelected:l}})})]}),(0,s.jsx)(n(),{id:eA.__hash,children:eA})]})},_=()=>{let{width:t}=e;if(null==t)return null;let a=S();return(0,s.jsxs)("div",{"data-sentry-component":"renderMap","data-sentry-source-file":"211-SelectFeature.tsx",className:"jsx-".concat(eA.__hash)+" feature-selector-map",children:[(0,s.jsx)(ey.default,{width:a,height:a/2,crs:x.UI.defaultCrs,center:ek,zoom:0,zoomLimits:x.UI.zoomLimits,visibleExtentLimits:eM,layers:eN,"data-sentry-element":"Map2d","data-sentry-source-file":"211-SelectFeature.tsx",children:y}),(0,s.jsx)(n(),{id:eA.__hash,children:eA})]})},y=e=>{if(null==j)return null;let t=S();return(0,s.jsx)("svg",{width:t,height:t/2,"data-sentry-element":"svg","data-sentry-component":"renderMapTopLayer","data-sentry-source-file":"211-SelectFeature.tsx",children:f.map(t=>{let a;let{geometry:i}=j[t];switch(i.type){case"Point":a=w([i.coordinates],e);break;case"MultiPoint":a=w(i.coordinates,e);break;case"LineString":a=k([i.coordinates],e);break;case"MultiLineString":a=k(i.coordinates,e);break;case"Polygon":a=k([i.coordinates[0]],e);break;case"MultiPolygon":a=k(i.coordinates.map(e=>e[0]),e)}return(0,s.jsx)("g",{children:a},t)})})},w=(e,t)=>{let{variableProjection:a}=t;return e.map((e,t)=>{let[i,n]=a(e);return(0,s.jsx)("circle",{className:"cm-preview-map-point",cx:i,cy:n,r:4},t)})},k=(e,t)=>{let{variableProjection:a}=t;return e.map((e,t)=>{let i=e.map(a),n="M".concat(i.join("L"));return(0,s.jsx)("path",{className:"cm-preview-map-line",d:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},t)})},M=()=>{j&&j.length&&(b([]),e.onClearHistory())},N=()=>{if(o){let{mapSplitToUnsplit:e}=u,t=new Set;for(let a=0;a<f.length;a++){let s=e[f[a]];null!=s&&t.add(s)}b(Array.from(t)),d(!1)}else{let e=u;e||p(e=eI(t));let{mapUnsplitToSplit:a}=e,s=[];for(let e=0;e<f.length;e++){let t=a[f[e]];t&&s.push(...t)}b(s),d(!0)}},S=()=>{let{width:t}=e;return null==t?0:t<830?t:500};return(()=>{let{width:t}=e;return(0,s.jsxs)("div",{"data-sentry-component":"render","data-sentry-source-file":"211-SelectFeature.tsx",className:"jsx-".concat(eA.__hash)+" "+(c()("feature-selector",{vertical:null==t||t<=830,"no-margin":i})||""),children:[v(),_(),(0,s.jsx)(n(),{id:eA.__hash,children:eA})]})})()},eD={"application/json":[".json",".geojson"],"application/geo+json":[".json",".geojson"]},eT={"application/zip":[".zip"]},eL="importMainProp",eE={features:null,displayProp:null,filename:x.PLACEHOLDER_ID};class eO extends l.Component{componentDidMount(){this.props.modalOpen("importGeometry"),this.resizeObserver=new ResizeObserver(this.onResize),this.resizeObserver.observe(this.refMeasure.current),(0,p.PJ)({category:"viewer",action:"importGeometryShow"}),"history"===this.state.tab&&this.fetchHistory()}componentDidUpdate(e,t){let{tab:a}=this.state;"history"===a&&"history"!==t.tab&&this.fetchHistory()}componentWillUnmount(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.props.modalClose("importGeometry"),this.props.setFeatureHint("importGeometries",!1),(0,p.PJ)({category:"viewer",action:"importGeometryHide"}),this.isUnmounted=!0}render(){return(0,s.jsxs)(ex.A,{className:"wk-modal-upload-geom",onClose:this.props.onClose,"data-sentry-element":"Modal","data-sentry-component":"_ImportGeometryModal","data-sentry-source-file":"210-ImportGeometryModal.tsx",children:[(0,s.jsx)("div",{ref:this.refMeasure,className:"jsx-".concat(eB.__hash)}),"history"!==this.state.tab&&null!=this.state.features?this.renderFeatureSelector():this.renderContent(),(0,s.jsx)(n(),{id:eB.__hash,children:eB})]})}renderContent(){let{intl:e}=this.props,{tab:t}=this.state;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eb.A,{title:e.$t({id:"importGeometries.title",defaultMessage:"Import geometries"}),onClickBack:this.props.onClose}),(0,s.jsxs)("div",{className:"jsx-".concat(eB.__hash)+" upload-geom",children:[this.renderTabs(),"presets"===t&&this.renderPresets(),"history"===t&&this.renderHistory(),"wkt"===t&&this.renderWkt(),"geojson"===t&&this.renderGeojson(),"shapefile"===t&&this.renderShapefile()]}),(0,s.jsx)(n(),{id:eB.__hash,children:eB})]})}renderTabs(){let{intl:e}=this.props,t=[{id:"presets",label:e.$t({id:"importGeometries.tabs.presets",defaultMessage:"Presets"})},{id:"history",label:e.$t({id:"importGeometries.tabs.recent",defaultMessage:"Recent"})}];return x.APP_CONFIG.noAuth||(t.push({id:"wkt",label:"WKT"}),t.push({id:"geojson",label:"GeoJSON"}),t.push({id:"shapefile",label:"Shapefile"})),(0,s.jsx)(eg.A,{tabs:t,activeTabId:this.state.tab,onClickTab:e=>{(0,ed.qK)("importModal.tab",e),this.setState({tab:e,..."history"===this.state.tab?eE:{}})}})}renderPresets(){return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"jsx-".concat(eB.__hash),children:(0,s.jsx)(g.A,{id:"importGeometries.presetsHint",defaultMessage:"Please choose one of the following presets. Please note that the geometries in these collections may have been heavily simplified for performance reasons. If you need more detailed geometries, please download the original data from its provider."})}),(0,s.jsx)("div",{className:"jsx-".concat(eB.__hash)+" presets",children:Object.values(x.PRESET_COLLECTIONS).map(this.renderPreset)}),(0,s.jsx)(n(),{id:eB.__hash,children:eB})]})}renderHistory(){return this.renderFeatureSelector()}renderWkt(){return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("textarea",{ref:this.refWkt,placeholder:"POINT(6 68)",rows:4,cols:40,className:"jsx-".concat(eB.__hash)}),(0,s.jsx)("p",{className:"jsx-".concat(eB.__hash)+" centered-buttons",children:(0,s.jsx)("span",{onClick:this.onSubmitWktTextarea,className:"jsx-".concat(eB.__hash)+" wk-button primary",children:(0,s.jsx)(g.A,{id:"importGeometries.importButton",defaultMessage:"Import"})})}),(0,s.jsx)(n(),{id:eB.__hash,children:eB})]})}renderGeojson(){return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"jsx-".concat(eB.__hash)+" drop-zone-wrapper",children:(0,s.jsx)(e_,{onDropFile:this.onDropGeojsonFile,acceptFileTypes:eD})}),(0,s.jsx)("textarea",{ref:this.refGeojson,placeholder:'{\n  "type": "Point",\n  "coordinates": [6, 68]\n}',rows:4,cols:40,className:"jsx-".concat(eB.__hash)}),(0,s.jsx)("p",{className:"jsx-".concat(eB.__hash)+" centered-buttons",children:(0,s.jsxs)("span",{onClick:this.onSubmitGeojsonTextarea,className:"jsx-".concat(eB.__hash)+" wk-button primary",children:[(0,s.jsx)(g.A,{id:"importGeometries.importButton",defaultMessage:"Import"}),"…"]})}),(0,s.jsx)(n(),{id:eB.__hash,children:eB})]})}renderShapefile(){return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"jsx-".concat(eB.__hash)+" drop-zone-wrapper",children:(0,s.jsx)(e_,{onDropFile:this.onDropShapefile,acceptFileTypes:eT})}),(0,s.jsx)(n(),{id:eB.__hash,children:eB})]})}renderFeatureSelector(){let{intl:e}=this.props,{width:t,tab:a,features:i,isSelectFromPreset:l}=this.state,r="history"===a,o=null!=i&&i.length>0;return(0,s.jsxs)(s.Fragment,{children:[!r&&(0,s.jsx)(eb.A,{title:e.$t({id:"importGeometries.selectGeometriesTitle",defaultMessage:"Select geometries"}),isNested:!0,onClickBack:()=>{this.setState({...eE})},rightClickBack:this.props.onClose}),o&&(0,s.jsx)(eC,{features:i,displayProp:this.state.displayProp,canSplitMultipart:!r,canChooseDisplayProp:!l&&!r,isHistory:r,isUploading:this.state.isUploading,width:t,onClearHistory:this.onClearHistory,changeDisplayProp:e=>{this.setState({displayProp:e}),eU(this.state.filename,e)},importFeatures:this.importFeatures}),(0,s.jsx)(n(),{id:eB.__hash,children:eB})]})}constructor(...e){var t,a;super(...e),t=this,this.state={tab:null!==(a=(0,ed.EL)("importModal.tab"))&&void 0!==a?a:"presets",features:null,displayProp:null,filename:x.PLACEHOLDER_ID,loadingPreset:null,isSelectFromPreset:!1,isUploading:!1,width:null},this.refWkt=l.createRef(),this.refGeojson=l.createRef(),this.refMeasure=l.createRef(),this.resizeObserver=null,this.isUnmounted=!1,this.onResize=e=>{let{width:t}=e[0].contentRect;(t-=2*x.UI.modalPadding)!==this.state.width&&this.setState({width:t})},this.fetchHistory=async()=>{let{intl:e}=this.props;try{let e=await (0,eh.Iw)();if(this.isUnmounted)return;this.setState({features:e,displayProp:"name"})}catch(t){console.error(t),(0,h.notify)({type:"error",icon:"cloud-arrow-up",title:e.$t({id:"notif.historyError",defaultMessage:"Error fetching history"})})}},this.renderPreset=e=>{let{id:t,thumbnailUrl:a,sourceUrl:i,longName:l}=e,{intl:r}=this.props,{loadingPreset:o}=this.state,d=()=>this.onSelectPreset(e);return(0,s.jsxs)("div",{className:"jsx-".concat(eB.__hash)+" "+(c()("preset",{loading:!!o})||""),children:[(0,s.jsxs)("div",{className:"jsx-".concat(eB.__hash)+" preset-image-wrapper",children:[(0,s.jsx)("img",{src:a,alt:l(r),onClick:d,className:"jsx-".concat(eB.__hash)+" preset-image"}),o===t&&(0,s.jsx)("div",{className:"jsx-".concat(eB.__hash)+" preset-spinner",children:(0,s.jsx)(ef.A,{timeout:200})})]}),(0,s.jsxs)("div",{className:"jsx-".concat(eB.__hash)+" preset-title",children:[(0,s.jsx)("span",{onClick:d,className:"jsx-".concat(eB.__hash)+" preset-name",children:l(r)}),(0,s.jsx)("span",{className:"jsx-".concat(eB.__hash)+" info-link",children:(0,s.jsx)(em.A,{href:i,openInNewTab:!0,children:(0,s.jsx)(h.Icon,{icon:"info-circle"})})})]}),(0,s.jsx)(n(),{id:eB.__hash,children:eB})]},t)},this.onSubmitWktTextarea=e=>{let{intl:t}=this.props;try{let t=this.refWkt.current.value;if(!(t=t.trim()))throw Error("Empty WKT");let a=(0,en.parse)(t);if(!a)throw Error("WKT parser error");this.importFeatures(e,[{type:"Feature",geometry:a,properties:{}}])}catch(e){console.error(e),(0,h.notify)({type:"error",icon:"cloud-arrow-up",title:t.$t({id:"notif.wktValidationError",defaultMessage:"Please enter a valid WKT geometry"})})}},this.onSubmitGeojsonTextarea=()=>{let{intl:e}=this.props;try{let e=this.refGeojson.current.value;if(!(e=e.trim()))throw Error("Empty GeoJSON");let t=JSON.parse(e),a=eP(t);this.setUpSelectionProcess(a)}catch(t){console.error(t),(0,h.notify)({type:"error",icon:"cloud-arrow-up",title:e.$t({id:"notif.geojsonValidationError",defaultMessage:"Please enter valid GeoJSON features or geometries"})})}},this.onDropGeojsonFile=async(e,t)=>{let{intl:a}=this.props;try{let a=new TextDecoder().decode(e),s=JSON.parse(a);if(!s||!s.type)throw Error("Invalid GeoJSON");let i=eP(s);this.setUpSelectionProcess(i,{filename:t})}catch(e){(0,h.notify)({type:"error",icon:"cloud-arrow-up",title:a.$t({id:"notif.geojsonFormatError",defaultMessage:"File does not seem to contain valid GeoJSON data"})})}},this.onDropShapefile=async(e,t)=>{let{intl:a}=this.props,s=await (0,ec.T)(a);try{let a=await s(e);if(Array.isArray(a)){let e=Error("");throw e.displayMsg="Multiple shapefiles in provided Zip",e}let i=eP(a);this.setUpSelectionProcess(i,{filename:t})}catch(e){(0,h.notify)({type:"error",icon:"cloud-arrow-up",title:a.$t({id:"notif.shapefileFormatError",defaultMessage:"File does not seem to contain valid Shapefile data"})})}},this.onSelectPreset=async e=>{let{intl:t}=this.props;try{let{id:t,featureCollectionUrl:a}=e;this.setState({loadingPreset:t});let{features:s}=await (0,eo.z)(a,{forceJsonDecode:!0});this.setUpSelectionProcess(s,{displayProp:"name",filename:t,isSelectFromPreset:!0})}catch(e){(0,h.notify)({type:"error",icon:"cloud-arrow-up",title:t.$t({id:"notif.featurePresetError",defaultMessage:"Error loading preset"})})}finally{this.setState({loadingPreset:null})}},this.onClearHistory=()=>{let{features:e}=this.state;if(!e||!e.length)return;let{intl:t}=this.props;try{(0,eh.BP)(),this.fetchHistory()}catch(e){(0,h.notify)({type:"error",icon:"cloud-arrow-up",title:t.$t({id:"notif.featureHistoryError",defaultMessage:"Error clearing history"})})}},this.importFeatures=async(e,t)=>{let{intl:a}=this.props;try{var s,i;let a;this.setState({isUploading:!0});let{displayProp:n}=this.state;a=this.state.isSelectFromPreset?await this.props.importFeaturesFromPreset(t):"history"===this.state.tab?await this.props.importFeaturesFromHistory(t):await this.props.importFeaturesAndUpload(t,n),null===(s=(i=this.props).onClose)||void 0===s||s.call(i,e);let{zoomIntoMapView:l,width:r,height:o}=this.props,c=x.UI.defaultCrs,d=(0,el.bboxToCenterZoom)(a,c,r,o,{margin:80,cover:!1}),{center:h}=d,{zoom:u}=d;a[0]===a[2]&&a[1]===a[3]&&u>12&&(u=12),l({center:h,zoom:u,crs:c})}catch(e){console.error(e),(0,h.notify)({type:"error",icon:"cloud-arrow-up",title:a.$t({id:"notif.geometryImportError",defaultMessage:"Error importing geometries"}),msg:e.displayMessage})}finally{this.setState({isUploading:!1})}},this.setUpSelectionProcess=function(e){var a,s;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null!==(a=i.filename)&&void 0!==a?a:x.PLACEHOLDER_ID,l=null!==(s=i.displayProp)&&void 0!==s?s:eF(e,n);e.sort(eR(l)),t.setState({features:e,isSelectFromPreset:!!i.isSelectFromPreset,displayProp:l,filename:n})}}}let eP=e=>{let t;t="FeatureCollection"===e.type?e.features:"Feature"===e.type?[e]:"object"==typeof e?[{type:"Feature",geometry:e,properties:{}}]:[],t=(0,er.e6)(t);for(let e=0;e<t.length;e++){let{properties:a}=t[e];for(let e in a)null!=a[e]&&"object"==typeof a[e]&&(a[e]=JSON.stringify(a[e]))}if(0===t.length)throw Error("No features found");for(let e=0;e<t.length;e++){let a=t[e];if("Feature"!==a.type)throw Error("Invalid GeoJSON");if(!a.geometry)throw Error("Feature has no geometry");if(!a.geometry.type)throw Error("Geometry has no type");let s=a.geometry.type;if(!["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"].includes(s))throw Error("Unsupported geometry type: ".concat(s));if(!a.geometry.coordinates)throw Error("Geometry has no coordinates")}return t},ez=["name","geoname","country","id"],eF=(e,t)=>{var a;let s;let{properties:i}=e[0];if(null!=i[s=(0,ed.EL)("".concat(eL,"-").concat(t))])return s;for(let e=0;e<ez.length;e++)if(null!=i[s=ez[e]])return eU(t,s),s;return null!==(a=Object.keys(i)[0])&&void 0!==a?a:null},eU=(e,t)=>{(0,ed.qK)("".concat(eL,"-").concat(e),t)},eR=e=>(t,a)=>{let s=t.properties,i=a.properties,n=s[e],l=i[e];if(null==n&&null!=l)return 1;if(null!=n&&null==l)return -1;let r=s.id,o=i.id;return null==n&&null==l?r<o?-1:1:n<l?-1:1},eB=new String(".wk-modal-upload-geom .wk-modal-inner{max-width:900px}.upload-geom.jsx-749c9708480fd651{margin:var(--modal-padding)}.info-link.jsx-749c9708480fd651{margin-left:.5em}p.jsx-749c9708480fd651{margin:10px 0}.label.jsx-749c9708480fd651{font-weight:bold}.presets.jsx-749c9708480fd651{margin-top:var(--modal-padding);display:grid;grid-template-columns:1fr 1fr;gap:20px}.preset.jsx-749c9708480fd651{cursor:pointer}.preset.loading.jsx-749c9708480fd651{pointer-events:none}.preset-image-wrapper.jsx-749c9708480fd651{position:relative}.preset-image.jsx-749c9708480fd651{display:block;width:100%;height:150px;-o-object-fit:cover;object-fit:cover;border:1px solid#ddd}.preset.loading.jsx-749c9708480fd651 .preset-image.jsx-749c9708480fd651{opacity:.5}.preset-spinner.jsx-749c9708480fd651{position:absolute;width:100%;top:-webkit-calc(50% - 1rem);top:-moz-calc(50% - 1rem);top:calc(50% - 1rem);font-size:2rem;text-align:center;color:var(--color-dim)}.preset-title.jsx-749c9708480fd651{font-weight:bold}.drop-zone-wrapper.jsx-749c9708480fd651{margin-bottom:var(--modal-padding)}textarea.jsx-749c9708480fd651{display:block;width:100%;min-height:150px;resize:vertical}.centered-buttons.jsx-749c9708480fd651{text-align:center}");eB.__hash="749c9708480fd651";let eV=(0,r.Ng)(e=>({loginStatus:(0,b.iN)(e)}),u)(e=>{let t=(0,ee.A)(),a=(0,l.useContext)(eu.g);if(!a)throw Error("No ZoomIntoMapViewContext");return"LOGGED_IN"!==e.loginStatus?(0,s.jsx)(ep.A,{onClose:()=>e.setActiveTool(null)}):(0,s.jsx)(eO,{...e,zoomIntoMapView:a,intl:t,"data-sentry-element":"_ImportGeometryModal","data-sentry-component":"ImportGeometryModal","data-sentry-source-file":"210-ImportGeometryModal.tsx"})});class eG extends l.Component{componentDidMount(){this.measureVerticalSpace()}componentDidUpdate(e){e.height!==this.props.height&&this.measureVerticalSpace()}measureVerticalSpace(){let e=this.refToolbox.current;if(!e)return;let{offsetTop:t}=e,a=this.props.isDashboard?0:85;this.setState({hasSufficientSpace:t>=a+22})}render(){let{isExternalEmbed:e,isDashboard:t,intl:a}=this.props,{activeTool:i,hasTime:l,hasElevation:r}=this.props,{isEditingThumbnail:o,isEditingDashboard:d}=this.props,h={"hidden-by-user":this.props.isHidden,"has-time":l,"has-elevation":r,"no-space":!this.state.hasSufficientSpace},u=!e&&!o,p=u&&t,m=this.canShowModals();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{style:{height:110+(t?33:0)},className:"jsx-".concat(eW.__hash)+" "+(c()("backdrop",h)||"")}),(0,s.jsxs)("div",{ref:this.refToolbox,className:"jsx-".concat(eW.__hash)+" "+(c()("toolbox",h)||""),children:[p&&this.renderTool({id:x.UI.tools.dashboardSelect,icon:"mouse-pointer",label:a.$t({id:"tool.select",defaultMessage:"Select"})}),u&&this.renderTool({id:x.UI.tools.point,icon:"crosshairs",label:a.$t({id:"tool.points",defaultMessage:"Points"})}),u&&this.renderTool({id:x.UI.tools.line,icon:"ruler",label:a.$t({id:"tool.lines",defaultMessage:"Lines"})}),u&&this.renderTool({id:x.UI.tools.area,icon:"draw-polygon",label:a.$t({id:"tool.areas",defaultMessage:"Areas"})}),u&&this.renderTool({id:x.UI.tools.importGeometry,icon:"cloud-arrow-up",label:a.$t({id:"tool.import",defaultMessage:"Import"}),hintIds:["importGeometries","importGeometriesSplitMultipart"]}),!d&&this.renderTool({id:x.UI.tools.settings,icon:"cog",label:a.$t({id:"tool.settings",defaultMessage:"Settings"}),hintIds:["largeGraphsByDefault","unitConversion","i18n"],dataTestid:"viewer-settings-button"})]}),i===x.UI.tools.settings&&m&&(0,s.jsx)(ei.A,{onClose:()=>this.props.setActiveTool(null)}),i===x.UI.tools.importGeometry&&m&&(0,s.jsx)(eV,{width:this.props.width,height:this.props.height,onClose:()=>this.props.setActiveTool(null)}),(0,s.jsx)(n(),{id:eW.__hash,children:eW})]})}renderTool(e){let{intl:t}=this.props,{id:a,label:i,hintIds:l}=e,r=this.props.activeTool===a,o=[];e.tooltip&&o.push(e.tooltip);let d=x.UI.keys[a];d&&o.push(t.$t({id:"tool.tooltip",defaultMessage:"Press {key} to toggle on and off"},{key:d.toUpperCase()}));let[u,p]=e.icon.split("/");return(0,s.jsxs)("div",{title:o.join(". "),onClick:()=>this.props.setActiveTool(r?null:a),"data-testid":e.dataTestid,className:"jsx-".concat(eH.__hash)+" "+(c()("tool",{active:r})||""),children:[(0,s.jsxs)("span",{className:"jsx-".concat(eH.__hash)+" "+(c()("button",{active:r})||""),children:[(0,s.jsx)(h.Icon,{icon:u,family:p,fixedWidth:!0}),l&&(0,s.jsx)(ew.A,{ids:l,top:-3,right:-3})]}),(0,s.jsx)("span",{className:"jsx-".concat(eH.__hash)+" label",children:i}),(0,s.jsx)(n(),{id:eH.__hash,children:eH})]})}constructor(...e){super(...e),this.state={hasSufficientSpace:!0},this.refToolbox=l.createRef(),this.canShowModals=()=>{if(!this.props.isDashboard||this.props.isEditingDashboard)return!0;let{cardId:e,mapLayers:t}=this.props,a=Object.values(t).find(e=>null!=e.cardId);return(null==a?void 0:a.cardId)===e}}}let eW=new String(".backdrop.jsx-170d5bed42d259f9{position:absolute;z-index:var(--z-time-elevation-backdrop);bottom:14px;right:0;width:0;pointer-events:none;-webkit-box-shadow:0px 0px ".concat(Y+15,"px 30px black;-moz-box-shadow:0px 0px ").concat(Y+15,"px 30px black;box-shadow:0px 0px ").concat(Y+15,"px 30px black;opacity:1;-webkit-transition:all ").concat(x.UI.transitionDuration,"ms ease-in-out;-moz-transition:all ").concat(x.UI.transitionDuration,"ms ease-in-out;-o-transition:all ").concat(x.UI.transitionDuration,"ms ease-in-out;transition:all ").concat(x.UI.transitionDuration,"ms ease-in-out}.toolbox.jsx-170d5bed42d259f9{position:absolute;bottom:22px;right:0;width:").concat(x.UI.timeElevationRight+13,"px;overflow-x:hidden;z-index:var(--z-toolbox);-webkit-transition:bottom ").concat(x.UI.transitionDuration,"ms,right ").concat(x.UI.transitionDuration,"ms ease-in-out;-moz-transition:bottom ").concat(x.UI.transitionDuration,"ms,right ").concat(x.UI.transitionDuration,"ms ease-in-out;-o-transition:bottom ").concat(x.UI.transitionDuration,"ms,right ").concat(x.UI.transitionDuration,"ms ease-in-out;transition:bottom ").concat(x.UI.transitionDuration,"ms,right ").concat(x.UI.transitionDuration,"ms ease-in-out;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.backdrop.no-space.jsx-170d5bed42d259f9,.toolbox.no-space.jsx-170d5bed42d259f9{opacity:0;pointer-events:none}.toolbox.has-time.jsx-170d5bed42d259f9,.backdrop.has-time.jsx-170d5bed42d259f9{bottom:").concat(x.UI.timeElevationBottom+20,"px}.toolbox.has-elevation.jsx-170d5bed42d259f9,.backdrop.has-elevation.jsx-170d5bed42d259f9{bottom:").concat(x.UI.timeElevationHeight+4,"px}.toolbox.hidden-by-user.jsx-170d5bed42d259f9,.backdrop.hidden-by-user.jsx-170d5bed42d259f9{right:").concat(-Y,"px}"));eW.__hash="170d5bed42d259f9";let eH=new String(".tool.jsx-9cf1f2ca00570a2d{-webkit-border-radius:14px 0 0 14px;-moz-border-radius:14px 0 0 14px;border-radius:14px 0 0 14px;background:-webkit-linear-gradient(left,rgba(0,0,0,.1),transparent);background:-moz-linear-gradient(left,rgba(0,0,0,.1),transparent);background:-o-linear-gradient(left,rgba(0,0,0,.1),transparent);background:linear-gradient(to right,rgba(0,0,0,.1),transparent);padding:5px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;cursor:pointer;color:white}.tool.active.jsx-9cf1f2ca00570a2d{background:-webkit-linear-gradient(left,rgba(0,0,0,.7),transparent);background:-moz-linear-gradient(left,rgba(0,0,0,.7),transparent);background:-o-linear-gradient(left,rgba(0,0,0,.7),transparent);background:linear-gradient(to right,rgba(0,0,0,.7),transparent);color:var(--color-accent-bg)}.tool.jsx-9cf1f2ca00570a2d+.tool.jsx-9cf1f2ca00570a2d{margin-top:3px}.button.jsx-9cf1f2ca00570a2d{margin-right:5px;font-size:15px}.label.jsx-9cf1f2ca00570a2d{display:inline-block;font-size:10px;letter-spacing:.5px;font-weight:bold}");eH.__hash="9cf1f2ca00570a2d";let e$=(0,r.Ng)(e=>({mapLayers:(0,b.b7)(e),activeTool:(0,b.Z9)(e),isExternalEmbed:(0,b.$x)(e),isEditingThumbnail:(0,b.R9)(e),isDashboard:(0,b.N0)(e),isEditingDashboard:(0,b.Rp)(e)}),u)((0,d.Ay)(eG));class eq extends l.Component{render(){let{mapLayers:e,width:t,height:a,isToolboxShown:i,isLight:l}=this.props,{datasets:r,cardId:o}=this.props,{isDashboard:c,isEditingDashboard:d,dashSettings:h}=this.props,u=!i,p={isDashboard:c,isEditingDashboard:d,cardId:o,dashSettings:h},x=eZ(e,r,p),m=eY(e,r,p);return(0,s.jsxs)("div",{"data-sentry-component":"MapTools","data-sentry-source-file":"110-MapTools.tsx",className:"jsx-".concat(eJ.__hash)+" map-tools",children:[!l&&(0,s.jsx)(es,{isHidden:u,cardId:o,width:t}),!d&&(0,s.jsx)(R,{isHidden:u,cardId:o,hasTime:x,width:t}),!d&&(0,s.jsx)(X,{isHidden:u,cardId:o,hasElevation:m}),!l&&(0,s.jsx)(e$,{isHidden:u,cardId:o,hasTime:x,hasElevation:m,width:t,height:a}),!l&&!d&&this.renderHideButton(),(0,s.jsx)(n(),{id:eJ.__hash,children:eJ})]})}renderHideButton(){let{intl:e}=this.props,t=!this.props.isToolboxShown;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{onClick:this.onClickHideButton,title:t?e.$t({id:"mapTools.show",defaultMessage:"Show map tools"}):e.$t({id:"mapTools.hide",defaultMessage:"Hide map tools"}),className:"jsx-".concat(eK.__hash)+" "+(c()("control-block-hide-button",{active:t})||""),children:(0,s.jsx)(h.Icon,{icon:"angle-left"})}),(0,s.jsx)(n(),{id:eK.__hash,children:eK})]})}constructor(...e){super(...e),this.refRoot=l.createRef(),this.onClickHideButton=()=>{let e=!this.props.isToolboxShown;this.props.setIsToolboxShown(e),(0,p.PJ)({category:"viewer",action:e?"timeElevationShow":"timeElevationHide"})}}}let eZ=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(a.isEditingDashboard)return!1;let s=Object.keys(e),{isDashboard:i,cardId:n,dashSettings:l}=a;for(let a=0;a<s.length;a++){let r=e[s[a]],o=(0,m.VF)(t,r.layerId);if(!o||i&&(r.isHidden||n&&r.cardId!==n)||(0,f.hU)(o,{dashSettings:l}))continue;let{tMin:c,tMax:d}=(0,f.w6)(o,{dashSettings:l});if(o.isViewable&&null!=c&&null!=d&&d!==c)return!0}return!1},eY=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(a.isEditingDashboard)return!1;let s=Object.keys(e),{isDashboard:i,cardId:n,dashSettings:l}=a;for(let a=0;a<s.length;a++){let r=e[s[a]],o=(0,m.VF)(t,r.layerId);if(o&&(!i||!r.isHidden&&(!n||r.cardId===n))&&!(0,f.hU)(o,{dashSettings:l})&&o.isViewable&&null!=o.zValues&&!(0,m.NS)(o,x.DIM_ELEVATION))return!0}return!1},eJ=new String("@media(hover:none){.map-tools.jsx-60bf596667c9bf25{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}}");eJ.__hash="60bf596667c9bf25";let eK=new String(".control-block-hide-button.jsx-d01504220ada8a90{position:absolute;z-index:var(--z-time-elevation-hide-button);bottom:0;left:0;height:32px;width:32px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;background-color:var(--color-accent-bg);color:var(--color-accent-fg)!important;font-size:1.1rem;text-align:center;overflow:hidden;cursor:pointer;-webkit-transition:all ".concat(x.UI.transitionDuration,"ms;-moz-transition:all ").concat(x.UI.transitionDuration,"ms;-o-transition:all ").concat(x.UI.transitionDuration,"ms;transition:all ").concat(x.UI.transitionDuration,"ms;-webkit-transform:rotate(-90deg);-moz-transform:rotate(-90deg);-ms-transform:rotate(-90deg);-o-transform:rotate(-90deg);transform:rotate(-90deg)}.control-block-hide-button.active.jsx-d01504220ada8a90{-webkit-transform:rotate(90deg);-moz-transform:rotate(90deg);-ms-transform:rotate(90deg);-o-transform:rotate(90deg);transform:rotate(90deg)}"));eK.__hash="d01504220ada8a90";let eQ=(0,r.Ng)(e=>({mapLayers:(0,b.b7)(e),datasets:(0,b.yT)(e),isToolboxShown:(0,b.$Y)(e),isLight:(0,b.H9)(e),isDashboard:(0,b.N0)(e),isEditingDashboard:(0,b.Rp)(e),dashSettings:(0,b.YO)(e)}),u)((0,d.Ay)(eq))},18355:(e,t,a)=>{a.d(t,{A:()=>O});var s=a(31085),i=a(93243),n=a.n(i),l=a(14041),r=a(70541),o=a(64104),c=a(8953),d=a(31242),h=a(20409),u=a(55808),p=a.n(u),x=a(89594),m=a(55065),f=a(41821),b=a(81864),g=a(83832),j=a(83720),v=a(20084),_=a(99870),y=a.n(_),w=a(8867);let k=new String(".basemap-select.jsx-cbd725c6c5ef6306{margin:4px 0 -6px -4px;width:100%;overflow-x:auto}.inner.jsx-cbd725c6c5ef6306{white-space:nowrap}");k.__hash="cbd725c6c5ef6306";let M=new String(".basemap.jsx-255f4f31ab02d4fc{display:inline-block;width:75px;height:75px;border:2px solid transparent;cursor:pointer;padding:3px}.basemap.jsx-255f4f31ab02d4fc+.basemap.jsx-255f4f31ab02d4fc{margin-left:2px}.basemap-none.jsx-255f4f31ab02d4fc{width:100%;height:100%;background-color:black}.basemap-image.jsx-255f4f31ab02d4fc{display:block;width:100%;height:100%;-o-object-fit:cover;object-fit:cover}.basemap.active.jsx-255f4f31ab02d4fc{border-color:var(--color-icon-button-active)}");M.__hash="255f4f31ab02d4fc";let N=e=>{let t=(0,w.A)(),a=a=>{let i=e.value===a,l="none"===a,r=m.BASEMAPS[a];return(0,s.jsxs)("div",{onClick:()=>{e.onChange(a)},title:l?t.$t({id:"basemap.none",defaultMessage:"None"}):r.label(t),"data-sentry-component":"renderBasemap","data-sentry-source-file":"201-BasemapSelect.tsx",className:"jsx-".concat(M.__hash)+" "+(y()("basemap",{active:i,none:l})||""),children:[l?(0,s.jsx)("div",{className:"jsx-".concat(M.__hash)+" basemap-none"}):(0,s.jsx)("img",{src:r.thumbnailUrl,className:"jsx-".concat(M.__hash)+" basemap-image"}),(0,s.jsx)(n(),{id:M.__hash,children:M})]})};return(0,s.jsxs)("div",{"data-sentry-component":"render","data-sentry-source-file":"201-BasemapSelect.tsx",className:"jsx-".concat(k.__hash)+" basemap-select",children:[(0,s.jsxs)("div",{className:"jsx-".concat(k.__hash)+" inner",children:[a("dark"),a("light"),a("bathymetry"),a("coastline"),a("none")]}),(0,s.jsx)(n(),{id:k.__hash,children:k})]})};var S=a(85317),I=a(59916),A=a(19416),C=a(41723);let D=e=>[{value:"epsg:4326",label:e.$t({id:"settings.epsg4326",defaultMessage:"Equatorial"})+" (EPSG:4326)"},{value:"epsg:32661",label:e.$t({id:"settings.epsg32661",defaultMessage:"North Polar"})+" (EPSG:32661)"},{value:"epsg:32761",label:e.$t({id:"settings.epsg32761",defaultMessage:"South Polar"})+" (EPSG:32761)"}];class T extends l.Component{componentDidMount(){(0,x.PJ)({category:"viewer",action:"settingsShow"}),this.props.modalOpen("settings")}componentWillUnmount(){(0,x.PJ)({category:"viewer",action:"settingsHide"}),this.props.modalClose("settings")}render(){let{showLogin:e}=this.state,{intl:t}=this.props;return e?(0,s.jsx)(v.A,{initialForm:e,onClose:()=>this.setState({showLogin:null}),"data-sentry-element":"LoginModal","data-sentry-component":"SettingsModal","data-sentry-source-file":"200-SettingsModal.tsx"}):(0,s.jsxs)(S.A,{className:"wk-modal-settings",onClose:this.props.onClose,"data-sentry-element":"Modal","data-sentry-component":"SettingsModal","data-sentry-source-file":"200-SettingsModal.tsx",children:[(0,s.jsx)(I.A,{title:t.$t({id:"settings.modalTitle",defaultMessage:"Settings"}),onClickBack:this.props.onClose,dataTestid:"viewer-settings-title","data-sentry-element":"TitleRow","data-sentry-source-file":"200-SettingsModal.tsx"}),this.renderSettings(),(0,s.jsx)(n(),{id:L.__hash,children:L})]})}renderSettings(){let{settings:e,isLight:t,isExternalEmbed:a,isSubstore:i,intl:l}=this.props,r=m.UNITS_LENGTH.map(e=>({label:e,value:e})),c=m.UNITS_AREA.map(e=>({label:e.replace("km2","km\xb2"),value:e})),d=(0,m.UNITS_TEMPERATURE)(l).map(e=>({label:e.replace("deg","\xb0"),value:e})),u=(0,m.UNITS_WIND_SPEED)(l).map(e=>({label:e,value:e})),p=l.$t({id:"settings.minElevationTooltip",defaultMessage:"Blank = no limit"}),x=!a&&!i&&!m.APP_CONFIG.noAuth,{canEditThumbnails:b}=this.props;return(0,s.jsxs)("div",{className:"jsx-".concat(E.__hash)+" settings",children:[x&&this.renderLogInOut(),this.renderLangSelector(),(0,s.jsxs)("div",{className:"jsx-".concat(E.__hash)+" settings-section",children:[(0,s.jsxs)("div",{className:"jsx-".concat(E.__hash)+" basemap-section-wrapper",children:[(0,s.jsx)("div",{className:"jsx-".concat(E.__hash)+" settings-section-title",children:(0,s.jsx)(o.A,{id:"settings.map",defaultMessage:"Map"})}),!t&&(0,s.jsx)("button",{onClick:this.onCLickReset,title:l.$t({id:"settings.mapResetTooltip",defaultMessage:"Reset map-related settings and layers (except for colour-blindness mode)"}),className:"jsx-".concat(E.__hash)+" wk-button extra-small",children:(0,s.jsx)(o.A,{id:"settings.mapReset",defaultMessage:"Reset"})})]}),(0,s.jsx)("div",{className:"jsx-".concat(E.__hash)+" settings-row",children:(0,s.jsx)(N,{value:e.basemap,onChange:this.onChangeBasemap})}),(0,s.jsx)("div",{className:"jsx-".concat(E.__hash)+" settings-row",children:(0,s.jsx)(h.Checkbox,{id:"show-toponyms",label:l.$t({id:"settings.toponyms",defaultMessage:"Show toponyms"}),value:e.showToponyms,onChange:(e,t)=>this.props.updateSettings({showToponyms:t})})}),(0,s.jsx)("div",{className:"jsx-".concat(E.__hash)+" settings-row",children:(0,s.jsx)(h.Checkbox,{id:"show-graticule",label:l.$t({id:"settings.graticule",defaultMessage:"Show 10\xb0 graticule"}),value:!e.hideGraticule,onChange:(e,t)=>this.props.updateSettings({hideGraticule:!t})})}),!t&&(0,s.jsx)("div",{className:"jsx-".concat(E.__hash)+" settings-row",children:(0,s.jsx)(h.Checkbox,{id:"show-invalid-insitu",label:l.$t({id:"settings.invalidInsitus",defaultMessage:"Show invalid insitu data (quality flags 3, 4, 9)"}),value:e.showInvalidInsituData,onChange:(e,t)=>this.props.updateSettings({showInvalidInsituData:t})})}),!t&&(0,s.jsx)("div",{className:"jsx-".concat(E.__hash)+" settings-row",children:(0,s.jsx)(h.Checkbox,{id:"high-resolution",label:l.$t({id:"settings.resolution3x",defaultMessage:"3x resolution (until you leave the page)"}),value:e.highResolution,onChange:(e,t)=>this.props.updateSettings({highResolution:t})})}),(0,s.jsx)("div",{className:"jsx-".concat(E.__hash)+" settings-row",children:(0,s.jsx)(h.Checkbox,{id:"color-blind",label:l.$t({id:"settings.colourBlind",defaultMessage:"Colour-blind mode"}),value:e.colorBlind,onChange:this.onChangeColorBlind})}),!t&&(0,s.jsxs)("div",{className:"jsx-".concat(E.__hash)+" settings-row",children:[(0,s.jsx)(o.A,{id:"settings.projection",defaultMessage:"Projection"}),":"," ",(0,s.jsx)(h.Select,{items:D(l),value:this.props.crs,onChange:(e,t)=>this.props.setCrs(t),required:!0})]})]}),!t&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"jsx-".concat(E.__hash)+" settings-section",children:[(0,s.jsx)("div",{className:"jsx-".concat(E.__hash)+" settings-section-title",children:(0,s.jsx)(o.A,{id:"settings.geometries",defaultMessage:"Geometries"})}),(0,s.jsx)("div",{title:l.$t({id:"settings.autoAddGraphsTooltip",defaultMessage:"Note: alt-click on the map while creating a geometry to invert this setting temporarily."}),className:"jsx-".concat(E.__hash)+" settings-row",children:(0,s.jsx)(h.Checkbox,{id:"auto-add-graphs",label:l.$t({id:"settings.autoAddGraphs",defaultMessage:"Add sample graphs to new geometries"}),value:e.autoAddGraphs,onChange:(e,t)=>this.props.updateSettings({autoAddGraphs:t})})}),(0,s.jsx)("div",{className:"jsx-".concat(E.__hash)+" settings-row",children:(0,s.jsx)(h.Checkbox,{id:"large-graphs-by-default",label:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.A,{id:"settings.largeGraphs",defaultMessage:"Show large graphs by default"})," ",(0,s.jsx)(C.A,{ids:["largeGraphsByDefault"]})]}),value:e.enlargeGraphs,onChange:(e,t)=>{this.props.updateSettings({enlargeGraphs:t})}})}),(0,s.jsx)("div",{className:"jsx-".concat(E.__hash)+" settings-row",children:(0,s.jsx)(h.Checkbox,{id:"hide-graph-stats",label:l.$t({id:"settings.additionalStats",defaultMessage:"Show additional statistics"}),value:!e.hideGraphStats,onChange:(e,t)=>this.props.updateSettings({hideGraphStats:!t})})}),(0,s.jsxs)("div",{title:p,className:"jsx-".concat(E.__hash)+" settings-row",children:[(0,s.jsx)(o.A,{id:"settings.minElevation",defaultMessage:"Minimum graph elevation"}),":"," ",(0,s.jsx)("input",{type:"number",defaultValue:String(e.minGraphElevation),onBlur:this.onChangeMinElevation,onKeyUp:t=>(0,f.jr)(t,this.onChangeMinElevation,String(e.minGraphElevation)),className:"jsx-".concat(E.__hash)+" min-graph-elevation"})," ","m",(0,s.jsx)("span",{title:p,className:"jsx-".concat(E.__hash)+" info",children:(0,s.jsx)(h.Icon,{className:"wk-icon-button no-hover",icon:"info-circle"})})]})]})}),!t&&(0,s.jsxs)("div",{className:"jsx-".concat(E.__hash)+" settings-section",children:[(0,s.jsxs)("div",{className:"jsx-".concat(E.__hash)+" settings-section-title",children:[(0,s.jsx)(o.A,{id:"settings.units",defaultMessage:"Units"}),(0,s.jsx)(C.A,{ids:["unitConversion"]})]}),(0,s.jsxs)("div",{className:"jsx-".concat(E.__hash)+" two-cols",children:[(0,s.jsxs)("div",{className:"jsx-".concat(E.__hash)+" col",children:[(0,s.jsxs)("div",{className:"jsx-".concat(E.__hash)+" settings-row unit",children:[(0,s.jsx)("div",{style:{minWidth:70},"data-testid":"length-label",className:"jsx-".concat(E.__hash)+" unit-label",children:(0,s.jsx)(o.A,{id:"settings.unitsLength",defaultMessage:"Length"})}),(0,s.jsx)(h.Select,{className:"select-unit",items:r,value:e.unitsLength,onChange:(e,t)=>this.props.setUnits("unitsLength",t),required:!0,"data-testid":"length-select"})]}),(0,s.jsxs)("div",{className:"jsx-".concat(E.__hash)+" settings-row unit",children:[(0,s.jsx)("div",{style:{minWidth:70},"data-testid":"area-label",className:"jsx-".concat(E.__hash)+" unit-label",children:(0,s.jsx)(o.A,{id:"settings.unitsArea",defaultMessage:"Area"})}),(0,s.jsx)(h.Select,{className:"select-unit",items:c,value:e.unitsArea,onChange:(e,t)=>this.props.setUnits("unitsArea",t),required:!0,"data-testid":"area-select"})," "]})]}),(0,s.jsxs)("div",{className:"jsx-".concat(E.__hash)+" col",children:[(0,s.jsxs)("div",{className:"jsx-".concat(E.__hash)+" settings-row unit",children:[(0,s.jsx)("div",{style:{minWidth:100},"data-testid":"temperature-label",className:"jsx-".concat(E.__hash)+" unit-label",children:(0,s.jsx)(o.A,{id:"settings.unitsTemperature",defaultMessage:"Temperature"})}),(0,s.jsx)(h.Select,{className:"select-unit",items:d,value:e.unitsTemperature,onChange:(e,t)=>this.props.setUnits("unitsTemperature",t),required:!0,"data-testid":"temperature-select"})," "]}),(0,s.jsxs)("div",{className:"jsx-".concat(E.__hash)+" settings-row unit",children:[(0,s.jsx)("div",{style:{minWidth:100},"data-testid":"wind-speed-label",className:"jsx-".concat(E.__hash)+" unit-label",children:(0,s.jsx)(o.A,{id:"settings.unitsWindSpeed",defaultMessage:"Wind speed"})}),(0,s.jsx)(h.Select,{className:"select-unit",items:u,value:e.unitsWindSpeed,onChange:(e,t)=>this.props.setUnits("unitsWindSpeed",t),required:!0,"data-testid":"wind-speed-select"})]})]})]})]}),!t&&(0,s.jsxs)("div",{className:"jsx-".concat(E.__hash)+" settings-section",children:[(0,s.jsx)("div",{className:"jsx-".concat(E.__hash)+" settings-section-title",children:(0,s.jsx)(o.A,{id:"settings.misc",defaultMessage:"Miscellaneous"})}),(0,s.jsx)("div",{className:"jsx-".concat(E.__hash)+" settings-row",children:(0,s.jsx)(h.Checkbox,{id:"always-show-layer-area-subtitle",label:l.$t({id:"settings.disambiguateLayers",defaultMessage:"Always show layer domain and time resolution"}),value:e.alwaysShowLayerAreaSubtitle,onChange:(e,t)=>this.props.updateSettings({alwaysShowLayerAreaSubtitle:t})})}),(0,s.jsx)("div",{className:"jsx-".concat(E.__hash)+" settings-row",children:(0,s.jsx)(h.Checkbox,{id:"show-subdataset-ids",label:l.$t({id:"settings.datasetIds",defaultMessage:"Show full dataset identifiers"}),value:!e.hideSubdatasetIds,onChange:(e,t)=>this.props.updateSettings({hideSubdatasetIds:!t})})}),b&&(0,s.jsx)("div",{className:"jsx-".concat(E.__hash)+" settings-row",children:(0,s.jsx)(h.Checkbox,{id:"edit-thumbnails",label:l.$t({id:"settings.thumbnailEditor",defaultMessage:"Enable thumbnail editor (until you leave the page)"}),value:e.editThumbnails,onChange:(e,t)=>this.props.updateSettings({editThumbnails:t})})})]}),(0,s.jsx)(n(),{id:E.__hash,children:E})]})}renderLogInOut(){let{loginStatus:e,username:t,intl:a}=this.props;return null==e?null:"LOGGED_IN"===e?(0,s.jsxs)("div",{className:"jsx-".concat(E.__hash)+" settings-section",children:[(0,s.jsxs)("div",{className:"jsx-".concat(E.__hash)+" settings-section-title",children:[(0,s.jsx)(o.A,{id:"settings.session",defaultMessage:"Session"}),":",(0,s.jsx)("span",{className:"jsx-".concat(E.__hash)+" login-status",children:(0,s.jsx)(o.A,{id:"settings.loggedIn",defaultMessage:"Logged in as {username}",values:{username:(0,s.jsx)("b",{className:"jsx-".concat(E.__hash),children:t},"username")}})}),(0,s.jsx)("button",{onClick:()=>this.props.logOut(a),className:"jsx-".concat(E.__hash)+" wk-button extra-small",children:(0,s.jsx)(o.A,{id:"settings.logOutButton",defaultMessage:"Log out"})})]}),(0,s.jsx)(n(),{id:E.__hash,children:E})]}):"LOGGING_OUT"===e||"LOGGING_IN"===e?(0,s.jsxs)("div",{className:"jsx-".concat(E.__hash)+" settings-section",children:[(0,s.jsxs)("div",{className:"jsx-".concat(E.__hash)+" settings-section-title",children:[(0,s.jsx)(o.A,{id:"settings.session",defaultMessage:"Session"}),(0,s.jsx)("span",{className:"jsx-".concat(E.__hash)+" login-status",children:(0,s.jsx)(A.A,{timeout:0})})]}),(0,s.jsx)(n(),{id:E.__hash,children:E})]}):(0,s.jsxs)("div",{className:"jsx-".concat(E.__hash)+" settings-section",children:[(0,s.jsxs)("div",{className:"jsx-".concat(E.__hash)+" settings-section-title",children:[(0,s.jsx)(o.A,{id:"settings.session",defaultMessage:"Session"}),(0,s.jsx)("span",{className:"jsx-".concat(E.__hash)+" login-status",children:(0,s.jsx)("button",{onClick:()=>this.setState({showLogin:"login"}),className:"jsx-".concat(E.__hash)+" wk-button extra-small",children:(0,s.jsx)(o.A,{id:"loginForm.button.logIn",defaultMessage:"Log in"})})})," ",(0,s.jsx)(o.A,{id:"loginForm.button.or",defaultMessage:"or"})," ",(0,s.jsx)("span",{className:"jsx-".concat(E.__hash)+" login-status",children:(0,s.jsx)("button",{onClick:()=>this.setState({showLogin:"register"}),className:"jsx-".concat(E.__hash)+" wk-button extra-small",children:(0,s.jsx)(o.A,{id:"loginForm.button.register",defaultMessage:"Register"})})})]}),(0,s.jsx)(n(),{id:E.__hash,children:E})]})}constructor(...e){super(...e),this.state={showLogin:null},this.renderLangSelector=()=>{let e=j.SC.map(e=>{let{langCode:t,langName:a}=e;return{label:a,value:t}}),{router:t}=this.props;return(0,s.jsxs)("div",{className:"jsx-".concat(E.__hash)+" settings-section",children:[(0,s.jsxs)("div",{className:"jsx-".concat(E.__hash)+" settings-section-title",children:[(0,s.jsx)(o.A,{id:"settings.language",defaultMessage:"Language"}),(0,s.jsx)("span",{className:"jsx-".concat(E.__hash)+" select-lang-wrapper",children:(0,s.jsx)(h.Select,{className:"select-lang",items:e,value:t.locale,onChange:(e,t)=>{this.props.changeLang(t)},required:!0,"data-testid":"lang-select"})}),(0,s.jsx)(C.A,{ids:["i18n"]})]}),(0,s.jsx)(n(),{id:E.__hash,children:E})]})},this.onChangeColorBlind=(e,t)=>{this.props.updateSettings({colorBlind:t}),(0,x.PJ)({category:"viewer",action:t?"colorBlindOn":"colorBlindOff"})},this.onChangeBasemap=e=>{this.props.updateSettings({basemap:e});let t="setBasemap".concat(p()(e));(0,x.PJ)({category:"viewer",action:t})},this.onCLickReset=()=>{this.props.setMapLayers(m.DEFAULT_LAYERS,{persist:!0,mergeLocalAttrs:!1});let{basemap:e,hideGraticule:t,showToponyms:a,highResolution:s}=m.INITIAL_SETTINGS;this.props.updateSettings({basemap:e,hideGraticule:t,showToponyms:a,highResolution:s}),this.props.setCrs(m.UI.defaultCrs)},this.onChangeMinElevation=e=>{let t=""!==e.target.value?Number(e.target.value):null;this.props.updateSettings({minGraphElevation:t})}}}let L=new String(".wk-modal-settings .wk-modal-inner{max-width:450px}");L.__hash="7a06b25e5751ab30";let E=new String(".settings.jsx-f7dbc80bb036b07c{margin:var(--modal-padding);line-height:1.6}.basemap-section-wrapper.jsx-f7dbc80bb036b07c{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:.5em}.settings-section.jsx-f7dbc80bb036b07c+.settings-section.jsx-f7dbc80bb036b07c{margin-top:14px}.settings-section-title.jsx-f7dbc80bb036b07c{font-weight:bold}.settings-row.jsx-f7dbc80bb036b07c{margin-left:1em}.settings-label.jsx-f7dbc80bb036b07c{margin-right:5px}.settings.jsx-f7dbc80bb036b07c .giu-checkbox{white-space:normal}.min-graph-elevation.jsx-f7dbc80bb036b07c{width:70px}.giu-float-error-login-input{z-index:var(--z-modal-error)}.login-status.jsx-f7dbc80bb036b07c{margin:0 .5em;font-weight:normal}.info.jsx-f7dbc80bb036b07c{margin-left:.5em}.info.jsx-f7dbc80bb036b07c .wk-icon-button{color:var(--color-dim)}.two-cols.jsx-f7dbc80bb036b07c{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex}.unit.jsx-f7dbc80bb036b07c{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex}.unit-label.jsx-f7dbc80bb036b07c{display:inline-block}.unit.jsx-f7dbc80bb036b07c .giu-select-native-wrapper,.unit.jsx-f7dbc80bb036b07c .giu-select-native{width:100%}.select-lang-wrapper.jsx-f7dbc80bb036b07c{margin-left:.5em;font-weight:normal}");E.__hash="f7dbc80bb036b07c";let O=(0,d.withRouter)((0,r.Ng)(e=>({loginStatus:(0,g.iN)(e),username:(0,g.TO)(e),settings:(0,g.mt)(e),crs:(0,g.tT)(e),isLight:(0,g.H9)(e),isExternalEmbed:(0,g.$x)(e),isSubstore:(0,g.wZ)(e),canEditThumbnails:(0,g.YY)(e)}),b)((0,c.Ay)(T)))},49650:(e,t,a)=>{a.d(t,{A:()=>A});var s=a(31085),i=a(93243),n=a.n(i),l=a(14041),r=a(70541),o=a(64104),c=a(8953),d=a(99420),h=a.n(d),u=a(20409),p=a(51893),x=a(81864),m=a(55065),f=a(7859),b=a(83832),g=a(33638),j=a(85317),v=a(59916),_=a(8867),y=a(99870),w=a.n(y);let k=new String(".copy.jsx-d749b797e83cd028{position:absolute;top:0;right:10px}.code.jsx-d749b797e83cd028{position:relative;margin:25px 0;padding-right:40px}.preview.jsx-d749b797e83cd028{position:relative;max-width:100%;overflow-x:auto;font-size:.9rem;border-left:3px solid var(--color-dim);border-right:3px solid var(--color-dim);padding:0 12px}.preview.wrap.jsx-d749b797e83cd028{white-space:pre-wrap}");k.__hash="d749b797e83cd028";let M=e=>{let t=(0,_.A)(),a=()=>{try{var a;navigator.clipboard.writeText(e.children),(0,u.notify)({type:"success",title:null!==(a=e.copyMessage)&&void 0!==a?a:t.$t({id:"notif.copySnippetSuccess",defaultMessage:"Code snippet copied!"}),icon:"copy",iconFamily:"far"})}catch(e){(0,u.notify)({type:"error",title:t.$t({id:"notif.copySnippetErrorTitle",defaultMessage:"Could not copy the code snippet"}),msg:t.$t({id:"notif.copySnippetManually",defaultMessage:"Please select and copy manually"}),icon:"copy",iconFamily:"far"})}};return(()=>{let t=e.children,{splitLines:i}=e;return i&&(t=t.split(i).map((e,t)=>(0,s.jsxs)(l.Fragment,{children:[t>0&&"  ".concat(i),e,(0,s.jsx)("br",{})]},t))),(0,s.jsxs)("div",{translate:"no","data-sentry-component":"render","data-sentry-source-file":"980-Code.tsx",className:"jsx-".concat(k.__hash)+" code",children:[(0,s.jsx)("pre",{className:"jsx-".concat(k.__hash)+" "+(w()("preview",{wrap:e.wrap})||""),children:t}),navigator.clipboard&&(0,s.jsxs)("div",{onClick:a,className:"jsx-".concat(k.__hash)+" wk-icon-button copy",children:[(0,s.jsx)(u.Icon,{icon:"copy",family:"far"})," "]}),(0,s.jsx)(n(),{id:k.__hash,children:k})]})})()};var N=a(61708);class S extends l.Component{componentDidMount(){this.props.modalOpen("automate")}componentWillUnmount(){this.props.modalClose("automate")}render(){let{intl:e}=this.props,{tab:t}=this.state,a=(0,s.jsxs)("span",{className:"jsx-".concat(I.__hash)+" title",children:[(0,s.jsx)("span",{className:"jsx-".concat(I.__hash),children:(0,s.jsx)(o.A,{id:"automate.title",defaultMessage:"Automate download"})}),"\xa0\xa0",(0,s.jsx)(n(),{id:I.__hash,children:I})]});return(0,s.jsxs)(j.A,{className:"wk-modal-subset-request-preview",onClose:this.props.onClose,"data-sentry-element":"Modal","data-sentry-component":"AutomateModal","data-sentry-source-file":"240-AutomateModal.tsx",children:[(0,s.jsx)(v.A,{title:a,noTooltip:!0,onClickBack:this.props.onClose,"data-sentry-element":"TitleRow","data-sentry-source-file":"240-AutomateModal.tsx"}),(0,s.jsxs)("div",{className:"jsx-".concat(I.__hash)+" content",children:[(0,s.jsxs)("p",{className:"jsx-".concat(I.__hash),children:[(0,s.jsx)(o.A,{id:"automate.intro1",defaultMessage:"Thanks to the new {mdsLink}, new advanced interfaces are available.",values:{mdsLink:(0,s.jsx)("a",{href:"https://marine.copernicus.eu/news/introducing-new-copernicus-marine-data-store",target:"_blank",rel:"noopener noreferrer",className:"jsx-".concat(I.__hash),children:m.APP_CONFIG.storeName(e)},"mdsLink")},"data-sentry-element":"FormattedMessage","data-sentry-source-file":"240-AutomateModal.tsx"})," ",(0,s.jsx)(o.A,{id:"automate.intro2",defaultMessage:"The {toolboxLink} comprises a Command-Line Interface (CLI) tool as well as a Python Application Programming Interface (API).",values:{toolboxLink:(0,s.jsx)("a",{href:"https://help.marine.copernicus.eu/en/articles/7949409-copernicus-marine-toolbox-introduction",target:"_blank",rel:"noopener noreferrer",className:"jsx-".concat(I.__hash),children:(0,s.jsx)(o.A,{id:"automate.toolboxName",defaultMessage:"Copernicus Marine Toolbox"})},"toolboxLink")},"data-sentry-element":"FormattedMessage","data-sentry-source-file":"240-AutomateModal.tsx"})]}),this.renderTabs(),"cli"===t&&this.renderCli(),"python"===t&&this.renderPython()]}),(0,s.jsx)(n(),{id:I.__hash,children:I})]})}renderTabs(){let e=[{id:"cli",label:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"jsx-".concat(I.__hash)+" tab-icon",children:(0,s.jsx)(u.Icon,{icon:"terminal"})}),(0,s.jsx)(o.A,{id:"automate.tabCliTitle",defaultMessage:"Command-Line Interface"}),(0,s.jsx)(n(),{id:I.__hash,children:I})]})},{id:"python",label:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"jsx-".concat(I.__hash)+" tab-icon",children:(0,s.jsx)(u.Icon,{icon:"python",family:"fab"})}),(0,s.jsx)(o.A,{id:"automate.tabPythonTitle",defaultMessage:"Python API"}),(0,s.jsx)(n(),{id:I.__hash,children:I})]})}];return(0,s.jsx)(N.A,{tabs:e,activeTabId:this.state.tab,onClickTab:e=>{(0,g.qK)("automateDialogue.tab",e),this.setState({tab:e})}})}renderCli(){let{intl:e}=this.props,t=this.calcCliRequest();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{children:(0,s.jsx)(o.A,{id:"automate.cliInstructions",defaultMessage:"To download this subset {cliLink}, run the following command:",values:{cliLink:(0,s.jsx)("a",{href:"https://help.marine.copernicus.eu/en/articles/7972861-copernicus-marine-toolbox-cli-subset",target:"_blank",rel:"noopener noreferrer",children:(0,s.jsx)(o.A,{id:"automate.cliLink",defaultMessage:"programmatically in CLI"})},"cliLink")}})}),(0,s.jsx)(M,{wrap:!0,splitLines:" --",copyMessage:e.$t({id:"notif.copyCliSuccess",defaultMessage:"CLI command copied!"}),children:t}),this.renderAdvancedCheckbox()]})}renderPython(){let{intl:e}=this.props,t=this.calcPythonRequest();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{children:(0,s.jsx)(o.A,{id:"automate.pythonInstructions",defaultMessage:"To download this subset {pythonLink}, run this snippet:",values:{pythonLink:(0,s.jsx)("a",{href:"https://help.marine.copernicus.eu/en/articles/8283072-copernicus-marine-toolbox-api-subset",target:"_blank",rel:"noopener noreferrer",children:(0,s.jsx)(o.A,{id:"automate.pythonLink",defaultMessage:"from a Python environment"})},"pythonLink")}})}),(0,s.jsx)(M,{copyMessage:e.$t({id:"notif.copyPythonSuccess",defaultMessage:"Python snippet copied!"}),children:t}),this.renderAdvancedCheckbox(),(0,s.jsx)("p",{children:(0,s.jsx)(o.A,{id:"automate.xarrayInstructions",defaultMessage:"Alternatively, to remotely open the dataset (xarray/OPeNDAP-like), consult the {xarrayLink} function.",values:{xarrayLink:(0,s.jsx)("a",{href:"https://help.marine.copernicus.eu/en/articles/8287609-copernicus-marine-toolbox-api-open-a-dataset-or-read-a-dataframe-remotely",target:"_blank",rel:"noopener noreferrer",children:(0,s.jsx)("code",{children:"open_dataset"})},"xarrayLink")}})})]})}renderAdvancedCheckbox(){return(0,s.jsxs)("div",{style:{textAlign:"right"},className:"jsx-".concat(I.__hash),children:[(0,s.jsxs)("label",{className:"jsx-".concat(I.__hash),children:[(0,s.jsx)("input",{type:"checkbox",checked:this.state.isAdvanced,onChange:e=>{this.setState({isAdvanced:e.target.checked}),(0,g.qK)("automateDialogue.isAdvanced",e.target.checked)},className:"jsx-".concat(I.__hash)}),"\xa0"," ",(0,s.jsx)(o.A,{id:"automate.advanced",defaultMessage:"Show advanced options"}),"\xa0\xa0",(0,s.jsx)("a",{href:"https://help.marine.copernicus.eu/en/articles/8684964-i-m-an-operational-user-what-should-i-know-to-use-the-copernicus-marine-toolbox#h_80517d4fb6",target:"_blank",rel:"noreferrer",className:"jsx-".concat(I.__hash),children:(0,s.jsx)(u.Icon,{icon:"info-circle"})})]}),(0,s.jsx)(n(),{id:I.__hash,children:I})]})}calcCliRequest(){var e;let{layerSpec:t,subsetValues:a}=this.props,{isAdvanced:s}=this.state,i=(0,p.getTaglessSubdatasetId)(t.subdatasetId),n=(0,p.getSubdatasetIdExtension)(t.subdatasetId),l=(0,p.getSubdatasetIdTag)(t.subdatasetId),r=[];r.push("copernicusmarine subset"),r.push("--dataset-id ".concat(i)),n&&r.push("--dataset-part ".concat(n)),s&&l&&r.push("--dataset-version ".concat(l)),(null!==(e=a.variableIds)&&void 0!==e?e:[]).forEach(e=>{r.push("--variable ".concat(e))});let{timeMin:o,timeMax:c}=a;if(null!=o&&null!=c){let e=o<c?o:c,t=o>c?o:c;r.push("--start-datetime ".concat(h().utc(e).format("YYYY-MM-DDTHH:mm:ss"))),r.push("--end-datetime ".concat(h().utc(t).format("YYYY-MM-DDTHH:mm:ss")))}let{lonMin:d,lonMax:u,latMin:x,latMax:m}=this.calcFinalLonLatRanges(a);null!=d&&null!=u&&null!=x&&null!=m&&(r.push("--minimum-longitude ".concat(Math.min(d,u))),r.push("--maximum-longitude ".concat(Math.max(d,u))),r.push("--minimum-latitude ".concat(Math.min(x,m))),r.push("--maximum-latitude ".concat(Math.max(x,m))));let{elevationMin:f,elevationMax:b}=a;if(null!=f&&null!=b){let e=-f,t=-b;r.push("--minimum-depth ".concat(Math.min(t,e))),r.push("--maximum-depth ".concat(Math.max(t,e)))}return s&&(r.push("--coordinates-selection-method strict-inside"),t.hasSqlite||r.push("--netcdf-compression-level 1"),r.push("--disable-progress-bar"),r.push("--log-level ERROR")),r.join(" ")}calcPythonRequest(){var e;let{layerSpec:t,subsetValues:a}=this.props,{isAdvanced:s}=this.state,i=(0,p.getTaglessSubdatasetId)(t.subdatasetId),n=(0,p.getSubdatasetIdExtension)(t.subdatasetId),l=(0,p.getSubdatasetIdTag)(t.subdatasetId),r=[];r.push("import copernicusmarine"),r.push(""),r.push("copernicusmarine.subset("),r.push('  dataset_id="'.concat(i,'",')),n&&r.push('  dataset_part="'.concat(n,'",')),s&&l&&r.push('  dataset_version="'.concat(l,'",'));let o=(null!==(e=a.variableIds)&&void 0!==e?e:[]).map(e=>'"'.concat(e,'"')).join(", ");r.push("  variables=[".concat(o,"],"));let{lonMin:c,lonMax:d,latMin:u,latMax:x}=this.calcFinalLonLatRanges(a);null!=c&&null!=d&&null!=u&&null!=x&&(r.push("  minimum_longitude=".concat(Math.min(c,d),",")),r.push("  maximum_longitude=".concat(Math.max(c,d),",")),r.push("  minimum_latitude=".concat(Math.min(u,x),",")),r.push("  maximum_latitude=".concat(Math.max(u,x),",")));let{timeMin:m,timeMax:f}=a;if(null!=m&&null!=f){let e=h().utc(m<f?m:f).format("YYYY-MM-DDTHH:mm:ss"),t=h().utc(m>f?m:f).format("YYYY-MM-DDTHH:mm:ss");r.push('  start_datetime="'.concat(e,'",')),r.push('  end_datetime="'.concat(t,'",'))}let{elevationMin:b,elevationMax:g}=a;if(null!=b&&null!=g){let e=-b,t=-g;r.push("  minimum_depth=".concat(Math.min(t,e),",")),r.push("  maximum_depth=".concat(Math.max(t,e),","))}return s&&(r.push('  coordinates_selection_method="strict-inside",'),t.hasSqlite||r.push("  netcdf_compression_level=1,"),r.push("  disable_progress_bar=True,")),r.push(")"),r.join("\n")}calcFinalLonLatRanges(e){var t,a,s,i,n;let{dataset:l}=this.props,[r,o,c,d]=null!==(t=(0,f.QQ)(l))&&void 0!==t?t:[null,null,null,null],h=null!==(a=e.lonMin)&&void 0!==a?a:r;return{lonMin:h,lonMax:null!==(s=e.lonMax)&&void 0!==s?s:c,latMin:null!==(i=e.latMin)&&void 0!==i?i:o,latMax:null!==(n=e.latMax)&&void 0!==n?n:d}}constructor(...e){var t,a;super(...e),this.state={tab:null!==(t=(0,g.EL)("automateDialogue.tab"))&&void 0!==t?t:"cli",isAdvanced:null!==(a=(0,g.EL)("automateDialogue.isAdvanced"))&&void 0!==a&&a}}}let I=new String(".wk-modal-subset-request-preview .wk-modal-inner{max-width:680px}.content.jsx-dc1e0206f951ed7c{margin:var(--modal-padding)}.title.jsx-dc1e0206f951ed7c{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.title-detail.jsx-dc1e0206f951ed7c{position:relative;top:-.5em;font-size:.7em;margin-left:.2em}.title-detail.deprecated.jsx-dc1e0206f951ed7c{color:darkorange}.tab-icon.jsx-dc1e0206f951ed7c{margin-right:.5em}@media(max-width:450px){.tab-icon.jsx-dc1e0206f951ed7c{display:none}}");I.__hash="dc1e0206f951ed7c";let A=(0,r.Ng)((e,t)=>({dataset:(0,b.vh)(e,t.datasetId)}),x)((0,c.Ay)(S))},20481:(e,t,a)=>{a.d(t,{A:()=>h});var s=a(31085),i=a(93243),n=a.n(i);a(14041);var l=a(8867),r=a(99870),o=a.n(r),c=a(88133);let d=new String(".units.jsx-450cc7699504a91a{color:var(--color-disabled)}.units.plain.jsx-450cc7699504a91a{color:inherit}");d.__hash="450cc7699504a91a";let h=e=>{let t=(0,l.A)();return(()=>{let{units:a,brackets:i,plain:l,long:r}=e,h=(0,c.vr)(a,t,{long:r});return null==h?null:(0,s.jsxs)("span",{"data-sentry-component":"render","data-sentry-source-file":"945-Units.tsx",className:"jsx-".concat(d.__hash)+" "+(o()("units",{plain:l})||""),children:[i?"[":void 0,h.split(/(\^2|\^3|\^4|\^5|\^6|\^-1|\^-2|\^-3|\^-4|\^-5|\^-6)/).map((e,t)=>t%2==0?(0,s.jsx)("span",{className:"jsx-".concat(d.__hash),children:e},String(t)):(0,s.jsx)("sup",{className:"jsx-".concat(d.__hash),children:e.slice(1)},String(t))),i?"]":void 0,(0,s.jsx)(n(),{id:d.__hash,children:d})]})})()}},19101:(e,t,a)=>{a.d(t,{A:()=>o});var s=a(31085),i=a(14041),n=a(99420),l=a.n(n);class r extends i.PureComponent{componentDidMount(){this.timer=setInterval(this.refresh,200),this.refresh()}componentWillUnmount(){this.isUnmounted=!0,null!=this.timer&&(window.clearInterval(this.timer),this.timer=null)}render(){return(0,s.jsx)(s.Fragment,{children:this.state.displayString})}constructor(...e){super(...e),this.state={displayString:null},this.isUnmounted=!1,this.timer=null,this.refresh=()=>{var e;if(this.isUnmounted)return;let{refTime:t}=this.props,a=null!==(e=this.props.format)&&void 0!==e?e:"HH:mm:ss",s=t?l()(Date.now()-t).format(a):l()().format(a);s!==this.state.displayString&&this.setState({displayString:s})}}}let o=r},61708:(e,t,a)=>{a.d(t,{A:()=>h});var s=a(31085),i=a(93243),n=a.n(i),l=a(99870),r=a.n(l),o=a(20409);let c=new String(".tab-titles.jsx-513179e4fef6d65c{margin:20px 0;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-border-radius:0px;-moz-border-radius:0px;border-radius:0px;border:1px solid var(--color-title-bg);display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;cursor:pointer;overflow:hidden}@media screen and (max-width:".concat(500,"px){.tab-titles.jsx-513179e4fef6d65c{font-size:.8rem}}"));c.__hash="513179e4fef6d65c";let d=new String(".tab-title.jsx-3925ade572a51884{-webkit-box-flex:1;-webkit-flex:1 1 0px;-moz-box-flex:1;-ms-flex:1 1 0px;flex:1 1 0px;padding:6px 3px;text-align:center;font-weight:bold;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.tab-title.jsx-3925ade572a51884+.tab-title.jsx-3925ade572a51884{border-left:1px solid var(--color-title-bg)}.tab-title.jsx-3925ade572a51884:hover:not(.disabled){color:inherit!important}.tab-title.active.jsx-3925ade572a51884{background:var(--color-title-bg)}.tab-title.jsx-3925ade572a51884:not(.active){color:var(--color-dim)}.tab-title.disabled.jsx-3925ade572a51884{color:#ccc;cursor:not-allowed}.tab-title-icon.jsx-3925ade572a51884{margin-right:.4em}@media screen and (max-width:".concat(350,"px){.tab-title-label.jsx-3925ade572a51884{display:none}}"));d.__hash="3925ade572a51884";let h=e=>{let t=t=>{let{id:a,label:i,icon:l,iconFamily:c}=t,h=a===e.activeTabId,u=t.disabled||e.disabled;return(0,s.jsxs)("div",{onClick:u?void 0:()=>e.onClickTab(a),"data-sentry-component":"renderTab","data-sentry-source-file":"985-TabTitles.tsx",className:"jsx-".concat(d.__hash)+" "+(r()("tab-title",{active:h,disabled:u})||""),children:[l&&(0,s.jsx)("span",{className:"jsx-".concat(d.__hash)+" tab-title-icon",children:(0,s.jsx)(o.Icon,{icon:l,family:c})}),(0,s.jsx)("span",{className:"jsx-".concat(d.__hash)+" tab-title-label",children:i}),(0,s.jsx)(n(),{id:d.__hash,children:d})]},a)};return(0,s.jsxs)("div",{"data-sentry-component":"render","data-sentry-source-file":"985-TabTitles.tsx",className:"jsx-".concat(c.__hash)+" tab-titles",children:[e.tabs.map(e=>t(e)),(0,s.jsx)(n(),{id:c.__hash,children:c})]})}},62020:(e,t,a)=>{a.d(t,{A:()=>i});var s=a(14041);let i=e=>{let[t,a]=(0,s.useState)(null);return(0,s.useEffect)(()=>{let t=()=>{e.current&&a(e.current.clientWidth)};return t(),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[e]),t}},53432:(e,t,a)=>{a.d(t,{Q:()=>i,g:()=>n});var s=a(14041);let i=(0,s.createContext)(null),n=(0,s.createContext)(null)},78945:(e,t,a)=>{a.d(t,{BQ:()=>b,G3:()=>y,IR:()=>v,Ig:()=>S,J$:()=>M,LF:()=>D,LR:()=>g,M7:()=>P,Mj:()=>w,Ms:()=>L,Om:()=>T,Ti:()=>u,X0:()=>j,gu:()=>U,h_:()=>F,hb:()=>z,qE:()=>O,rC:()=>E,tv:()=>k});var s=a(71680),i=a.n(s),n=a(20409),l=a(51893),r=a(55065),o=a(63449),c=a(94036),d=a(89594),h=a(77226);let u=(e,t,a,s)=>t.hasSqlite?x(e,t,a,s):p(e,t,a,s),p=(e,t,a,s)=>{let{stacItem:i}=t,n=m(t,a),l=i.id;return s.map(a=>{let s={id:void 0,isSparse:!1,datasetId:"".concat(e,"/").concat(l),variableId:a,dimReqs:n,description:"DOWNLOAD ".concat(t.id)};return s.id=(0,o.rF)(s),s})},x=(e,t,a,s)=>{let{stacItem:i}=t,n=m(t,a),l=i.id;return s.map(a=>{let s={id:void 0,isSparse:!0,datasetId:"".concat(e,"/").concat(l),variableId:a,dedupeForMaps:!1,dimReqs:n,description:"DOWNLOAD ".concat(t.id)};return s.id=(0,c.gU)(i,s),s})},m=(e,t)=>{let a={},{stacItem:s}=e,i=(0,h.BQ)(s);if(i[r.DIM_TIME]){let{tMin:e,tMax:i}=(0,h.l9)(s),{timeMin:n,timeMax:l}=t,o=null==n?void 0:n.getTime(),c=null==l?void 0:l.getTime();(null==o||o<e)&&(o=e),(null==c||c>i)&&(c=i),a[r.DIM_TIME]=f(o,c)}if(i[r.DIM_ELEVATION]){let{zMin:e,zMax:i}=(0,h.tQ)(s),{elevationMin:n,elevationMax:l}=t,o=n,c=l;(null==o||o<e)&&(o=e),(null==c||c>i)&&(c=i),a[r.DIM_ELEVATION]=f(o,c)}if(i[r.DIM_LONGITUDE]&&i[r.DIM_LATITUDE]){let{lonMin:s,lonMax:i,latMin:n,latMax:l}=t;a[r.DIM_LONGITUDE]=f(s,i,{normalizeLons:e.hasZarr}),a[r.DIM_LATITUDE]=f(n,l)}return Object.keys(i).forEach(e=>{if(null!=a[e])return;let t=i[e];null!=t.values&&t.values.length>0&&(a[e]={coord:t.values[0]})}),a},f=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null==e||null==t)return{};if(a.normalizeLons){if(t-e>=360)return{};let a=Math.floor((e+180)/360);e-=360*a,t-=360*a}return{range:[e,t],maxInclusive:!0}},b=async function(e,t,a){var s,i;let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=t.isSparse?await (0,c.n5)(e.stacItem,t,{username:null!==(s=n.username)&&void 0!==s?s:void 0,usage:n.usage}):await (0,o.aS)(e.stacItem,t,{username:null!==(i=n.username)&&void 0!==i?i:void 0,usage:n.usage,timeout:r.UI.subset.downloadTimeout});return l?{...l,isSparse:t.isSparse}:(N(a),null)},g=async function(e,t,a){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=(0,l.getTaglessSubdatasetId)(e.subdatasetId);if(e.hasSqlite)try{let n="".concat(i,"_").concat(Date.now(),".csv"),{bytes:l,samples:r}=await (0,c.sL)(e,t,a,n);null==l||s.noNotification||C(l,r,a)}catch(e){if("EMPTY_SUBSET"===e.message){N(a);return}throw e}else{let n="".concat(i,"_").concat(Date.now(),".nc"),{bytes:l}=await (0,o.yZ)(e,t,n);null==l||s.noNotification||A(l,a)}},j=async(e,t,a,s)=>{let{tzDataset:i,stacItem:n}=t,l=u(e,t,a,s),d=0,h=0;if(t.hasSqlite){for(let e=0;e<l.length;e++){let t=l[e];h+=(0,c.VQ)(n,t)}if(h>r.UI.subset.maxSparseChunks)return{bytes:d,chunks:h};for(let e=0;e<l.length;e++){let t=l[e];d+=await (0,c.Eb)(n,t)}return{bytes:d,chunks:h}}{let e=new Set;for(let t=0;t<l.length;t++){let a=l[t],{dataBytes:s,dimBytes:n}=(0,o.Xf)(i,a);d+=s,Object.keys(n).forEach(t=>{e.has(t)||(d+=n[t],e.add(t))})}return{bytes:d,chunks:h}}},v=(e,t,a)=>{if(null==t)return{tooSmall:!1,tooLarge:!1,tooLargeMsg:null};let{chunks:s,bytes:i}=t,{hasSqlite:n}=e,l=_(i);l&&n&&(l+=" "+a.$t({id:"subset.toFetch",defaultMessage:"to fetch"}));let o=n?0===i||0===s:0===i,c=null,d=!1;return e.hasSqlite?s>r.UI.subset.maxSparseChunks?(d=!0,c=a.$t({id:"subset.tooLargeSparseChunks",defaultMessage:"Too large download ({symbol} {chunks, plural, one {# chunk} other {# chunks}})"},{chunks:s,symbol:s>0?"~":"="})):i>r.UI.subset.maxSizeBytesSparse&&(d=!0,c=a.$t({id:"subset.tooLargeSparseBytes",defaultMessage:"Too large download ({bytesStr})"},{bytesStr:l})):i>r.UI.subset.maxSizeBytesDense&&(d=!0,c=a.$t({id:"subset.tooLargeDenseBytes",defaultMessage:"Too large subset ({bytesStr})"},{bytesStr:l})),{bytesStr:l,tooSmall:o,tooLarge:d,tooLargeMsg:c}},_=e=>{if(e!=e)return"";let t=i()(e),a=e>0?"~":"=";return"".concat(a," ").concat(t)},y=(e,t,a,s)=>{let i=w(t,a,s),n={product_id:e,dataset_id:t.subdatasetId,variables:s};return null!=i.timeMin&&(n.start_datetime=new Date(i.timeMin).toISOString()),null!=i.timeMax&&(n.end_datetime=new Date(i.timeMax).toISOString()),null!=i.elevationMax&&(n.minimum_depth=-i.elevationMax),null!=i.elevationMin&&(n.maximum_depth=-i.elevationMin),null!=i.lonMin&&(n.minimum_longitude=i.lonMin),null!=i.lonMax&&(n.maximum_longitude=i.lonMax),null!=i.latMin&&(n.minimum_latitude=i.latMin),null!=i.latMax&&(n.maximum_latitude=i.latMax),n},w=(e,t,a)=>{var s,i,n,l;let o={},c=m(e,t),d=null!==(s=c[r.DIM_LONGITUDE])&&void 0!==s?s:{};d.range?(o.lonMin=d.range[0],o.lonMax=d.range[1]):null!=d.coord&&(o.lonMin=o.lonMax=d.coord);let h=null!==(i=c[r.DIM_LATITUDE])&&void 0!==i?i:{};h.range?(o.latMin=h.range[0],o.latMax=h.range[1]):null!=h.coord&&(o.latMin=o.latMax=h.coord);let u=null!==(n=c[r.DIM_TIME])&&void 0!==n?n:{};u.range?(o.timeMin=u.range[0],o.timeMax=u.range[1]):null!=u.coord&&(o.timeMin=o.timeMax=u.coord);let p=null!==(l=c[r.DIM_ELEVATION])&&void 0!==l?l:{};return p.range?(o.elevationMin=p.range[0],o.elevationMax=p.range[1]):null!=p.coord&&(o.elevationMin=o.elevationMax=p.coord),o.variableIds=a,o},k=(e,t)=>null!=(0,h.BQ)(e)[t],M=(e,t,a)=>{var s;let i=(0,h.BQ)(e)[a];if(!i||i.extent[0]===i.extent[1])return!1;let n=null!==(s=e.properties["cube:variables"])&&void 0!==s?s:{};for(let e=0;e<t.length;e++){let s=n[t[e]];if(s&&s.dimensions.includes(a))return!0}return!1},N=e=>{(0,n.notify)({type:"warn",icon:"download",title:e.$t({id:"notif.emptySubset",defaultMessage:"Empty subset"}),msg:e.$t({id:"notif.emptySubsetDetails",defaultMessage:"Try modifying your subset criteria."})})},S=(e,t,a,s)=>{if(r.APP_CONFIG.noChatbot)return I(e,a);let i=a.$t({id:"notif.clickToChat",defaultMessage:"Click on this message to talk to an expert."}),l=e.displayMessage?"".concat(e.displayMessage,". ").concat(i):i;(0,n.notify)({type:"error",icon:"download",title:a.$t({id:"notif.downloadError",defaultMessage:"Error downloading"}),msg:l,onClick:()=>{let a="I'm having problems downloading data. Can you help me?";e.displayMessage&&(a+="\n\nThis error was shown in the console: ".concat(e.displayMessage)),a+="\n\nFor this data request:\n\n",s(a+=JSON.stringify(t,null,2))},timeout:2e4})},I=(e,t)=>{(0,n.notify)({type:"error",icon:"download",title:t.$t({id:"notif.downloadError",defaultMessage:"Error downloading"}),msg:e.displayMessage,timeout:2e4})},A=(e,t)=>{let{locale:a}=t,s=i()(e,{locale:a});(0,n.notify)({type:"success",icon:"download",title:t.$t({id:"notif.downloadComplete",defaultMessage:"Download complete"}),msg:t.$t({id:"notif.denseDownloadSize",defaultMessage:"Downloaded {bytes}"},{bytes:s}),timeout:2e4})},C=(e,t,a)=>{let{locale:s}=a,l=i()(e,{locale:s}),r=t>1e6?"".concat((Math.round(t/1e6*10)/10).toLocaleString(s),"M"):t.toLocaleString(s),o=a.$t({id:"notif.sparseSamples",defaultMessage:"{samples} samples"},{samples:r});(0,n.notify)({type:"success",icon:"download",title:a.$t({id:"notif.downloadComplete",defaultMessage:"Download complete"}),msg:a.$t({id:"notif.sparseDownloadSize",defaultMessage:"Downloaded {bytes} ({samples})"},{bytes:l,samples:o}),timeout:2e4})},D=(e,t,a)=>{var s;return{label:"".concat(e,"/").concat(t.subdatasetId),value:null!==(s=null==a?void 0:a.bytes)&&void 0!==s?s:0}},T=e=>{let{label:t}=e;return(0,d.PJ)({category:"subsetter",action:"downloadSubsetStart",label:t})},L=e=>{let{label:t,value:a}=e;return(0,d.PJ)({category:"subsetter",action:"downloadSubsetSuccess",label:t,value:a})},E=e=>{let{label:t}=e;return(0,d.PJ)({category:"subsetter",action:"downloadSubsetError",label:t})},O=(e,t,a)=>(null==e||(null!=t&&e<t&&(e=t),null!=a&&e>a&&(e=a)),e),P=(e,t,a)=>null==e?e:new Date(O(e.getTime(),t,a)),z=(e,t,a)=>null!=e&&(e<t||e>a),F=(e,t,a,s)=>null!=e&&null!=t&&(e<a&&t<a||e>s&&t>s),U=e=>null!=e?-e:null},25003:(e,t,a)=>{a.d(t,{T:()=>n,X:()=>l});var s=a(20409),i=a(83720);let n=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.ym;try{return(await a.e(8972).then(a.bind(a,28972))).default}catch(t){throw r(e),t}},l=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.ym;try{return await Promise.all([a.e(1068),a.e(624),a.e(4003)]).then(a.bind(a,73654))}catch(t){throw r(e),t}},r=e=>{(0,s.notify)({type:"error",icon:"cloud-arrow-up",title:e.$t({id:"notif.importLibraryError",defaultMessage:"Error loading library"}),msg:e.$t({id:"notif.importLibraryErrorDetail",defaultMessage:"Please check the console"})})}},69328:(e,t,a)=>{a.d(t,{O:()=>d});var s=a(23624),i=a.n(s),n=a(99420),l=a.n(n);let r=[{unit:"hour",step:1,tPeriod:36e5,nextStep:3},{unit:"hour",step:3,tPeriod:108e5,nextStep:6},{unit:"hour",step:6,tPeriod:216e5,nextStep:12},{unit:"hour",step:12,tPeriod:432e5,nextStep:24},{unit:"day",step:1,tPeriod:864e5,minToHighlight:8},{unit:"day",step:2,tPeriod:1728e5,minToHighlight:5},{unit:"week",step:1,tPeriod:6048e5,minToHighlight:5},{unit:"month",step:1,tPeriod:2592e6,nextStep:3},{unit:"month",step:3,tPeriod:78624e5,nextStep:12},{unit:"month",step:6,tPeriod:157248e5,nextStep:12},{unit:"year",step:1,tPeriod:31536e6,nextStep:2},{unit:"year",step:2,tPeriod:63072e6,nextStep:5},{unit:"year",step:5,tPeriod:15768e7,nextStep:10},{unit:"year",step:10,tPeriod:31536e7,nextStep:20},{unit:"year",step:20,tPeriod:63072e7,nextStep:50},{unit:"year",step:50,tPeriod:15768e8,nextStep:100}],o={hour:"hour",day:"date",week:"week",month:"month",year:"year"},c=new(i())({max:20}),d=(e,t,a,s)=>{let i="".concat(e,".").concat(t,".").concat(a),n=c.get(i);if(null!=n)return n;let{tickValues:r}=n={tickValues:{},highlighted:!1},[d,u]=e,[p,x]=t,m=h((u-d)/(Math.abs(x-p)/(s?20:80)));if(!m)return n;let{unit:f,step:b,nextStep:g}=m,j="year"===f,v="month"===f,_="week"===f,y="day"===f,w="hour"===f,k=l().utc(d).startOf(f).subtract(1,f);if(b>1){let e=k[o[f]]();(_||y)&&(e-=1);let t=e%b;t&&k.subtract(t,f)}let M=l().utc(d),N=l().utc(u),S=k.month(),I=!1,A=!1;for(;!k.isAfter(N);){let e=k.month(),t=e!==S;if(S=e,!k.isBefore(M)){let a;let s=k.valueOf(),i=!1;if(j)a="YYYY",I=!0,A=!0,i=k.year()%g==0;else if(v)0!==e&&(I||N.year()!==k.year())?a="MMM":(a=b>1?"YYYY":"MMM YYYY",I=!0),A=!0,i=e%g==0;else if(t)0!==e&&(I||N.year()!==k.year())?a="D MMM":(a="D MMM YYYY",I=!0),A=!0,i=!0;else{let e=w?k.hour():void 0;if(A||N.month()!==k.month()||N.year()!==k.year()?a=w?e>0?"HH:00":"D MMM":"D":(a="D MMM YYYY",I=!0,A=!0),y){let e=k.day();i=1===b?1===e:1===e||2===e}else i=!!w&&e%g==0}let n=k.format(a).replace(".","");r["t".concat(s)]={t:s,label:n,highlighted:i}}k.add(b,f)}let C=Object.keys(r).length,{minToHighlight:D}=m;return null!=D?n.highlighted=C>=D:null!=g?n.highlighted=C>g/b:n.highlighted=!1,c.set(i,n),n},h=e=>{let t,a=1/0;for(let s=0;s<r.length;s++){let i=r[s],{tPeriod:n}=i,l=e>n?e/n:n/e;l<a&&(a=l,t=i)}return t}},75791:(e,t,a)=>{a.d(t,{$:()=>n,k:()=>s});let s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAA0klEQVRYhe2WsQ3CQAxFfdIXO7ACSKzBBlR0VNDDEBmAjo6KCWANpLCOkSVOinJJhGzLae6kNDk/6zlF/KlZLFme5/HcMvOa/jhSJ/WZtfDIL9+3+4qIHsy8Sym1BdU5ci91Uv/j1Dw2h/3H2sTCY3ttXCbR8vD8nBoeXpNoeXg0sfDwaGLh4dHEwhcC0RKDApESowJREpMCERKQxRD57+/zeJ0u4Quoy2OuLZh5eE2i5WseqHmg5oGaBwqBaIlBgUiJUYEoiUmBCImaB+bNA0T0BSu2iVbyU3PaAAAAAElFTkSuQmCC",i={},n=e=>{if(!i[e]){let t=new Image;t.src=s,i[e]=new Promise(e=>{t.onload=e}).then(()=>l(t,16*e,16*e))}return i[e]},l=(e,t,a)=>{let s=document.createElement("canvas");s.width=t,s.height=a;let i=s.getContext("2d");return i.drawImage(e,0,0,e.width,e.height,0,0,t,a),i.createPattern(s,"repeat")}},49872:(e,t,a)=>{a.d(t,{Y:()=>h,h:()=>u});var s=a(51893),i=a(99420),n=a.n(i),l=a(55065),r=a(49608),o=a(70226),c=a(58223),d=a(94631);let h=function(e,t,a){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e||!(0,o.p)(e))return null;let i=p(e);if(!i)return null;let n={useHeuristics:!0,layerId:i.id,allowCoverExceptions:!0},r=(0,d.A)(e,t,a,n),h="".concat(e.id,"/").concat(i.id),u={crs:r.crs,center:(0,c.uY)(r.center),zoom:(0,c.IP)(r.zoom),t:m(i),z:f(i),layers:(0,c.rB)({temp1:{id:"temp1",layerId:h,zIndex:0}}),forceMapView:"1"};if(s.isExternalEmbed&&(u.embed="1"),s.basemap){var x,b;let t=null!==(b=null===(x=e.thumbnailMeta)||void 0===x?void 0:x.basemapId)&&void 0!==b?b:null;t&&(u.basemap=t)}let g=Object.keys(u).filter(e=>null!=u[e]).map(e=>"".concat(e,"=").concat(u[e])).join("&");return"".concat(l.URLS.viewer,"?").concat(g)},u=function(e,t,a){var s;let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e||!(0,o.p)(e))return null;let n=p(e);if(!n)return null;let l={useHeuristics:!0,layerId:n.id,allowCoverExceptions:!0},{crs:r,center:c,zoom:h}=(0,d.A)(e,t,a,l),u="".concat(e.id,"/").concat(n.id),x={isExternalEmbed:i.isExternalEmbed,crs:r,center:c,zoom:h,time:m(n),elevation:f(n),mapLayers:{temp1:{id:"temp1",layerId:u,zIndex:0}}};return i.basemap&&(x.basemap=null===(s=e.thumbnailMeta)||void 0===s?void 0:s.basemapId),x},p=e=>{var t,a;let i;if(!e||!(0,o.p)(e))return null;let{layers:n}=e;if(!n)return null;let l=null!==(a=null===(t=e.thumbnailMeta)||void 0===t?void 0:t.layerId)&&void 0!==a?a:null;if(null==(i=x(e,l))?void 0:i.isViewable)return i;let c=(0,r.jk)(n);if(l){let{subdatasetId:e,variableId:t}=(0,r.ei)(l),a=(0,s.getTaglessSubdatasetId)(e);if((null==(i=c.find(e=>e.variableId===t&&(0,s.getTaglessSubdatasetId)(e.subdatasetId)===a))?void 0:i.isViewable)||(null==(i=c.find(e=>e.variableId===t))?void 0:i.isViewable))return i}{let t=(0,r.FA)(e.id);if(null==(i=x(e,t))?void 0:i.isViewable)return i}let d=(0,r.jk)(n).filter(e=>e.isViewable);return(0===d.length&&(d=(0,r.jk)(n)),0===d.length)?null:d[0]},x=(e,t)=>{var a,s;if(!t)return null;let{subdatasetId:i,variableId:n}=(0,r.ei)(t),l="".concat(i,"/").concat(n);return null!==(s=null==e?void 0:null===(a=e.layers)||void 0===a?void 0:a[l])&&void 0!==s?s:null},m=e=>{let t,a;let{tValues:s}=e;if(!s)return;Array.isArray(s)?(t=s[0],a=s[s.length-1]):(t=s.tMin,a=s.tMax);let i=n().utc(a).startOf("day");e.hasSqlite?i.subtract(2,"day"):i.subtract(1,"day");let l=i.valueOf();return l<t&&(l=t),l},f=e=>{let{zValues:t}=e;if(t)return 0}},1216:(e,t,a)=>{a.d(t,{Iz:()=>c,ON:()=>s,bF:()=>o,dp:()=>n,mV:()=>d,nG:()=>r,uk:()=>i});let s=e=>[{value:"equal",label:"="},{value:"different",label:"≠"},{value:"gte",label:"≥"},{value:"lte",label:"≤"},{value:"between",label:"∈"},{value:"outside",label:"∉"}],i=e=>{if(null==e)return[];switch(e.type){case"equal":return[[e.max,e.max]];case"different":return[[-1/0,e.max],[e.max,Infinity]];case"gte":return[[e.max,Infinity]];case"lte":return[[-1/0,e.min]];case"between":return[[e.min,e.max]];case"outside":return[[-1/0,e.min],[e.max,Infinity]];default:return[]}},n=function(e,t,a,s){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],n=a[0]<a[1]?a[0]:a[1],r=a[0]<a[1]?a[1]:a[0],[o,c]=e,d=o===-1/0?i?r:n:t(o),h=Infinity===c?i?n:r:t(c);if(d<n&&h<n)return[n,n];if(d>r&&h>r)return[r,r];d=l(d,n,r);let u=i?-1:1;return(h=l(h,n,r))===d?(d-=4*u,h+=4*u):s&&(e[0]===-1/0?h-=4*u:Infinity===e[1]&&(d+=4*u)),i?[h,d]:[d,h]},l=(e,t,a)=>Math.max(t,Math.min(a,e)),r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!e)return"";let{type:a}=e;return"equal"===a?"=".concat(t).concat(e.max):"different"===a?"≠".concat(t).concat(e.max):"gte"===a?"≥".concat(t).concat(e.max):"lte"===a?"≤".concat(t).concat(e.min):"between"===a?"∈".concat(t,"[").concat(e.min,",").concat(t).concat(e.max,"]"):"outside"===a?"∉".concat(t,"[").concat(e.min,",").concat(t).concat(e.max,"]"):""},o=(e,t)=>{if(null==e)return!1;let{type:a}=e;return"equal"===a?t==e.max:"different"===a?t!=e.max:"gte"===a?t>=e.max:"lte"===a?t<=e.min:"between"===a?t>=e.min&&t<=e.max:"outside"===a&&(t<=e.min||t>=e.max)},c=e=>!!e&&("lte"===e.type||"between"===e.type||"outside"===e.type),d=e=>!!e&&("equal"===e.type||"different"===e.type||"gte"===e.type||"between"===e.type||"outside"===e.type)}}]);